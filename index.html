<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบแผนที่โรงเรียนอัจฉริยะ (ปรับปรุงแล้ว v4)</title>
    
    <!-- External Libraries - ไลบรารีจากภายนอก -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <style id="dynamicStyles">
        /* =================== CSS Variables for Theming - ตัวแปรสีธีม =================== */
        :root {
            --primary-color: #667eea;      /* สีหลัก - น้ำเงิน */
            --secondary-color: #764ba2;    /* สีรอง - ม่วง */
            --accent-color: #28a745;       /* สีเน้น - เขียว */
            --danger-color: #dc3545;       /* สีแจ้งเตือน - แดง */
            --warning-color: #ffc107;      /* สีเตือน - เหลือง */
            --info-color: #17a2b8;         /* สีข้อมูล - ฟ้า */
            
            --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* ไล่สีพื้นหลัง */
            --card-background: #ffffff;    /* พื้นหลังการ์ด - ขาว */
            --text-primary: #333333;       /* สีข้อความหลัก - เทาเข้ม */
            --text-secondary: #666666;     /* สีข้อความรอง - เทาอ่อน */
            --border-color: #e0e6ff;       /* สีเส้นขอบ - ฟ้าอ่อน */
            
            --border-radius: 15px;         /* มุมโค้ง - 15px */
            --box-shadow: 0 8px 25px rgba(0,0,0,0.1);  /* เงา - เทาอ่อน */
            --transition: all 0.3s ease;  /* ภาพเคลื่อนไหว - 0.3วินาที */
        }

        /* Apple Liquid Glass Theme */
        [data-theme="apple"] {
            --primary-color: #007AFF;
            --secondary-color: #5856D6;
            --accent-color: #34C759;
            --danger-color: #FF3B30;
            --warning-color: #FF9500;
            --info-color: #5AC8FA;
            --background-gradient: linear-gradient(135deg, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0.1) 100%);
            --card-background: rgba(255,255,255,0.85);
            --border-radius: 20px;
            --box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        /* TailwindCSS Theme */
        [data-theme="tailwind"] {
            --primary-color: #3B82F6;
            --secondary-color: #8B5CF6;
            --accent-color: #10B981;
            --danger-color: #EF4444;
            --warning-color: #F59E0B;
            --info-color: #06B6D4;
            --background-gradient: linear-gradient(135deg, #F3F4F6 0%, #E5E7EB 100%);
            --card-background: #FFFFFF;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --border-color: #D1D5DB;
            --border-radius: 8px;
            --box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* =================== Base Styles - สไตล์พื้นฐาน =================== */
        * {
            margin: 0;                     /* ไม่มีระยะขอบ - รีเซ็ต margin */
            padding: 0;                    /* ไม่มีระยะห่าง - รีเซ็ต padding */
            box-sizing: border-box;        /* นับขนาดรวมเส้นขอบ - รวม border+padding */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  /* ฟอนต์ - ฟอนต์หลัก */
            background: var(--background-gradient);  /* พื้นหลังไล่สี - ใช้ตัวแปร */
            min-height: 100vh;             /* ความสูงขั้นต่ำเต็มหน้าจอ - 100% viewport */
            color: var(--text-primary);    /* สีข้อความ - ใช้ตัวแปร */
            overflow-x: hidden;            /* ซ่อนแถบเลื่อนแนวนอน - ป้องกันเลื่อนซ้าย-ขวา */
            transition: var(--transition);
        }

        [data-theme="apple"] body {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .container {
            max-width: 100%;               /* ความกว้างสูงสุด - เต็มหน้าจอ */
            margin: 0 auto;                /* จัดตรงกลาง - margin ซ้าย-ขวา auto */
            padding: 10px;                 /* ระยะห่างภายใน - 10px ทุกด้าน */
        }

        /* =================== Enhanced Top Controls Bar - แถบควบคุมด้านบนปรับปรุงแล้ว =================== */
        .top-controls {
            position: fixed;               /* ตำแหน่งแน่นอน - ติดด้านบน */
            top: 15px;                     /* ห่างจากด้านบน - 15px */
            right: 15px;                   /* ห่างจากด้านขวา - 15px */
            z-index: 1000;                 /* ลำดับชั้น - อยู่บนสุด */
            display: flex;                 /* แสดงแบบแถว - ใช้ flexbox */
            gap: 10px;                     /* ระยะห่างระหว่างปุ่ม - 10px */
            align-items: center;           /* จัดกลางแนวตั้ง - center alignment */
        }

        /* Enhanced Control Button - ปุ่มควบคุมที่ปรับปรุงแล้ว */
        .control-button {
            background: var(--card-background);
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--primary-color);
            min-width: 120px;
            justify-content: center;
        }

        .control-button:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.15);
        }

        .control-button.active {
            background: var(--primary-color);
            color: white;
        }

        .control-button i {
            font-size: 16px;
        }

        /* Language Button */
        .language-button {
            background: linear-gradient(135deg, var(--info-color), var(--primary-color));
            color: white;
            border: none;
        }

        .language-button:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--info-color));
        }

        /* Admin Button */
        .admin-button {
            background: linear-gradient(135deg, var(--danger-color), var(--warning-color));
            color: white;
            border: none;
        }

        .admin-button.logged-in {
            background: linear-gradient(135deg, #6c757d, #495057);
        }

        .admin-button:hover {
            background: linear-gradient(135deg, var(--warning-color), var(--danger-color));
        }

        /* =================== Header Styles - สไตล์ส่วนหัว =================== */
        .header {
            background: var(--card-background);  /* พื้นหลัง - ขาว */
            padding: 20px;                 /* ระยะห่างภายใน - 20px ทุกด้าน */
            border-radius: var(--border-radius);  /* มุมโค้ง - ใช้ตัวแปร */
            box-shadow: var(--box-shadow);  /* เงา - ใช้ตัวแปร */
            margin: 80px 0 20px 0;         /* ระยะห่าง - 80px บน, 0 ซ้าย-ขวา, 20px ล่าง */
            text-align: center;            /* จัดข้อความตรงกลาง - center */
            position: relative;            /* ตำแหน่งสัมพัทธ์ - relative positioning */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .header.admin-mode {
            margin-top: 80px;             /* ระยะห่างด้านบนในโหมดแอดมิน - 80px */
        }

        .school-logo {
            width: 60px;                   /* ความกว้างโลโก้ - 60px */
            height: 60px;                  /* ความสูงโลโก้ - 60px */
            border-radius: 50%;            /* ทำให้เป็นวงกลม - 50% radius */
            margin-bottom: 15px;           /* ระยะห่างด้านล่าง - 15px */
            object-fit: cover;             /* ปรับขนาดรูปภาพ - cover fit */
            border: 3px solid var(--primary-color);
        }

        .header h1 {
            color: var(--text-primary);    /* สีข้อความ - สีหลัก */
            margin-bottom: 10px;            /* ระยะห่างด้านล่าง - 10px */
            font-size: 1.6em;              /* ขนาดตัวอักษร - 1.6 เท่า */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));  /* ไล่สี - จากสีหลักไปสีรอง */
            -webkit-background-clip: text; /* ใช้ไล่สีกับข้อความ - WebKit */
            -webkit-text-fill-color: transparent;  /* ทำให้ข้อความโปร่งใส - แสดงไล่สี */
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);  /* สีข้อความรอง - เทาอ่อน */
            font-size: 1em;              /* ขนาดตัวอักษร - 1em */
        }

        /* =================== Navigation Tabs - แท็บเมนู =================== */
        .nav-tabs {
            display: flex;                 /* แสดงแบบแถว - flexbox */
            gap: 10px;                      /* ระยะห่างระหว่างแท็บ - 10px */
            justify-content: center;       /* จัดตรงกลาง - center justify */
            margin-top: 20px;              /* ระยะห่างด้านบน - 20px */
            flex-wrap: wrap;               /* ให้แท็บขึ้นบรรทัดใหม่ได้ - wrap */
        }

        .nav-tabs.hidden {
            display: none;                 /* ซ่อนแท็บเมื่อมีคลาส hidden */
        }

        .nav-tab {
            flex: 1;                       /* ขยายเต็มพื้นที่ - flex grow */
            min-width: 100px;               /* ความกว้างขั้นต่ำ - 100px */
            padding: 15px 12px;             /* ระยะห่างในปุ่ม - 15px บน-ล่าง, 12px ซ้าย-ขวา */
            background: rgba(255,255,255,0.8);           /* พื้นหลัง - ฟ้าอ่อน */
            border: 2px solid var(--border-color);                  /* ไม่มีเส้นขอบ - no border */
            border-radius: var(--border-radius);           /* มุมโค้ง - วงรี */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            font-weight: 600;              /* ความหนาตัวอักษร - bold */
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
            color: var(--text-primary);    /* สีตัวอักษร - สีหลัก */
            text-align: center;            /* จัดข้อความตรงกลาง - center */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));  /* พื้นหลังเมื่อเลือก - ไล่สี */
            color: white;                  /* สีตัวอักษรเมื่อเลือก - ขาว */
            transform: translateY(-3px);   /* เลื่อนขึ้น - 3px */
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);  /* เงา - น้ำเงินใส */
            border-color: var(--primary-color);
        }

        .nav-tab i {
            display: block;                /* แสดงเป็นบล็อก - block display */
            font-size: 18px;               /* ขนาดไอคอน - 18px */
            margin-bottom: 8px;            /* ระยะห่างด้านล่าง - 8px */
        }

        /* =================== Page Styles - สไตล์หน้า =================== */
        .page {
            display: none;                 /* ซ่อนหน้า - hidden by default */
            background: var(--card-background);  /* พื้นหลัง - ขาว */
            border-radius: var(--border-radius);  /* มุมโค้ง - ใช้ตัวแปร */
            padding: 20px;                 /* ระยะห่างภายใน - 20px ทุกด้าน */
            box-shadow: var(--box-shadow);  /* เงา - ใช้ตัวแปร */
            min-height: 70vh;              /* ความสูงขั้นต่ำ - 70% viewport */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .page.active {
            display: block;                /* แสดงหน้าที่เลือก - show active page */
            animation: fadeInUp 0.5s ease-out;  /* ภาพเคลื่อนไหวเฟดอิน - fade in animation */
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }  /* จากโปร่งใสและเลื่อนลง - start state */
            to { opacity: 1; transform: translateY(0); }       /* เป็นทึบและตำแหน่งปกติ - end state */
        }

        /* =================== Enhanced Search - ค้นหาปรับปรุงแล้ว =================== */
        .search-container {
            background: linear-gradient(135deg, #f8f9ff, #e6f3ff);  /* พื้นหลังไล่สี - ฟ้าอ่อน */
            padding: 20px;                 /* ระยะห่างภายใน - 20px ทุกด้าน */
            border-radius: var(--border-radius);  /* มุมโค้ง - ใช้ตัวแปร */
            margin-bottom: 20px;           /* ระยะห่างด้านล่าง - 20px */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .search-box {
            display: flex;                 /* แสดงแบบแถว - flexbox */
            gap: 12px;                     /* ระยะห่างระหว่างองค์ประกอบ - 12px */
            margin-bottom: 20px;           /* ระยะห่างด้านล่าง - 20px */
        }

        .search-input {
            flex: 1;                       /* ขยายเต็มพื้นที่ - flex grow */
            padding: 15px 20px;            /* ระยะห่างภายใน - 15px บน-ล่าง, 20px ซ้าย-ขวา */
            border: 2px solid #ddd;        /* เส้นขอบ - เทาอ่อน 2px */
            border-radius: var(--border-radius);           /* มุมโค้ง - วงรี */
            font-size: 16px;               /* ขนาดตัวอักษร - 16px */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.9);
        }

        .search-input:focus {
            outline: none;                 /* ไม่มีกรอบเมื่อโฟกัส - no outline */
            border-color: var(--primary-color);  /* สีเส้นขอบเมื่อโฟกัส - สีหลัก */
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);  /* เงาเมื่อโฟกัส - น้ำเงินใส */
            background: white;
        }

        .search-btn {
            padding: 15px 25px;            /* ระยะห่างในปุ่ม - 15px บน-ล่าง, 25px ซ้าย-ขวา */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));  /* พื้นหลังไล่สี - สีหลักไปสีรอง */
            color: white;                  /* สีตัวอักษร - ขาว */
            border: none;                  /* ไม่มีเส้นขอบ - no border */
            border-radius: var(--border-radius);           /* มุมโค้ง - วงรี */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            font-weight: 600;              /* ความหนาตัวอักษร - bold */
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            white-space: nowrap;           /* ไม่ให้ขึ้นบรรทัดใหม่ - no wrap */
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        /* Quick Categories - หมวดหมู่ด่วน สำหรับมือถือ */
        .quick-categories {
            display: grid;                 /* แสดงแบบกริด - CSS Grid */
            grid-template-columns: repeat(2, 1fr);  /* 2 คอลัมน์เท่ากัน - 2 equal columns */
            gap: 15px;                     /* ระยะห่างระหว่างการ์ด - 15px */
            margin-top: 20px;              /* ระยะห่างด้านบน - 20px */
        }

        .category-card {
            background: var(--card-background);  /* พื้นหลังไล่สี - ฟ้าอ่อน */
            padding: 20px;                 /* ระยะห่างภายใน - 20px ทุกด้าน */
            border-radius: var(--border-radius);  /* มุมโค้ง - ใช้ตัวแปร */
            text-align: center;            /* จัดข้อความตรงกลาง - center */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            border: 2px solid var(--border-color);  /* เส้นขอบ - สีขอบใช้ตัวแปร */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .category-card:hover, .category-card:active {
            transform: translateY(-5px);   /* เลื่อนขึ้นเมื่อวางเมาส์ - 5px */
            box-shadow: var(--box-shadow);  /* เงา - ใช้ตัวแปร */
            border-color: var(--primary-color);
        }

        .category-card i {
            font-size: 32px;               /* ขนาดไอคอน - 32px */
            color: var(--primary-color);   /* สีไอคอน - สีหลัก */
            margin-bottom: 12px;            /* ระยะห่างด้านล่าง - 12px */
        }

        .category-card h4 {
            color: var(--primary-color);   /* สีหัวข้อ - สีหลัก */
            margin-bottom: 8px;            /* ระยะห่างด้านล่าง - 8px */
            font-size: 16px;               /* ขนาดตัวอักษร - 16px */
        }

        .category-card p {
            color: var(--text-secondary);  /* สีข้อความรอง - เทาอ่อน */
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
        }

        /* =================== Enhanced Room List for 100+ Rooms - รายการห้องปรับปรุงสำหรับ 100+ ห้อง =================== */
        .room-management-container {
            max-height: 70vh;
            overflow-y: auto;
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 15px;
            margin: 15px 0;
        }

        .room-filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .room-filter-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
        }

        .room-filter-select {
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            background: white;
            font-size: 14px;
            min-width: 120px;
        }

        .room-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .room-card {
            background: var(--card-background);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 15px;
            transition: var(--transition);
            position: relative;
        }

        .room-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        .room-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .room-card-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 5px;
        }

        .room-card-code {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .room-card-info {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .room-card-actions {
            display: flex;
            gap: 5px;
        }

        .room-card-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: var(--transition);
        }

        .room-card-btn.edit {
            background: var(--info-color);
            color: white;
        }

        .room-card-btn.delete {
            background: var(--danger-color);
            color: white;
        }

        .room-card-btn.view {
            background: var(--accent-color);
            color: white;
        }

        /* Status Badge */
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .status-badge.active {
            background: var(--accent-color);
        }

        .status-badge.inactive {
            background: var(--text-secondary);
        }

        /* =================== Building Management Enhanced - จัดการอาคารปรับปรุงแล้ว =================== */
        .building-manager {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 15px 0;
        }

        .building-list {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .building-item {
            background: rgba(255,255,255,0.7);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .building-item:hover {
            border-color: var(--primary-color);
            background: white;
        }

        .building-info h4 {
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .building-info p {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .building-actions {
            display: flex;
            gap: 5px;
        }

        .building-form {
            background: linear-gradient(135deg, #f8f9ff, #e6f3ff);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        /* =================== Theme Customization - การปรับแต่งธีม =================== */
        .theme-customizer {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 15px 0;
        }

        .theme-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .theme-option {
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-option.active {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .theme-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .color-customizer {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .color-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .color-input-group label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .color-input {
            width: 100%;
            height: 40px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
        }

        /* =================== Content Editor - เครื่องมือแก้ไขเนื้อหา =================== */
        .content-editor {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 15px 0;
        }

        .content-group {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .content-group-header {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .content-group-body {
            padding: 20px;
            display: none;
        }

        .content-group-body.expanded {
            display: block;
        }

        .content-item {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .content-item label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .content-item input,
        .content-item textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
        }

        .content-item textarea {
            min-height: 60px;
            resize: vertical;
        }

        /* =================== Mobile Map Layout - แผนที่สำหรับมือถือ =================== */
        .map-container {
            display: flex;                 /* แสดงแบบแถว - flexbox */
            flex-direction: column;        /* จัดแนวตั้ง - vertical layout */
            gap: 20px;                     /* ระยะห่างระหว่างองค์ประกอบ - 20px */
            margin-top: 20px;              /* ระยะห่างด้านบน - 20px */
            position: relative;            /* ตำแหน่งสัมพัทธ์ - relative positioning */
        }

        .map-area {
            background: #f8f9ff;           /* พื้นหลัง - ฟ้าอ่อน */
            border: 3px solid var(--primary-color);  /* เส้นขอบ - สีหลัก 3px */
            border-radius: var(--border-radius);  /* มุมโค้ง - ใช้ตัวแปร */
            position: relative;            /* ตำแหน่งสัมพัทธ์ - relative positioning */
            height: 400px;                 /* ความสูง - 400px */
            overflow: hidden;              /* ซ่อนส่วนเกิน - hide overflow */
        }

        .map-area.fullscreen {
            position: fixed;               /* ตำแหน่งคงที่ - fixed positioning */
            top: 0; left: 0; right: 0; bottom: 0; /* เต็มหน้าจอ - full screen */
            z-index: 2000;                 /* ลำดับชั้นสูง - high z-index */
            height: 100vh;                 /* ความสูงเต็มหน้าจอ - full viewport height */
            border-radius: 0;              /* ไม่มีมุมโค้ง - no border radius */
        }

        /* Map Controls - ปุ่มควบคุมแผนที่ */
        .map-controls {
            position: absolute;            /* ตำแหน่งแน่นอน - absolute positioning */
            top: 15px;                     /* ห่างจากด้านบน - 15px */
            left: 15px;                    /* ห่างจากด้านซ้าย - 15px */
            display: flex;                 /* แสดงแบบแถว - flexbox */
            gap: 8px;                      /* ระยะห่างระหว่างปุ่ม - 8px */
            z-index: 100;                  /* ลำดับชั้น - z-index 100 */
            flex-wrap: wrap;               /* ให้ปุ่มขึ้นบรรทัดใหม่ได้ - wrap */
        }

        .map-control-btn {
            padding: 8px 15px;             /* ระยะห่างในปุ่ม - 8px บน-ล่าง, 15px ซ้าย-ขวา */
            background: rgba(255,255,255,0.95); /* พื้นหลังโปร่งใส - ขาวใส 95% */
            border: 2px solid var(--primary-color); /* เส้นขอบ - สีหลัก 2px */
            border-radius: var(--border-radius);           /* มุมโค้ง - วงรี */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            font-size: 12px;               /* ขนาดตัวอักษร - 12px */
            font-weight: 600;              /* ความหนาตัวอักษร - bold */
            color: var(--primary-color);   /* สีตัวอักษร - สีหลัก */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .map-control-btn.active {
            background: var(--primary-color); /* พื้นหลังเมื่อเลือก - สีหลัก */
            color: white;                  /* สีตัวอักษรเมื่อเลือก - ขาว */
        }

        .map-control-btn:hover {
            transform: translateY(-2px);   /* เลื่อนขึ้นเมื่อวางเมาส์ - 2px */
            box-shadow: 0 8px 20px rgba(0,0,0,0.2); /* เงาเมื่อวางเมาส์ - เทาใส */
        }

        .map-image {
            width: 100%;                   /* ความกว้างเต็ม - 100% */
            height: 100%;                  /* ความสูงเต็ม - 100% */
            object-fit: cover;             /* ปรับขนาดรูปภาพ - cover fit */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
        }

        /* Room Markers - จุดมาร์กเกอร์ห้อง */
        .room-marker {
            position: absolute;            /* ตำแหน่งแน่นอน - absolute positioning */
            width: 35px;                   /* ความกว้าง - 35px */
            height: 35px;                  /* ความสูง - 35px */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* พื้นหลังไล่สี - สีหลักไปสีรอง */
            border-radius: 50%;            /* ทำให้เป็นวงกลม - circle */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            display: flex;                 /* แสดงแบบ flex - flexbox */
            align-items: center;           /* จัดกลางแนวตั้ง - vertical center */
            justify-content: center;       /* จัดกลางแนวนอน - horizontal center */
            color: white;                  /* สีตัวอักษรขาว - white text */
            font-weight: bold;             /* ตัวอักษรหนา - bold font */
            font-size: 16px;               /* ขนาดตัวอักษร - 16px */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            border: 3px solid white;       /* เส้นขอบขาว - white border 3px */
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); /* เงา - เทาใส */
            z-index: 30;                   /* ลำดับชั้น - z-index 30 */
            transform: translate(-50%, -50%); /* จัดกลางมาร์กเกอร์ - center marker */
        }

        .room-marker:hover, .room-marker:active {
            transform: translate(-50%, -50%) scale(1.3); /* ขยายใหญ่เมื่อวางเมาส์ - scale 1.3 */
            z-index: 100;                  /* ลำดับชั้นสูง - high z-index */
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }

        .room-marker.highlighted {
            background: var(--danger-color); /* พื้นหลังสีแดงเมื่อไฮไลต์ - red background */
            animation: pulse 2s infinite;  /* ภาพเคลื่อนไหวกระพริบ - pulse animation */
            transform: translate(-50%, -50%) scale(1.3); /* ขยายใหญ่ - scale 1.3 */
        }

        .entrance-marker {
            background: var(--accent-color); /* พื้นหลังสีเขียว - green background */
            width: 40px;                   /* ความกว้างใหญ่กว่า - 40px */
            height: 40px;                  /* ความสูงใหญ่กว่า - 40px */
            font-size: 18px;               /* ขนาดตัวอักษรใหญ่กว่า - 18px */
            animation: entrancePulse 3s infinite; /* ภาพเคลื่อนไหวพิเศษ - special pulse */
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }     /* เริ่มต้นและจบด้วยความทึบ 80% - start/end opacity */
            50% { opacity: 1; }            /* กลางเป็นทึบเต็ม - middle full opacity */
        }

        @keyframes entrancePulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1); /* ขนาดปกติ - normal scale */
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); /* เงาแบบไม่มี - no shadow */
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.2); /* ขยายใหญ่ - scale up */
                box-shadow: 0 0 0 15px rgba(40, 167, 69, 0); /* เงาแบบกระจาย - spread shadow */
            }
        }

        /* =================== Enhanced Room Info Overlay - แผงข้อมูลห้องปรับปรุงแล้ว =================== */
        .room-info-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1500;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .room-info-content {
            background: var(--card-background);
            border-radius: var(--border-radius);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .room-info-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            position: relative;
        }

        .room-info-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .room-info-close:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .room-info-body {
            padding: 25px;
        }

        /* =================== Admin Styles Enhanced - สไตล์แอดมินปรับปรุงแล้ว =================== */
        .admin-page {
            padding: 15px;                 /* ระยะห่างภายใน - 15px all sides */
            max-height: calc(100vh - 140px); /* ความสูงสูงสุด - viewport based */
            overflow-y: auto;              /* เลื่อนแนวตั้งได้ - vertical scroll */
        }

        .admin-section {
            background: var(--card-background);             /* พื้นหลังขาว - white background */
            border-radius: var(--border-radius);           /* มุมโค้ง - 15px radius */
            margin-bottom: 20px;           /* ระยะห่างด้านล่าง - 20px */
            box-shadow: var(--box-shadow); /* เงา - shadow */
            overflow: hidden;              /* ซ่อนส่วนเกิน - hide overflow */
            border: 2px solid var(--border-color);
        }

        .admin-section-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* พื้นหลังไล่สี - gradient */
            color: white;                  /* สีตัวอักษรขาว - white text */
            padding: 20px;                 /* ระยะห่างภายใน - 20px */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            display: flex;                 /* แสดงแบบ flex - flexbox */
            justify-content: space-between; /* จัดระหว่างสองข้าง - space between */
            align-items: center;           /* จัดกลางแนวตั้ง - vertical center */
            font-weight: 600;              /* ความหนาตัวอักษร - bold */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
        }

        .admin-section-header:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color)); /* เปลี่ยนไล่สีเมื่อวางเมาส์ - reverse gradient */
        }

        .admin-section-header h3 {
            margin: 0;                     /* ไม่มีระยะขอบ - no margin */
            font-size: 18px;               /* ขนาดตัวอักษร - 18px */
        }

        .admin-section-content {
            padding: 0;                    /* ไม่มีระยะห่างภายใน - no padding */
            max-height: 0;                 /* ความสูงเริ่มต้นเป็น 0 - start height 0 */
            overflow: hidden;              /* ซ่อนส่วนเกิน - hide overflow */
            transition: all 0.4s ease;     /* ภาพเคลื่อนไหวทั้งหมด - all transitions */
        }

        .admin-section-content.expanded {
            max-height: 2000px;            /* ความสูงสูงสุดเมื่อขยาย - max height when expanded */
            padding: 25px;                 /* ระยะห่างภายในเมื่อขยาย - padding when expanded */
        }

        .chevron-icon {
            transition: transform 0.4s ease; /* ภาพเคลื่อนไหวหมุน - rotation transition */
            font-size: 16px;
        }

        .admin-section-header.expanded .chevron-icon {
            transform: rotate(180deg);     /* หมุน 180 องศา - rotate 180 degrees */
        }

        /* =================== Enhanced Mobile Form Styles - ฟอร์มมือถือปรับปรุงแล้ว =================== */
        .mobile-form {
            display: grid;                 /* แสดงแบบกริด - CSS Grid */
            gap: 20px;                     /* ระยะห่างระหว่างช่อง - 20px gap */
        }

        .form-group {
            display: flex;                 /* แสดงแบบ flex - flexbox */
            flex-direction: column;        /* จัดแนวตั้ง - vertical layout */
            gap: 10px;                      /* ระยะห่างระหว่างองค์ประกอบ - 10px gap */
        }

        .form-group label {
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
            font-weight: 600;              /* ความหนาตัวอักษร - bold */
            color: var(--text-primary);    /* สีข้อความหลัก - primary text color */
        }

        .form-group input, 
        .form-group textarea, 
        .form-group select {
            padding: 15px;                 /* ระยะห่างภายใน - 15px all sides */
            border: 2px solid var(--border-color);        /* เส้นขอบ - gray border 2px */
            border-radius: var(--border-radius);           /* มุมโค้ง - 10px radius */
            font-size: 16px;               /* ขนาดตัวอักษร - 16px */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            background: white;             /* พื้นหลังขาว - white background */
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;                 /* ไม่มีกรอบเมื่อโฟกัส - no outline */
            border-color: var(--primary-color); /* สีเส้นขอบเมื่อโฟกัส - primary color border */
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); /* เงาเมื่อโฟกัส - focus shadow */
        }

        /* Enhanced Button Grid - กริดปุ่มปรับปรุงแล้ว */
        .button-grid {
            display: grid;                 /* แสดงแบบกริด - CSS Grid */
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* คอลัมน์ยืดหยุ่น - flexible columns */
            gap: 12px;                     /* ระยะห่างระหว่างปุ่ม - 12px gap */
            margin-top: 20px;              /* ระยะห่างด้านบน - 20px top margin */
        }

        .btn {
            padding: 15px;                 /* ระยะห่างภายใน - 15px all sides */
            border: none;                  /* ไม่มีเส้นขอบ - no border */
            border-radius: var(--border-radius);           /* มุมโค้ง - วงรี */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
            font-weight: 600;              /* ความหนาตัวอักษร - bold */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            text-align: center;            /* จัดข้อความตรงกลาง - center text */
            min-height: 50px;              /* ความสูงขั้นต่ำ - 50px min height */
            display: flex;                 /* แสดงแบบ flex - flexbox */
            align-items: center;           /* จัดกลางแนวตั้ง - vertical center */
            justify-content: center;       /* จัดกลางแนวนอน - horizontal center */
        }

        .btn:active {
            transform: scale(0.96);        /* ย่อขนาดเมื่อกด - scale down when pressed */
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .btn-primary { background: var(--primary-color); color: white; } /* ปุ่มหลัก - primary button */
        .btn-success { background: var(--accent-color); color: white; }  /* ปุ่มสำเร็จ - success button */
        .btn-danger { background: var(--danger-color); color: white; }   /* ปุ่มอันตราย - danger button */
        .btn-warning { background: var(--warning-color); color: #333; }  /* ปุ่มเตือน - warning button */
        .btn-info { background: var(--info-color); color: white; }       /* ปุ่มข้อมูล - info button */

        /* =================== Responsive Design - การออกแบบตอบสนอง =================== */
        @media (min-width: 768px) {
            .container {
                max-width: 1200px;          /* ความกว้างสูงสุดบนหน้าจอใหญ่ - max width on large screen */
                padding: 25px;             /* ระยะห่างภายใน - 25px */
            }
            
            .map-container {
                flex-direction: row;       /* จัดแนวนอนบนหน้าจอใหญ่ - horizontal on large screen */
            }
            
            .map-area {
                flex: 2;                   /* ขยายเป็น 2 ส่วน - flex grow 2 */
                height: 500px;             /* ความสูง - 500px */
            }
            
            .quick-categories {
                grid-template-columns: repeat(4, 1fr); /* 4 คอลัมน์บนหน้าจอใหญ่ - 4 columns on large screen */
            }

            .button-grid {
                grid-template-columns: repeat(3, 1fr); /* 3 คอลัมน์บนหน้าจอใหญ่ - 3 columns on large screen */
            }

            .room-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
        }

        /* =================== Notification Enhanced - การแจ้งเตือนปรับปรุงแล้ว =================== */
        .notification {
            position: fixed;               /* ตำแหน่งคงที่ - fixed positioning */
            top: 90px;                     /* ห่างจากด้านบน - 90px from top */
            right: 20px;                   /* ห่างจากด้านขวา - 20px from right */
            padding: 15px 25px;            /* ระยะห่างภายใน - 15px vertical, 25px horizontal */
            background: var(--accent-color); /* พื้นหลังสีเขียว - green background */
            color: white;                  /* สีตัวอักษรขาว - white text */
            border-radius: var(--border-radius);           /* มุมโค้ง - วงรี */
            box-shadow: var(--box-shadow);  /* เงา - shadow */
            opacity: 0;                    /* โปร่งใส - transparent */
            transform: translateX(350px);   /* เลื่อนออกนอกหน้าจอ - slide off screen */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            z-index: 3000;                 /* ลำดับชั้นสูง - high z-index */
            max-width: 320px;              /* ความกว้างสูงสุด - max width 320px */
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
            font-weight: 500;              /* ความหนาตัวอักษร - medium weight */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .notification.show {
            opacity: 1;                    /* ทึบเมื่อแสดง - opaque when shown */
            transform: translateX(0);       /* กลับมาตำแหน่งปกติ - return to normal position */
        }

        .notification.error { background: var(--danger-color); }     /* พื้นหลังแดงสำหรับข้อผิดพลาด - red for error */
        .notification.warning { background: var(--warning-color); color: #333; } /* พื้นหลังเหลืองสำหรับคำเตือน - yellow for warning */
        .notification.info { background: var(--info-color); }        /* พื้นหลังฟ้าสำหรับข้อมูล - blue for info */

        /* =================== Hidden Elements - องค์ประกอบที่ซ่อน =================== */
        .hidden {
            display: none !important;      /* ซ่อนโดยสมบูรณ์ - completely hidden */
        }

        /* =================== Loading States - สถานะกำลังโหลด =================== */
        .loading {
            display: inline-block;         /* แสดงในบรรทัด - inline block */
            width: 20px;                   /* ความกว้าง - 20px */
            height: 20px;                  /* ความสูง - 20px */
            border: 3px solid #f3f3f3;     /* เส้นขอบ - light gray border */
            border-top: 3px solid var(--primary-color); /* เส้นขอบด้านบน - primary color top border */
            border-radius: 50%;            /* ทำให้เป็นวงกลม - circle */
            animation: spin 1s linear infinite; /* ภาพเคลื่อนไหวหมุน - spin animation */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }    /* เริ่มต้น 0 องศา - start 0 degrees */
            100% { transform: rotate(360deg); } /* จบที่ 360 องศา - end 360 degrees */
        }

        /* Compact Info - ข้อมูลแบบกะทัดรัด */
        .compact-info {
            display: grid;                 /* แสดงแบบกริด - CSS Grid */
            grid-template-columns: 1fr 1fr; /* 2 คอลัมน์เท่ากัน - 2 equal columns */
            gap: 15px;                     /* ระยะห่างระหว่างช่อง - 15px gap */
            margin-bottom: 20px;           /* ระยะห่างด้านล่าง - 20px */
        }

        .info-item {
            background: rgba(255,255,255,0.8);             /* พื้นหลังขาว - white background */
            padding: 15px;                 /* ระยะห่างภายใน - 15px all sides */
            border-radius: var(--border-radius);            /* มุมโค้ง - 8px radius */
            text-align: center;            /* จัดข้อความตรงกลาง - center text */
            border-left: 4px solid var(--primary-color); /* เส้นขอบซ้าย - left border 4px */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .info-label {
            font-size: 12px;               /* ขนาดตัวอักษรเล็ก - 12px */
            color: var(--text-secondary);  /* สีข้อความรอง - secondary text color */
            margin-bottom: 5px;            /* ระยะห่างด้านล่าง - 5px */
        }

        .info-value {
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
            font-weight: 600;              /* ความหนาตัวอักษร - bold */
            color: var(--text-primary);    /* สีข้อความหลัก - primary text color */
        }

        /* Navigation Controls - ควบคุมการนำทาง */
        .navigation-controls {
            display: flex;                 /* แสดงแบบแถว - flexbox */
            gap: 10px;                      /* ระยะห่างระหว่างปุ่ม - 10px */
            margin: 20px 0;                /* ระยะห่างบนล่าง - 20px top/bottom */
        }

        .nav-control-btn {
            flex: 1;                       /* ขยายเต็มพื้นที่ - flex grow */
            padding: 15px;                 /* ระยะห่างภายใน - 15px all sides */
            background: var(--primary-color); /* พื้นหลังสีหลัก - primary color */
            color: white;                  /* สีตัวอักษรขาว - white text */
            border: none;                  /* ไม่มีเส้นขอบ - no border */
            border-radius: var(--border-radius);           /* มุมโค้ง - วงรี */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
            font-weight: 600;              /* ความหนาตัวอักษร - bold */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            text-align: center;            /* จัดข้อความตรงกลาง - center text */
        }

        .nav-control-btn:active {
            transform: scale(0.96);        /* ย่อขนาดเมื่อกด - scale down */
        }

        .nav-control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .voice-btn {
            background: var(--accent-color); /* พื้นหลังสีเขียว - green background */
        }

        .voice-btn.speaking {
            background: var(--danger-color); /* พื้นหลังสีแดงเมื่อพูด - red when speaking */
            animation: voice-pulse 1s infinite; /* ภาพเคลื่อนไหวกระพริบ - pulse animation */
        }

        @keyframes voice-pulse {
            0%, 100% { opacity: 1; }       /* เริ่มต้นและจบด้วยความทึบเต็ม - full opacity */
            50% { opacity: 0.5; }          /* กลางเป็นโปร่งใส - half opacity */
        }

        /* Room Status Checkbox */
        .room-status-checkbox {
            display: flex;                 /* แสดงแบบ flex - flexbox */
            align-items: center;           /* จัดกลางแนวตั้ง - vertical center */
            gap: 10px;                      /* ระยะห่าง - 10px gap */
            margin-top: 15px;              /* ระยะห่างด้านบน - 15px top margin */
            padding: 15px;                 /* ระยะห่างภายใน - 15px padding */
            background: rgba(255,255,255,0.7);           /* พื้นหลัง - light blue background */
            border-radius: var(--border-radius);            /* มุมโค้ง - 8px radius */
            border: 2px solid var(--border-color);
        }

        .room-status-checkbox input[type="checkbox"] {
            width: 20px;                   /* ความกว้าง - 20px */
            height: 20px;                  /* ความสูง - 20px */
            margin: 0;                     /* ไม่มี margin - no margin */
        }

        .room-status-checkbox label {
            margin: 0;                     /* ไม่มี margin - no margin */
            font-size: 14px;               /* ขนาดตัวอักษร - 14px */
            font-weight: 500;              /* ความหนาตัวอักษร - medium weight */
        }

        /* Image Gallery - แกลลอรี่รูปภาพ */
        .room-image {
            width: 100%;                   /* ความกว้างเต็ม - 100% width */
            height: 120px;                 /* ความสูง - 120px */
            object-fit: cover;             /* ปรับขนาดรูปภาพ - cover fit */
            border-radius: var(--border-radius);            /* มุมโค้ง - 8px radius */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            transition: var(--transition); /* ภาพเคลื่อนไหว - ใช้ตัวแปร */
            border: 2px solid transparent; /* เส้นขอบโปร่งใส - transparent border */
        }

        .room-image:hover {
            transform: scale(1.05);        /* ขยายเมื่อวางเมาส์ - scale on hover */
            border-color: var(--primary-color); /* เปลี่ยนสีเส้นขอบ - change border color */
            box-shadow: var(--box-shadow);
        }

        /* Image Modal - โมดัลรูปภาพ */
        .image-modal {
            display: none;                 /* ซ่อนโดยปกติ - hidden by default */
            position: fixed;               /* ตำแหน่งคงที่ - fixed positioning */
            top: 0; left: 0;               /* มุมซ้ายบน - top left corner */
            width: 100%; height: 100%;     /* เต็มหน้าจอ - full screen */
            background: rgba(0,0,0,0.9);   /* พื้นหลังดำโปร่งใส - black transparent background */
            z-index: 3000;                 /* ลำดับชั้นสูง - high z-index */
            justify-content: center;       /* จัดกลางแนวนอน - horizontal center */
            align-items: center;           /* จัดกลางแนวตั้ง - vertical center */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .image-modal img {
            max-width: 90%;                /* ความกว้างสูงสุด 90% - max 90% width */
            max-height: 90%;               /* ความสูงสูงสุด 90% - max 90% height */
            border-radius: var(--border-radius);           /* มุมโค้ง - 10px radius */
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }

        .image-modal-close {
            position: absolute;            /* ตำแหน่งแน่นอน - absolute positioning */
            top: 30px; right: 30px;        /* มุมขวาบน - top right corner */
            background: white;             /* พื้นหลังขาว - white background */
            color: black;                  /* สีตัวอักษรดำ - black text */
            border: none;                  /* ไม่มีเส้นขอบ - no border */
            border-radius: 50%;            /* ทำให้เป็นวงกลม - circle */
            width: 50px; height: 50px;     /* ขนาด 50x50px - 50x50px size */
            cursor: pointer;               /* เปลี่ยนเมาส์เป็นมือ - pointer */
            font-size: 20px;               /* ขนาดตัวอักษร - 20px */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        /* =================== Search Results Enhanced - ผลการค้นหาปรับปรุงแล้ว =================== */
        .live-results {
            margin-top: 15px;
        }

        .search-result-item {
            background: var(--card-background);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid var(--border-color);
        }

        .search-result-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
            border-color: var(--primary-color);
        }

        .search-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .search-result-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 16px;
        }

        .search-result-code {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }

        .search-result-info {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* =================== Preview Mode Enhanced - โหมดตัวอย่างปรับปรุงแล้ว =================== */
        .preview-mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2500;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .preview-content {
            background: var(--card-background);
            border-radius: var(--border-radius);
            width: 100%;
            height: 100%;
            max-width: 1000px;
            max-height: 90vh;
            position: relative;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }

        .preview-header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .preview-close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
            font-weight: 600;
        }

        .preview-close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .preview-map-area {
            height: calc(100% - 80px);
            position: relative;
        }
    </style>
</head>
<body data-theme="default">
    <!-- Enhanced Top Controls Bar - แถบควบคุมด้านบนปรับปรุงแล้ว -->
    <div class="top-controls">
        <!-- Language Button - ปุ่มเปลี่ยนภาษา -->
        <button class="control-button language-button" onclick="toggleLanguage()">
            <i class="fas fa-globe"></i>
            <span id="languageText">ไทย</span>
        </button>
        
        <!-- Admin Button - ปุ่มแอดมิน -->
        <button class="control-button admin-button" id="adminButton" onclick="toggleAdmin()">
            <i class="fas fa-user-shield"></i>
            <span id="adminText">Admin</span>
        </button>
    </div>

    <!-- ======================== Login Page - หน้าล็อกอิน ======================== -->
    <div class="login-page" id="loginPage" style="display: none;">
        <div style="max-width: 400px; margin: 50px auto; padding: 20px;">
            <div style="background: var(--card-background); padding: 40px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);">
                <div style="text-align: center; margin-bottom: 30px;">
                    <!-- โลโก้โรงเรียนในหน้าล็อกอิน - School logo in login page -->
                    <img id="loginLogo" class="school-logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23667eea'/%3E%3Ctext x='50' y='60' text-anchor='middle' font-family='Arial' font-size='40' fill='white'%3E🏫%3C/text%3E%3C/svg%3E" alt="School Logo">
                    <h2 style="color: var(--primary-color); margin-top: 15px;" data-text="admin_login">🔐 เข้าสู่ระบบผู้ดูแล</h2>
                </div>
                <!-- ฟอร์มล็อกอิน - Login form -->
                <div class="mobile-form">
                    <div class="form-group">
                        <label data-text="username">ชื่อผู้ใช้:</label>
                        <input type="text" id="username" placeholder="admin" required>
                    </div>
                    <div class="form-group">
                        <label data-text="password">รหัสผ่าน:</label>
                        <input type="password" id="password" placeholder="1234" required>
                    </div>
                    <button type="button" onclick="adminLogin(event)" class="btn btn-primary" style="width: 100%; margin-top: 20px;" data-text="login">เข้าสู่ระบบ</button>
                </div>
                <!-- ข้อมูลรหัสผ่านเริ่มต้น - Default password info -->
                <p style="margin-top: 20px; text-align: center; font-size: 12px; color: var(--text-secondary);">
                    <span data-text="default_password">รหัสผ่านเริ่มต้น: <strong>admin / 1234</strong></span><br>
                    <a href="#" onclick="showMainApp(false)" style="color: var(--primary-color);" data-text="back_to_main">กลับไปหน้าหลัก</a>
                </p>
            </div>
        </div>
    </div>

    <!-- ======================== Main Application - แอปพลิเคชันหลัก ======================== -->
    <div class="main-app" id="mainApp">
        <div class="container">
            <!-- Header - ส่วนหัว -->
            <div class="header" id="mainHeader">
                <!-- โลโก้โรงเรียน - School logo -->
                <img id="schoolLogo" class="school-logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23667eea'/%3E%3Ctext x='50' y='60' text-anchor='middle' font-family='Arial' font-size='40' fill='white'%3E🏫%3C/text%3E%3C/svg%3E" alt="School Logo">
                
                <!-- ชื่อระบบ - System title -->
                <h1 id="systemTitle" data-text="system_title">🏫 ระบบแผนที่โรงเรียนอัจฉริยะ</h1>
                <p id="systemSubtitle" data-text="system_subtitle">ค้นหาห้องเรียนและสถานที่ต่างๆ พร้อมระบบนำทางด้วยเสียง</p>
                
                <!-- Navigation Tabs - แท็บเมนู -->
                <div class="nav-tabs" id="navTabs">
                    <button class="nav-tab active" onclick="showPage('search')">
                        <i class="fas fa-search"></i>
                        <span data-text="search_rooms">ค้นหา</span>
                    </button>
                    <button class="nav-tab" onclick="showPage('map')">
                        <i class="fas fa-map"></i>
                        <span data-text="map">แผนที่</span>
                    </button>
                </div>
            </div>

            <!-- ======================== Search Page - หน้าค้นหา ======================== -->
            <div class="page active" id="search-page">
                <div class="search-container">
                    <h2><i class="fas fa-search"></i> <span data-text="search_title">ค้นหาห้องเรียนและสถานที่</span></h2>
                    
                    <!-- กล่องค้นหา - Search box -->
                    <div class="search-box">
                        <input class="search-input" id="searchInput" 
                               onkeypress="handleSearchKeyPress(event)" 
                               oninput="liveSearch()" 
                               placeholder="🔍 พิมพ์ชื่อห้อง รหัส หรือตำแหน่ง..." 
                               type="text"
                               data-placeholder="search_placeholder">
                        <button class="search-btn" onclick="searchRoom()">
                            <i class="fas fa-search"></i> <span data-text="search">ค้นหา</span>
                        </button>
                    </div>
                    
                    <!-- ผลการค้นหาแบบสด - Live search results -->
                    <div class="live-results" id="liveResults"></div>
                </div>

                <!-- Quick Access Categories - หมวดหมู่เข้าถึงเร็ว -->
                <div class="quick-categories">
                    <div class="category-card" onclick="quickSearch('classroom')">
                        <i class="fas fa-graduation-cap"></i>
                        <h4 data-text="classrooms">ห้องเรียน</h4>
                        <p data-text="classrooms_desc">ห้องเรียนปกติทั้งหมด</p>
                    </div>
                    <div class="category-card" onclick="quickSearch('special')">
                        <i class="fas fa-flask"></i>
                        <h4 data-text="special_rooms">ห้องพิเศษ</h4>
                        <p data-text="special_rooms_desc">ห้องปฏิบัติการ</p>
                    </div>
                    <div class="category-card" onclick="quickSearch('facilities')">
                        <i class="fas fa-building"></i>
                        <h4 data-text="facilities">สิ่งอำนวยความสะดวก</h4>
                        <p data-text="facilities_desc">ห้องสมุด โรงอาหาร</p>
                    </div>
                    <div class="category-card" onclick="quickSearch('office')">
                        <i class="fas fa-briefcase"></i>
                        <h4 data-text="offices">ห้องสำนักงาน</h4>
                        <p data-text="offices_desc">ห้องผู้บริหาร</p>
                    </div>
                </div>
            </div>

            <!-- ======================== Map Page - หน้าแผนที่ ======================== -->
            <div class="page" id="map-page">
                <h2><i class="fas fa-map"></i> <span data-text="school_map">แผนที่โรงเรียน</span></h2>
                
                <!-- Map Container - คอนเทนเนอร์แผนที่ -->
                <div class="map-container">
                    <div class="map-area" id="mapArea">
                        <!-- Map Controls - ปุ่มควบคุมแผนที่ -->
                        <div class="map-controls">
                            <button class="map-control-btn active" onclick="setMapLayout('floorplan')" data-layout="floorplan">
                                <i class="fas fa-drafting-compass"></i> <span data-text="floor_plan">แผนผัง</span>
                            </button>
                            <button class="map-control-btn" onclick="setMapLayout('real')" data-layout="real">
                                <i class="fas fa-camera"></i> <span data-text="real_photo">ภาพจริง</span>
                            </button>
                            <button class="map-control-btn" onclick="toggleFullscreen()" id="fullscreenBtn">
                                <i class="fas fa-expand"></i> <span data-text="fullscreen">เต็มจอ</span>
                            </button>
                        </div>

                        <!-- Floorplan Map - แผนผัง -->
                        <img id="floorplanMap" class="map-image" 
                             src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f0f8ff'/%3E%3Ctext x='400' y='280' text-anchor='middle' font-family='Arial' font-size='28' fill='%23667eea' font-weight='bold'%3E🏫 แผนผังโรงเรียนอัจฉริยะ%3C/text%3E%3Ctext x='400' y='320' text-anchor='middle' font-family='Arial' font-size='16' fill='%23999'%3E(อัปโหลดแผนผังในหน้าแอดมิน)%3C/text%3E%3Ctext x='400' y='350' text-anchor='middle' font-family='Arial' font-size='14' fill='%23667eea'%3E📍 คลิกจุดบนแผนที่เพื่อดูข้อมูลห้อง%3C/text%3E%3C/svg%3E" 
                             alt="แผนผังโรงเรียน">
                             
                        <!-- Real Photo Map - ภาพจริง -->
                        <img id="realMap" class="map-image" style="display: none;"
                             src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23e8f5e8'/%3E%3Ctext x='400' y='280' text-anchor='middle' font-family='Arial' font-size='28' fill='%2328a745' font-weight='bold'%3E📸 ภาพจริงโรงเรียนอัจฉริยะ%3C/text%3E%3Ctext x='400' y='320' text-anchor='middle' font-family='Arial' font-size='16' fill='%23999'%3E(อัปโหลดภาพจริงในหน้าแอดมิน)%3C/text%3E%3Ctext x='400' y='350' text-anchor='middle' font-family='Arial' font-size='14' fill='%2328a745'%3E📍 คลิกจุดบนแผนที่เพื่อดูข้อมูลห้อง%3C/text%3E%3C/svg%3E" 
                             alt="ภาพจริงโรงเรียน">
                        
                        <!-- Room Markers - มาร์กเกอร์ห้อง -->
                        <div id="roomMarkers"></div>
                    </div>
                </div>
            </div>

            <!-- ======================== Admin Page - หน้าแอดมิน ======================== -->
            <div class="page admin-page" id="admin-page">
                <h2><i class="fas fa-cogs"></i> <span data-text="system_management">จัดการข้อมูลระบบ</span></h2>
                
                <!-- Admin Sections with Enhanced Mobile-First Collapsible Design -->
                
                <!-- 1. Building Management Section Enhanced - ส่วนจัดการอาคารปรับปรุงแล้ว -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection('building-manage')" id="header-building-manage">
                        <h3><i class="fas fa-building"></i> <span data-text="manage_buildings">จัดการอาคาร</span></h3>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                    <div class="admin-section-content" id="content-building-manage">
                        <div class="building-manager">
                            <h4 style="color: var(--primary-color); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-list"></i> รายการอาคาร
                            </h4>
                            <div class="building-list" id="buildingList">
                                <!-- Building list will be rendered here -->
                            </div>
                            
                            <div class="building-form">
                                <h4 style="color: var(--primary-color); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-plus"></i> เพิ่มอาคารใหม่
                                </h4>
                                <div class="mobile-form">
                                    <div class="form-group">
                                        <label>ชื่อและรายละเอียดอาคาร</label>
                                        <input type="text" id="newBuildingName" placeholder="เช่น อาคาร 4, ห้องสมุดใหม่">
                                        <textarea id="newBuildingDesc" placeholder="รายละเอียดเพิ่มเติม (ไม่บังคับ)" rows="2"></textarea>
                                    </div>
                                    <div class="button-grid">
                                        <button type="button" class="btn btn-success" onclick="addBuilding()">
                                            <i class="fas fa-plus"></i> เพิ่มอาคาร
                                        </button>
                                        <button type="button" class="btn btn-warning" onclick="clearBuildingForm()">
                                            <i class="fas fa-redo"></i> ล้าง
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 2. Enhanced Room Management Section - ส่วนจัดการห้องปรับปรุงแล้ว -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection('room-manage')" id="header-room-manage">
                        <h3><i class="fas fa-home"></i> <span data-text="manage_rooms">จัดการห้อง</span></h3>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                    <div class="admin-section-content" id="content-room-manage">
                        <!-- Quick Actions -->
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-bolt"></i> ดำเนินการเร็ว
                            </h4>
                            <div class="button-grid">
                                <button class="btn btn-success" onclick="loadSampleData()">
                                    <i class="fas fa-database"></i> <span data-text="load_sample">โหลดตัวอย่าง</span>
                                </button>
                                <button class="btn btn-warning" onclick="clearAllData()">
                                    <i class="fas fa-trash"></i> <span data-text="clear_all">ล้างข้อมูล</span>
                                </button>
                                <button class="btn btn-info" onclick="exportRoomData()">
                                    <i class="fas fa-download"></i> ส่งออกข้อมูล
                                </button>
                                <button class="btn btn-primary" onclick="importRoomData()">
                                    <i class="fas fa-upload"></i> นำเข้าข้อมูล
                                </button>
                            </div>
                        </div>

                        <!-- Enhanced Room List with Filtering -->
                        <div class="room-management-container">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-building"></i> <span data-text="building_hierarchy">โครงสร้างห้อง</span>
                                <span id="roomCount" style="font-size: 14px; color: var(--text-secondary); margin-left: 10px;">(0 ห้อง)</span>
                            </h4>
                            
                            <!-- Filter Bar -->
                            <div class="room-filter-bar">
                                <input type="text" class="room-filter-input" id="roomSearchInput" placeholder="🔍 ค้นหาห้อง..." oninput="filterRooms()">
                                <select class="room-filter-select" id="buildingFilter" onchange="filterRooms()">
                                    <option value="">ทุกอาคาร</option>
                                </select>
                                <select class="room-filter-select" id="statusFilter" onchange="filterRooms()">
                                    <option value="">ทุกสถานะ</option>
                                    <option value="active">แสดง</option>
                                    <option value="inactive">ซ่อน</option>
                                </select>
                            </div>
                            
                            <!-- Room Grid -->
                            <div class="room-grid" id="roomGrid">
                                <!-- Room cards will be rendered here -->
                            </div>
                        </div>

                        <!-- Add/Edit Room Form Enhanced -->
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-plus"></i> <span data-text="add_edit_room">เพิ่ม/แก้ไขห้อง</span>
                            </h4>
                            <div id="roomForm" class="mobile-form">
                                <!-- Hidden field for editing room ID -->
                                <input type="hidden" id="editingRoomId">
                                
                                <!-- Building Selection -->
                                <div class="form-group">
                                    <label data-text="building_name">ชื่ออาคาร</label>
                                    <select id="buildingSelect">
                                        <option value="อาคาร 1">อาคาร 1</option>
                                        <option value="อาคาร 2">อาคาร 2</option>
                                        <option value="อาคาร 3">อาคาร 3</option>
                                        <option value="สนามกีฬา">สนามกีฬา</option>
                                        <option value="โรงอาหาร">โรงอาหาร</option>
                                        <option value="ห้องสมุด">ห้องสมุด</option>
                                    </select>
                                </div>
                                
                                <!-- Room Code and Name -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div class="form-group">
                                        <label data-text="room_code">รหัสห้อง</label>
                                        <input type="text" id="roomCode" placeholder="R001" required>
                                    </div>
                                    <div class="form-group">
                                        <label data-text="room_name">ชื่อห้อง</label>
                                        <input type="text" id="roomName" placeholder="ห้องเรียน ม.1/1" required>
                                    </div>
                                </div>
                                
                                <!-- Location -->
                                <div class="form-group">
                                    <label data-text="location">ตำแหน่ง</label>
                                    <input type="text" id="roomLocation" placeholder="ชั้น 2" required>
                                </div>
                                
                                <!-- Description -->
                                <div class="form-group">
                                    <label data-text="description">รายละเอียด</label>
                                    <textarea id="roomDescription" rows="3" placeholder="รายละเอียดห้อง..."></textarea>
                                </div>
                                
                                <!-- Hours -->
                                <div class="form-group">
                                    <label data-text="hours">เวลาเปิด-ปิด</label>
                                    <input type="text" id="roomHours" value="08:00 - 17:00">
                                </div>
                                
                                <!-- Room Status Checkbox -->
                                <div class="room-status-checkbox">
                                    <input type="checkbox" id="roomActive" checked>
                                    <label for="roomActive">แสดงห้องนี้บนแผนที่</label>
                                </div>
                                
                                <!-- Room Images -->
                                <div class="form-group">
                                    <label data-text="room_images">รูปภาพห้อง (URL แยกด้วยเส้นใหม่)</label>
                                    <textarea id="roomImages" rows="4" placeholder="https://example.com/image1.jpg
https://example.com/image2.jpg"></textarea>
                                </div>
                                
                                <!-- Position Information -->
                                <div style="display: none;" id="positionInfo">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                        <div class="form-group">
                                            <label>X (%)</label>
                                            <input type="number" id="roomX" min="0" max="100" step="0.1" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label>Y (%)</label>
                                            <input type="number" id="roomY" min="0" max="100" step="0.1" readonly>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="button-grid">
                                    <button type="button" class="btn btn-success" onclick="saveRoom()">
                                        <i class="fas fa-save"></i> <span data-text="save">บันทึก</span>
                                    </button>
                                    <button type="button" class="btn btn-warning" onclick="clearForm()">
                                        <i class="fas fa-redo"></i> <span data-text="clear">ล้าง</span>
                                    </button>
                                    <button type="button" class="btn btn-primary" onclick="selectMapPosition()">
                                        <i class="fas fa-crosshairs"></i> <span data-text="select_position">เลือกตำแหน่ง</span>
                                    </button>
                                    <button type="button" class="btn btn-info" onclick="showMapPreview()" id="showPreviewBtn">
                                        <i class="fas fa-eye"></i> <span data-text="preview">ดูตัวอย่าง</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Theme Customization Section - ส่วนปรับแต่งธีม -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection('theme-manage')" id="header-theme-manage">
                        <h3><i class="fas fa-palette"></i> ปรับแต่งสีสันและธีม</h3>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                    <div class="admin-section-content" id="content-theme-manage">
                        <div class="theme-customizer">
                            <h4 style="color: var(--primary-color); margin-bottom: 20px;">
                                <i class="fas fa-swatchbook"></i> เลือกธีมสำเร็จรูป
                            </h4>
                            
                            <div class="theme-selector">
                                <div class="theme-option active" data-theme="default" onclick="applyTheme('default')">
                                    <h5>🎨 Default</h5>
                                    <p>ธีมมาตรฐาน</p>
                                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                                        <div style="width: 20px; height: 20px; background: #667eea; border-radius: 50%;"></div>
                                        <div style="width: 20px; height: 20px; background: #764ba2; border-radius: 50%;"></div>
                                        <div style="width: 20px; height: 20px; background: #28a745; border-radius: 50%;"></div>
                                    </div>
                                </div>
                                
                                <div class="theme-option" data-theme="apple" onclick="applyTheme('apple')">
                                    <h5>🍎 Apple Liquid Glass</h5>
                                    <p>สไตล์แอปเปิล</p>
                                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                                        <div style="width: 20px; height: 20px; background: #007AFF; border-radius: 50%;"></div>
                                        <div style="width: 20px; height: 20px; background: #5856D6; border-radius: 50%;"></div>
                                        <div style="width: 20px; height: 20px; background: #34C759; border-radius: 50%;"></div>
                                    </div>
                                </div>
                                
                                <div class="theme-option" data-theme="tailwind" onclick="applyTheme('tailwind')">
                                    <h5>🌊 TailwindCSS</h5>
                                    <p>สไตล์โมเดิร์น</p>
                                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                                        <div style="width: 20px; height: 20px; background: #3B82F6; border-radius: 50%;"></div>
                                        <div style="width: 20px; height: 20px; background: #8B5CF6; border-radius: 50%;"></div>
                                        <div style="width: 20px; height: 20px; background: #10B981; border-radius: 50%;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <h4 style="color: var(--primary-color); margin: 30px 0 20px 0;">
                                <i class="fas fa-edit"></i> ปรับแต่งสีแบบกำหนดเอง
                            </h4>
                            
                            <div class="color-customizer">
                                <div class="color-input-group">
                                    <label>สีหลัก (Primary)</label>
                                    <input type="color" class="color-input" id="primaryColor" value="#667eea" onchange="updateCustomColor('primary', this.value)">
                                </div>
                                <div class="color-input-group">
                                    <label>สีรอง (Secondary)</label>
                                    <input type="color" class="color-input" id="secondaryColor" value="#764ba2" onchange="updateCustomColor('secondary', this.value)">
                                </div>
                                <div class="color-input-group">
                                    <label>สีเน้น (Accent)</label>
                                    <input type="color" class="color-input" id="accentColor" value="#28a745" onchange="updateCustomColor('accent', this.value)">
                                </div>
                                <div class="color-input-group">
                                    <label>สีอันตราย (Danger)</label>
                                    <input type="color" class="color-input" id="dangerColor" value="#dc3545" onchange="updateCustomColor('danger', this.value)">
                                </div>
                                <div class="color-input-group">
                                    <label>สีเตือน (Warning)</label>
                                    <input type="color" class="color-input" id="warningColor" value="#ffc107" onchange="updateCustomColor('warning', this.value)">
                                </div>
                                <div class="color-input-group">
                                    <label>สีข้อมูล (Info)</label>
                                    <input type="color" class="color-input" id="infoColor" value="#17a2b8" onchange="updateCustomColor('info', this.value)">
                                </div>
                            </div>
                            
                            <div class="button-grid" style="margin-top: 20px;">
                                <button class="btn btn-success" onclick="saveThemeSettings()">
                                    <i class="fas fa-save"></i> บันทึกธีม
                                </button>
                                <button class="btn btn-warning" onclick="resetTheme()">
                                    <i class="fas fa-undo"></i> รีเซ็ต
                                </button>
                                <button class="btn btn-info" onclick="exportTheme()">
                                    <i class="fas fa-download"></i> ส่งออกธีม
                                </button>
                                <button class="btn btn-primary" onclick="importTheme()">
                                    <i class="fas fa-upload"></i> นำเข้าธีม
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. Content Editor Section - ส่วนแก้ไขเนื้อหา -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection('content-manage')" id="header-content-manage">
                        <h3><i class="fas fa-edit"></i> แก้ไขเนื้อหาเว็บไซต์</h3>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                    <div class="admin-section-content" id="content-content-manage">
                        <div class="content-editor">
                            <!-- Header Content Group -->
                            <div class="content-group">
                                <div class="content-group-header" onclick="toggleContentGroup('header-content')">
                                    <span><i class="fas fa-heading"></i> เนื้อหาส่วนหัว</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="content-group-body" id="header-content">
                                    <div class="content-item">
                                        <label>ชื่อระบบ (ไทย)</label>
                                        <input type="text" id="systemTitleTh" value="🏫 ระบบแผนที่โรงเรียนอัจฉริยะ" onchange="updateContent('systemTitle', 'th', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>ชื่อระบบ (อังกฤษ)</label>
                                        <input type="text" id="systemTitleEn" value="🏫 Smart School Map System" onchange="updateContent('systemTitle', 'en', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>คำบรรยาย (ไทย)</label>
                                        <textarea id="systemSubtitleTh" onchange="updateContent('systemSubtitle', 'th', this.value)">ค้นหาห้องเรียนและสถานที่ต่างๆ พร้อมระบบนำทางด้วยเสียง</textarea>
                                    </div>
                                    <div class="content-item">
                                        <label>คำบรรยาย (อังกฤษ)</label>
                                        <textarea id="systemSubtitleEn" onchange="updateContent('systemSubtitle', 'en', this.value)">Find classrooms and locations with voice navigation</textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Search Content Group -->
                            <div class="content-group">
                                <div class="content-group-header" onclick="toggleContentGroup('search-content')">
                                    <span><i class="fas fa-search"></i> เนื้อหาหน้าค้นหา</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="content-group-body" id="search-content">
                                    <div class="content-item">
                                        <label>หัวข้อค้นหา (ไทย)</label>
                                        <input type="text" id="searchTitleTh" value="ค้นหาห้องเรียนและสถานที่" onchange="updateContent('searchTitle', 'th', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>หัวข้อค้นหา (อังกฤษ)</label>
                                        <input type="text" id="searchTitleEn" value="Search Classrooms and Locations" onchange="updateContent('searchTitle', 'en', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>Placeholder ค้นหา (ไทย)</label>
                                        <input type="text" id="searchPlaceholderTh" value="🔍 พิมพ์ชื่อห้อง รหัส หรือตำแหน่ง..." onchange="updateContent('searchPlaceholder', 'th', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>Placeholder ค้นหา (อังกฤษ)</label>
                                        <input type="text" id="searchPlaceholderEn" value="🔍 Type room name, code or location..." onchange="updateContent('searchPlaceholder', 'en', this.value)">
                                    </div>
                                </div>
                            </div>

                            <!-- Categories Content Group -->
                            <div class="content-group">
                                <div class="content-group-header" onclick="toggleContentGroup('categories-content')">
                                    <span><i class="fas fa-th-large"></i> หมวดหมู่ค้นหาเร็ว</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="content-group-body" id="categories-content">
                                    <div class="content-item">
                                        <label>ห้องเรียน - ชื่อ (ไทย/อังกฤษ)</label>
                                        <input type="text" id="classroomsTh" value="ห้องเรียน" onchange="updateContent('classrooms', 'th', this.value)">
                                        <input type="text" id="classroomsEn" value="Classrooms" onchange="updateContent('classrooms', 'en', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>ห้องเรียน - คำอธิบาย (ไทย/อังกฤษ)</label>
                                        <input type="text" id="classroomsDescTh" value="ห้องเรียนปกติทั้งหมด" onchange="updateContent('classroomsDesc', 'th', this.value)">
                                        <input type="text" id="classroomsDescEn" value="All regular classrooms" onchange="updateContent('classroomsDesc', 'en', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>ห้องพิเศษ - ชื่อ (ไทย/อังกฤษ)</label>
                                        <input type="text" id="specialRoomsTh" value="ห้องพิเศษ" onchange="updateContent('specialRooms', 'th', this.value)">
                                        <input type="text" id="specialRoomsEn" value="Special Rooms" onchange="updateContent('specialRooms', 'en', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>ห้องพิเศษ - คำอธิบาย (ไทย/อังกฤษ)</label>
                                        <input type="text" id="specialRoomsDescTh" value="ห้องปฏิบัติการ" onchange="updateContent('specialRoomsDesc', 'th', this.value)">
                                        <input type="text" id="specialRoomsDescEn" value="Laboratory rooms" onchange="updateContent('specialRoomsDesc', 'en', this.value)">
                                    </div>
                                </div>
                            </div>

                            <!-- Navigation Content Group -->
                            <div class="content-group">
                                <div class="content-group-header" onclick="toggleContentGroup('navigation-content')">
                                    <span><i class="fas fa-compass"></i> เนื้อหาการนำทาง</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="content-group-body" id="navigation-content">
                                    <div class="content-item">
                                        <label>เริ่มนำทาง (ไทย/อังกฤษ)</label>
                                        <input type="text" id="startNavigationTh" value="เริ่มนำทาง" onchange="updateContent('startNavigation', 'th', this.value)">
                                        <input type="text" id="startNavigationEn" value="Start Navigation" onchange="updateContent('startNavigation', 'en', this.value)">
                                    </div>
                                    <div class="content-item">
                                        <label>เสียง (ไทย/อังกฤษ)</label>
                                        <input type="text" id="voiceTh" value="เสียง" onchange="updateContent('voice', 'th', this.value)">
                                        <input type="text" id="voiceEn" value="Voice" onchange="updateContent('voice', 'en', this.value)">
                                    </div>
                                </div>
                            </div>

                            <!-- Save Content Changes -->
                            <div class="button-grid" style="margin-top: 20px;">
                                <button class="btn btn-success" onclick="saveAllContent()">
                                    <i class="fas fa-save"></i> บันทึกเนื้อหาทั้งหมด
                                </button>
                                <button class="btn btn-warning" onclick="resetAllContent()">
                                    <i class="fas fa-undo"></i> รีเซ็ตเนื้อหา
                                </button>
                                <button class="btn btn-info" onclick="exportContent()">
                                    <i class="fas fa-download"></i> ส่งออกเนื้อหา
                                </button>
                                <button class="btn btn-primary" onclick="importContent()">
                                    <i class="fas fa-upload"></i> นำเข้าเนื้อหา
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. Map Management Section - ส่วนจัดการแผนที่ -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection('map-manage')" id="header-map-manage">
                        <h3><i class="fas fa-map"></i> <span data-text="manage_maps">จัดการแผนที่</span></h3>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                    <div class="admin-section-content" id="content-map-manage">
                        <!-- Floorplan Upload -->
                        <div style="margin-bottom: 30px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 20px;">
                                <i class="fas fa-upload"></i> <span data-text="upload_floorplan">อัปโหลดแผนผัง</span>
                            </h4>
                            
                            <div style="background: var(--card-background); padding: 20px; border-radius: var(--border-radius); margin-bottom: 20px; border: 3px dashed var(--border-color); text-align: center; cursor: pointer;" onclick="document.getElementById('floorplanFileInput').click()">
                                <input type="file" id="floorplanFileInput" accept="image/*" onchange="handleMapUpload(event, 'floorplan')" style="display: none;">
                                <div>
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--primary-color); margin-bottom: 15px;"></i>
                                    <h4 data-text="upload_floorplan">อัปโหลดแผนผัง</h4>
                                    <p style="color: var(--text-secondary); font-size: 14px;">คลิกเพื่อเลือกไฟล์แผนผัง (PNG, JPG, SVG)</p>
                                </div>
                            </div>
                            
                            <div id="floorplanStatus">
                                <p><strong data-text="floorplan_status">สถานะแผนผัง:</strong> <span id="floorplanStatusText" data-text="using_default">ใช้แผนผังเริ่มต้น</span></p>
                                <img id="floorplanPreview" class="hidden" style="max-width: 100%; max-height: 200px; border-radius: var(--border-radius); margin-top: 15px; box-shadow: var(--box-shadow);">
                            </div>
                        </div>

                        <!-- Real Photo Upload -->
                        <div style="margin-bottom: 30px;">
                            <h4 style="color: var(--accent-color); margin-bottom: 20px;">
                                <i class="fas fa-camera"></i> <span data-text="upload_real_photo">อัปโหลดภาพจริง</span>
                            </h4>
                            
                            <div style="background: var(--card-background); padding: 20px; border-radius: var(--border-radius); margin-bottom: 20px; border: 3px dashed var(--border-color); text-align: center; cursor: pointer;" onclick="document.getElementById('realFileInput').click()">
                                <input type="file" id="realFileInput" accept="image/*" onchange="handleMapUpload(event, 'real')" style="display: none;">
                                <div>
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--accent-color); margin-bottom: 15px;"></i>
                                    <h4 data-text="upload_real_photo">อัปโหลดภาพจริง</h4>
                                    <p style="color: var(--text-secondary); font-size: 14px;">คลิกเพื่อเลือกไฟล์ภาพจริง (PNG, JPG)</p>
                                </div>
                            </div>
                            
                            <div id="realStatus">
                                <p><strong data-text="real_photo_status">สถานะภาพจริง:</strong> <span id="realStatusText" data-text="using_default">ใช้ภาพเริ่มต้น</span></p>
                                <img id="realPreview" class="hidden" style="max-width: 100%; max-height: 200px; border-radius: var(--border-radius); margin-top: 15px; box-shadow: var(--box-shadow);">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6. Entrance Setup Section - ส่วนตั้งค่าประตูทางเข้า -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection('entrance-manage')" id="header-entrance-manage">
                        <h3><i class="fas fa-door-open"></i> <span data-text="entrance_setup">ตั้งค่าประตูทางเข้า</span></h3>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                    <div class="admin-section-content" id="content-entrance-manage">
                        <!-- Current Entrance Status -->
                        <div style="background: linear-gradient(135deg, #e8f5e8, #d4edda); border: 2px solid var(--accent-color); border-radius: var(--border-radius); padding: 25px; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: var(--border-radius);">
                                <div id="entranceIcon" style="font-size: 32px; color: var(--accent-color);">
                                    <i class="fas fa-door-open"></i>
                                </div>
                                <div>
                                    <h4 style="margin: 0; color: var(--primary-color); font-size: 18px;">
                                        <span data-text="entrance_status">สถานะประตู</span>
                                    </h4>
                                    <p style="margin: 8px 0 0 0; font-size: 16px;" id="entranceStatusText" data-text="not_set">ยังไม่ได้ตั้งค่า</p>
                                </div>
                            </div>
                            
                            <!-- Entrance Controls -->
                            <div class="button-grid">
                                <button class="btn btn-success" onclick="setEntrance()">
                                    <i class="fas fa-door-open"></i> <span data-text="set_entrance">ตั้งประตูหลัก</span>
                                </button>
                                <button class="btn btn-danger" onclick="removeEntrance()">
                                    <i class="fas fa-trash"></i> <span data-text="remove_entrance">ลบประตู</span>
                                </button>
                            </div>
                            
                            <!-- Instructions -->
                            <div style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: var(--border-radius); margin-top: 20px;">
                                <h5 style="margin: 0 0 10px 0; color: var(--text-primary);">
                                    <i class="fas fa-info-circle"></i> คำแนะนำ
                                </h5>
                                <ul style="margin: 0; padding-left: 25px; font-size: 14px; color: var(--text-secondary); line-height: 1.6;">
                                    <li>คลิก "ตั้งประตูหลัก" แล้วไปที่หน้าแผนที่</li>
                                    <li>คลิกบนแผนที่ที่ตำแหน่งประตูทางเข้าหลัก</li>
                                    <li>ประตูจะใช้สำหรับคำนวณเส้นทางนำทาง</li>
                                    <li>สามารถมีประตูหลักได้เพียงหนึ่งประตู</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 7. Google Sheets Integration Section -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection('sheets-manage')" id="header-sheets-manage">
                        <h3><i class="fas fa-table"></i> <span data-text="google_sheets_integration">Google Sheets Integration</span></h3>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                    <div class="admin-section-content" id="content-sheets-manage">
                        <!-- Setup Guide -->
                        <div style="background: #f8f9ff; border-radius: var(--border-radius); padding: 20px; margin-bottom: 20px; border-left: 4px solid var(--primary-color);">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-list-ol"></i> ขั้นตอนการตั้งค่า Google Sheets Backend
                            </h4>
                            
                            <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.6;">
                                <p><strong>1.</strong> ไปที่ <a href="https://sheets.google.com" target="_blank">Google Sheets</a> และสร้างไฟล์ใหม่</p>
                                <p><strong>2.</strong> ใส่หัวคอลัมน์: Room Code | Room Name | Building | Location | Description | Hours | X Position | Y Position | Images</p>
                                <p><strong>3.</strong> ไปที่ Extensions → Apps Script</p>
                                <p><strong>4.</strong> วางโค้ด Backend ด้านล่าง</p>
                                <p><strong>5.</strong> Deploy → New deployment → Web app</p>
                                <p><strong>6.</strong> คัดลอก URL มาใส่ด้านล่าง</p>
                            </div>
                        </div>

                        <!-- Google Apps Script Code -->
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-code"></i> Google Apps Script Backend Code
                            </h4>
                            <div style="background: #f8f9fa; border: 2px solid var(--border-color); border-radius: var(--border-radius); padding: 20px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <strong>code.gs</strong>
                                    <button class="btn btn-info" onclick="copyBackendCode()" style="padding: 8px 15px; font-size: 12px;">
                                        <i class="fas fa-copy"></i> คัดลอก
                                    </button>
                                </div>
                                <pre id="backendCode" style="background: #fff; padding: 15px; border-radius: 8px; font-size: 11px; overflow-x: auto; max-height: 300px; font-family: 'Courier New', monospace;">function doGet(e) {
  const action = e.parameter.action;
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  
  if (action === 'getRooms') {
    return getRooms(sheet);
  }
  
  return ContentService
    .createTextOutput(JSON.stringify({success: false, error: 'Invalid action'}))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  const action = e.parameter.action;
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  
  if (action === 'saveRoom') {
    return saveRoom(sheet, e.parameter);
  }
  
  return ContentService
    .createTextOutput(JSON.stringify({success: false, error: 'Invalid action'}))
    .setMimeType(ContentService.MimeType.JSON);
}

function getRooms(sheet) {
  try {
    const data = sheet.getDataRange().getValues();
    const headers = data[0];
    const rows = data.slice(1);
    
    const rooms = rows.map(row => {
      const room = {};
      headers.forEach((header, index) => {
        room[header] = row[index];
      });
      return room;
    });
    
    return ContentService
      .createTextOutput(JSON.stringify({success: true, data: rooms}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function saveRoom(sheet, params) {
  try {
    const headers = ['Room Code', 'Room Name', 'Building', 'Location', 'Description', 'Hours', 'X Position', 'Y Position', 'Images'];
    
    // If first time, add headers
    if (sheet.getLastRow() === 0) {
      sheet.appendRow(headers);
    }
    
    const roomData = [
      params['Room Code'] || params.code,
      params['Room Name'] || params.name,
      params['Building'] || params.building,
      params['Location'] || params.location,
      params['Description'] || params.description,
      params['Hours'] || params.hours,
      params['X Position'] || params.x,
      params['Y Position'] || params.y,
      params['Images'] || (params.images ? params.images.join(',') : '')
    ];
    
    // Check if room exists
    const data = sheet.getDataRange().getValues();
    const existingRowIndex = data.findIndex((row, index) => 
      index > 0 && row[0] === roomData[0]
    );
    
    if (existingRowIndex > 0) {
      // Update existing room
      const range = sheet.getRange(existingRowIndex + 1, 1, 1, headers.length);
      range.setValues([roomData]);
    } else {
      // Add new room
      sheet.appendRow(roomData);
    }
    
    return ContentService
      .createTextOutput(JSON.stringify({success: true, message: 'Room saved successfully'}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({success: false, error: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}</pre>
                            </div>
                        </div>
                        
                        <!-- Web App URL Input -->
                        <div class="form-group">
                            <label>Google Apps Script Web App URL</label>
                            <input type="url" id="webAppUrl" placeholder="https://script.google.com/macros/s/AKfycby.../exec">
                            <small style="color: var(--text-secondary);">URL ที่ได้จากการ Deploy Apps Script</small>
                        </div>
                        
                        <!-- Connection Controls -->
                        <div class="button-grid">
                            <button class="btn btn-primary" onclick="testAppsScriptConnection()">
                                <i class="fas fa-link"></i> ทดสอบการเชื่อมต่อ
                            </button>
                            <button class="btn btn-success" onclick="saveAppsScriptConfig()">
                                <i class="fas fa-save"></i> บันทึกการตั้งค่า
                            </button>
                        </div>
                        
                        <div id="connectionResult" style="margin-top: 20px;"></div>

                        <!-- Sync Controls -->
                        <div style="margin-top: 30px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-sync"></i> ตัวเลือกการซิงค์ข้อมูล
                            </h4>
                            
                            <div class="button-grid">
                                <button class="btn btn-info" onclick="exportToSheets()">
                                    <i class="fas fa-upload"></i> ส่งไป Sheets
                                </button>
                                <button class="btn btn-warning" onclick="importFromSheets()">
                                    <i class="fas fa-download"></i> นำเข้าจาก Sheets
                                </button>
                                <button class="btn btn-success" onclick="syncWithSheets()">
                                    <i class="fas fa-sync"></i> ซิงค์ทั้งสองทาง
                                </button>
                            </div>
                            
                            <div id="syncStatus" style="margin-top: 20px;"></div>
                        </div>
                    </div>
                </div>

                <!-- 8. GitLab Deployment Section -->
                <div class="admin-section">
                    <div class="admin-section-header" onclick="toggleAdminSection('gitlab-deploy')" id="header-gitlab-deploy">
                        <h3><i class="fab fa-gitlab"></i> Deploy ไป GitLab Pages</h3>
                        <i class="fas fa-chevron-down chevron-icon"></i>
                    </div>
                    <div class="admin-section-content" id="content-gitlab-deploy">
                        <!-- GitLab Deployment Guide -->
                        <div style="background: #fff3cd; border-radius: var(--border-radius); padding: 20px; margin-bottom: 20px; border-left: 4px solid var(--warning-color);">
                            <h4 style="color: #856404; margin-bottom: 15px;">
                                <i class="fas fa-rocket"></i> คู่มือการ Deploy เว็บไซต์ไป GitLab Pages
                            </h4>
                            
                            <div style="font-size: 14px; color: #856404; line-height: 1.6;">
                                <p><strong>สำหรับผู้ที่ไม่เคยใช้ GitLab มาก่อน:</strong></p>
                                
                                <h5 style="margin: 15px 0 8px 0;">ขั้นตอนที่ 1: สร้างบัญชี GitLab</h5>
                                <p>• ไปที่ <a href="https://gitlab.com" target="_blank">https://gitlab.com</a></p>
                                <p>• คลิก "Register" และสมัครบัญชีใหม่</p>
                                <p>• ยืนยันอีเมลของคุณ</p>
                                
                                <h5 style="margin: 15px 0 8px 0;">ขั้นตอนที่ 2: สร้าง Project ใหม่</h5>
                                <p>• เข้าสู่ระบบ GitLab แล้วคลิก "New project"</p>
                                <p>• เลือก "Create blank project"</p>
                                <p>• ใส่ชื่อ Project เช่น "school-map-system"</p>
                                <p>• เลือก "Public" หรือ "Private" ตามต้องการ</p>
                                <p>• คลิก "Create project"</p>
                                
                                <h5 style="margin: 15px 0 8px 0;">ขั้นตอนที่ 3: Upload ไฟล์</h5>
                                <p>• ในหน้า Project คลิก "+" แล้วเลือก "New file"</p>
                                <p>• ตั้งชื่อไฟล์เป็น "index.html"</p>
                                <p>• คัดลอกโค้ด HTML ทั้งหมดจากด้านล่างไปวาง</p>
                                <p>• เลื่อนลงล่างแล้วคลิก "Commit changes"</p>
                                
                                <h5 style="margin: 15px 0 8px 0;">ขั้นตอนที่ 4: เปิดใช้ Pages</h5>
                                <p>• ไปที่ Settings → Pages (ในเมนูซ้าย)</p>
                                <p>• หาข้อความ "Your pages are served under:" จะมี URL เว็บไซต์ของคุณ</p>
                                <p>• รอประมาณ 5-10 นาที เว็บไซต์จะพร้อมใช้งาน</p>
                                
                                <h5 style="margin: 15px 0 8px 0;">ขั้นตอนที่ 5: แก้ไขไฟล์ (เมื่อต้องการอัปเดต)</h5>
                                <p>• กลับไปหน้า Project หลัก</p>
                                <p>• คลิกที่ไฟล์ "index.html"</p>
                                <p>• คลิก "Edit" เพื่อแก้ไข</p>
                                <p>• แก้ไขโค้ดตามต้องการ</p>
                                <p>• คลิก "Commit changes" เพื่อบันทึก</p>
                            </div>
                        </div>

                        <!-- Export HTML Code -->
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 15px;">
                                <i class="fas fa-file-code"></i> โค้ด HTML สำหรับ Deploy
                            </h4>
                            <div style="background: #f8f9fa; border: 2px solid var(--border-color); border-radius: var(--border-radius); padding: 20px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <strong>index.html (คัดลอกไปวางใน GitLab)</strong>
                                    <button class="btn btn-success" onclick="exportHTMLCode()" style="padding: 8px 15px; font-size: 12px;">
                                        <i class="fas fa-download"></i> ดาวน์โหลด HTML
                                    </button>
                                </div>
                                <textarea id="htmlCodeExport" style="width: 100%; height: 250px; font-family: 'Courier New', monospace; font-size: 10px; border: 2px solid var(--border-color); border-radius: 8px; padding: 15px;" readonly>
<!-- โค้ด HTML จะถูกสร้างอัตโนมัติที่นี่ เมื่อคลิกปุ่มดาวน์โหลด -->
คลิกปุ่ม "ดาวน์โหลด HTML" เพื่อสร้างโค้ดที่รวมข้อมูลปัจจุบันของคุณ
                                </textarea>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="button-grid">
                            <button class="btn btn-primary" onclick="openGitLab()">
                                <i class="fab fa-gitlab"></i> เปิด GitLab
                            </button>
                            <button class="btn btn-info" onclick="copyHTMLCode()">
                                <i class="fas fa-copy"></i> คัดลอกโค้ด HTML
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Room Info Overlay - แผงข้อมูลห้องแบบ overlay -->
    <div class="room-info-overlay" id="roomInfoOverlay">
        <div class="room-info-content">
            <div class="room-info-header">
                <div class="room-title" id="overlayRoomName"></div>
                <div style="font-size: 16px; opacity: 0.9;" id="overlayRoomLocation"></div>
                <button class="room-info-close" onclick="closeRoomInfoOverlay()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="room-info-body">
                <!-- ข้อมูลแบบกะทัดรัด -->
                <div class="compact-info">
                    <div class="info-item">
                        <div class="info-label" data-text="hours">เวลาเปิด-ปิด</div>
                        <div class="info-value" id="overlayRoomHours"></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label" data-text="building">อาคาร</div>
                        <div class="info-value" id="overlayRoomBuilding"></div>
                    </div>
                </div>
                
                <!-- รายละเอียดเพิ่มเติม -->
                <div style="background: rgba(255,255,255,0.7); padding: 20px; border-radius: var(--border-radius); margin-bottom: 20px;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;" data-text="description">รายละเอียด</div>
                    <div style="font-size: 16px;" id="overlayRoomDescription"></div>
                </div>
                
                <!-- Room Image Gallery -->
                <div id="overlayRoomGallery" style="display: none;">
                    <h4 style="font-size: 16px; color: var(--primary-color); margin-bottom: 15px;">
                        <i class="fas fa-images"></i> <span data-text="room_photos">รูปภาพห้อง</span>
                    </h4>
                    <div id="overlayImageGallery" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                        <!-- Images will be inserted here -->
                    </div>
                </div>
                
                <!-- Navigation Controls -->
                <div class="navigation-controls">
                    <button class="nav-control-btn" onclick="startNavigation()">
                        <i class="fas fa-route"></i> <span data-text="start_navigation">เริ่มนำทาง</span>
                    </button>
                    <button class="nav-control-btn voice-btn" onclick="toggleVoiceNavigation()" id="overlayVoiceBtn">
                        <i class="fas fa-volume-up"></i> <span data-text="voice">เสียง</span>
                    </button>
                </div>
                
                <!-- ขั้นตอนการเดินทาง -->
                <div id="overlayRouteSteps" style="margin-top: 15px;"></div>
            </div>
        </div>
    </div>

    <!-- Preview Mode Overlay - โหมดตัวอย่าง -->
    <div class="preview-mode-overlay" id="previewModeOverlay">
        <div class="preview-content">
            <div class="preview-header">
                <h3><i class="fas fa-eye"></i> ตัวอย่างแผนที่</h3>
                <button class="preview-close-btn" onclick="closePreviewMode()">
                    <i class="fas fa-times"></i> ปิดตัวอย่าง
                </button>
            </div>
            <div class="preview-map-area" id="previewMapArea">
                <!-- Preview map content will be rendered here -->
                <img id="previewMapImage" class="map-image" alt="ตัวอย่างแผนที่">
                <div id="previewRoomMarkers"></div>
            </div>
        </div>
    </div>

    <!-- Notification - การแจ้งเตือน -->
    <div class="notification" id="notification"></div>

    <script>
        // =================== Global Variables - ตัวแปรสำคัญทั้งหมด ===================
        let roomData = {};                    // ข้อมูลห้องทั้งหมด
        let buildingData = ['อาคาร 1', 'อาคาร 2', 'อาคาร 3', 'สนามกีฬา', 'โรงอาหาร', 'ห้องสมุด']; // รายการอาคาร
        let buildingHierarchy = {};           // โครงสร้างอาคาร
        let isAdminMode = false;              // สถานะโหมดแอดมิน
        let selectedRoom = null;              // ห้องที่เลือกปัจจุบัน
        let floorplanMapImage = null;         // รูปภาพแผนผัง
        let realMapImage = null;              // รูปภาพจริง
        let entrancePosition = null;          // ตำแหน่งประตูทางเข้า
        let isSelectingPosition = false;      // สถานะการเลือกตำแหน่ง
        let voiceNavigationEnabled = false;   // สถานะเสียงนำทาง
        let currentSpeech = null;             // เสียงที่กำลังพูด
        let currentLanguage = 'th';           // ภาษาปัจจุบัน
        let googleSheetsConnected = false;    // สถานะการเชื่อมต่อ Google Sheets
        let currentMapLayout = 'floorplan';   // รูปแบบแผนที่ปัจจุบัน
        let activeAdminSection = null;        // ส่วนแอดมินที่เปิดอยู่
        let isFullscreen = false;             // สถานะเต็มจอ
        let isPreviewMode = false;            // สถานะโหมดตัวอย่าง
        let currentTheme = 'default';         // ธีมปัจจุบัน
        let customContent = {};               // เนื้อหาที่แก้ไขแล้ว

        // =================== Enhanced Language System - ระบบภาษาปรับปรุงแล้ว ===================
        const translations = {
            th: {
                // ข้อความภาษาไทย - Thai text translations
                system_title: "🏫 ระบบแผนที่โรงเรียนอัจฉริยะ",
                system_subtitle: "ค้นหาห้องเรียนและสถานที่ต่างๆ พร้อมระบบนำทางด้วยเสียง",
                admin_login: "🔐 เข้าสู่ระบบผู้ดูแล",
                username: "ชื่อผู้ใช้:",
                password: "รหัสผ่าน:",
                login: "เข้าสู่ระบบ",
                logout: "ออกจากระบบ",
                admin: "Admin",
                search_rooms: "ค้นหา",
                map: "แผนที่", 
                manage: "จัดการ",
                search_title: "ค้นหาห้องเรียนและสถานที่",
                search_placeholder: "🔍 พิมพ์ชื่อห้อง รหัส หรือตำแหน่ง...",
                search: "ค้นหา",
                classrooms: "ห้องเรียน",
                classrooms_desc: "ห้องเรียนปกติทั้งหมด",
                special_rooms: "ห้องพิเศษ",
                special_rooms_desc: "ห้องปฏิบัติการ",
                facilities: "สิ่งอำนวยความสะดวก",
                facilities_desc: "ห้องสมุด โรงอาหาร",
                offices: "ห้องสำนักงาน",
                offices_desc: "ห้องผู้บริหาร",
                school_map: "แผนที่โรงเรียน",
                room_info: "ข้อมูลห้อง",
                click_marker: "คลิกที่จุดบนแผนที่เพื่อดูข้อมูลรายละเอียด",
                symbols: "คำอธิบายสัญลักษณ์",
                classroom: "ห้องเรียน",
                computer_room: "ห้องคอมพิวเตอร์",
                library: "ห้องสมุด",
                cafeteria: "โรงอาหาร",
                entrance: "ประตูทางเข้า",
                hours: "เวลาเปิด-ปิด",
                building: "อาคาร",
                description: "รายละเอียด",
                start_navigation: "เริ่มนำทาง",
                voice: "เสียง",
                system_management: "จัดการข้อมูลระบบ",
                manage_buildings: "จัดการอาคาร",
                manage_rooms: "จัดการห้อง",
                load_sample: "โหลดตัวอย่าง",
                clear_all: "ล้างข้อมูล",
                save: "บันทึก",
                clear: "ล้าง",
                default_password: "รหัสผ่านเริ่มต้น: <strong>admin / 1234</strong>",
                back_to_main: "กลับไปหน้าหลัก",
                floor_plan: "แผนผัง",
                real_photo: "ภาพจริง",
                fullscreen: "เต็มจอ",
                room_details: "รายละเอียดห้อง",
                view_details: "ดูรายละเอียด",
                room_photos: "รูปภาพห้อง",
                room_images: "รูปภาพห้อง (URL แยกด้วยเส้นใหม่)",
                select_position: "เลือกตำแหน่ง",
                preview: "ดูตัวอย่าง",
                upload_floorplan: "อัปโหลดแผนผัง",
                upload_real_photo: "อัปโหลดภาพจริง",
                floorplan_status: "สถานะแผนผัง",
                real_photo_status: "สถานะภาพจริง",
                entrance_setup: "ตั้งค่าประตูทางเข้า",
                set_entrance: "ตั้งประตูหลัก",
                remove_entrance: "ลบประตู",
                entrance_status: "สถานะประตู",
                not_set: "ยังไม่ได้ตั้งค่า",
                manage_maps: "จัดการแผนที่",
                google_sheets_integration: "Google Sheets Integration",
                building_hierarchy: "โครงสร้างอาคาร",
                add_edit_room: "เพิ่ม/แก้ไขห้อง",
                building_name: "ชื่ออาคาร",
                room_code: "รหัสห้อง",
                room_name: "ชื่อห้อง",
                location: "ตำแหน่ง",
                using_default: "ใช้ค่าเริ่มต้น"
            },
            en: {
                // ข้อความภาษาอังกฤษ - English text translations
                system_title: "🏫 Smart School Map System",
                system_subtitle: "Find classrooms and locations with voice navigation",
                admin_login: "🔐 Admin Login",
                username: "Username:",
                password: "Password:",
                login: "Login",
                logout: "Logout", 
                admin: "Admin",
                search_rooms: "Search",
                map: "Map",
                manage: "Manage",
                search_title: "Search Classrooms and Locations",
                search_placeholder: "🔍 Type room name, code or location...",
                search: "Search",
                classrooms: "Classrooms",
                classrooms_desc: "All regular classrooms",
                special_rooms: "Special Rooms",
                special_rooms_desc: "Laboratory rooms",
                facilities: "Facilities",
                facilities_desc: "Library, Cafeteria",
                offices: "Offices",
                offices_desc: "Administration offices",
                school_map: "School Map",
                room_info: "Room Information",
                click_marker: "Click on map markers to view detailed information",
                symbols: "Symbol Guide",
                classroom: "Classroom",
                computer_room: "Computer Room",
                library: "Library",
                cafeteria: "Cafeteria", 
                entrance: "Entrance",
                hours: "Operating Hours",
                building: "Building",
                description: "Description",
                start_navigation: "Start Navigation",
                voice: "Voice",
                system_management: "System Management",
                manage_buildings: "Manage Buildings",
                manage_rooms: "Manage Rooms",
                load_sample: "Load Sample",
                clear_all: "Clear All",
                save: "Save",
                clear: "Clear",
                default_password: "Default password: <strong>admin / 1234</strong>",
                back_to_main: "Back to Main",
                floor_plan: "Floor Plan",
                real_photo: "Real Photo",
                fullscreen: "Fullscreen",
                room_details: "Room Details",
                view_details: "View Details",
                room_photos: "Room Photos",
                room_images: "Room Images (URLs separated by new lines)",
                select_position: "Select Position",
                preview: "Preview",
                upload_floorplan: "Upload Floor Plan",
                upload_real_photo: "Upload Real Photo",
                floorplan_status: "Floor Plan Status",
                real_photo_status: "Real Photo Status",
                entrance_setup: "Entrance Setup",
                set_entrance: "Set Main Entrance",
                remove_entrance: "Remove Entrance",
                entrance_status: "Entrance Status",
                not_set: "Not set yet",
                manage_maps: "Manage Maps",
                google_sheets_integration: "Google Sheets Integration",
                building_hierarchy: "Building Hierarchy",
                add_edit_room: "Add/Edit Room",
                building_name: "Building Name",
                room_code: "Room Code",
                room_name: "Room Name",
                location: "Location",
                using_default: "Using default"
            }
        };

        // =================== Enhanced Sample Data - ข้อมูลตัวอย่างปรับปรุงแล้ว ===================
        const sampleRoomData = {
            'R001': {
                code: 'R001',
                name: 'ห้องเรียน ม.1/1',
                building: 'อาคาร 1',
                location: 'ชั้น 1',
                description: 'ห้องเรียนปกติสำหรับนักเรียนชั้นมัธยมศึกษาปีที่ 1',
                hours: '08:00 - 16:30',
                status: 'active',
                x: 20, y: 30,
                images: [
                    'https://picsum.photos/400/300?random=1',
                    'https://picsum.photos/400/300?random=2'
                ]
            },
            'R002': {
                code: 'R002',
                name: 'ห้องเรียน ม.1/2',
                building: 'อาคาร 1',
                location: 'ชั้น 1',
                description: 'ห้องเรียนปกติสำหรับนักเรียนชั้นมัธยมศึกษาปีที่ 1',
                hours: '08:00 - 16:30',
                status: 'active',
                x: 45, y: 30,
                images: [
                    'https://picsum.photos/400/300?random=3'
                ]
            },
            'R003': {
                code: 'R003',
                name: 'ห้องเรียน ม.1/3',
                building: 'อาคาร 1',
                location: 'ชั้น 1',
                description: 'ห้องเรียนปกติสำหรับนักเรียนชั้นมัธยมศึกษาปีที่ 1',
                hours: '08:00 - 16:30',
                status: 'active',
                x: 70, y: 30,
                images: []
            },
            'C001': {
                code: 'C001',
                name: 'ห้องคอมพิวเตอร์ 1',
                building: 'อาคาร 2',
                location: 'ชั้น 2',
                description: 'ห้องปฏิบัติการคอมพิวเตอร์ มีเครื่องคอมพิวเตอร์ 30 เครื่อง',
                hours: '08:00 - 17:00',
                status: 'active',
                x: 25, y: 65,
                images: [
                    'https://picsum.photos/400/300?random=10'
                ]
            },
            'C002': {
                code: 'C002',
                name: 'ห้องคอมพิวเตอร์ 2',
                building: 'อาคาร 2',
                location: 'ชั้น 2',
                description: 'ห้องปฏิบัติการคอมพิวเตอร์ขั้นสูง มีเครื่องคอมพิวเตอร์ 25 เครื่อง',
                hours: '08:00 - 17:00',
                status: 'active',
                x: 55, y: 65,
                images: [
                    'https://picsum.photos/400/300?random=11',
                    'https://picsum.photos/400/300?random=12'
                ]
            },
            'L001': {
                code: 'L001',
                name: 'ห้องสมุดหลัก',
                building: 'ห้องสมุด',
                location: 'ชั้น 1',
                description: 'ห้องสมุดหลักของโรงเรียน มีหนังสือมากกว่า 15,000 เล่ม',
                hours: '07:30 - 18:00',
                status: 'active',
                x: 80, y: 70,
                images: [
                    'https://picsum.photos/400/300?random=14',
                    'https://picsum.photos/400/300?random=15'
                ]
            },
            'LAB001': {
                code: 'LAB001',
                name: 'ห้องปฏิบัติการเคมี',
                building: 'อาคาร 3',
                location: 'ชั้น 3',
                description: 'ห้องปฏิบัติการเคมีพร้อมอุปกรณ์ครบครัน',
                hours: '08:00 - 17:00',
                status: 'active',
                x: 15, y: 85,
                images: [
                    'https://picsum.photos/400/300?random=16'
                ]
            },
            'LAB002': {
                code: 'LAB002',
                name: 'ห้องปฏิบัติการฟิสิกส์',
                building: 'อาคาร 3',
                location: 'ชั้น 3',
                description: 'ห้องปฏิบัติการฟิสิกส์พร้อมอุปกรณ์การทดลอง',
                hours: '08:00 - 17:00',
                status: 'active',
                x: 45, y: 85,
                images: []
            },
            'CAFE001': {
                code: 'CAFE001',
                name: 'โรงอาหารหลัก',
                building: 'โรงอาหาร',
                location: 'ชั้น 1',
                description: 'โรงอาหารหลักของโรงเรียน รองรับนักเรียน 500 คน',
                hours: '06:30 - 14:00',
                status: 'active',
                x: 85, y: 40,
                images: [
                    'https://picsum.photos/400/300?random=17',
                    'https://picsum.photos/400/300?random=18'
                ]
            },
            'OFF001': {
                code: 'OFF001',
                name: 'ห้องผู้อำนวยการ',
                building: 'อาคาร 1',
                location: 'ชั้น 2',
                description: 'ห้องทำงานของผู้อำนวยการโรงเรียน',
                hours: '08:00 - 16:30',
                status: 'active',
                x: 10, y: 50,
                images: []
            }
        };

        // =================== Utility Functions - ฟังก์ชันยูทิลิตี้ ===================
        
        // ฟังก์ชันดึงไอคอนห้อง - Get room icon function
        function getRoomIcon(roomName) {
            const lowerName = roomName.toLowerCase();
            if (lowerName.includes('computer') || lowerName.includes('คอมพิวเตอร์')) return '💻';
            if (lowerName.includes('library') || lowerName.includes('สมุด')) return '📚';
            if (lowerName.includes('cafeteria') || lowerName.includes('อาหาร')) return '🍽️';
            if (lowerName.includes('music') || lowerName.includes('ดนตรี')) return '🎵';
            if (lowerName.includes('art') || lowerName.includes('ศิลปะ')) return '🎨';
            if (lowerName.includes('gym') || lowerName.includes('ยิม')) return '🏃';
            if (lowerName.includes('lab') || lowerName.includes('ปฏิบัติการ') || lowerName.includes('เคมี') || lowerName.includes('ฟิสิกส์')) return '🧪';
            if (lowerName.includes('office') || lowerName.includes('สำนักงาน') || lowerName.includes('ผู้อำนวยการ')) return '🏢';
            return '🎓';
        }

        // =================== Language Functions - ฟังก์ชันภาษา ===================
        
        // ฟังก์ชันสลับภาษา - Toggle language function
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'th' ? 'en' : 'th';
            localStorage.setItem('preferredLanguage', currentLanguage);
            updateTexts();
            updatePlaceholders();
            updateLanguageButton();
            showNotification(
                currentLanguage === 'th' ? '🇹🇭 เปลี่ยนเป็นภาษาไทย' : '🇺🇸 Changed to English',
                'success'
            );
        }

        // ฟังก์ชันอัปเดตปุ่มภาษา - Update language button function
        function updateLanguageButton() {
            const languageText = document.getElementById('languageText');
            if (languageText) {
                languageText.textContent = currentLanguage === 'th' ? 'ไทย' : 'EN';
            }
        }

        // ฟังก์ชันสลับแอดมิน - Toggle admin function
        function toggleAdmin() {
            if (isAdminMode) {
                logout();
            } else {
                showAdminLogin();
            }
        }

        // ฟังก์ชันอัปเดตปุ่มแอดมิน - Update admin button function
        function updateAdminButton() {
            const adminButton = document.getElementById('adminButton');
            const adminText = document.getElementById('adminText');
            
            if (adminButton && adminText) {
                if (isAdminMode) {
                    adminButton.classList.add('logged-in');
                    adminText.textContent = currentLanguage === 'th' ? 'ออกจากระบบ' : 'Logout';
                } else {
                    adminButton.classList.remove('logged-in');
                    adminText.textContent = 'Admin';
                }
            }
        }

        // ฟังก์ชันอัปเดตข้อความ - Update texts function
        function updateTexts() {
            const texts = translations[currentLanguage];
            document.querySelectorAll('[data-text]').forEach(element => {
                const key = element.dataset.text;
                if (texts[key]) {
                    // ตรวจสอบ custom content ก่อน
                    const customKey = `${key}_${currentLanguage}`;
                    if (customContent[customKey]) {
                        if (element.innerHTML.includes('<strong>')) {
                            element.innerHTML = customContent[customKey];
                        } else {
                            element.textContent = customContent[customKey];
                        }
                    } else {
                        if (element.innerHTML.includes('<strong>')) {
                            element.innerHTML = texts[key];
                        } else {
                            element.textContent = texts[key];
                        }
                    }
                }
            });
        }

        // ฟังก์ชันอัปเดต placeholder - Update placeholders function
        function updatePlaceholders() {
            const texts = translations[currentLanguage];
            document.querySelectorAll('[data-placeholder]').forEach(element => {
                const key = element.dataset.placeholder;
                if (texts[key]) {
                    const customKey = `${key}_${currentLanguage}`;
                    if (customContent[customKey]) {
                        element.placeholder = customContent[customKey];
                    } else {
                        element.placeholder = texts[key];
                    }
                }
            });
        }

        // =================== Enhanced Theme Functions - ฟังก์ชันธีมปรับปรุงแล้ว ===================
        
        // ฟังก์ชันใช้ธีม - Apply theme function
        function applyTheme(themeName) {
            currentTheme = themeName;
            document.body.setAttribute('data-theme', themeName);
            
            // อัปเดตการเลือกธีม
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === themeName) {
                    option.classList.add('active');
                }
            });
            
            localStorage.setItem('selectedTheme', themeName);
            showNotification(`🎨 เปลี่ยนธีมเป็น ${themeName}`, 'success');
        }

        // ฟังก์ชันอัปเดตสีแบบกำหนดเอง - Update custom color function
        function updateCustomColor(colorType, value) {
            const root = document.documentElement;
            const colorMap = {
                'primary': '--primary-color',
                'secondary': '--secondary-color',
                'accent': '--accent-color',
                'danger': '--danger-color',
                'warning': '--warning-color',
                'info': '--info-color'
            };
            
            if (colorMap[colorType]) {
                root.style.setProperty(colorMap[colorType], value);
                
                // อัปเดต gradient สำหรับ primary และ secondary
                if (colorType === 'primary' || colorType === 'secondary') {
                    const primaryColor = getComputedStyle(root).getPropertyValue('--primary-color').trim();
                    const secondaryColor = getComputedStyle(root).getPropertyValue('--secondary-color').trim();
                    root.style.setProperty('--background-gradient', `linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%)`);
                }
            }
        }

        // ฟังก์ชันบันทึกการตั้งค่าธีม - Save theme settings function
        function saveThemeSettings() {
            const themeSettings = {
                theme: currentTheme,
                customColors: {
                    primary: document.getElementById('primaryColor').value,
                    secondary: document.getElementById('secondaryColor').value,
                    accent: document.getElementById('accentColor').value,
                    danger: document.getElementById('dangerColor').value,
                    warning: document.getElementById('warningColor').value,
                    info: document.getElementById('infoColor').value
                }
            };
            
            localStorage.setItem('themeSettings', JSON.stringify(themeSettings));
            showNotification('✅ บันทึกการตั้งค่าธีมเรียบร้อย', 'success');
        }

        // ฟังก์ชันรีเซ็ตธีม - Reset theme function
        function resetTheme() {
            if (confirm('คุณต้องการรีเซ็ตธีมเป็นค่าเริ่มต้นหรือไม่?')) {
                applyTheme('default');
                document.getElementById('primaryColor').value = '#667eea';
                document.getElementById('secondaryColor').value = '#764ba2';
                document.getElementById('accentColor').value = '#28a745';
                document.getElementById('dangerColor').value = '#dc3545';
                document.getElementById('warningColor').value = '#ffc107';
                document.getElementById('infoColor').value = '#17a2b8';
                
                // รีเซ็ตสีใน CSS
                const root = document.documentElement;
                root.style.removeProperty('--primary-color');
                root.style.removeProperty('--secondary-color');
                root.style.removeProperty('--accent-color');
                root.style.removeProperty('--danger-color');
                root.style.removeProperty('--warning-color');
                root.style.removeProperty('--info-color');
                root.style.removeProperty('--background-gradient');
                
                localStorage.removeItem('themeSettings');
                showNotification('🔄 รีเซ็ตธีมเรียบร้อย', 'success');
            }
        }

        // ฟังก์ชันส่งออกธีม - Export theme function
        function exportTheme() {
            const themeSettings = {
                theme: currentTheme,
                customColors: {
                    primary: document.getElementById('primaryColor').value,
                    secondary: document.getElementById('secondaryColor').value,
                    accent: document.getElementById('accentColor').value,
                    danger: document.getElementById('dangerColor').value,
                    warning: document.getElementById('warningColor').value,
                    info: document.getElementById('infoColor').value
                }
            };
            
            const blob = new Blob([JSON.stringify(themeSettings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'school-map-theme.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('📥 ส่งออกธีมเรียบร้อย', 'success');
        }

        // ฟังก์ชันนำเข้าธีม - Import theme function
        function importTheme() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const themeSettings = JSON.parse(e.target.result);
                            
                            // ใช้ธีม
                            if (themeSettings.theme) {
                                applyTheme(themeSettings.theme);
                            }
                            
                            // ใช้สีแบบกำหนดเอง
                            if (themeSettings.customColors) {
                                Object.keys(themeSettings.customColors).forEach(colorType => {
                                    const value = themeSettings.customColors[colorType];
                                    const inputId = colorType + 'Color';
                                    const input = document.getElementById(inputId);
                                    if (input) {
                                        input.value = value;
                                        updateCustomColor(colorType, value);
                                    }
                                });
                            }
                            
                            showNotification('✅ นำเข้าธีมเรียบร้อย', 'success');
                        } catch (error) {
                            showNotification('❌ ไฟล์ธีมไม่ถูกต้อง', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // =================== Enhanced Content Management Functions - ฟังก์ชันจัดการเนื้อหาปรับปรุงแล้ว ===================
        
        // ฟังก์ชันสลับกลุ่มเนื้อหา - Toggle content group function
        function toggleContentGroup(groupId) {
            const content = document.getElementById(groupId);
            const header = content.parentElement.querySelector('.content-group-header');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                header.querySelector('i').style.transform = 'rotate(0deg)';
            } else {
                // ปิดกลุ่มอื่นทั้งหมด
                document.querySelectorAll('.content-group-body').forEach(item => {
                    item.classList.remove('expanded');
                    item.parentElement.querySelector('.content-group-header i').style.transform = 'rotate(0deg)';
                });
                
                content.classList.add('expanded');
                header.querySelector('i').style.transform = 'rotate(180deg)';
            }
        }

        // ฟังก์ชันอัปเดตเนื้อหา - Update content function
        function updateContent(key, language, value) {
            const customKey = `${key}_${language}`;
            customContent[customKey] = value;
            
            // อัปเดตทันทีถ้าเป็นภาษาปัจจุบัน
            if (language === currentLanguage) {
                const elements = document.querySelectorAll(`[data-text="${key}"]`);
                elements.forEach(element => {
                    if (element.innerHTML.includes('<strong>')) {
                        element.innerHTML = value;
                    } else {
                        element.textContent = value;
                    }
                });
                
                const placeholderElements = document.querySelectorAll(`[data-placeholder="${key}"]`);
                placeholderElements.forEach(element => {
                    element.placeholder = value;
                });
            }
        }

        // ฟังก์ชันบันทึกเนื้อหาทั้งหมด - Save all content function
        function saveAllContent() {
            localStorage.setItem('customContent', JSON.stringify(customContent));
            showNotification('✅ บันทึกเนื้อหาทั้งหมดเรียบร้อย', 'success');
        }

        // ฟังก์ชันรีเซ็ตเนื้อหา - Reset all content function
        function resetAllContent() {
            if (confirm('คุณต้องการรีเซ็ตเนื้อหาทั้งหมดเป็นค่าเริ่มต้นหรือไม่?')) {
                customContent = {};
                localStorage.removeItem('customContent');
                
                // รีเซ็ตค่าในฟอร์ม
                document.querySelectorAll('#content-content-manage input, #content-content-manage textarea').forEach(input => {
                    const defaultValue = input.getAttribute('value') || '';
                    input.value = defaultValue;
                });
                
                updateTexts();
                updatePlaceholders();
                showNotification('🔄 รีเซ็ตเนื้อหาเรียบร้อย', 'success');
            }
        }

        // ฟังก์ชันส่งออกเนื้อหา - Export content function
        function exportContent() {
            const contentData = {
                customContent: customContent,
                defaultTexts: translations
            };
            
            const blob = new Blob([JSON.stringify(contentData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'school-map-content.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('📥 ส่งออกเนื้อหาเรียบร้อย', 'success');
        }

        // ฟังก์ชันนำเข้าเนื้อหา - Import content function
        function importContent() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const contentData = JSON.parse(e.target.result);
                            
                            if (contentData.customContent) {
                                customContent = contentData.customContent;
                                localStorage.setItem('customContent', JSON.stringify(customContent));
                                
                                // อัปเดตฟอร์ม
                                Object.keys(customContent).forEach(key => {
                                    const input = document.getElementById(key);
                                    if (input) {
                                        input.value = customContent[key];
                                    }
                                });
                                
                                updateTexts();
                                updatePlaceholders();
                                showNotification('✅ นำเข้าเนื้อหาเรียบร้อย', 'success');
                            }
                        } catch (error) {
                            showNotification('❌ ไฟล์เนื้อหาไม่ถูกต้อง', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // =================== Enhanced Room Management Functions - ฟังก์ชันจัดการห้องปรับปรุงแล้ว ===================
        
        // ฟังก์ชันกรองห้อง - Filter rooms function
        function filterRooms() {
            const searchText = document.getElementById('roomSearchInput').value.toLowerCase();
            const buildingFilter = document.getElementById('buildingFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            let filteredRooms = Object.values(roomData);
            
            // กรองตามข้อความค้นหา
            if (searchText) {
                filteredRooms = filteredRooms.filter(room => 
                    room.name.toLowerCase().includes(searchText) ||
                    room.code.toLowerCase().includes(searchText) ||
                    room.location.toLowerCase().includes(searchText) ||
                    room.building.toLowerCase().includes(searchText)
                );
            }
            
            // กรองตามอาคาร
            if (buildingFilter) {
                filteredRooms = filteredRooms.filter(room => room.building === buildingFilter);
            }
            
            // กรองตามสถานะ
            if (statusFilter) {
                filteredRooms = filteredRooms.filter(room => room.status === statusFilter);
            }
            
            renderRoomGrid(filteredRooms);
        }

        // ฟังก์ชันแสดงตารางห้อง - Render room grid function
        function renderRoomGrid(rooms = null) {
            const container = document.getElementById('roomGrid');
            const roomCount = document.getElementById('roomCount');
            if (!container) return;
            
            const roomsToShow = rooms || Object.values(roomData);
            
            if (roomCount) {
                roomCount.textContent = `(${roomsToShow.length} ห้อง)`;
            }
            
            if (roomsToShow.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-search" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>ไม่พบห้องที่ตรงกับเงื่อนไข</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = roomsToShow.map(room => `
                <div class="room-card" data-room="${room.code}">
                    <div class="status-badge ${room.status}"></div>
                    <div class="room-card-header">
                        <div>
                            <div class="room-card-title">
                                ${getRoomIcon(room.name)} ${room.name}
                            </div>
                            <div class="room-card-info">
                                ${room.building} - ${room.location}
                            </div>
                        </div>
                        <div class="room-card-code">${room.code}</div>
                    </div>
                    <div class="room-card-info">
                        <strong>เวลา:</strong> ${room.hours}<br>
                        <strong>สถานะ:</strong> ${room.status === 'active' ? 'แสดง' : 'ซ่อน'}
                    </div>
                    <div class="room-card-actions">
                        <button class="room-card-btn edit" onclick="editRoom('${room.code}')" title="แก้ไข">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="room-card-btn view" onclick="viewOnMap('${room.code}')" title="ดูบนแผนที่">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                        <button class="room-card-btn delete" onclick="deleteRoom('${room.code}')" title="ลบ">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ฟังก์ชันส่งออกข้อมูลห้อง - Export room data function
        function exportRoomData() {
            const data = {
                rooms: roomData,
                buildings: buildingData,
                entrance: entrancePosition,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'school-map-data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('📥 ส่งออกข้อมูลเรียบร้อย', 'success');
        }

        // ฟังก์ชันนำเข้าข้อมูลห้อง - Import room data function
        function importRoomData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.rooms) {
                                roomData = data.rooms;
                                saveDataToLocalStorage();
                            }
                            
                            if (data.buildings) {
                                buildingData = data.buildings;
                                localStorage.setItem('buildingData', JSON.stringify(buildingData));
                            }
                            
                            if (data.entrance) {
                                entrancePosition = data.entrance;
                                localStorage.setItem('entrancePosition', JSON.stringify(entrancePosition));
                            }
                            
                            updateUI();
                            showNotification('✅ นำเข้าข้อมูลเรียบร้อย', 'success');
                        } catch (error) {
                            showNotification('❌ ไฟล์ข้อมูลไม่ถูกต้อง', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // =================== Login Functions - ฟังก์ชันล็อกอิน ===================
        
        // ฟังก์ชันล็อกอินแอดมิน - Admin login function
        function adminLogin(event) {
            if (event) event.preventDefault();
            
            const usernameEl = document.getElementById('username');
            const passwordEl = document.getElementById('password');
            
            if (!usernameEl || !passwordEl) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'ไม่พบฟอร์มล็อกอิน' : 'Login form not found'), 'error');
                return;
            }
            
            const username = usernameEl.value;
            const password = passwordEl.value;
            
            if (username === 'admin' && password === '1234') {
                isAdminMode = true;
                showMainApp(true);
                showNotification('✅ ' + (currentLanguage === 'th' ? 'เข้าสู่ระบบสำเร็จ!' : 'Login successful!'), 'success');
            } else {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง' : 'Invalid username or password'), 'error');
            }
        }

        // ฟังก์ชันแสดงหน้าล็อกอินแอดมิน - Show admin login page function
        function showAdminLogin() {
            const loginPage = document.getElementById('loginPage');
            const mainApp = document.getElementById('mainApp');
            
            if (loginPage) loginPage.style.display = 'block';
            if (mainApp) mainApp.style.display = 'none';
        }

        // ฟังก์ชันออกจากระบบ - Logout function
        function logout() {
            isAdminMode = false;
            showMainApp(false);
            
            const usernameEl = document.getElementById('username');
            const passwordEl = document.getElementById('password');
            
            if (usernameEl) usernameEl.value = '';
            if (passwordEl) passwordEl.value = '';
            
            showNotification('👋 ' + (currentLanguage === 'th' ? 'ออกจากระบบเรียบร้อย' : 'Logged out successfully'), 'success');
        }

        // ฟังก์ชันแสดงแอปหลัก - Show main app function
        function showMainApp(isAdmin = false) {
            const loginPage = document.getElementById('loginPage');
            const mainApp = document.getElementById('mainApp');
            const navTabs = document.getElementById('navTabs');
            const mainHeader = document.getElementById('mainHeader');
            
            if (loginPage) loginPage.style.display = 'none';
            if (mainApp) mainApp.style.display = 'block';
            
            if (isAdmin) {
                isAdminMode = true;
                if (navTabs) navTabs.classList.add('hidden');
                if (mainHeader) mainHeader.classList.add('admin-mode');
                showPage('admin');
            } else {
                isAdminMode = false;
                if (navTabs) navTabs.classList.remove('hidden');
                if (mainHeader) mainHeader.classList.remove('admin-mode');
                showPage('search');
            }
            
            updateAdminButton();
            loadInitialData();
        }

        // =================== Page Management Functions - ฟังก์ชันจัดการหน้าเว็บ ===================
        
        // ฟังก์ชันแสดงหน้า - Show page function
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            const targetTab = Array.from(document.querySelectorAll('.nav-tab')).find(tab => 
                tab.onclick && tab.onclick.toString().includes(`showPage('${pageId}')`)
            );
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            if (pageId === 'map') {
                setTimeout(() => {
                    updateRoomMarkers();
                }, 100);
            }
        }

        // =================== Search Functions - ฟังก์ชันค้นหา ===================
        
        // ฟังก์ชันจัดการการกดปุ่ม Enter ในช่องค้นหา - Handle Enter key press in search
        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                searchRoom();
            }
        }

        // ฟังก์ชันค้นหาแบบสด - Live search function
        function liveSearch() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            const resultsContainer = document.getElementById('liveResults');
            
            if (!resultsContainer) return;
            
            if (!searchTerm) {
                resultsContainer.innerHTML = '';
                return;
            }
            
            const results = searchRooms(searchTerm);
            displaySearchResults(results);
        }

        // ฟังก์ชันค้นหาห้อง - Search room function
        function searchRoom() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (!searchTerm) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'กรุณาใส่คำค้นหา' : 'Please enter search term'), 'error');
                return;
            }
            
            const results = searchRooms(searchTerm);
            displaySearchResults(results);
        }

        // ฟังก์ชันค้นหาห้องในข้อมูล - Search rooms in data function
        function searchRooms(searchTerm) {
            const rooms = Object.values(roomData);
            return rooms.filter(room => {
                if (room.status !== 'active') return false;
                
                const searchFields = [
                    room.name.toLowerCase(),
                    room.code.toLowerCase(),
                    room.location.toLowerCase(),
                    room.building.toLowerCase(),
                    room.description.toLowerCase()
                ];
                return searchFields.some(field => field.includes(searchTerm));
            });
        }

        // ฟังก์ชันแสดงผลการค้นหา - Display search results function
        function displaySearchResults(results) {
            const resultsContainer = document.getElementById('liveResults');
            if (!resultsContainer) return;
            
            if (results.length > 0) {
                resultsContainer.innerHTML = results.map(room => `
                    <div class="search-result-item" onclick="viewOnMap('${room.code}')">
                        <div class="search-result-header">
                            <div class="search-result-title">
                                ${getRoomIcon(room.name)} ${room.name}
                            </div>
                            <div class="search-result-code">${room.code}</div>
                        </div>
                        <div class="search-result-info">
                            ${room.building} - ${room.location}
                        </div>
                    </div>
                `).join('');
            } else {
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 15px; opacity: 0.7;">🔍</div>
                        <p>${currentLanguage === 'th' ? 'ไม่พบผลการค้นหา' : 'No results found'}</p>
                    </div>
                `;
            }
        }

        // ฟังก์ชันค้นหาเร็วตามหมวดหมู่ - Quick search by category function
        function quickSearch(category) {
            let searchResults = [];
            
            switch(category) {
                case 'classroom':
                    searchResults = Object.values(roomData).filter(room => 
                        room.status === 'active' && (
                        room.name.includes('ห้องเรียน') || room.name.includes('Classroom') || room.name.includes('ม.'))
                    );
                    break;
                case 'special':
                    searchResults = Object.values(roomData).filter(room => 
                        room.status === 'active' && (
                        room.name.includes('คอมพิวเตอร์') || room.name.includes('Computer') ||
                        room.name.includes('ปฏิบัติการ') || room.name.includes('Lab'))
                    );
                    break;
                case 'facilities':
                    searchResults = Object.values(roomData).filter(room => 
                        room.status === 'active' && (
                        room.name.includes('สมุด') || room.name.includes('Library') ||
                        room.name.includes('อาหาร') || room.name.includes('Cafeteria'))
                    );
                    break;
                case 'office':
                    searchResults = Object.values(roomData).filter(room => 
                        room.status === 'active' && (
                        room.name.includes('สำนักงาน') || room.name.includes('Office'))
                    );
                    break;
            }
            
            displaySearchResults(searchResults);
        }

        // =================== Map Functions - ฟังก์ชันแผนที่ ===================
        
        // ฟังก์ชันดูห้องบนแผนที่ - View room on map function
        function viewOnMap(roomCode) {
            showPage('map');
            setTimeout(() => {
                highlightRoom(roomCode);
                showRoomInfoOverlay(roomCode);
            }, 300);
        }

        // ฟังก์ชันไฮไลต์ห้อง - Highlight room function
        function highlightRoom(roomCode) {
            document.querySelectorAll('.room-marker').forEach(marker => {
                marker.classList.remove('highlighted');
            });
            
            const targetMarker = document.querySelector(`[data-room="${roomCode}"]`);
            if (targetMarker) {
                targetMarker.classList.add('highlighted');
                selectedRoom = roomCode;
                
                setTimeout(() => {
                    targetMarker.classList.remove('highlighted');
                }, 3000);
            }
        }

        // ฟังก์ชันแสดงข้อมูลห้องแบบ overlay - Show room info overlay function
        function showRoomInfoOverlay(roomCode) {
            const room = roomData[roomCode];
            if (!room) return;

            selectedRoom = roomCode;
            
            const overlay = document.getElementById('roomInfoOverlay');
            if (!overlay) return;
            
            const roomName = document.getElementById('overlayRoomName');
            const roomLocation = document.getElementById('overlayRoomLocation');
            const roomHours = document.getElementById('overlayRoomHours');
            const roomBuilding = document.getElementById('overlayRoomBuilding');
            const roomDescription = document.getElementById('overlayRoomDescription');
            
            if (roomName) roomName.innerHTML = `${getRoomIcon(room.name)} ${room.name}`;
            if (roomLocation) roomLocation.textContent = room.location;
            if (roomHours) roomHours.textContent = room.hours;
            if (roomBuilding) roomBuilding.textContent = room.building;
            if (roomDescription) roomDescription.textContent = room.description;
            
            updateOverlayImageGallery(room.images);
            generateOverlayNavigationSteps(room);
            
            overlay.style.display = 'flex';
        }

        // ฟังก์ชันปิด overlay ข้อมูลห้อง - Close room info overlay function
        function closeRoomInfoOverlay() {
            const overlay = document.getElementById('roomInfoOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            selectedRoom = null;
        }

        // ฟังก์ชันอัปเดตแกลลอรี่รูปภาพใน overlay - Update overlay image gallery function
        function updateOverlayImageGallery(images) {
            const galleryContainer = document.getElementById('overlayImageGallery');
            const gallerySection = document.getElementById('overlayRoomGallery');
            
            if (!galleryContainer || !gallerySection) return;
            
            if (images && images.length > 0) {
                gallerySection.style.display = 'block';
                galleryContainer.innerHTML = images.map((url, index) => `
                    <img src="${url}" 
                         alt="รูปห้อง ${index + 1}" 
                         class="room-image" 
                         onclick="openImageModal('${url}')" 
                         onerror="this.style.display='none'">
                `).join('');
            } else {
                gallerySection.style.display = 'none';
            }
        }

        // ฟังก์ชันสร้างขั้นตอนการนำทางใน overlay - Generate overlay navigation steps function
        function generateOverlayNavigationSteps(room) {
            const routeSteps = document.getElementById('overlayRouteSteps');
            if (!routeSteps) return;
            
            if (!entrancePosition) {
                routeSteps.innerHTML = `
                    <div style="text-align: center; padding: 20px; background: #fff3cd; border-radius: var(--border-radius); color: #856404;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p style="margin: 8px 0 0 0; font-size: 14px;">
                            ${currentLanguage === 'th' ? 'ยังไม่ได้ตั้งค่าประตูทางเข้า' : 'Main entrance not set yet'}
                        </p>
                    </div>
                `;
                return;
            }
            
            const deltaX = room.x - entrancePosition.x;
            const deltaY = room.y - entrancePosition.y;
            const distance = Math.round(Math.sqrt(deltaX * deltaX + deltaY * deltaY) * 2);
            
            let direction = '';
            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                direction = deltaX > 0 ? 
                    (currentLanguage === 'th' ? 'ทางขวา' : 'to the right') : 
                    (currentLanguage === 'th' ? 'ทางซ้าย' : 'to the left');
            } else {
                direction = deltaY > 0 ? 
                    (currentLanguage === 'th' ? 'ด้านล่าง' : 'downward') : 
                    (currentLanguage === 'th' ? 'ด้านบน' : 'upward');
            }
            
            const steps = [
                {
                    step: 1,
                    text: currentLanguage === 'th' ? `เริ่มต้นจาก${entrancePosition.name}` : `Start from ${entrancePosition.name}`,
                    distance: '0m'
                },
                {
                    step: 2,
                    text: currentLanguage === 'th' ? `เดินไป${direction} ประมาณ ${distance} เมตร` : `Walk ${direction} about ${distance} meters`,
                    distance: `${distance}m`
                },
                {
                    step: 3,
                    text: currentLanguage === 'th' ? `มองหา ${room.building}` : `Look for ${room.building}`,
                    distance: '10m'
                },
                {
                    step: 4,
                    text: currentLanguage === 'th' ? `เข้าสู่ ${room.name}` : `Enter ${room.name}`,
                    distance: '0m'
                }
            ];
            
            routeSteps.innerHTML = `
                <div style="background: var(--card-background); padding: 20px; border-radius: var(--border-radius); margin-top: 15px;">
                    <h4 style="margin: 0 0 15px 0; font-size: 16px; color: var(--primary-color);">
                        <i class="fas fa-route"></i> ${currentLanguage === 'th' ? 'ขั้นตอนการเดินทาง' : 'Navigation Steps'}
                    </h4>
                    ${steps.map(step => `
                        <div style="display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border-color);">
                            <div style="
                                background: var(--primary-color);
                                color: white;
                                width: 24px;
                                height: 24px;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 12px;
                                font-weight: bold;
                                flex-shrink: 0;
                            ">${step.step}</div>
                            <div style="flex: 1; font-size: 14px;">${step.text}</div>
                            <div style="
                                background: rgba(102, 126, 234, 0.1);
                                padding: 4px 8px;
                                border-radius: 12px;
                                font-size: 11px;
                                color: var(--primary-color);
                                font-weight: 600;
                            ">${step.distance}</div>
                            <button onclick="speakStep('${step.text}')" style="
                                background: var(--accent-color);
                                color: white;
                                border: none;
                                border-radius: 50%;
                                width: 24px;
                                height: 24px;
                                cursor: pointer;
                                font-size: 10px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">
                                <i class="fas fa-volume-up"></i>
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ฟังก์ชันอัปเดตมาร์กเกอร์ห้อง - Update room markers function
        function updateRoomMarkers() {
            const markersContainer = document.getElementById('roomMarkers');
            if (!markersContainer) return;
            
            const activeRooms = Object.values(roomData).filter(room => room.status === 'active');
            
            markersContainer.innerHTML = activeRooms.map(room => {
                return `
                    <div class="room-marker" 
                         data-room="${room.code}" 
                         onclick="showRoomInfoOverlay('${room.code}')" 
                         style="top: ${room.y}%; left: ${room.x}%;"
                         title="${room.name}">
                        ${getRoomIcon(room.name)}
                    </div>
                `;
            }).join('') + (entrancePosition ? `
                <div class="room-marker entrance-marker" 
                     style="top: ${entrancePosition.y}%; left: ${entrancePosition.x}%;"
                     title="${currentLanguage === 'th' ? 'ประตูหลัก' : 'Main Entrance'}"
                     onclick="showEntranceInfo()">
                    🚪
                </div>
            ` : '');
        }

        // ฟังก์ชันเซ็ตรูปแบบแผนที่ - Set map layout function
        function setMapLayout(layout) {
            currentMapLayout = layout;
            
            document.querySelectorAll('.map-control-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.layout === layout) {
                    btn.classList.add('active');
                }
            });
            
            const floorplanMap = document.getElementById('floorplanMap');
            const realMap = document.getElementById('realMap');
            
            if (layout === 'floorplan') {
                if (floorplanMap) floorplanMap.style.display = 'block';
                if (realMap) realMap.style.display = 'none';
                showNotification('📐 ' + (currentLanguage === 'th' ? 'เปลี่ยนเป็นแผนผัง' : 'Switched to Floor Plan'), 'success');
            } else {
                if (floorplanMap) floorplanMap.style.display = 'none';
                if (realMap) realMap.style.display = 'block';
                showNotification('📸 ' + (currentLanguage === 'th' ? 'เปลี่ยนเป็นภาพจริง' : 'Switched to Real Photo'), 'success');
            }
        }

        // ฟังก์ชันสลับเต็มจอ - Toggle fullscreen function
        function toggleFullscreen() {
            const mapArea = document.getElementById('mapArea');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            if (!mapArea || !fullscreenBtn) return;
            
            if (isFullscreen) {
                mapArea.classList.remove('fullscreen');
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> <span data-text="fullscreen">เต็มจอ</span>';
                isFullscreen = false;
                showNotification('📱 ' + (currentLanguage === 'th' ? 'ออกจากโหมดเต็มจอ' : 'Exit fullscreen mode'), 'info');
            } else {
                mapArea.classList.add('fullscreen');
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> <span data-text="exit_fullscreen">ออกจากเต็มจอ</span>';
                isFullscreen = true;
                showNotification('🖥️ ' + (currentLanguage === 'th' ? 'เข้าโหมดเต็มจอ' : 'Enter fullscreen mode'), 'info');
            }
            
            updateTexts();
        }

        // ฟังก์ชันเปิดโมดัลรูปภาพ - Open image modal function
        function openImageModal(imageUrl) {
            const modal = document.createElement('div');
            modal.className = 'image-modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <img src="${imageUrl}" alt="Room Image">
                <button class="image-modal-close" onclick="this.parentElement.remove()">×</button>
            `;
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            document.body.appendChild(modal);
        }

        // =================== Preview Mode Functions - ฟังก์ชันโหมดตัวอย่าง ===================
        
        // ฟังก์ชันแสดงโหมดตัวอย่างแผนที่ - Show map preview mode function
        function showMapPreview() {
            isPreviewMode = true;
            const overlay = document.getElementById('previewModeOverlay');
            const previewMapImage = document.getElementById('previewMapImage');
            const previewRoomMarkers = document.getElementById('previewRoomMarkers');
            
            if (!overlay) return;
            
            if (previewMapImage) {
                if (currentMapLayout === 'floorplan') {
                    previewMapImage.src = floorplanMapImage || document.getElementById('floorplanMap').src;
                } else {
                    previewMapImage.src = realMapImage || document.getElementById('realMap').src;
                }
            }
            
            if (previewRoomMarkers) {
                const activeRooms = Object.values(roomData).filter(room => room.status === 'active');
                previewRoomMarkers.innerHTML = activeRooms.map(room => {
                    return `
                        <div class="room-marker" 
                             style="top: ${room.y}%; left: ${room.x}%; position: absolute; z-index: 30;"
                             title="${room.name}">
                            ${getRoomIcon(room.name)}
                        </div>
                    `;
                }).join('') + (entrancePosition ? `
                    <div class="room-marker entrance-marker" 
                         style="top: ${entrancePosition.y}%; left: ${entrancePosition.x}%; position: absolute; z-index: 30;"
                         title="${currentLanguage === 'th' ? 'ประตูหลัก' : 'Main Entrance'}">
                        🚪
                    </div>
                ` : '');
            }
            
            overlay.style.display = 'flex';
            showNotification('👁️ ' + (currentLanguage === 'th' ? 'เปิดโหมดตัวอย่าง' : 'Preview mode enabled'), 'info');
        }

        // ฟังก์ชันปิดโหมดตัวอย่าง - Close preview mode function
        function closePreviewMode() {
            isPreviewMode = false;
            const overlay = document.getElementById('previewModeOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            showNotification('✖️ ' + (currentLanguage === 'th' ? 'ปิดโหมดตัวอย่าง' : 'Preview mode closed'), 'info');
        }

        // =================== Room Management Functions - ฟังก์ชันจัดการห้อง ===================
        
        // ฟังก์ชันโหลดข้อมูลตัวอย่าง - Load sample data function
        function loadSampleData() {
            roomData = { ...sampleRoomData };
            saveDataToLocalStorage();
            updateUI();
            showNotification('✅ ' + (currentLanguage === 'th' ? 'โหลดข้อมูลตัวอย่างเรียบร้อย!' : 'Sample data loaded successfully!'), 'success');
        }

        // ฟังก์ชันล้างข้อมูลทั้งหมด - Clear all data function
        function clearAllData() {
            if (confirm(currentLanguage === 'th' ? 'คุณต้องการล้างข้อมูลทั้งหมดหรือไม่?' : 'Do you want to clear all data?')) {
                roomData = {};
                saveDataToLocalStorage();
                updateUI();
                showNotification('🗑️ ' + (currentLanguage === 'th' ? 'ล้างข้อมูลทั้งหมดเรียบร้อย' : 'All data cleared'), 'success');
            }
        }

        // ฟังก์ชันแก้ไขห้อง - Edit room function
        function editRoom(roomCode) {
            const room = roomData[roomCode];
            if (!room) {
                showNotification('❌ ไม่พบข้อมูลห้อง', 'error');
                return;
            }
            
            if (activeAdminSection !== 'room-manage') {
                toggleAdminSection('room-manage');
            }
            
            setTimeout(() => {
                fillEditForm(room, roomCode);
                const roomForm = document.getElementById('roomForm');
                if (roomForm) {
                    roomForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 600);
            
            showNotification('📝 ' + (currentLanguage === 'th' ? 'พร้อมแก้ไขข้อมูลห้อง' : 'Ready to edit room'), 'success');
        }

        // ฟังก์ชันกรอกข้อมูลในฟอร์มแก้ไข - Fill edit form function
        function fillEditForm(room, roomCode) {
            const editingRoomId = document.getElementById('editingRoomId');
            const buildingSelect = document.getElementById('buildingSelect');
            const roomCodeEl = document.getElementById('roomCode');
            const roomNameEl = document.getElementById('roomName');
            const roomLocationEl = document.getElementById('roomLocation');
            const roomDescriptionEl = document.getElementById('roomDescription');
            const roomHoursEl = document.getElementById('roomHours');
            const roomActiveEl = document.getElementById('roomActive');
            const roomXEl = document.getElementById('roomX');
            const roomYEl = document.getElementById('roomY');
            const roomImagesEl = document.getElementById('roomImages');
            const positionInfo = document.getElementById('positionInfo');
            
            if (editingRoomId) editingRoomId.value = roomCode;
            if (buildingSelect) buildingSelect.value = room.building || 'อาคาร 1';
            if (roomCodeEl) roomCodeEl.value = room.code || '';
            if (roomNameEl) roomNameEl.value = room.name || '';
            if (roomLocationEl) roomLocationEl.value = room.location || '';
            if (roomDescriptionEl) roomDescriptionEl.value = room.description || '';
            if (roomHoursEl) roomHoursEl.value = room.hours || '08:00 - 17:00';
            if (roomActiveEl) roomActiveEl.checked = room.status === 'active';
            if (roomXEl && room.x !== undefined) roomXEl.value = room.x;
            if (roomYEl && room.y !== undefined) roomYEl.value = room.y;
            if (roomImagesEl) roomImagesEl.value = (room.images || []).join('\n');
            
            if (positionInfo && room.x !== undefined && room.y !== undefined) {
                positionInfo.style.display = 'block';
            }
        }

        // ฟังก์ชันลบห้อง - Delete room function
        function deleteRoom(roomCode) {
            if (confirm(currentLanguage === 'th' ? 'คุณต้องการลบห้องนี้หรือไม่?' : 'Do you want to delete this room?')) {
                delete roomData[roomCode];
                saveDataToLocalStorage();
                updateUI();
                showNotification('🗑️ ' + (currentLanguage === 'th' ? 'ลบห้องเรียบร้อยแล้ว' : 'Room deleted successfully'), 'success');
            }
        }

        // ฟังก์ชันบันทึกห้อง - Save room function
        function saveRoom() {
            const roomCodeEl = document.getElementById('roomCode');
            const roomNameEl = document.getElementById('roomName');
            const editingIdEl = document.getElementById('editingRoomId');
            
            if (!roomCodeEl || !roomNameEl || !editingIdEl) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'ไม่พบฟอร์ม' : 'Form not found'), 'error');
                return;
            }
            
            const roomCode = roomCodeEl.value.trim();
            const roomName = roomNameEl.value.trim();
            const editingId = editingIdEl.value;
            
            if (!roomCode || !roomName) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'กรุณากรอกรหัสห้องและชื่อห้อง' : 'Please fill room code and name'), 'error');
                return;
            }
            
            if (!editingId && roomData[roomCode]) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'รหัสห้องนี้มีอยู่แล้ว' : 'Room code already exists'), 'error');
                return;
            }
            
            const buildingSelect = document.getElementById('buildingSelect');
            const roomLocation = document.getElementById('roomLocation');
            const roomDescription = document.getElementById('roomDescription');
            const roomHours = document.getElementById('roomHours');
            const roomActive = document.getElementById('roomActive');
            const roomX = document.getElementById('roomX');
            const roomY = document.getElementById('roomY');
            const roomImages = document.getElementById('roomImages');
            
            const imageUrls = roomImages ? 
                roomImages.value.split('\n').map(url => url.trim()).filter(url => url) : [];
            
            const roomInfo = {
                code: roomCode,
                name: roomName,
                building: buildingSelect ? buildingSelect.value : 'อาคาร 1',
                location: roomLocation ? roomLocation.value.trim() : '',
                description: roomDescription ? roomDescription.value.trim() : '',
                hours: roomHours ? roomHours.value.trim() || '08:00 - 17:00' : '08:00 - 17:00',
                status: roomActive && roomActive.checked ? 'active' : 'inactive',
                x: roomX && roomX.value ? parseFloat(roomX.value) : (roomData[editingId]?.x || Math.random() * 80 + 10),
                y: roomY && roomY.value ? parseFloat(roomY.value) : (roomData[editingId]?.y || Math.random() * 80 + 10),
                images: imageUrls
            };
            
            if (editingId && editingId !== roomCode) {
                delete roomData[editingId];
            }
            
            roomData[roomCode] = roomInfo;
            saveDataToLocalStorage();
            updateUI();
            clearForm();
            
            const action = editingId ? (currentLanguage === 'th' ? 'แก้ไข' : 'updated') : (currentLanguage === 'th' ? 'เพิ่ม' : 'added');
            showNotification(`✅ ${action}${currentLanguage === 'th' ? 'ข้อมูลห้องเรียบร้อยแล้ว' : ' room successfully'}`, 'success');
        }

        // ฟังก์ชันเคลียร์ฟอร์ม - Clear form function
        function clearForm() {
            const editingRoomId = document.getElementById('editingRoomId');
            const positionInfo = document.getElementById('positionInfo');
            const roomActive = document.getElementById('roomActive');
            
            const formInputs = document.querySelectorAll('#roomForm input, #roomForm textarea, #roomForm select');
            formInputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = true;
                } else if (input.id === 'roomHours') {
                    input.value = '08:00 - 17:00';
                } else {
                    input.value = '';
                }
            });
            
            if (editingRoomId) editingRoomId.value = '';
            if (positionInfo) positionInfo.style.display = 'none';
        }

        // ฟังก์ชันเลือกตำแหน่งบนแผนที่ - Select map position function
        function selectMapPosition() {
            isSelectingPosition = true;
            showPage('map');
            showNotification('📍 ' + (currentLanguage === 'th' ? 'คลิกที่ตำแหน่งบนแผนที่เพื่อเลือกตำแหน่งห้อง' : 'Click on map to select room position'), 'info');
        }

        // =================== Building Management Functions - ฟังก์ชันจัดการอาคาร ===================
        
        // ฟังก์ชันเพิ่มอาคาร - Add building function
        function addBuilding() {
            const newBuildingName = document.getElementById('newBuildingName');
            if (!newBuildingName) return;
            
            const buildingName = newBuildingName.value.trim();
            if (!buildingName) {
                showNotification('❌ กรุณากรอกชื่อนาคาร', 'error');
                return;
            }
            
            if (buildingData.includes(buildingName)) {
                showNotification('❌ ชื่ออาคารนี้มีอยู่แล้ว', 'error');
                return;
            }
            
            buildingData.push(buildingName);
            localStorage.setItem('buildingData', JSON.stringify(buildingData));
            updateBuildingSelect();
            renderBuildingList();
            clearBuildingForm();
            showNotification('✅ เพิ่มอาคารเรียบร้อย', 'success');
        }

        // ฟังก์ชันลบอาคาร - Delete building function
        function deleteBuilding(buildingName) {
            if (confirm(`คุณต้องการลบ ${buildingName} หรือไม่?`)) {
                const roomsInBuilding = Object.values(roomData).filter(room => room.building === buildingName);
                if (roomsInBuilding.length > 0) {
                    const confirmDelete = confirm(`มีห้อง ${roomsInBuilding.length} ห้องในอาคารนี้ ต้องการลบทั้งหมดหรือไม่?`);
                    if (!confirmDelete) return;
                    
                    roomsInBuilding.forEach(room => {
                        delete roomData[room.code];
                    });
                }
                
                buildingData = buildingData.filter(name => name !== buildingName);
                localStorage.setItem('buildingData', JSON.stringify(buildingData));
                updateBuildingSelect();
                renderBuildingList();
                updateUI();
                showNotification('🗑️ ลบอาคารเรียบร้อย', 'success');
            }
        }

        // ฟังก์ชันเคลียร์ฟอร์มอาคาร - Clear building form function
        function clearBuildingForm() {
            const newBuildingName = document.getElementById('newBuildingName');
            const newBuildingDesc = document.getElementById('newBuildingDesc');
            if (newBuildingName) newBuildingName.value = '';
            if (newBuildingDesc) newBuildingDesc.value = '';
        }

        // ฟังก์ชันแสดงรายการอาคาร - Render building list function
        function renderBuildingList() {
            const container = document.getElementById('buildingList');
            if (!container) return;
            
            container.innerHTML = buildingData.map(building => `
                <div class="building-item">
                    <div class="building-info">
                        <h4><i class="fas fa-building"></i> ${building}</h4>
                        <p>${Object.values(roomData).filter(room => room.building === building).length} ห้อง</p>
                    </div>
                    <div class="building-actions">
                        <button class="btn btn-danger" onclick="deleteBuilding('${building}')" style="padding: 8px 12px; font-size: 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ฟังก์ชันอัปเดต dropdown อาคาร - Update building select function
        function updateBuildingSelect() {
            const buildingSelect = document.getElementById('buildingSelect');
            const buildingFilter = document.getElementById('buildingFilter');
            
            if (buildingSelect) {
                const currentValue = buildingSelect.value;
                buildingSelect.innerHTML = buildingData.map(building => 
                    `<option value="${building}">${building}</option>`
                ).join('');
                
                if (buildingData.includes(currentValue)) {
                    buildingSelect.value = currentValue;
                }
            }
            
            if (buildingFilter) {
                buildingFilter.innerHTML = '<option value="">ทุกอาคาร</option>' + 
                    buildingData.map(building => 
                        `<option value="${building}">${building}</option>`
                    ).join('');
            }
        }

        // =================== Admin Section Management Functions - ฟังก์ชันจัดการส่วนแอดมิน ===================
        
        // ฟังก์ชันสลับส่วนแอดมิน - Toggle admin section function
        function toggleAdminSection(sectionId) {
            const content = document.getElementById(`content-${sectionId}`);
            const header = document.getElementById(`header-${sectionId}`);
            
            if (!content || !header) {
                console.warn('Admin section elements not found for:', sectionId);
                return;
            }
            
            // ปิดส่วนอื่นๆ ทั้งหมด
            document.querySelectorAll('.admin-section-content').forEach(item => {
                if (item.id !== `content-${sectionId}`) {
                    item.classList.remove('expanded');
                }
            });
            document.querySelectorAll('.admin-section-header').forEach(item => {
                if (item.id !== `header-${sectionId}`) {
                    item.classList.remove('expanded');
                }
            });
            
            // สลับส่วนปัจจุบัน
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                header.classList.remove('expanded');
                activeAdminSection = null;
            } else {
                content.classList.add('expanded');
                header.classList.add('expanded');
                activeAdminSection = sectionId;
                loadAdminSectionContent(sectionId);
            }
        }

        // ฟังก์ชันโหลดเนื้อหาส่วนแอดมิน - Load admin section content function
        function loadAdminSectionContent(sectionId) {
            switch(sectionId) {
                case 'building-manage':
                    renderBuildingList();
                    updateBuildingSelect();
                    break;
                case 'room-manage':
                    renderRoomGrid();
                    updateBuildingSelect();
                    break;
                case 'theme-manage':
                    loadThemeSettings();
                    break;
                case 'content-manage':
                    loadContentSettings();
                    break;
                case 'map-manage':
                    loadSavedMaps();
                    break;
                case 'entrance-manage':
                    updateEntranceStatus();
                    break;
                case 'sheets-manage':
                    loadGoogleSheetsSettings();
                    break;
                case 'gitlab-deploy':
                    break;
            }
        }

        // =================== Navigation Functions - ฟังก์ชันนำทาง ===================
        
        // ฟังก์ชันเริ่มการนำทาง - Start navigation function
        function startNavigation() {
            if (!selectedRoom || !roomData[selectedRoom]) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'กรุณาเลือกห้องที่ต้องการนำทางก่อน' : 'Please select a room first'), 'error');
                return;
            }
            
            if (!entrancePosition) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'ยังไม่ได้ตั้งค่าประตูทางเข้า' : 'Main entrance not set'), 'error');
                return;
            }
            
            const room = roomData[selectedRoom];
            showNotification(`🧭 ${currentLanguage === 'th' ? 'เริ่มการนำทางไปยัง' : 'Starting navigation to'} ${room.name}`, 'info');
            
            if (voiceNavigationEnabled) {
                const welcomeText = currentLanguage === 'th' ? 
                    `เริ่มการนำทางไปยัง ${room.name} จาก ${entrancePosition.name}` :
                    `Starting navigation to ${room.name} from ${entrancePosition.name}`;
                speakText(welcomeText);
            }
            
            highlightRoom(selectedRoom);
        }

        // ฟังก์ชันพูดขั้นตอน - Speak step function
        function speakStep(text) {
            if (voiceNavigationEnabled) {
                speakText(text);
            } else {
                showNotification('🔇 ' + (currentLanguage === 'th' ? 'กรุณาเปิดเสียงก่อน' : 'Please enable voice first'), 'warning');
            }
        }

        // ฟังก์ชันเปิด/ปิดเสียงนำทาง - Toggle voice navigation function
        function toggleVoiceNavigation() {
            voiceNavigationEnabled = !voiceNavigationEnabled;
            const voiceBtn = document.getElementById('voiceBtn');
            const overlayVoiceBtn = document.getElementById('overlayVoiceBtn');
            
            if (voiceNavigationEnabled) {
                if (voiceBtn) voiceBtn.classList.add('speaking');
                if (overlayVoiceBtn) overlayVoiceBtn.classList.add('speaking');
                showNotification('🔊 ' + (currentLanguage === 'th' ? 'เปิดการนำทางด้วยเสียง' : 'Voice navigation enabled'), 'success');
            } else {
                if (voiceBtn) voiceBtn.classList.remove('speaking');
                if (overlayVoiceBtn) overlayVoiceBtn.classList.remove('speaking');
                showNotification('🔇 ' + (currentLanguage === 'th' ? 'ปิดการนำทางด้วยเสียง' : 'Voice navigation disabled'), 'warning');
                
                if (currentSpeech) {
                    speechSynthesis.cancel();
                }
            }
        }

        // ฟังก์ชันพูดข้อความ - Speak text function
        function speakText(text) {
            if (!('speechSynthesis' in window)) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'เบราว์เซอร์ไม่รองรับการอ่านเสียง' : 'Browser does not support speech'), 'error');
                return;
            }
            
            if (currentSpeech) {
                speechSynthesis.cancel();
            }
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            currentSpeech.lang = currentLanguage === 'th' ? 'th-TH' : 'en-US';
            currentSpeech.rate = 0.8;
            currentSpeech.pitch = 1.0;
            
            speechSynthesis.speak(currentSpeech);
        }

        // =================== Entrance Management Functions - ฟังก์ชันจัดการประตู ===================
        
        // ฟังก์ชันอัปเดตสถานะประตู - Update entrance status function
        function updateEntranceStatus() {
            const statusEl = document.getElementById('entranceStatusText');
            const iconEl = document.getElementById('entranceIcon');
            
            if (statusEl) {
                if (entrancePosition) {
                    statusEl.textContent = `${currentLanguage === 'th' ? 'ตั้งค่าแล้ว' : 'Set'} - ${entrancePosition.name}`;
                    statusEl.style.color = 'var(--accent-color)';
                    if (iconEl) {
                        iconEl.style.color = 'var(--accent-color)';
                    }
                } else {
                    statusEl.textContent = currentLanguage === 'th' ? 'ยังไม่ได้ตั้งค่า' : 'Not set yet';
                    statusEl.style.color = 'var(--danger-color)';
                    if (iconEl) {
                        iconEl.style.color = 'var(--danger-color)';
                    }
                }
            }
        }

        // ฟังก์ชันตั้งประตูทางเข้า - Set entrance function
        function setEntrance() {
            isSelectingPosition = 'entrance';
            showPage('map');
            showNotification('🚪 ' + (currentLanguage === 'th' ? 'คลิกที่ตำแหน่งบนแผนที่เพื่อกำหนดประตูหลัก' : 'Click on map to set main entrance'), 'info');
        }

        // ฟังก์ชันลบประตูทางเข้า - Remove entrance function
        function removeEntrance() {
            if (confirm(currentLanguage === 'th' ? 'คุณต้องการลบประตูทางเข้าหรือไม่?' : 'Do you want to remove the entrance?')) {
                entrancePosition = null;
                localStorage.removeItem('entrancePosition');
                updateRoomMarkers();
                updateEntranceStatus();
                showNotification('🗑️ ' + (currentLanguage === 'th' ? 'ลบประตูทางเข้าเรียบร้อย' : 'Entrance removed successfully'), 'success');
            }
        }

        // ฟังก์ชันแสดงข้อมูลประตูทางเข้า - Show entrance info function
        function showEntranceInfo() {
            if (!entrancePosition) return;
            
            showNotification(`🚪 ${entrancePosition.name} - ${currentLanguage === 'th' ? 'จุดเริ่มต้นการนำทาง' : 'Navigation starting point'}`, 'info');
        }

        // =================== Map Upload Functions - ฟังก์ชันอัปโหลดแผนที่ ===================
        
        // ฟังก์ชันจัดการการอัปโหลดแผนที่ - Handle map upload function
        function handleMapUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'กรุณาเลือกไฟล์รูปภาพเท่านั้น' : 'Please select image files only'), 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) { // 5MB
                showNotification('❌ ' + (currentLanguage === 'th' ? 'ไฟล์ใหญ่เกินไป กรุณาเลือกไฟล์ที่มีขนาดไม่เกิน 5MB' : 'File too large. Please select file under 5MB'), 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                
                if (type === 'floorplan') {
                    floorplanMapImage = imageData;
                    localStorage.setItem('floorplanMapImage', imageData);
                    
                    const statusText = document.getElementById('floorplanStatusText');
                    if (statusText) statusText.textContent = currentLanguage === 'th' ? 'อัปโหลดสำเร็จ' : 'Upload successful';
                    
                    const preview = document.getElementById('floorplanPreview');
                    if (preview) {
                        preview.src = imageData;
                        preview.classList.remove('hidden');
                    }
                    
                    const floorplanMap = document.getElementById('floorplanMap');
                    if (floorplanMap) floorplanMap.src = imageData;
                    
                } else if (type === 'real') {
                    realMapImage = imageData;
                    localStorage.setItem('realMapImage', imageData);
                    
                    const statusText = document.getElementById('realStatusText');
                    if (statusText) statusText.textContent = currentLanguage === 'th' ? 'อัปโหลดสำเร็จ' : 'Upload successful';
                    
                    const preview = document.getElementById('realPreview');
                    if (preview) {
                        preview.src = imageData;
                        preview.classList.remove('hidden');
                    }
                    
                    const realMap = document.getElementById('realMap');
                    if (realMap) realMap.src = imageData;
                }
                
                showNotification(`✅ ${currentLanguage === 'th' ? 'อัปโหลดสำเร็จ' : 'Upload successful'}!`, 'success');
            };
            reader.readAsDataURL(file);
        }

        // ฟังก์ชันโหลดแผนที่ที่บันทึกไว้ - Load saved maps function
        function loadSavedMaps() {
            if (floorplanMapImage) {
                const floorplanMap = document.getElementById('floorplanMap');
                if (floorplanMap) floorplanMap.src = floorplanMapImage;
                
                const statusEl = document.getElementById('floorplanStatusText');
                if (statusEl) {
                    statusEl.textContent = currentLanguage === 'th' ? 'ใช้แผนผังที่อัปโหลด' : 'Using uploaded floorplan';
                }
                
                const preview = document.getElementById('floorplanPreview');
                if (preview) {
                    preview.src = floorplanMapImage;
                    preview.classList.remove('hidden');
                }
            }
            
            if (realMapImage) {
                const realMap = document.getElementById('realMap');
                if (realMap) realMap.src = realMapImage;
                
                const statusEl = document.getElementById('realStatusText');
                if (statusEl) {
                    statusEl.textContent = currentLanguage === 'th' ? 'ใช้ภาพจริงที่อัปโหลด' : 'Using uploaded real photo';
                }
                
                const preview = document.getElementById('realPreview');
                if (preview) {
                    preview.src = realMapImage;
                    preview.classList.remove('hidden');
                }
            }
        }

        // =================== Google Sheets Functions - ฟังก์ชัน Google Sheets ===================
        
        // ฟังก์ชันโหลดการตั้งค่า Google Sheets - Load Google Sheets settings function
        function loadGoogleSheetsSettings() {
            const savedUrl = localStorage.getItem('googleAppsScriptUrl');
            const webAppUrl = document.getElementById('webAppUrl');
            
            if (savedUrl && webAppUrl) {
                webAppUrl.value = savedUrl;
                googleSheetsConnected = true;
            }
        }

        // ฟังก์ชันคัดลอกโค้ด Backend - Copy backend code function
        function copyBackendCode() {
            const backendCode = document.getElementById('backendCode');
            if (!backendCode) return;
            
            const textarea = document.createElement('textarea');
            textarea.value = backendCode.textContent;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            showNotification('📋 ' + (currentLanguage === 'th' ? 'คัดลอกโค้ดเรียบร้อย' : 'Code copied successfully'), 'success');
        }

        // ฟังก์ชันทดสอบการเชื่อมต่อ Apps Script - Test Apps Script connection function
        function testAppsScriptConnection() {
            const webAppUrl = document.getElementById('webAppUrl');
            if (!webAppUrl) return;
            
            const url = webAppUrl.value.trim();
            
            if (!url) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'กรุณากรอก Web App URL' : 'Please fill Web App URL'), 'error');
                return;
            }
            
            const resultDiv = document.getElementById('connectionResult');
            if (resultDiv) {
                resultDiv.innerHTML = `
                    <div style="padding: 15px; background: #fff3cd; border-radius: var(--border-radius); color: #856404;">
                        <i class="fas fa-spinner fa-spin"></i> ${currentLanguage === 'th' ? 'กำลังทดสอบการเชื่อมต่อ...' : 'Testing connection...'}
                    </div>
                `;
            }
            
            fetch(url + '?action=getRooms')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        if (resultDiv) {
                            resultDiv.innerHTML = `
                                <div style="padding: 15px; background: #d4edda; border-radius: var(--border-radius); color: #155724;">
                                    <i class="fas fa-check-circle"></i> ${currentLanguage === 'th' ? 'เชื่อมต่อสำเร็จ!' : 'Connection successful!'}
                                    <br><small>${currentLanguage === 'th' ? 'พบข้อมูล' : 'Found'} ${data.data.length} ${currentLanguage === 'th' ? 'รายการ' : 'items'}</small>
                                </div>
                            `;
                        }
                    } else {
                        throw new Error(data.error || 'Connection failed');
                    }
                })
                .catch(error => {
                    if (resultDiv) {
                        resultDiv.innerHTML = `
                            <div style="padding: 15px; background: #f8d7da; border-radius: var(--border-radius); color: #721c24;">
                                <i class="fas fa-times-circle"></i> ${currentLanguage === 'th' ? 'การเชื่อมต่อล้มเหลว' : 'Connection failed'}
                                <br><small>${error.message}</small>
                            </div>
                        `;
                    }
                });
        }

        // ฟังก์ชันบันทึกการตั้งค่า Apps Script - Save Apps Script config function
        function saveAppsScriptConfig() {
            const webAppUrl = document.getElementById('webAppUrl');
            if (!webAppUrl) return;
            
            const url = webAppUrl.value.trim();
            
            if (!url) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'กรุณากรอก Web App URL' : 'Please fill Web App URL'), 'error');
                return;
            }
            
            localStorage.setItem('googleAppsScriptUrl', url);
            googleSheetsConnected = true;
            
            showNotification('✅ ' + (currentLanguage === 'th' ? 'บันทึกการตั้งค่าเรียบร้อย' : 'Configuration saved successfully'), 'success');
        }

        // ฟังก์ชันส่งข้อมูลไป Sheets - Export to Sheets function
        function exportToSheets() {
            if (!googleSheetsConnected) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'กรุณาเชื่อมต่อ Google Sheets ก่อน' : 'Please connect Google Sheets first'), 'error');
                return;
            }
            
            const statusDiv = document.getElementById('syncStatus');
            if (statusDiv) {
                statusDiv.innerHTML = `
                    <div style="padding: 15px; background: #cff4fc; border-radius: var(--border-radius); color: #055160;">
                        <i class="fas fa-upload"></i> ${currentLanguage === 'th' ? 'กำลังส่งข้อมูลไป Google Sheets...' : 'Exporting data to Google Sheets...'}
                    </div>
                `;
            }
            
            const webAppUrl = localStorage.getItem('googleAppsScriptUrl');
            if (!webAppUrl) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'ไม่พบการตั้งค่า Apps Script' : 'Apps Script configuration not found'), 'error');
                return;
            }
            
            const rooms = Object.values(roomData);
            let exportCount = 0;
            
            rooms.forEach(room => {
                const formData = new FormData();
                formData.append('action', 'saveRoom');
                Object.keys(room).forEach(key => {
                    if (key === 'images' && Array.isArray(room[key])) {
                        formData.append(key, room[key].join(','));
                    } else {
                        formData.append(key, room[key]);
                    }
                });
                
                fetch(webAppUrl, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        exportCount++;
                        if (exportCount === rooms.length) {
                            if (statusDiv) {
                                statusDiv.innerHTML = `
                                    <div style="padding: 15px; background: #d4edda; border-radius: var(--border-radius); color: #155724;">
                                        <i class="fas fa-check-circle"></i> ${currentLanguage === 'th' ? 'ส่งข้อมูลเรียบร้อยแล้ว' : 'Data exported successfully'}
                                        <br><small>${exportCount} ${currentLanguage === 'th' ? 'ห้อง' : 'rooms'} - ${new Date().toLocaleString()}</small>
                                    </div>
                                `;
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Export error:', error);
                });
            });
        }

        // ฟังก์ชันนำเข้าข้อมูลจาก Sheets - Import from Sheets function
        function importFromSheets() {
            if (!googleSheetsConnected) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'กรุณาเชื่อมต่อ Google Sheets ก่อน' : 'Please connect Google Sheets first'), 'error');
                return;
            }
            
            const statusDiv = document.getElementById('syncStatus');
            if (statusDiv) {
                statusDiv.innerHTML = `
                    <div style="padding: 15px; background: #fff3cd; border-radius: var(--border-radius); color: #856404;">
                        <i class="fas fa-download"></i> ${currentLanguage === 'th' ? 'กำลังนำเข้าข้อมูลจาก Google Sheets...' : 'Importing data from Google Sheets...'}
                    </div>
                `;
            }
            
            const webAppUrl = localStorage.getItem('googleAppsScriptUrl');
            if (!webAppUrl) {
                showNotification('❌ ' + (currentLanguage === 'th' ? 'ไม่พบการตั้งค่า Apps Script' : 'Apps Script configuration not found'), 'error');
                return;
            }
            
            fetch(webAppUrl + '?action=getRooms')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        roomData = {};
                        
                        data.data.forEach(room => {
                            if (room['Room Code']) {
                                roomData[room['Room Code']] = {
                                    code: room['Room Code'],
                                    name: room['Room Name'],
                                    building: room['Building'],
                                    location: room['Location'],
                                    description: room['Description'],
                                    hours: room['Hours'],
                                    status: 'active',
                                    x: parseFloat(room['X Position']) || Math.random() * 80 + 10,
                                    y: parseFloat(room['Y Position']) || Math.random() * 80 + 10,
                                    images: room['Images'] ? room['Images'].split(',').map(img => img.trim()) : []
                                };
                            }
                        });
                        
                        saveDataToLocalStorage();
                        updateUI();
                        
                        if (statusDiv) {
                            statusDiv.innerHTML = `
                                <div style="padding: 15px; background: #d4edda; border-radius: var(--border-radius); color: #155724;">
                                    <i class="fas fa-check-circle"></i> ${currentLanguage === 'th' ? 'นำเข้าข้อมูลเรียบร้อยแล้ว' : 'Data imported successfully'}
                                    <br><small>${data.data.length} ${currentLanguage === 'th' ? 'ห้อง' : 'rooms'} - ${new Date().toLocaleString()}</small>
                                </div>
                            `;
                        }
                    } else {
                        throw new Error(data.error || 'Import failed');
                    }
                })
                .catch(error => {
                    if (statusDiv) {
                        statusDiv.innerHTML = `
                            <div style="padding: 15px; background: #f8d7da; border-radius: var(--border-radius); color: #721c24;">
                                <i class="fas fa-times-circle"></i> ${currentLanguage === 'th' ? 'นำเข้าข้อมูลล้มเหลว' : 'Import failed'}
                                <br><small>${error.message}</small>
                            </div>
                        `;
                    }
                });
        }

        // ฟังก์ชันซิงค์ทั้งสองทาง - Sync with Sheets function
        function syncWithSheets() {
            exportToSheets();
            setTimeout(() => {
                importFromSheets();
            }, 2000);
        }

        // =================== GitLab Deployment Functions - ฟังก์ชัน GitLab Deploy ===================
        
        // ฟังก์ชันส่งออกโค้ด HTML - Export HTML code function
        function exportHTMLCode() {
            const currentData = {
                roomData: roomData,
                buildingData: buildingData,
                entrancePosition: entrancePosition,
                floorplanMapImage: floorplanMapImage,
                realMapImage: realMapImage,
                currentTheme: currentTheme,
                customContent: customContent
            };
            
            const htmlContent = document.documentElement.outerHTML;
            
            const updatedHtml = htmlContent.replace(
                'const sampleRoomData = {',
                `// ข้อมูลจากระบบ - Data from system
                const savedData = ${JSON.stringify(currentData, null, 2)};
                
                const sampleRoomData = {`
            );
            
            const htmlCodeExport = document.getElementById('htmlCodeExport');
            if (htmlCodeExport) {
                htmlCodeExport.value = updatedHtml;
            }
            
            const blob = new Blob([updatedHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'school-map-system.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('📥 ' + (currentLanguage === 'th' ? 'ดาวน์โหลดไฟล์ HTML เรียบร้อย' : 'HTML file downloaded successfully'), 'success');
        }

        // ฟังก์ชันคัดลอกโค้ด HTML - Copy HTML code function
        function copyHTMLCode() {
            exportHTMLCode();
            
            setTimeout(() => {
                const htmlCodeExport = document.getElementById('htmlCodeExport');
                if (htmlCodeExport) {
                    htmlCodeExport.select();
                    document.execCommand('copy');
                    showNotification('📋 ' + (currentLanguage === 'th' ? 'คัดลอกโค้ด HTML เรียบร้อย' : 'HTML code copied successfully'), 'success');
                }
            }, 500);
        }

        // ฟังก์ชันเปิด GitLab - Open GitLab function
        function openGitLab() {
            window.open('https://gitlab.com', '_blank');
        }

        // =================== Data Management Functions - ฟังก์ชันจัดการข้อมูล ===================
        
        // ฟังก์ชันบันทึกข้อมูลลง localStorage - Save data to localStorage function
        function saveDataToLocalStorage() {
            localStorage.setItem('schoolMapData', JSON.stringify(roomData));
            localStorage.setItem('buildingData', JSON.stringify(buildingData));
        }

        // ฟังก์ชันโหลดข้อมูลเริ่มต้น - Load initial data function
        function loadInitialData() {
            // โหลดภาษาที่บันทึกไว้
            const savedLang = localStorage.getItem('preferredLanguage') || 'th';
            currentLanguage = savedLang;
            updateLanguageButton();
            
            // โหลดเนื้อหาที่แก้ไข
            const savedContent = localStorage.getItem('customContent');
            if (savedContent) {
                try {
                    customContent = JSON.parse(savedContent);
                } catch (error) {
                    console.error('Error loading custom content:', error);
                }
            }
            
            updateTexts();
            updatePlaceholders();
            
            // โหลดข้อมูลห้อง
            const savedData = localStorage.getItem('schoolMapData');
            if (savedData) {
                try {
                    roomData = JSON.parse(savedData);
                } catch (error) {
                    console.error('Error loading saved data:', error);
                    roomData = { ...sampleRoomData };
                }
            } else {
                roomData = { ...sampleRoomData };
                saveDataToLocalStorage();
            }
            
            // โหลดข้อมูลอาคาร
            const savedBuildings = localStorage.getItem('buildingData');
            if (savedBuildings) {
                try {
                    buildingData = JSON.parse(savedBuildings);
                } catch (error) {
                    console.error('Error loading building data:', error);
                }
            }
            
            loadSavedSettings();
            updateUI();
        }

        // ฟังก์ชันโหลดการตั้งค่าที่บันทึกไว้ - Load saved settings function
        function loadSavedSettings() {
            // โหลดแผนที่
            floorplanMapImage = localStorage.getItem('floorplanMapImage');
            realMapImage = localStorage.getItem('realMapImage');
            
            // โหลดประตูทางเข้า
            const savedEntrance = localStorage.getItem('entrancePosition');
            if (savedEntrance) {
                try {
                    entrancePosition = JSON.parse(savedEntrance);
                } catch (error) {
                    console.error('Error loading entrance position:', error);
                }
            }
            
            // โหลดธีม
            const savedTheme = localStorage.getItem('selectedTheme');
            if (savedTheme) {
                applyTheme(savedTheme);
            }
            
            // โหลดการตั้งค่าธีม
            const savedThemeSettings = localStorage.getItem('themeSettings');
            if (savedThemeSettings) {
                try {
                    const themeSettings = JSON.parse(savedThemeSettings);
                    if (themeSettings.customColors) {
                        Object.keys(themeSettings.customColors).forEach(colorType => {
                            const value = themeSettings.customColors[colorType];
                            const inputId = colorType + 'Color';
                            const input = document.getElementById(inputId);
                            if (input) {
                                input.value = value;
                                updateCustomColor(colorType, value);
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading theme settings:', error);
                }
            }
            
            // โหลดการตั้งค่า Google Sheets
            const appsScriptUrl = localStorage.getItem('googleAppsScriptUrl');
            if (appsScriptUrl) {
                googleSheetsConnected = true;
            }
            
            updateEntranceStatus();
            loadSavedMaps();
        }

        // ฟังก์ชันโหลดการตั้งค่าธีม - Load theme settings function
        function loadThemeSettings() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            currentTheme = savedTheme;
            
            // อัปเดตการเลือกธีม
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === savedTheme) {
                    option.classList.add('active');
                }
            });
        }

        // ฟังก์ชันโหลดการตั้งค่าเนื้อหา - Load content settings function
        function loadContentSettings() {
            // กรอกค่าในฟอร์มจาก customContent และ translations
            Object.keys(translations.th).forEach(key => {
                const thInput = document.getElementById(`${key}Th`);
                const enInput = document.getElementById(`${key}En`);
                
                if (thInput) {
                    thInput.value = customContent[`${key}_th`] || translations.th[key] || '';
                }
                if (enInput) {
                    enInput.value = customContent[`${key}_en`] || translations.en[key] || '';
                }
            });
        }

        // ฟังก์ชันอัปเดต UI - Update UI function
        function updateUI() {
            updateRoomMarkers();
            renderRoomGrid();
            updateBuildingSelect();
            renderBuildingList();
        }

        // =================== Event Setup Functions - ฟังก์ชันเซ็ตอัปเหตุการณ์ ===================
        
        // ฟังก์ชันเซ็ตอัปเหตุการณ์แผนที่ - Setup map events function
        function setupMapEvents() {
            const mapArea = document.getElementById('mapArea');
            if (!mapArea) return;
            
            mapArea.addEventListener('click', function(event) {
                if (!isSelectingPosition) return;
                
                const rect = mapArea.getBoundingClientRect();
                const x = ((event.clientX - rect.left) / rect.width) * 100;
                const y = ((event.clientY - rect.top) / rect.height) * 100;
                
                if (isSelectingPosition === true) {
                    const roomX = document.getElementById('roomX');
                    const roomY = document.getElementById('roomY');
                    const positionInfo = document.getElementById('positionInfo');
                    
                    if (roomX) roomX.value = x.toFixed(1);
                    if (roomY) roomY.value = y.toFixed(1);
                    if (positionInfo) positionInfo.style.display = 'block';
                    
                    showNotification(`📍 ${currentLanguage === 'th' ? 'เลือกตำแหน่ง' : 'Position selected'} (${x.toFixed(1)}%, ${y.toFixed(1)}%)`, 'success');
                    isSelectingPosition = false;
                    
                    setTimeout(() => {
                        showMainApp(true);
                        if (activeAdminSection !== 'room-manage') {
                            toggleAdminSection('room-manage');
                        }
                    }, 1000);
                    
                } else if (isSelectingPosition === 'entrance') {
                    entrancePosition = {
                        name: currentLanguage === 'th' ? 'ประตูหลัก' : 'Main Entrance',
                        x: x,
                        y: y
                    };
                    
                    localStorage.setItem('entrancePosition', JSON.stringify(entrancePosition));
                    updateRoomMarkers();
                    updateEntranceStatus();
                    
                    showNotification(`🚪 ${currentLanguage === 'th' ? 'ตั้งประตูหลักเรียบร้อย' : 'Main entrance set successfully'}`, 'success');
                    isSelectingPosition = false;
                    
                    setTimeout(() => {
                        showMainApp(true);
                        if (activeAdminSection !== 'entrance-manage') {
                            toggleAdminSection('entrance-manage');
                        }
                    }, 1000);
                }
            });
        }

        // ฟังก์ชันเซ็ตอัปเหตุการณ์หน้าต่าง - Setup window events function
        function setupWindowEvents() {
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    updateRoomMarkers();
                }, 500);
            });

            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    updateRoomMarkers();
                }, 250);
            });

            window.addEventListener('beforeunload', function(e) {
                saveDataToLocalStorage();
            });

            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.focus();
                    }
                }
                
                if (e.key === 'Escape') {
                    if (isSelectingPosition) {
                        isSelectingPosition = false;
                        showNotification('❌ ' + (currentLanguage === 'th' ? 'ยกเลิกการเลือกตำแหน่ง' : 'Position selection cancelled'), 'warning');
                    }
                    
                    closeRoomInfoOverlay();
                    
                    const imageModal = document.querySelector('.image-modal');
                    if (imageModal) {
                        imageModal.remove();
                    }
                    
                    if (isFullscreen) {
                        toggleFullscreen();
                    }
                    
                    if (isPreviewMode) {
                        closePreviewMode();
                    }
                }
            });
        }

        // =================== Utility Functions - ฟังก์ชันยูทิลิตี้ ===================
        
        // ฟังก์ชันแสดงการแจ้งเตือน - Show notification function
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = message;
            notification.className = `notification ${type}`;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ฟังก์ชันปลอดภัยสำหรับการเรียกใช้ฟังก์ชัน - Safe function call
        function safeCall(func, ...args) {
            try {
                return func(...args);
            } catch (error) {
                console.error('Error in function:', func.name, error);
                showNotification('❌ ' + (currentLanguage === 'th' ? 'เกิดข้อผิดพลาด' : 'An error occurred'), 'error');
                return null;
            }
        }

        // =================== Initialization Function - ฟังก์ชันเริ่มต้นระบบ ===================
        
        // ฟังก์ชันเริ่มต้นระบบ - Initialize system function
        function initializeSystem() {
            try {
                loadInitialData();
                showMainApp(false);
                setupMapEvents();
                setupWindowEvents();
                
                setTimeout(() => {
                    showNotification(
                        currentLanguage === 'th' ? 
                        '🎉 ยินดีต้อนรับสู่ระบบแผนที่โรงเรียนอัจฉริยะ v4!' : 
                        '🎉 Welcome to Smart School Map System v4!', 
                        'info'
                    );
                }, 1500);
                
                console.log('🏫 Enhanced School Map System v4 Ready');
                console.log('✨ New Features: Enhanced controls, Room management for 100+ rooms, Theme customization, Content editor');
                
            } catch (error) {
                console.error('Initialization error:', error);
                showNotification('❌ ' + (currentLanguage === 'th' ? 'ไม่สามารถเริ่มต้นระบบได้' : 'Failed to initialize system'), 'error');
            }
        }

        // =================== เริ่มต้นระบบเมื่อหน้าเว็บโหลดเสร็จ - Initialize when page loads ===================
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
        });

        // =================== Console Messages - ข้อความในคอนโซล ===================
        console.log('🎉 ระบบแผนที่โรงเรียนอัจฉริยะ v4 พร้อมใช้งาน!');
        console.log('✨ ฟีเจอร์ใหม่: ปุ่มควบคุมใหม่, จัดการห้อง 100+ ห้อง, ปรับแต่งธีม, แก้ไขเนื้อหา');
        console.log('📱 Mobile-First Design: เหมาะกับมือถือเป็นหลัก');
        console.log('🔧 ปรับปรุง: UI ทันสมัย, การจัดการข้อมูลที่ดีขึ้น, ธีมหลากหลาย');
        console.log('🚀 พร้อม: Deploy ง่าย, รองรับข้อมูลจำนวนมาก, ปรับแต่งได้ทุกอย่าง');
    </script>

    <!-- Image Modal Container - คอนเทนเนอร์โมดัลรูปภาพ -->
    <div id="imageModalContainer"></div>
</body>
</html>
        