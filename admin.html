<!DOCTYPE html>      
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡πÄ‡∏î‡∏ä‡∏≤ (‡∏™‡∏¥‡∏á‡∏´‡πå ‡∏™‡∏¥‡∏á‡∏´‡πÄ‡∏™‡∏ô‡∏µ) V1.3 - Admin Interface</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* =================== CSS Variables =================== */
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --dark-color: #343a40;
            
            --admin-bg: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --card-background: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-light: #ffffff;
            --border-color: #e0e6ff;
            
            --border-radius: 15px;
            --box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
            
            --sidebar-width: 280px;
            --header-height: 70px;
            --mobile-nav-height: 70px;
        }

        /* =================== Base Styles =================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--admin-bg);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }
		
		/* Enhanced walkable-map-container */
		.walkable-map-controls {
			display: flex;
			gap: 8px;
			margin-bottom: 10px;
			justify-content: flex-start;
			align-items: center;
		}

		.walkable-map-type-btn {
			padding: 8px 12px;
			background: var(--primary-color);
			color: white;
			border: none;
			border-radius: 6px;
			font-size: 12px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
			display: flex;
			align-items: center;
			gap: 6px;
		}

		.walkable-map-type-btn:hover {
			background: var(--secondary-color);
			transform: translateY(-1px);
		}

		.walkable-map-type-btn.active {
			background: var(--accent-color);
			box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
		}

		.walkable-map-type-btn:not(.active) {
			background: #6c757d;
		}

		/* Enhanced walkable-map-container */
		/* üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏Ç‡∏ô‡∏≤‡∏î walkable-map-container ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index.html */
		.walkable-map-container {
			position: relative;
			border: 2px solid #e2e8f0;
			border-radius: 12px;
			overflow: hidden;
			background: #f8fafc;
			min-height: 400px;  /* ‚úÖ ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index.html .map-area */
			margin-bottom: 15px;
			/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index.html */
			width: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
		}

	 

		/* No map message */
		.walkable-no-map {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			text-align: center;
			color: #666;
			z-index: 5;
			background: rgba(255, 255, 255, 0.9);
			padding: 20px;
			border-radius: 10px;
			backdrop-filter: blur(5px);
		}

		/* Overlay stays above */
		.walkable-overlay {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: 10;
			pointer-events: none;
		}
		/* End of Enhanced walkable-map-container */

        /* =================== Login Screen =================== */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--admin-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .login-card {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 100%;
            margin: 20px;
            text-align: center;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .login-header {
            margin-bottom: 30px;
        }

        .login-logo {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .login-form {
            text-align: left;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
            background: var(--card-background);
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .login-error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
            padding: 12px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }

        .login-info {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            font-size: 13px;
        }

        /* =================== Layout =================== */
        .admin-container {
            display: flex;
            min-height: 100vh;
            padding-bottom: 0;
        }

        /* Desktop Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            transition: var(--transition);
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        /* Mobile Bottom Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--mobile-nav-height);
            background: rgba(255,255,255,0.95);
            border-top: 1px solid var(--border-color);
            display: none;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        }

        .mobile-nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            padding: 8px 4px;
            color: var(--text-secondary);
            text-decoration: none;
        }

        .mobile-nav-item.active {
            color: var(--primary-color);
        }

        .mobile-nav-item:hover {
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .mobile-nav-item i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .mobile-nav-item span {
            font-size: 10px;
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
            min-height: 100vh;
        }

        .main-content.expanded {
            margin-left: 70px;
        }

        /* =================== Responsive Design =================== */
        @media (max-width: 768px) {
		
			.walkable-canvas {
				min-height: 250px;  /* ‚úÖ ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index */
			}
            .admin-container {
                padding-bottom: var(--mobile-nav-height);
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-nav {
                display: flex;
            }
            
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                margin: 10px;
                max-width: none;
            }
            
            .login-card {
                margin: 10px;
                padding: 30px 20px;
            }
        }
		
		/* ‚úÖ Mobile responsive fix */
		@media (max-width: 768px) {
			.map-canvas-container {
				min-height: 250px;
			}
			
			.map-floorplan-image, 
			.map-canvas {
				max-height: 100%;
				max-width: 100%;
			}
		}

        /* =================== Sidebar =================== */
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-light);
        }

        .sidebar-header h2 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.9;
        }

        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .sidebar-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: var(--text-primary);
            text-decoration: none;
        }

        .menu-item:hover {
            background: rgba(102, 126, 234, 0.1);
            border-left-color: var(--primary-color);
        }

        .menu-item.active {
            background: rgba(102, 126, 234, 0.15);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .menu-item i {
            width: 20px;
            margin-right: 15px;
            font-size: 16px;
        }

        .menu-text {
            transition: var(--transition);
        }

        .sidebar.collapsed .menu-text {
            opacity: 0;
            width: 0;
        }

        /* =================== Header =================== */
        .main-header {
            height: var(--header-height);
            background: var(--card-background);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .header-btn.secondary {
            background: var(--card-background);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .logout-btn {
            background: var(--danger-color);
            color: white;
        }

        /* =================== Content Area =================== */
        .content-area {
            padding: 30px;
            min-height: calc(100vh - var(--header-height));
        }

        .page-section {
            display: none;
            animation: fadeInUp 0.4s ease-out;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* =================== Cards =================== */
        .admin-card {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            margin-bottom: 25px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* =================== Forms =================== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
            background: var(--card-background);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        /* =================== Buttons =================== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            text-align: center;
            justify-content: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-success { background: var(--accent-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-warning { background: var(--warning-color); color: var(--dark-color); }
        .btn-info { background: var(--info-color); color: white; }
        .btn-secondary { 
            background: var(--card-background); 
            color: var(--text-primary); 
            border: 2px solid var(--border-color); 
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        /* =================== Tables =================== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-background);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }

        .data-table th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
        }

        .data-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* =================== Stats Cards =================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-background);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* =================== Status Indicators =================== */
        .status-indicator {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: rgba(40, 167, 69, 0.1);
            color: var(--accent-color);
        }

        .status-inactive {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .status-connected {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
        }

        .status-error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        /* =================== Loading States =================== */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* =================== Sequential Loading UI =================== */
        .sequential-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
            backdrop-filter: blur(5px);
        }

        .sequential-loading.show {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: var(--border-radius);
            text-align: center;
            min-width: 400px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }

        .loading-steps {
            margin: 20px 0;
        }

        .loading-step {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .loading-step:last-child {
            border-bottom: none;
        }

        .step-icon {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .step-icon.pending {
            background: #f0f0f0;
            color: #999;
        }

        .step-icon.loading {
            background: var(--info-color);
            color: white;
        }

        .step-icon.success {
            background: var(--accent-color);
            color: white;
        }

        .step-icon.error {
            background: var(--danger-color);
            color: white;
        }

        .step-text {
            flex: 1;
            text-align: left;
        }

        .step-text.loading {
            color: var(--info-color);
            font-weight: 600;
        }

        .step-text.success {
            color: var(--accent-color);
        }

        .step-text.error {
            color: var(--danger-color);
        }

        /* =================== Notification =================== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            box-shadow: var(--box-shadow);
            z-index: 3000;
            opacity: 0;
            transform: translateX(350px);
            transition: var(--transition);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success { background: var(--accent-color); }
        .notification.error { background: var(--danger-color); }
        .notification.warning { background: var(--warning-color); color: var(--dark-color); }
        .notification.info { background: var(--info-color); }
		
		
		/* Maps Management Specific Styles */
		.upload-section .form-input[type="file"] {
			border: 2px dashed var(--border-color);
			padding: 20px;
			text-align: center;
			cursor: pointer;
			transition: var(--transition);
		}

		.upload-section .form-input[type="file"]:hover {
			border-color: var(--primary-color);
			background: rgba(102, 126, 234, 0.05);
		}

		.preview-card img {
			max-width: 100%;
			max-height: 150px;
			border-radius: 8px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.1);
		}

		.image-preview-info {
			margin-top: 10px;
			font-size: 12px;
			color: var(--text-secondary);
		}

		@media (max-width: 768px) {
			.image-previews {
				grid-template-columns: 1fr;
			}
		}
		
		/* Deployment Guide Specific Styles */
		.deployment-step {
			transition: var(--transition);
		}

		.deployment-step:hover {
			box-shadow: 0 4px 15px rgba(0,0,0,0.1);
		}

		.accordion-header:hover {
			background: #e9ecef !important;
		}

		.accordion-content.show {
			display: block !important;
		}

		.accordion-header .fas {
			transition: transform 0.3s ease;
		}

		.accordion-header.active .fas {
			transform: rotate(180deg);
		}

		.tip-card {
			transition: var(--transition);
		}

		.tip-card:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 15px rgba(0,0,0,0.1);
		}

		@media (max-width: 768px) {
			.deployment-quick-start > div {
				grid-template-columns: 1fr;
			}
			
			.advanced-tips > div {
				grid-template-columns: 1fr;
			}
		}
		/* Enhanced Google Sheets Specific Styles */
			.connection-banner {
				transition: var(--transition);
			}

			.connection-banner.connected {
				background: rgba(40, 167, 69, 0.1);
				border: 1px solid rgba(40, 167, 69, 0.3);
				color: var(--accent-color);
			}

			.connection-banner.disconnected {
				background: rgba(220, 53, 69, 0.1);
				border: 1px solid rgba(220, 53, 69, 0.3);
				color: var(--danger-color);
			}

			.connection-banner.testing {
				background: rgba(23, 162, 184, 0.1);
				border: 1px solid rgba(23, 162, 184, 0.3);
				color: var(--info-color);
			}

			.setup-step .step-header.completed {
				border-color: var(--accent-color) !important;
				background: rgba(40, 167, 69, 0.1) !important;
			}

			.setup-step .step-header.completed .step-number {
				background: var(--accent-color) !important;
			}

			.setup-step .step-header.active .step-chevron {
				transform: rotate(180deg);
			}

			.url-validation.valid {
				color: var(--accent-color);
			}

			.url-validation.invalid {
				color: var(--danger-color);
			}
			
			/* Modal Specific Styles */
			.modal {
				animation: fadeIn 0.3s ease-out;
			}

			@keyframes fadeIn {
				from { opacity: 0; }
				to { opacity: 1; }
			}

			.modal-content {
				animation: slideIn 0.3s ease-out;
			}

			@keyframes slideIn {
				from { transform: translateY(-50px); opacity: 0; }
				to { transform: translateY(0); opacity: 1; }
			}

			.image-url-input {
				transition: var(--transition);
			}

			.image-url-input input.error {
				border-color: var(--danger-color);
				background: rgba(220, 53, 69, 0.1);
			}

			.image-url-input input.success {
				border-color: var(--accent-color);
				background: rgba(40, 167, 69, 0.1);
			}

			/* Mobile Responsive */
			@media (max-width: 768px) {
				.modal-content {
					margin: 20px;
					max-width: none;
				}
				
				.modal-header {
					padding: 20px !important;
				}
				
				.modal-body {
					padding: 20px !important;
				}
				
				.form-row {
					grid-template-columns: 1fr !important;
				}
			}		
			/* Enhanced Navigation Styles */
				.mobile-more-menu {
					animation: slideUp 0.3s ease-out;
				}

				@keyframes slideUp {
					from { transform: translateY(20px); opacity: 0; }
					to { transform: translateY(0); opacity: 1; }
				}

				.more-menu-item:hover {
					background: rgba(102, 126, 234, 0.1);
				}

				.more-menu-item:last-child {
					border-bottom: none;
					border-radius: 0 0 10px 10px;
				}

				.more-menu-item:first-child {
					border-radius: 10px 10px 0 0;
				}

				/* Enhanced Search Styles */
				#buildingQuickSearch:focus,
				#roomQuickSearch:focus {
					outline: none;
					border-color: var(--primary-color);
					box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
				}

				/* Responsive Enhanced Headers */
				@media (max-width: 768px) {
					.enhanced-card-header {
						flex-direction: column;
						align-items: stretch;
					}
					
					.enhanced-card-header > div {
						justify-content: center;
					}
					
					#buildingQuickSearch,
					#roomQuickSearch {
						width: 100%;
					}
				}
				
			/* Additional styles for missing elements */
			.connection-banner {
				transition: all 0.3s ease;
			}

			.connection-banner.connected {
				background: rgba(40, 167, 69, 0.1);
				border-color: rgba(40, 167, 69, 0.3);
			}

			.connection-banner.disconnected {
				background: rgba(220, 53, 69, 0.1);
				border-color: rgba(220, 53, 69, 0.3);
			}

			.connection-banner.testing {
				background: rgba(23, 162, 184, 0.1);
				border-color: rgba(23, 162, 184, 0.3);
			}

			.url-validation.valid {
				color: var(--accent-color);
			}

			.url-validation.invalid {
				color: var(--danger-color);
			}

			.setup-step {
				margin-bottom: 15px;
				border: 1px solid var(--border-color);
				border-radius: 10px;
				overflow: hidden;
			}

			.step-header {
				padding: 15px;
				background: #f8f9fa;
				cursor: pointer;
				transition: background 0.3s ease;
			}

			.step-header:hover {
				background: #e9ecef;
			}

			.step-header.completed {
				border-left: 4px solid var(--accent-color);
				background: rgba(40, 167, 69, 0.1);
			}

			.step-content {
				padding: 20px;
				background: white;
				display: none;
			}

			.step-number {
				width: 30px;
				height: 30px;
				border-radius: 50%;
				background: #6c757d;
				color: white;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: 600;
				transition: all 0.3s ease;
			}

			.step-chevron {
				transition: transform 0.3s ease;
			}

			.step-header.active .step-chevron {
				transform: rotate(180deg);
			}

			/* Debug Panel Styles */
			.debug-line {
				margin: 2px 0;
				white-space: pre-wrap;
			}

			.debug-timestamp {
				color: #888;
				margin-right: 8px;
			}

			.debug-success {
				color: #00ff00;
			}

			.debug-error {
				color: #ff4444;
			}

			.debug-warning {
				color: #ffaa00;
			}

			.debug-info {
				color: #00aaff;
			}
			
			/* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô <style> ‡∏Ç‡∏≠‡∏á admin.html ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å CSS ‡πÄ‡∏î‡∏¥‡∏° */

			.interactive-map-container {
				background: var(--card-background);
				border-radius: var(--border-radius);
				padding: 20px;
				margin-bottom: 20px;
				border: 2px solid var(--border-color);
				position: relative;
			}

			.map-picker-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 15px;
				padding-bottom: 10px;
				border-bottom: 1px solid var(--border-color);
			}

			.map-picker-title {
				font-size: 14px;
				font-weight: 600;
				color: var(--primary-color);
				display: flex;
				align-items: center;
				gap: 8px;
			} 

			.map-canvas-container {
				position: relative;
				border: 1px solid var(--border-color);
				border-radius: 8px;
				overflow: hidden;
				background: #f8f9fa;
				cursor: crosshair;
				width: 100%;
				margin-bottom: 15px;
				min-height: 400px;  /* ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å 350px ‡πÄ‡∏õ‡πá‡∏ô 400px ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index */
				display: flex;
				align-items: center;    /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index */
				justify-content: center; /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index */
			}

			.position-marker {
				position: absolute;
				width: 16px;
				height: 16px;
				background: #ff4757;
				border: 2px solid white;
				border-radius: 50%;
				transform: translate(-50%, -50%);
				box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);
				pointer-events: none;
				z-index: 10;
				animation: markerPulse 2s infinite;
			}

			@keyframes markerPulse {
				0% { transform: translate(-50%, -50%) scale(1); }
				50% { transform: translate(-50%, -50%) scale(1.3); }
				100% { transform: translate(-50%, -50%) scale(1); }
			}

		 

			.coordinate-display { 
				background: rgba(0, 0, 0, 0.7);
				color: white;
				padding: 4px 8px;
				border-radius: 10px;
				font-family: monospace;
				font-size: 9px;
				position: absolute;
				top: 5px;
				left: 5px;  /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å right ‡πÄ‡∏õ‡πá‡∏ô left */
				z-index: 20;
				backdrop-filter: blur(3px);
				pointer-events: none;  /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å */
				opacity: 0.8;
			} 
   
			.coordinate-inputs-enhanced {
				display: grid;
				grid-template-columns: 1fr 1fr auto;
				gap: 10px;
				align-items: end;
				margin-top: 15px;
			}

			.coordinate-input-group-enhanced {
				display: flex;
				flex-direction: column;
			}

			.coordinate-input-enhanced {
				padding: 8px 10px;
				border: 1px solid var(--border-color);
				border-radius: 6px;
				font-family: monospace;
				font-size: 13px;
				background: #f8f9fa;
				width: 100%;
			}

			.coordinate-input-enhanced:focus {
				outline: none;
				border-color: var(--primary-color);
				background: white;
			}

			.clear-position-btn {
				padding: 8px 12px;
				background: var(--danger-color);
				color: white;
				border: none;
				border-radius: 6px;
				cursor: pointer;
				font-size: 11px;
				display: flex;
				align-items: center;
				gap: 4px;
				transition: var(--transition);
				height: fit-content;
			}

			.clear-position-btn:hover {
				background: #c92a2a;
				transform: translateY(-1px);
			}

			.map-instructions {
				background: #e3f2fd;
				border: 1px solid #2196f3;
				border-radius: 6px;
				padding: 10px;
				margin-bottom: 12px;
				font-size: 12px;
				color: #1565c0;
			}

			.map-placeholder {
				width: 100%;
				height: 250px;
				background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
							linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
							linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
							linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
				background-size: 20px 20px;
				background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
				border: 2px dashed #ddd;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				color: #666;
				font-weight: 500;
				border-radius: 6px;
				position: relative;
			}

			/* Mobile responsive Optimizations */
			@media (max-width: 768px) {
				.walkable-map-container {
					min-height: 250px;  /* ‚úÖ ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index.html .map-area */
				}
						
				.map-canvas-container {
					 min-height: 250px;  /* ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å 280px ‡πÄ‡∏õ‡πá‡∏ô 250px ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index */
				} 

				.coordinate-inputs-enhanced {
					grid-template-columns: 1fr;
					gap: 8px;
				}

				.coordinate-display {
					font-size: 8px;
					padding: 3px 6px;
				}

				.map-canvas-container {
					cursor: pointer;
					min-height: 200px;
				} 
				
				/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index.html */
				.walkable-bg-image,
				.map-floorplan-image, 
				.map-canvas,
				.canvas-background {
					object-fit: contain;  /* ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mobile */
					max-height: 100%;
					max-width: 100%;
				}
			 
			}
			/* =================== Image Loading Enhancements =================== */
			.map-image-container {
				position: relative;
				width: 100%;
				height: 100%;
				background: #f5f5f5;
				border-radius: 6px;
				overflow: hidden;
			}

			
			/* ‚úÖ ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ CSS ‡∏ô‡∏µ‡πâ (‡∏ï‡∏≤‡∏° admin 1.3.html) */
			.map-floorplan-image, 
			.map-canvas {
				width: 100%;
				height: 100%;
				object-fit: contain;
				object-position: center;
				display: block;
			}

			/* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö walkable-bg-image ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å */
			.walkable-bg-image {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				object-fit: contain;
				object-position: center;
				display: block;
				border-radius: var(--border-radius);
				z-index: 1;
			}

			/* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö canvas-background ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å */
			.canvas-background {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				object-fit: contain;
				object-position: center;
				display: block;
				border-radius: var(--border-radius);
				z-index: 1;
			}

			/* ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ map-image-container ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á */
			.map-image-container {
				position: relative;
				width: 100%;
				height: 100%;
				background: #f5f5f5;
				border-radius: 6px;
				overflow: hidden;
			}

			/* üéØ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JavaScript Error Prevention */

			/* ‚úÖ ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ container ‡∏°‡∏µ min-height */
			.map-canvas-container {
				position: relative;
				width: 100%;
				min-height: 250px;
				background: #f8fafc;
				border: 1px solid #e2e8f0;
				border-radius: 8px;
				overflow: hidden;
				cursor: crosshair;
				display: flex;
				align-items: center;
				justify-content: center;
			} 

			.map-loading-overlay {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: rgba(255, 255, 255, 0.9);
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				z-index: 5;
			}

			.map-upload-zone {
				border: 2px dashed var(--primary-color);
				border-radius: 10px;
				padding: 20px;
				text-align: center;
				background: rgba(102, 126, 234, 0.05);
				cursor: pointer;
				transition: all 0.3s ease;
				margin-bottom: 15px;
			}

			.map-upload-zone:hover {
				border-color: var(--secondary-color);
				background: rgba(102, 126, 234, 0.1);
			}

			.map-upload-zone.dragover {
				border-color: var(--accent-color);
				background: rgba(40, 167, 69, 0.1);
			}

			.image-controls {
				position: absolute;
				top: 10px;
				right: 10px;
				display: flex;
				gap: 5px;
				z-index: 10;
			}

			.image-control-btn {
				width: 30px;
				height: 30px;
				border-radius: 50%;
				border: none;
				background: rgba(0, 0, 0, 0.7);
				color: white;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 12px;
				transition: all 0.2s ease;
			}

			.image-control-btn:hover {
				background: rgba(0, 0, 0, 0.9);
				transform: scale(1.1);
			}	

		/* ========== Route Control Panel Styles ========== */
		.route-control-panel {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			border-radius: 15px;
			margin: 15px 0;
			box-shadow: 0 8px 25px rgba(0,0,0,0.1);
			overflow: hidden;
			transition: all 0.3s ease;
		}

		.control-header {
			background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
			color: white;
			padding: 15px 20px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.control-header h3 {
			margin: 0;
			font-size: 16px;
			font-weight: 600;
		}

		.control-toggle {
			background: rgba(255,255,255,0.2);
			border: none;
			color: white;
			padding: 8px;
			border-radius: 50%;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.control-toggle:hover {
			background: rgba(255,255,255,0.3);
			transform: scale(1.1);
		}

		.control-content {
			padding: 20px;
			transition: all 0.3s ease;
		}

		.control-content.collapsed {
			max-height: 0;
			padding: 0 20px;
			overflow: hidden;
		}

		.control-group {
			margin-bottom: 20px;
		}

		.control-group:last-child {
			margin-bottom: 0;
		}

		.control-label {
			display: block;
			font-weight: 600;
			color: var(--text-primary);
			margin-bottom: 10px;
			font-size: 14px;
		}

		.control-label i {
			margin-right: 8px;
			color: var(--primary-color);
		}

		/* Start Point Options */
		.start-point-options {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 10px;
			margin-bottom: 10px;
		}

		.option-btn {
			background: #f8fafc;
			border: 1px solid #e2e8f0;
			border-radius: 10px;
			padding: 12px 15px;
			cursor: pointer;
			transition: all 0.2s ease;
			display: flex;
			align-items: center;
			gap: 8px;
			font-size: 13px;
		}

		.option-btn:hover {
			background: var(--primary-color);
			color: white;
			border-color: var(--primary-color);
		}

		.option-btn.active {
			background: var(--primary-color);
			color: white;
			border-color: var(--primary-color);
		}

		.selected-point, .selected-destination {
			background: #f0f9ff;
			border: 1px solid #bae6fd;
			border-radius: 8px;
			padding: 10px;
			font-size: 13px;
			color: var(--text-secondary);
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.selected-point.has-selection,
		.selected-destination.has-selection {
			background: #f0fdf4;
			border-color: #bbf7d0;
			color: var(--text-primary);
		}

		/* Destination Selector */
		.destination-selector {
			position: relative;
		}

		.search-input {
			width: 100%;
			padding: 12px 15px;
			border: 1px solid #d1d5db;
			border-radius: 10px;
			font-size: 14px;
			transition: all 0.2s ease;
		}

		.search-input:focus {
			outline: none;
			border-color: var(--primary-color);
			box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
		}

		.search-suggestions {
			position: absolute;
			top: 100%;
			left: 0;
			right: 0;
			background: white;
			border: 1px solid #e5e7eb;
			border-top: none;
			border-radius: 0 0 10px 10px;
			max-height: 200px;
			overflow-y: auto;
			z-index: 1000;
			display: none;
		}

		.search-suggestions.show {
			display: block;
		}

		.suggestion-item {
			padding: 12px 15px;
			cursor: pointer;
			border-bottom: 1px solid #f3f4f6;
			transition: all 0.2s ease;
		}

		.suggestion-item:hover {
			background: #f9fafb;
		}

		.suggestion-item:last-child {
			border-bottom: none;
		}

		/* Route Options */
		.route-options {
			display: flex;
			flex-direction: column;
			gap: 10px;
		}

		.option-item {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.option-item input[type="radio"],
		.option-item input[type="checkbox"] {
			margin: 0;
		}

		.option-item label {
			display: flex;
			align-items: center;
			gap: 8px;
			font-size: 13px;
			cursor: pointer;
			margin: 0;
		}

		/* Action Buttons */
		.action-buttons {
			display: grid;
			grid-template-columns: 1fr auto;
			gap: 10px;
			margin-top: 20px;
		}

		.route-btn {
			background: var(--primary-color);
			color: white;
			border: none;
			padding: 12px 20px;
			border-radius: 10px;
			cursor: pointer;
			font-weight: 600;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
			transition: all 0.2s ease;
			font-size: 14px;
		}

		.route-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
		}

		.route-btn:disabled {
			background: #9ca3af;
			cursor: not-allowed;
			transform: none;
			box-shadow: none;
		}

		.route-btn.secondary {
			background: var(--text-secondary);
		}

		.route-btn.secondary:hover {
			box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
		}

		/* ========== Route Info Panel ========== */
		.route-info-panel {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(10px);
			border-radius: 15px;
			margin: 15px 0;
			padding: 20px;
			box-shadow: 0 8px 25px rgba(0,0,0,0.1);
			animation: slideUp 0.3s ease;
		}

		@keyframes slideUp {
			from {
				opacity: 0;
				transform: translateY(20px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.route-summary {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 15px;
			margin-bottom: 20px;
		}

		.summary-item {
			background: linear-gradient(135deg, #f8fafc, #e2e8f0);
			border-radius: 12px;
			padding: 15px;
			text-align: center;
			transition: all 0.2s ease;
		}

		.summary-item:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 15px rgba(0,0,0,0.1);
		}

		.summary-icon {
			font-size: 24px;
			margin-bottom: 8px;
		}

		.summary-value {
			font-size: 20px;
			font-weight: bold;
			color: var(--primary-color);
			margin-bottom: 4px;
		}

		.summary-label {
			font-size: 12px;
			color: var(--text-secondary);
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		/* Directions */
		.directions-container {
			margin-bottom: 20px;
		}

		.directions-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 15px;
			padding-bottom: 10px;
			border-bottom: 1px solid #e5e7eb;
		}

		.directions-header h4 {
			margin: 0;
			font-size: 16px;
			color: var(--text-primary);
		}

		.voice-toggle {
			background: #f3f4f6;
			border: none;
			padding: 8px 12px;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.voice-toggle:hover {
			background: var(--primary-color);
			color: white;
		}

		.voice-toggle.active {
			background: var(--accent-color);
			color: white;
		}

		.directions-list {
			max-height: 200px;
			overflow-y: auto;
		}

		.direction-item {
			display: flex;
			align-items: center;
			gap: 15px;
			padding: 12px 0;
			border-bottom: 1px solid #f3f4f6;
		}

		.direction-item:last-child {
			border-bottom: none;
		}

		.direction-step {
			background: var(--primary-color);
			color: white;
			width: 24px;
			height: 24px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 12px;
			font-weight: bold;
			flex-shrink: 0;
		}

		.direction-content {
			flex: 1;
		}

		.direction-instruction {
			font-weight: 600;
			color: var(--text-primary);
			margin-bottom: 2px;
		}

		.direction-distance {
			font-size: 12px;
			color: var(--text-secondary);
		}

		.direction-icon {
			width: 20px;
			text-align: center;
			color: var(--primary-color);
		}

		/* Route Actions */
		.route-actions {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
		}

		.action-btn {
			background: #f8fafc;
			border: 1px solid #e2e8f0;
			border-radius: 10px;
			padding: 12px 8px;
			cursor: pointer;
			transition: all 0.2s ease;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 5px;
			font-size: 12px;
		}

		.action-btn:hover {
			background: var(--primary-color);
			color: white;
			border-color: var(--primary-color);
		}

		.action-btn i {
			font-size: 16px;
		}

		/* ========== Interactive Elements ========== */
		.walkable-points-layer,
		.route-path-layer,
		.interactive-overlay {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
		}

		.interactive-overlay {
			z-index: 200;
		}

		.start-point-indicator,
		.destination-indicator {
			position: absolute;
			transform: translate(-50%, -50%);
			z-index: 201;
		}

		.pulse-ring {
			width: 30px;
			height: 30px;
			border: 2px solid var(--accent-color);
			border-radius: 50%;
			animation: pulse 2s infinite;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
		}

		@keyframes pulse {
			0% {
				transform: translate(-50%, -50%) scale(0.8);
				opacity: 1;
			}
			100% {
				transform: translate(-50%, -50%) scale(2);
				opacity: 0;
			}
		}

		.start-dot,
		.destination-dot {
			width: 20px;
			height: 20px;
			background: white;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 12px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.2);
			position: relative;
			z-index: 202;
		}

		/* ========== Responsive Design ========== */
		@media (max-width: 768px) {
			.start-point-options {
				grid-template-columns: 1fr;
			}
			
			.route-summary {
				grid-template-columns: 1fr;
				gap: 10px;
			}
			
			.action-buttons {
				grid-template-columns: 1fr;
			}
			
			.route-actions {
				grid-template-columns: 1fr;
			}
			
			.option-btn {
				padding: 10px 12px;
				font-size: 12px;
			}
			
			.control-content {
				padding: 15px;
			}
			
			.route-info-panel {
				padding: 15px;
			}
		}

		@media (max-width: 480px) {
			.summary-item {
				padding: 12px;
			}
			
			.summary-value {
				font-size: 18px;
			}
			
			.summary-icon {
				font-size: 20px;
			}
			
			.direction-item {
				gap: 10px;
			}
			
			.control-header {
				padding: 12px 15px;
			}
			
			.control-header h3 {
				font-size: 14px;
			}
			
			.walkable-map-container {
				min-height: 200px;  /* ‚úÖ ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index.html .map-area */
			}
			
			.map-canvas-container {
				min-height: 200px;  /* ‚úÖ ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index.html */
			}
			
			.walkable-canvas {
				min-height: 200px;  /* ‚úÖ ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index */
			}
			
			
		}

		/* ========== Admin Walkable Points Styles ========== */
		.admin-walkable-section {
			background: #fff;
			border-radius: 15px;
			padding: 25px;
			margin: 20px 0;
			box-shadow: 0 4px 20px rgba(0,0,0,0.08);
		}

		.walkable-dashboard {
			margin-bottom: 25px;
		}

		.stat-cards {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 15px;
		}

		.stat-card {
			background: linear-gradient(135deg, #f8fafc, #e2e8f0);
			border-radius: 12px;
			padding: 20px;
			display: flex;
			align-items: center;
			gap: 15px;
			transition: all 0.2s ease;
		}

		.stat-card:hover {
			transform: translateY(-3px);
			box-shadow: 0 8px 25px rgba(0,0,0,0.1);
		}

		.stat-card.primary { background: linear-gradient(135deg, var(--primary-color), #4338ca); color: white; }
		.stat-card.success { background: linear-gradient(135deg, var(--accent-color), #059669); color: white; }
		.stat-card.warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
		.stat-card.info { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }

		.stat-icon {
			font-size: 32px;
			opacity: 0.9;
		}

		.stat-content {
			flex: 1;
		}

		.stat-number {
			font-size: 24px;
			font-weight: bold;
			margin-bottom: 4px;
		}

		.stat-label {
			font-size: 12px;
			opacity: 0.9;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		/* Walkable Canvas */
		.walkable-canvas-container {
			background: #f8fafc;
			border: 1px solid #e2e8f0;
			border-radius: 12px;
			overflow: hidden;
			margin-bottom: 25px;
		}

		.canvas-header {
			background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
			color: white;
			padding: 15px 20px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.canvas-header h4 {
			margin: 0;
			font-size: 16px;
		}

		.canvas-controls {
			display: flex;
			gap: 8px;
		}

		.canvas-btn {
			background: rgba(255,255,255,0.2);
			border: none;
			color: white;
			padding: 8px;
			border-radius: 6px;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.canvas-btn:hover {
			background: rgba(255,255,255,0.3);
		}

	 		
		/* üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: walkable-canvas ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index.html */
		.walkable-canvas {
			position: relative;
			width: 100%;
			min-height: 400px;  /* ‚úÖ ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö map container */
			background: #f8fafc;
			border: 1px solid #e2e8f0;
			border-radius: 8px;
			overflow: hidden;
			cursor: crosshair;
			/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö index */
			display: flex;
			align-items: center;
			justify-content: center;
		}
 
		.grid-overlay {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			opacity: 0.3;
			background-image: 
				linear-gradient(to right, #e5e7eb 1px, transparent 1px),
				linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
			background-size: 20px 20px;
			display: none;
		}

		.grid-overlay.show {
			display: block;
		} 
		
		/* üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: coordinate system ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ viewBox ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
		.walkable-svg {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 2;
		}

		/* üéØ ‡πÉ‡∏´‡πâ overlay elements ‡πÉ‡∏ä‡πâ coordinate system ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
		.walkable-overlay,
		.points-layer,
		.selection-tools {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: 10;
			pointer-events: none;
		}

		.canvas-info-bar {
			background: #f3f4f6;
			padding: 10px 20px;
			display: flex;
			gap: 20px;
			font-size: 12px;
			border-top: 1px solid #e5e7eb;
		}

		.info-item {
			display: flex;
			gap: 5px;
			align-items: center;
		}

		.info-label {
			color: var(--text-secondary);
			font-weight: 500;
		}

		.info-value {
			color: var(--text-primary);
			font-weight: 600;
		}

		/* Tools Panel */
		.walkable-tools-panel {
			background: #f8fafc;
			border: 1px solid #e2e8f0;
			border-radius: 12px;
			padding: 20px;
			margin-bottom: 25px;
		}

		.tool-groups {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 20px;
			margin-bottom: 20px;
		}

		.tool-group h5 {
			margin: 0 0 15px 0;
			color: var(--text-primary);
			font-size: 14px;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.tool-buttons {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
			gap: 8px;
		}

		.tool-btn {
			background: white;
			border: 1px solid #d1d5db;
			border-radius: 8px;
			padding: 10px 8px;
			cursor: pointer;
			transition: all 0.2s ease;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 5px;
			font-size: 11px;
			text-align: center;
		}

		.tool-btn:hover {
			background: var(--primary-color);
			color: white;
			border-color: var(--primary-color);
		}

		.tool-btn.active {
			background: var(--primary-color);
			color: white;
			border-color: var(--primary-color);
			box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
		}

		.tool-btn i {
			font-size: 16px;
		}

		/* Settings Panel */
		.settings-panel {
			border-top: 1px solid #e5e7eb;
			padding-top: 20px;
		}

		.settings-panel h5 {
			margin: 0 0 15px 0;
			color: var(--text-primary);
			font-size: 14px;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.setting-groups {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 15px;
		}

		.setting-item {
			display: flex;
			flex-direction: column;
			gap: 8px;
		}

		.setting-item label {
			font-size: 12px;
			font-weight: 500;
			color: var(--text-primary);
		}

		.setting-item input[type="range"] {
			width: 100%;
		}

		.setting-item input[type="number"],
		.setting-item input[type="checkbox"] {
			padding: 6px 8px;
			border: 1px solid #d1d5db;
			border-radius: 6px;
			font-size: 12px;
		}

		.setting-value {
			font-size: 12px;
			color: var(--primary-color);
			font-weight: 600;
		}

		/* Walkable Actions */
		.walkable-actions {
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
			justify-content: center;
		}

		.walkable-actions .btn {
			flex: 1;
			min-width: 140px;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
		}

		@media (max-width: 768px) {
			.tool-groups {
				grid-template-columns: 1fr;
			}
			
			.tool-buttons {
				grid-template-columns: repeat(2, 1fr);
			}
			
			.setting-groups {
				grid-template-columns: 1fr;
			}
			
			.stat-cards {
				grid-template-columns: repeat(2, 1fr);
			}
			
			.canvas-controls {
				flex-wrap: wrap;
			}
			
			.walkable-actions {
				flex-direction: column;
			}
			
			.walkable-actions .btn {
				min-width: auto;
			}
		}	
		
		/* ========== FIXED MAP COORDINATE SYSTEM ========== */
		/* üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á admin ‡πÅ‡∏•‡∏∞ index */

		/* ‚úÖ Base Map Container - ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á admin ‡πÅ‡∏•‡∏∞ index */
		.map-area,
		.map-canvas-container,
		.walkable-canvas,
		.walkable-map-container,
		.mapWrap {
			position: relative;
			width: 100%;
			min-height: 520px;  /* ‚úÖ Desktop: ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
			background: #f8fafc;
			border: 1px solid #e2e8f0;
			border-radius: 8px;
			overflow: hidden;
			display: flex;
			align-items: center;
			justify-content: center;
			aspect-ratio: 4/3;  /* ‚úÖ ‡∏£‡∏±‡∏Å‡∏©‡∏≤ aspect ratio ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
		}

		/* ‚úÖ Map Images - ‡πÉ‡∏ä‡πâ object-fit ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
		.map-image,
		.map-floorplan-image,
		.walkable-bg-image,
		.canvas-background,
		.floor {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			object-fit: contain;  /* ‚úÖ ‡πÉ‡∏ä‡πâ contain ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà */
			object-position: center;
			display: block;
			border-radius: inherit;
			z-index: 1;
		}

		/* ‚úÖ SVG Overlay - ‡πÉ‡∏ä‡πâ viewBox ‡πÅ‡∏•‡∏∞ coordinate system ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
		.overlay,
		.walkable-svg,
		svg.overlay {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 2;
			/* ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î viewBox ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô */
			viewBox: 0 0 100 100;
			preserveAspectRatio: none;
		}

		/* ========== RESPONSIVE FIXES ========== */
		/* ‚úÖ Tablet: 768px */
		@media (max-width: 768px) {
			.map-area,
			.map-canvas-container,
			.walkable-canvas,
			.walkable-map-container,
			.mapWrap {
				min-height: 350px;  /* ‚úÖ Tablet: ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
			}
		}

		/* ‚úÖ Mobile: 480px */
		@media (max-width: 480px) {
			.map-area,
			.map-canvas-container,
			.walkable-canvas,
			.walkable-map-container,
			.mapWrap {
				min-height: 250px;  /* ‚úÖ Mobile: ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
				aspect-ratio: 3/2;  /* ‚úÖ Mobile: aspect ratio ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
			}
		}

		/* ========== WALKABLE POINTS COORDINATE FIXES ========== */
		/* ‚úÖ Walkable Points - ‡πÉ‡∏ä‡πâ coordinate system ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
		.node,
		.walkable-point,
		.route-point {
			position: absolute;
			transform: translate(-50%, -50%);  /* ‚úÖ Center positioning */
			z-index: 10;
			/* ‚úÖ ‡πÉ‡∏ä‡πâ % coordinates relative to container */
		}

		/* ‚úÖ Path/Route Lines - ‡πÉ‡∏ä‡πâ SVG coordinates ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
		.path,
		.edge,
		.route-line {
			stroke-width: 3;
			fill: none;
			stroke-linecap: round;
			stroke-linejoin: round;
		}

		/* ========== CONTAINER VALIDATION ========== */
		/* ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô JavaScript errors */
		.map-container-validation {
			min-height: 250px !important;
			min-width: 200px !important;
			background: #f8fafc;
			border: 1px solid #e2e8f0;
			display: flex !important;
			align-items: center;
			justify-content: center;
		}

		/* ========== COORDINATE SYSTEM SYNC ========== */
		/* ‚úÖ ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å container ‡πÉ‡∏ä‡πâ coordinate system ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
		[data-coordinate-system="percentage"] {
			--coord-system: percentage;
		}

		[data-coordinate-system="percentage"] .node,
		[data-coordinate-system="percentage"] .walkable-point {
			/* ‚úÖ ‡πÉ‡∏ä‡πâ CSS custom properties ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö positioning */
			left: calc(var(--x-percent) * 1%);
			top: calc(var(--y-percent) * 1%);
		}

		/* ========== ERROR PREVENTION ========== */
		/* ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô layout shift ‡πÅ‡∏•‡∏∞ JavaScript errors */
		.map-loading {
			min-height: inherit;
			display: flex;
			align-items: center;
			justify-content: center;
			background: #f8fafc;
			color: #64748b;
		}

		.map-error {
			min-height: inherit;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			background: #fef2f2;
			color: #dc2626;
			border: 1px solid #fecaca;
			border-radius: 8px;
			padding: 20px;
		}

		/* ========== GRID OVERLAY CONSISTENCY ========== */
		.grid-overlay {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			opacity: 0.1;
			background-image: 
				linear-gradient(to right, #cbd5e1 1px, transparent 1px),
				linear-gradient(to bottom, #cbd5e1 1px, transparent 1px);
			background-size: 10% 10%;  /* ‚úÖ 10% grid ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 100% coordinate system */
			z-index: 1;
		}
				
    </style>
	<script>
	
	// üéØ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sync coordinate system ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á admin ‡πÅ‡∏•‡∏∞ index
	function syncCoordinateSystem() {
		console.log('üéØ Syncing coordinate system between admin and index...');
		
		// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î container ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ admin
		const containers = [
			document.getElementById('walkableMapContainer'),
			document.getElementById('walkableCanvas'),
			document.querySelector('.map-canvas-container'),
			document.querySelector('.walkable-canvas')
		];
		
		containers.forEach((container, index) => {
			if (container) {
				const rect = container.getBoundingClientRect();
				console.log(`üìê Container ${index} size:`, {
					width: rect.width,
					height: rect.height,
					element: container.className || container.id
				});
				
				// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ viewBox ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SVG elements
				const svgElements = container.querySelectorAll('svg');
				svgElements.forEach(svg => {
					svg.setAttribute('viewBox', '0 0 100 100');
					svg.setAttribute('preserveAspectRatio', 'none');
				});
			}
		});
	}

	// üéØ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á coordinate ‡∏à‡∏≤‡∏Å % ‡πÄ‡∏õ‡πá‡∏ô pixel ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö
	function convertCoordinates(x, y, fromType, container) {
		if (!container) {
			container = document.getElementById('walkableMapContainer') || 
					   document.querySelector('.walkable-canvas') ||
					   document.querySelector('.map-canvas-container');
		}
		
		if (!container) return { x: 0, y: 0 };
		
		const rect = container.getBoundingClientRect();
		
		if (fromType === 'percent-to-pixel') {
			return {
				x: (x / 100) * rect.width,
				y: (y / 100) * rect.height
			};
		} else if (fromType === 'pixel-to-percent') {
			return {
				x: (x / rect.width) * 100,
				y: (y / rect.height) * 100
			};
		}
		
		return { x, y };
	}

	// üéØ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ coordinate system ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°
	 function validateCoordinateSystem() {
		console.log('üîç Validating coordinate system...');
		
		const results = {
			consistent: true,
			containers: [],
			errors: []
		};
		
		// ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö MapCoordinateSystem
		const expectedMinHeights = {
			desktop: 520,  // ‚úÖ ‡πÉ‡∏ä‡πâ 520px ‡πÅ‡∏ó‡∏ô 400px
			tablet: 350,   
			mobile: 250    
		};
		
		const screenWidth = window.innerWidth;
		const expectedMinHeight = screenWidth <= 480 ? expectedMinHeights.mobile :
								  screenWidth <= 768 ? expectedMinHeights.tablet :
								  expectedMinHeights.desktop;
		
		const configs = [
			{ class: 'walkable-canvas', expected: { minHeight: expectedMinHeight }},
			{ class: 'map-canvas-container', expected: { minHeight: expectedMinHeight }},
			{ id: 'walkableMapContainer', expected: { minHeight: expectedMinHeight }}
		];

		configs.forEach(config => {
			const element = config.id ? 
				document.getElementById(config.id) : 
				document.querySelector(`.${config.class}`);
			
			if (element) {
				const rect = element.getBoundingClientRect();
				const computedStyle = window.getComputedStyle(element);
				const minHeight = parseInt(computedStyle.minHeight) || 0;
				
				const result = {
					element: config.id || config.class,
					actualHeight: rect.height,
					minHeight: minHeight,
					expectedMinHeight: expectedMinHeight,
					valid: Math.abs(minHeight - expectedMinHeight) <= 10  // ‚úÖ Allow 10px tolerance
				};
				
				results.containers.push(result);
				
				if (!result.valid) {
					results.consistent = false;
					results.errors.push(`${result.element}: expected ~${expectedMinHeight}px, got ${minHeight}px`);
				}
			}
		});
		
		console.log('üîç Coordinate system validation:', results);
		return results;
	}

	// üéØ Auto-fix coordinate system inconsistencies
	function autoFixCoordinateSystem() {
		console.log('üîß Auto-fixing coordinate system...');
		
		const validation = validateCoordinateSystem();
		
		if (!validation.consistent) {
			console.warn('‚ö†Ô∏è Coordinate system inconsistencies detected:', validation.errors);
			
			// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
			const containers = document.querySelectorAll(
				'#walkableMapContainer, .walkable-canvas, .map-canvas-container'
			);
			
			containers.forEach(container => {
				// ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö index.html
				container.style.minHeight = '400px';
				container.style.display = 'flex';
				container.style.alignItems = 'center';
				container.style.justifyContent = 'center';
				
				// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç responsive
				const mediaQuery768 = window.matchMedia('(max-width: 768px)');
				const mediaQuery480 = window.matchMedia('(max-width: 480px)');
				
				if (mediaQuery480.matches) {
					container.style.minHeight = '200px';
				} else if (mediaQuery768.matches) {
					container.style.minHeight = '250px';
				}
			});
			
			console.log('‚úÖ Auto-fix applied');
		} else {
			console.log('‚úÖ Coordinate system is consistent');
		}
	}

	// üéØ Initialize coordinate system sync
	function initCoordinateSystemSync() {
		console.log('üöÄ Initializing coordinate system sync...');
		
		// Sync ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î
		syncCoordinateSystem();
		
		// Auto-fix ‡∏´‡∏≤‡∏Å‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
		setTimeout(() => {
			autoFixCoordinateSystem();
		}, 1000);
		
		// Sync ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠ resize
		let resizeTimeout;
		window.addEventListener('resize', () => {
			clearTimeout(resizeTimeout);
			resizeTimeout = setTimeout(() => {
				syncCoordinateSystem();
				autoFixCoordinateSystem();
			}, 300);
		});
		
		// Expose validation function
		window.validateMapCoordinates = validateCoordinateSystem;
		window.fixMapCoordinates = autoFixCoordinateSystem;
		
		console.log('‚úÖ Coordinate system sync initialized');
	}

	// üéØ Auto-initialize
	document.addEventListener('DOMContentLoaded', function() {
		setTimeout(() => {
			initCoordinateSystemSync();
		}, 2000);
	});

	// üéØ Also initialize when maps section is shown
	if (typeof window !== 'undefined') {
		const originalShowSection = window.showSection;
		if (originalShowSection) {
			window.showSection = function(section) {
				originalShowSection(section);
				if (section === 'maps') {
					setTimeout(() => {
						initCoordinateSystemSync();
					}, 500);
				}
			};
		}
	}
	// End:  üéØ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sync coordinate system ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á admin ‡πÅ‡∏•‡∏∞ index

		// Add CSS for walkable points management
		const walkablePointsCSS = `
		<style>
			/* Walkable Points Management Styles */
			.walkable-section {
				background: #fff;
				border-radius: 15px;
				padding: 20px;
				margin-bottom: 20px;
				box-shadow: 0 4px 15px rgba(0,0,0,0.1);
			}
			
			.walkable-header {
				display: flex;
				justify-content: between;
				align-items: center;
				margin-bottom: 15px;
				padding-bottom: 10px;
				border-bottom: 2px solid var(--primary-color);
			}
			
			.walkable-controls {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
				margin-bottom: 15px;
			}
			
			.walkable-btn {
				background: var(--primary-color);
				color: white;
				border: none;
				padding: 10px 15px;
				border-radius: 8px;
				cursor: pointer;
				display: flex;
				align-items: center;
				gap: 8px;
				font-size: 13px;
				transition: all 0.2s ease;
			}
			.walkable-btn:hover { opacity: 0.9; transform: translateY(-1px); }
			.walkable-btn.secondary { background: var(--text-secondary); }
			.walkable-btn.danger { background: var(--danger-color); }
			.walkable-btn.success { background: var(--accent-color); }
			
			.walkable-map-container {
				position: relative;
				border: 2px solid #e2e8f0;
				border-radius: 12px;
				overflow: hidden;
				background: #f8fafc;
				min-height: 400px;
				margin-bottom: 15px;
			}
			
			.walkable-overlay {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				pointer-events: none;
				z-index: 100;
			}
			
			.walkable-node {
				position: absolute;
				width: 12px;
				height: 12px;
				background: #10b981;
				border: 2px solid #fff;
				border-radius: 50%;
				cursor: pointer;
				transform: translate(-50%, -50%);
				transition: all 0.2s ease;
				pointer-events: all;
				box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
			}
			.walkable-node:hover {
				background: #f59e0b;
				transform: translate(-50%, -50%) scale(1.2);
				box-shadow: 0 4px 15px rgba(245, 158, 11, 0.5);
			}
			.walkable-node.selected {
				background: #dc2626;
				box-shadow: 0 4px 15px rgba(220, 38, 38, 0.6);
			}
			
			.walkable-edge {
				stroke: #cbd5e1;
				stroke-width: 2;
				fill: none;
				opacity: 0.6;
				transition: all 0.2s ease;
			}
			.walkable-edge:hover {
				stroke: var(--primary-color);
				stroke-width: 3;
				opacity: 1;
			}
			
			.walkable-stats {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				gap: 15px;
				margin-bottom: 20px;
			}
			
			.stat-card {
				background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
				color: Green;
				padding: 15px;
				border-radius: 12px;
				text-align: center;
			}
			.stat-value {
				font-size: 24px;
				font-weight: bold;
				margin-bottom: 5px;
			}
			.stat-label {
				font-size: 12px;
				opacity: 0.9;
			}
			
			.walkable-settings {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 15px;
				margin-bottom: 20px;
			}
			
			.setting-group {
				background: #f8fafc;
				padding: 15px;
				border-radius: 10px;
				border: 1px solid #e2e8f0;
			}
			.setting-label {
				font-weight: 600;
				margin-bottom: 8px;
				color: var(--text-primary);
			}
			.setting-input {
				width: 100%;
				padding: 8px 12px;
				border: 1px solid #cbd5e1;
				border-radius: 6px;
				font-size: 13px;
			}
			.setting-help {
				font-size: 11px;
				color: var(--text-secondary);
				margin-top: 5px;
			}
			
			.export-section {
				background: #f8fafc;
				border: 1px solid #e2e8f0;
				border-radius: 10px;
				padding: 15px;
				margin-top: 20px;
			}
			
			.export-textarea {
				width: 100%;
				height: 120px;
				padding: 10px;
				border: 1px solid #cbd5e1;
				border-radius: 6px;
				font-family: monospace;
				font-size: 12px;
				resize: vertical;
			}
			
			@media (max-width: 768px) {
				.walkable-controls {
					flex-direction: column;
				}
				.walkable-btn {
					justify-content: center;
				}
				.walkable-settings {
					grid-template-columns: 1fr;
				}
			}
		</style>
		`;

		// ========== 2. CSS Styles (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô <style>) ==========
				const WALKABLE_UI_STYLES = `
				.sync-status {
					padding: 6px 12px;
					border-radius: 15px;
					font-size: 12px;
					font-weight: 500;
					display: inline-block;
					transition: all 0.3s ease;
				}
				.sync-status.idle { background: #e9ecef; color: #6c757d; }
				.sync-status.syncing { background: #cce5ff; color: #0066cc; animation: pulse 1.5s infinite; }
				.sync-status.success { background: #d4edda; color: #155724; }
				.sync-status.error { background: #f8d7da; color: #721c24; }

				.sync-progress {
					width: 100%;
					height: 4px;
					background: #e9ecef;
					border-radius: 2px;
					overflow: hidden;
					margin-top: 5px;
				}
				.progress-bar {
					height: 100%;
					background: linear-gradient(90deg, #007bff, #0056b3);
					width: 0%;
					transition: width 0.3s ease;
					animation: shimmer 1s infinite;
				}

				.error-log {
					background: #fff3cd;
					border: 1px solid #ffeaa7;
					border-radius: 6px;
					padding: 8px;
					max-height: 100px;
					overflow-y: auto;
				}
				.error-item {
					font-size: 11px;
					color: #856404;
					margin-bottom: 4px;
					word-break: break-word;
				}

				@keyframes pulse {
					0%, 100% { opacity: 1; }
					50% { opacity: 0.7; }
				}
				@keyframes shimmer {
					0% { transform: translateX(-100%); }
					100% { transform: translateX(100%); }
				}

				.btn-sm {
					padding: 4px 8px;
					font-size: 11px;
					border-radius: 4px;
				}
				`;
		// Add walkable points CSS to head
		document.head.insertAdjacentHTML('beforeend', walkablePointsCSS);
		
		
		// walkableMap  
		// ===== DECLARE VARIABLES FIRST (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ReferenceError) =====
		let walkableMapCurrentType = 'floorplan';  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°
		let walkableMapData = {
			floorplan: null,
			realphoto: null,
			loaded: false
		};


		// Switch map type function
		function switchWalkableMapView(mapType) {
			//if (mapType === walkableMapCurrentType) return;
			
			walkableMapCurrentType = mapType;
			
			// Update button states
			const floorplanBtn = document.getElementById('walkableFloorplanBtn');
			const realphotonBtn = document.getElementById('walkableRealphotonBtn');
			
			if (floorplanBtn && realphotonBtn) {
				floorplanBtn.classList.toggle('active', mapType === 'floorplan');
				realphotonBtn.classList.toggle('active', mapType === 'realphoto');
			}
			
			// Update display
			updateWalkableMapView();
			
			// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
			if (!walkableMapData.loaded || 
				(mapType === 'floorplan' && !walkableMapData.floorplan) ||
				(mapType === 'realphoto' && !walkableMapData.realphoto)) {
				console.log('üîÑ Reloading map data...');
				loadWalkableMapImages();
			}

			
			// Show notification
			const mapName = mapType === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á';
			if (typeof showNotification === 'function') {
				showNotification(`üó∫Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà${mapName}`, 'info');
			}
			
			console.log(`üó∫Ô∏è Switched to: ${mapType}`);
		}

		// Update map display
		function updateWalkableMapView() {
			const floorplanImg = document.getElementById('walkableFloorplanImage');
			const realphotoImg = document.getElementById('walkableRealphotoImage');
			const noMapMsg = document.getElementById('walkableNoMapMsg');
			
			if (!floorplanImg || !realphotoImg || !noMapMsg) return;
			
			// Hide all first
			floorplanImg.style.display = 'none';
			realphotoImg.style.display = 'none';
			noMapMsg.style.display = 'none';
			
			// Show appropriate image with safe loading
			if (walkableMapCurrentType === 'floorplan') {
				if (walkableMapData.floorplan && isValidWalkableUrl(walkableMapData.floorplan)) {
					loadImageSafely(floorplanImg, walkableMapData.floorplan, 'floorplan');
				} else {
					console.log('‚ùå No valid floorplan data');
					noMapMsg.style.display = 'block';
				}
			} else if (walkableMapCurrentType === 'realphoto') {
				if (walkableMapData.realphoto && isValidWalkableUrl(walkableMapData.realphoto)) {
					loadImageSafely(realphotoImg, walkableMapData.realphoto, 'realphoto');
				} else {
					console.log('‚ùå No valid realphoto data');
					noMapMsg.style.display = 'block';
				}
			}
		}
		
		// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏ß‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏´‡∏•‡∏±‡∏á updateWalkableMapView):
		function loadImageSafely(imgElement, imageData, imageType) {
			console.log(`üñºÔ∏è Loading ${imageType} safely...`);
			
			// ‡∏™‡∏£‡πâ‡∏≤‡∏á loading indicator
			const container = imgElement.parentElement;
			let loadingDiv = container.querySelector('.loading-indicator');
			if (!loadingDiv) {
				loadingDiv = document.createElement('div');
				loadingDiv.className = 'loading-indicator';
				loadingDiv.innerHTML = `
					<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
								background: rgba(255,255,255,0.9); padding: 10px; border-radius: 5px;">
						<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î${imageType === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á'}...
					</div>
				`;
				container.appendChild(loadingDiv);
			}
			loadingDiv.style.display = 'block';
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
			const dataSizeKB = Math.round(imageData.length / 1024);
			console.log(`üìä ${imageType} data size: ${dataSizeKB}KB`);
			
			// ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Å‡πà‡∏≠‡∏ô
			if (dataSizeKB > 2000) { // 2MB
				console.warn(`‚ö†Ô∏è Large image detected (${dataSizeKB}KB), processing...`);
				processLargeImage(imgElement, imageData, imageType, loadingDiv);
				return;
			}
			
			// ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡πÉ‡∏´‡∏ç‡πà
			imgElement.onload = function() {
				console.log(`‚úÖ ${imageType} loaded successfully`);
				imgElement.style.display = 'block';
				loadingDiv.style.display = 'none';
			};
			
			imgElement.onerror = function() {
				console.error(`‚ùå Failed to load ${imageType}`);
				loadingDiv.style.display = 'none';
				showImageError(container, imageType);
			};
			
			try {
				imgElement.src = imageData;
			} catch (error) {
				console.error(`‚ùå Error setting ${imageType} src:`, error);
				loadingDiv.style.display = 'none';
				showImageError(container, imageType);
			}
		}
		
		// =================== ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 4: Large Image Processing ===================

		// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà:
		async function processLargeImage(imgElement, imageData, imageType, loadingDiv) {
			try {
				console.log(`üîÑ Processing large ${imageType}...`);
				
				// ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤
				updateLoadingProgress(loadingDiv, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà...', 25);
				
				// ‡∏™‡∏£‡πâ‡∏≤‡∏á temporary image ‡πÄ‡∏û‡∏∑‡πà‡∏≠ resize
				const tempImg = new Image();
				
				await new Promise((resolve, reject) => {
					tempImg.onload = resolve;
					tempImg.onerror = reject;
					
					// ‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ browser hang
					setTimeout(() => {
						tempImg.src = imageData;
					}, 100);
				});
				
				updateLoadingProgress(loadingDiv, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î...', 50);
				
				// ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ
				const canvas = document.createElement('canvas');
				const ctx = canvas.getContext('2d');
				
				// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà (‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏•‡∏á)
				const maxDimension = 1200; // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
				let { width, height } = tempImg;
				
				if (width > height && width > maxDimension) {
					height = (height * maxDimension) / width;
					width = maxDimension;
				} else if (height > maxDimension) {
					width = (width * maxDimension) / height;
					height = maxDimension;
				}
				
				canvas.width = width;
				canvas.height = height;
				
				updateLoadingProgress(loadingDiv, '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î...', 75);
				
				// ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà
				ctx.drawImage(tempImg, 0, 0, width, height);
				
				// ‡πÅ‡∏õ‡∏•‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô base64 ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏•‡∏î‡∏•‡∏á
				const compressedData = canvas.toDataURL('image/jpeg', 0.7);
				
				const newSizeKB = Math.round(compressedData.length / 1024);
				console.log(`üìâ Compressed ${imageType}: ${Math.round(imageData.length/1024)}KB ‚Üí ${newSizeKB}KB`);
				
				updateLoadingProgress(loadingDiv, '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!', 100);
				
				// ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß
				setTimeout(() => {
					imgElement.onload = function() {
						console.log(`‚úÖ Compressed ${imageType} loaded`);
						imgElement.style.display = 'block';
						loadingDiv.style.display = 'none';
						
						if (typeof showNotification === 'function') {
							showNotification(`üìâ ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î${imageType === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á'}‡πÅ‡∏•‡πâ‡∏ß (${newSizeKB}KB)`, 'info');
						}
					};
					
					imgElement.onerror = function() {
						console.error(`‚ùå Failed to load compressed ${imageType}`);
						loadingDiv.style.display = 'none';
						showImageError(imgElement.parentElement, imageType);
					};
					
					imgElement.src = compressedData;
				}, 500);
				
			} catch (error) {
				console.error(`‚ùå Error processing large ${imageType}:`, error);
				loadingDiv.style.display = 'none';
				showImageError(imgElement.parentElement, imageType);
			}
		}
		// ===================  end of ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 4: Large Image Processing ===================
		// =================== ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 5: Helper Functions ===================
		function updateLoadingProgress(loadingDiv, message, percent) {
			loadingDiv.innerHTML = `
				<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
							background: rgba(255,255,255,0.9); padding: 15px; border-radius: 8px; text-align: center;">
					<i class="fas fa-spinner fa-spin"></i><br>
					<small>${message}</small><br>
					<div style="width: 150px; height: 4px; background: #eee; border-radius: 2px; margin-top: 8px;">
						<div style="width: ${percent}%; height: 100%; background: #007bff; border-radius: 2px; transition: width 0.3s;"></div>
					</div>
				</div>
			`;
		}

		function showImageError(container, imageType) {
			const errorDiv = document.createElement('div');
			errorDiv.className = 'image-error';
			errorDiv.innerHTML = `
				<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
							text-align: center; color: #666;">
					<i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px;"></i><br>
					<small>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á${imageType === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á'}‡πÑ‡∏î‡πâ</small><br>
					<button onclick="retryLoadImage('${imageType}')" style="margin-top: 8px; padding: 4px 8px; font-size: 12px;">
						‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
					</button>
				</div>
			`;
			
			// ‡∏•‡∏ö error div ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
			const existingError = container.querySelector('.image-error');
			if (existingError) existingError.remove();
			
			container.appendChild(errorDiv);
		}
		// =================== ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 6: Retry Function ===================

		function retryLoadImage(imageType) {
			console.log(`üîÑ Retrying to load ${imageType}...`);
			
			// ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
			if (imageType === 'floorplan') {
				walkableMapData.floorplan = null;
			} else {
				walkableMapData.realphoto = null;
			}
			walkableMapData.loaded = false;
			
			// ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
			loadWalkableMapImages();
		}

		// Load walkable map images using existing system methods
		async function loadWalkableMapImages() {
			try {
				console.log('üó∫Ô∏è Loading walkable map images...');
				
				// Reset state
				walkableMapData = { floorplan: null, realphoto: null, loaded: false };
				
				// Method 1: Try existing mapData (‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°)
				if (typeof mapData !== 'undefined' && mapData) {
					if (mapData.floorplan) walkableMapData.floorplan = mapData.floorplan;
					if (mapData.realphoto) walkableMapData.realphoto = mapData.realphoto;
					
					if (walkableMapData.floorplan || walkableMapData.realphoto) {
						walkableMapData.loaded = true;
						updateWalkableMapView();
						console.log('‚úÖ Loaded from existing mapData');
						return;
					}
				}
				
				// Method 2: Try session storage (‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°)
				const sessionFloorplan = sessionStorage.getItem('temp_floorplan');
				const sessionRealphoto = sessionStorage.getItem('temp_realphoto');
				
				if (sessionFloorplan || sessionRealphoto) {
					if (sessionFloorplan && typeof isValidImageData !== 'undefined' && isValidImageData(sessionFloorplan)) {
						walkableMapData.floorplan = sessionFloorplan;
					}
					if (sessionRealphoto && typeof isValidImageData !== 'undefined' && isValidImageData(sessionRealphoto)) {
						walkableMapData.realphoto = sessionRealphoto;
					}
					
					if (walkableMapData.floorplan || walkableMapData.realphoto) {
						walkableMapData.loaded = true;
						updateWalkableMapView();
						console.log('‚úÖ Loaded from session storage');
						return;
					}
				}
				
				// Method 3: Try localStorage cache (‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°)
				const currentMap = localStorage.getItem('currentMap');
				if (currentMap) {
					try {
						const mapCache = JSON.parse(currentMap);
						if (mapCache.floorplan) walkableMapData.floorplan = mapCache.floorplan;
						if (mapCache.realphoto) walkableMapData.realphoto = mapCache.realphoto;
						
						if (walkableMapData.floorplan || walkableMapData.realphoto) {
							walkableMapData.loaded = true;
							updateWalkableMapView();
							console.log('‚úÖ Loaded from localStorage cache');
							return;
						}
					} catch (error) {
						console.warn('Failed to parse currentMap cache:', error);
					}
				}
				
				// Method 4: Always try Google Sheets (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î)
				if (typeof sheetsConfig !== 'undefined' && sheetsConfig.url) {
					await loadFromSheetsForWalkable();
				} else {
					console.log('‚ö†Ô∏è No Google Sheets connection');
					showWalkableNoMap();
				}
				
			} catch (error) {
				console.error('‚ùå Error loading walkable images:', error);
				showWalkableNoMap();
			}
		}

		// Load from Google Sheets (‡πÉ‡∏ä‡πâ method ‡πÄ‡∏î‡∏¥‡∏°)
		async function loadFromSheetsForWalkable() {
			try {
				// ‡πÉ‡∏ä‡πâ function ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
				if (typeof fetchMapImageFromSheets === 'function') {
					const buildingCode = typeof getCurrentBuildingName === 'function' ? 
						getCurrentBuildingName() : 'Main Building';
					
					console.log('üì° Fetching from sheets for building:', buildingCode);
					const result = await fetchMapImageFromSheets(buildingCode);
					
					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
					if (result && (result.floorplan || result.realphoto)) {
						// ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î floorplan
						if (result.floorplan) {
							const cleanFloorplan = cleanImageData(result.floorplan, 'floorplan');
							if (cleanFloorplan) {
								walkableMapData.floorplan = cleanFloorplan;
							} else {
								console.warn('‚ö†Ô∏è Floorplan data invalid after cleaning');
							}
						}
						
						// ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î realphoto
						if (result.realphoto) {
							const cleanRealphoto = cleanImageData(result.realphoto, 'realphoto');
							if (cleanRealphoto) {
								walkableMapData.realphoto = cleanRealphoto;
							} else {
								console.warn('‚ö†Ô∏è Realphoto data invalid after cleaning');
							}
						}
						
						if (walkableMapData.floorplan || walkableMapData.realphoto) {
							walkableMapData.loaded = true;
							updateWalkableMapView();
							console.log('‚úÖ Loaded from Google Sheets with cleaning');
							return;
						}
					}
				}
				
				// Fallback direct sheets call
				const params = new URLSearchParams();
				params.append('action', 'getMapImages');
				
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});
				
				if (response.ok) {
					const data = await response.json();
					if (data.success && data.data && data.data.length > 0) {
						const mapItem = data.data.find(item => 
							item.id === 'main_map' || item.id === 'maps'
						) || data.data[0];
						
						if (mapItem) {
							if (mapItem.floorplan && isValidWalkableUrl(mapItem.floorplan)) {
								walkableMapData.floorplan = mapItem.floorplan;
							}
							if (mapItem.realphoto && isValidWalkableUrl(mapItem.realphoto)) {
								walkableMapData.realphoto = mapItem.realphoto;
							}
							
							if (walkableMapData.floorplan || walkableMapData.realphoto) {
								walkableMapData.loaded = true;
								updateWalkableMapView();
								console.log('‚úÖ Loaded via direct sheets call');
								return;
							}
						}
					}
				}
				
				showWalkableNoMap();
				
			} catch (error) {
				console.error('‚ùå Failed to load from sheets:', error);
				showWalkableNoMap();
			}
		}
		
		// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô cleanImageData:
		function cleanImageData(imageData, imageType) {
			if (!imageData || typeof imageData !== 'string') return null;
			
			const trimmed = imageData.trim();
			if (!trimmed || trimmed.toLowerCase() === 'available') return null;
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏° data URL
			if (trimmed.startsWith('data:image/')) {
				const parts = trimmed.split(',');
				if (parts.length !== 2) {
					console.warn(`‚ö†Ô∏è Invalid ${imageType} data URL structure`);
					return null;
				}
				
				const header = parts[0];
				const base64Part = parts[1];
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á base64
				if (base64Part.length < 100) {
					console.warn(`‚ö†Ô∏è ${imageType} base64 too short (${base64Part.length} chars) - likely truncated`);
					return null;
				}
				
				// ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î base64 (‡∏•‡∏ö whitespace ‡πÅ‡∏•‡∏∞ characters ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
				const cleanBase64 = base64Part.replace(/[^A-Za-z0-9+/=]/g, '');
				
				if (cleanBase64 !== base64Part) {
					console.log(`üßπ Cleaned ${imageType} base64 data`);
					return `${header},${cleanBase64}`;
				}
				
				return trimmed;
			}
			
			// HTTP URL
			if (trimmed.startsWith('http')) {
				return trimmed;
			}
			
			console.warn(`‚ö†Ô∏è Unknown ${imageType} data format:`, trimmed.substring(0, 50) + '...');
			return null;
		}

		// Show no map message
		function showWalkableNoMap() {
			const floorplanImg = document.getElementById('walkableFloorplanImage');
			const realphotoImg = document.getElementById('walkableRealphotoImage');
			const noMapMsg = document.getElementById('walkableNoMapMsg');
			
			if (floorplanImg) floorplanImg.style.display = 'none';
			if (realphotoImg) realphotoImg.style.display = 'none';
			if (noMapMsg) noMapMsg.style.display = 'block';
		}

		// Validate URL (‡πÉ‡∏ä‡πâ logic ‡πÄ‡∏î‡∏¥‡∏°)
		function isValidWalkableUrl(url) {
			if (!url || typeof url !== 'string') return false;
			const trimmed = url.trim();
			if (trimmed === '' || trimmed.toLowerCase() === 'available') return false;
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö data URL
			if (trimmed.startsWith('data:image/')) {
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ base64 ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
				const parts = trimmed.split(',');
				if (parts.length !== 2) {
					console.warn('üö´ Invalid data URL format:', trimmed.substring(0, 100) + '...');
					return false;
				}
				
				const base64Part = parts[1];
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (‡∏ñ‡πâ‡∏≤‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å truncate)
				if (base64Part.length < 100) {
					console.warn('üö´ Base64 too short (likely truncated):', base64Part.length, 'chars');
					return false;
				}
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö base64 characters
				const base64Regex = /^[A-Za-z0-9+/]*={0,2}$/;
				if (!base64Regex.test(base64Part)) {
					console.warn('üö´ Invalid base64 characters detected');
					return false;
				}
				
				console.log('‚úÖ Valid base64 data URL:', Math.round(trimmed.length/1024) + 'KB');
				return true;
			}
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö HTTP URL
			return trimmed.startsWith('http');
		}

		// ===== INITIALIZATION & INTEGRATION =====

		// Initialize system
		function initWalkableMapSystem() {
			console.log('üöÄ Initializing walkable map system...');
			
			// Force reset data ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
			walkableMapData = { floorplan: null, realphoto: null, loaded: false };
	
			// Load images
			loadWalkableMapImages();
			
			// Hook into building change
			const buildingSelect = document.getElementById('buildingSelect');
			if (buildingSelect) {
				const originalHandler = buildingSelect.onchange;
				buildingSelect.onchange = function(e) {
					if (originalHandler) originalHandler.call(this, e);
					setTimeout(() => loadWalkableMapImages(), 1000);
				};
			}
			
			// Hook into map data changes
			if (typeof window !== 'undefined') {
				const originalLoadMapsForBuilding = window.loadMapsForBuilding;
				window.loadMapsForBuilding = function(building) {
					if (originalLoadMapsForBuilding) {
						originalLoadMapsForBuilding(building);
					}
					setTimeout(() => loadWalkableMapImages(), 500);
				};
			}
		}

		// Auto-initialize when ready
		document.addEventListener('DOMContentLoaded', function() {
			setTimeout(() => {
				initWalkableMapSystem();
			}, 2500); // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°
		});

		// Also initialize when maps section is loaded
		if (typeof window !== 'undefined') {
			// Expose functions globally
			window.switchWalkableMapView = switchWalkableMapView;
			window.loadWalkableMapImages = loadWalkableMapImages;
			
			// Refresh function
			window.refreshWalkableMapView = function() {
				if (typeof showNotification === 'function') {
					showNotification('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà...', 'info');
				}
				loadWalkableMapImages();
			};
			
			// Hook into addWalkablePointsSection if exists
			const originalAddWalkablePoints = window.addWalkablePointsSection;
			if (originalAddWalkablePoints) {
				window.addWalkablePointsSection = function() {
					originalAddWalkablePoints();
					setTimeout(() => initWalkableMapSystem(), 1000);
				};
			}
		}
		// End of walkableMap  

		// üîó Admin-Index Integration Bridge V1.3
		// ========== 1. Compatibility Analysis ==========
		/* 
		üîç CONFLICTS DETECTED:

		Admin.html ‡πÉ‡∏ä‡πâ:
		- walkablePointsData (global object)
		- Dynamic node creation (click to add)
		- localStorage key: walkableData_${building}
		- Manual node management via UI

		Index.html ‡πÉ‡∏ä‡πâ:
		- walkableRoutingData (global object) 
		- Fixed grid system (48 nodes)
		- localStorage key: walkableData_${building} (SAME!)
		- Automatic grid generation

		‚ùå CONFLICT: Data structure ‡πÅ‡∏•‡∏∞ management approach ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
		‚úÖ SOLUTION: ‡∏™‡∏£‡πâ‡∏≤‡∏á integration bridge
		*/

		// ========== 2. Data Structure Bridge ==========

		// ‡∏™‡∏£‡πâ‡∏≤‡∏á bridge object ‡πÄ‡∏û‡∏∑‡πà‡∏≠ sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á admin ‡πÅ‡∏•‡∏∞ index
		const ADMIN_INDEX_BRIDGE = {
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏´‡∏ô
			isAdminMode: () => window.location.pathname.includes('admin.html'),
			isIndexMode: () => window.location.pathname.includes('index.html'),
			
			// Data format mapping
			adminFormat: 'walkablePointsData',
			indexFormat: 'walkableRoutingData',
			
			// Sync settings
			syncEnabled: true,
			autoSyncOnChange: true,
			adminHasPriority: true,  // Admin data ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤
			lastSyncTime: null,
			
			// Storage key management (üö® FIXED: ‡πÅ‡∏¢‡∏Å keys ‡πÅ‡∏•‡πâ‡∏ß!)
			getStorageKey: (building, mode) => {
				if (!building) building = 'Main Building';
				return `walkableData_${building.replace(/\s+/g, '')}_${mode}`;
			},
				
			
			// Compatibility flags
			preserveFixedGrid: false, // ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ fixed grid ‡∏ñ‡πâ‡∏≤ admin ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
			allowDynamicNodes: true,   // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ admin ‡πÄ‡∏û‡∏¥‡πà‡∏° nodes ‡πÑ‡∏î‡πâ
			maxDataAge: 24 * 60 * 60 * 1000, // 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (milliseconds)
			
			// Status tracking
			lastConversionError: null,
			conversionCount: 0,
			debugMode: true    
		};

		// ========== 3. Data Format Converter ==========

		// ‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å admin format ‡πÄ‡∏õ‡πá‡∏ô index format
		function convertAdminToIndexFormat(adminData) {
			if (!adminData || !adminData.nodes) return null;
			
			debugLog('üîÑ Converting admin data to index format...', {
				adminNodes: Object.keys(adminData.nodes).length,
				adminEdges: adminData.edges ? adminData.edges.length : 0
			});
			
			const indexData = {
				nodes: {},
				edges: [],
				settings: {
					metersPerPercent: adminData.settings?.metersPerPercent || 1.2,
					maxSearchRadius: adminData.settings?.maxConnectionDistance || 25,
					defaultWalkSpeed: 1.5
				},
				currentBuilding: adminData.building || adminData.currentBuilding,
				lastPath: null,
				isInitialized: true,
				dataSource: 'admin',
				syncTime: new Date().toISOString()
			};
			
			// ‡πÅ‡∏õ‡∏•‡∏á nodes
			Object.values(adminData.nodes).forEach(node => {
				indexData.nodes[node.id] = {
					id: node.id,
					x: node.x,
					y: node.y,
					type: node.type || 'admin',  // mark as admin-created
					building: node.building || indexData.currentBuilding,
					isFixed: false,  // admin nodes ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà fixed
					source: 'admin'
				};
			});
			
			// ‡πÅ‡∏õ‡∏•‡∏á edges
			if (adminData.edges && Array.isArray(adminData.edges)) {
				adminData.edges.forEach(edge => {
					indexData.edges.push({
						from: edge.from,
						to: edge.to,
						weight: edge.weight,
						bidirectional: edge.bidirectional !== false,
						type: 'admin',
						source: 'admin'
					});
				});
			}
			
			debugLog('‚úÖ Admin to index conversion completed:', {
				convertedNodes: Object.keys(indexData.nodes).length,
				convertedEdges: indexData.edges.length
			});
			
			return indexData;
		}

		// ‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å index format ‡πÄ‡∏õ‡πá‡∏ô admin format
		function convertIndexToAdminFormat(indexData) {
			if (!indexData || !indexData.nodes) return null;
			
			debugLog('üîÑ Converting index data to admin format...', {
				indexNodes: Object.keys(indexData.nodes).length,
				indexEdges: indexData.edges ? indexData.edges.length : 0
			});
			
			const adminData = {
				currentBuilding: indexData.currentBuilding,
				building: indexData.currentBuilding,
				nodes: {},
				edges: [],
				settings: {
					maxConnectionDistance: indexData.settings?.maxSearchRadius || 25,
					metersPerPercent: indexData.settings?.metersPerPercent || 1.2,
					autoConnect: true,
					snapToGrid: false,
					gridSize: 5
				},
				selectedNodes: new Set(),
				isDragging: false,
				dragNode: null,
				dataSource: 'index',
				syncTime: new Date().toISOString()
			};
			
			// ‡πÅ‡∏õ‡∏•‡∏á nodes
			Object.values(indexData.nodes).forEach(node => {
				adminData.nodes[node.id] = {
					id: node.id,
					x: node.x,
					y: node.y,
					type: node.type || 'grid',
					building: node.building || adminData.currentBuilding,
					source: node.source || 'index'
				};
			});
			
			// ‡πÅ‡∏õ‡∏•‡∏á edges
			if (indexData.edges && Array.isArray(indexData.edges)) {
				indexData.edges.forEach(edge => {
					adminData.edges.push({
						from: edge.from,
						to: edge.to,
						weight: edge.weight,
						bidirectional: edge.bidirectional !== false,
						source: edge.source || 'index'
					});
				});
			}
			
			debugLog('‚úÖ Index to admin conversion completed:', {
				convertedNodes: Object.keys(adminData.nodes).length,
				convertedEdges: adminData.edges.length
			});
			
			return adminData;
		}

		// ========== 4. Smart Data Sync ==========

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô index.html ‡∏à‡∏≤‡∏Å admin data
		function syncAdminDataToIndex(building) {
			if (!ADMIN_INDEX_BRIDGE.isIndexMode()) return false;
			
			debugLog('üì• Syncing admin data to index...', { building });
			
			try {
				// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å admin
				const storageKey = `walkableData_${building}`;
				const adminDataString = localStorage.getItem(storageKey);
				
				if (!adminDataString) {
					debugLog('‚ö†Ô∏è No admin data found, using fixed grid');
					return false;
				}
				
				const adminData = JSON.parse(adminDataString);
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
				if (adminData.dataSource === 'index') {
					debugLog('‚ÑπÔ∏è Data source is index, no sync needed');
					return false;
				}
				
				// ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô index format
				const indexData = convertAdminToIndexFormat(adminData);
				if (!indexData) {
					debugLog('‚ùå Failed to convert admin data');
					return false;
				}
				
				// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkableRoutingData
				if (typeof walkableRoutingData !== 'undefined') {
					Object.assign(walkableRoutingData, indexData);
					debugLog('‚úÖ walkableRoutingData updated from admin');
				}
				
				// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï localStorage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö index
				const indexStorageKey = `walkableData_${building}_index`;
				localStorage.setItem(indexStorageKey, JSON.stringify(indexData));
				
				ADMIN_INDEX_BRIDGE.lastSyncTime = new Date().toISOString();
				
				debugLog('‚úÖ Admin data synced to index successfully');
				return true;
				
			} catch (error) {
				debugLog('‚ùå Error syncing admin data to index:', error);
				return false;
			}
		}

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô admin.html ‡∏à‡∏≤‡∏Å index data
		function syncIndexDataToAdmin(building) {
			if (!ADMIN_INDEX_BRIDGE.isAdminMode()) return false;
			
			debugLog('üì§ Syncing index data to admin...', { building });
			
			try {
				// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å index
				const indexStorageKey = `walkableData_${building}_index`;
				const indexDataString = localStorage.getItem(indexStorageKey);
				
				if (!indexDataString) {
					debugLog('‚ö†Ô∏è No index data found');
					return false;
				}
				
				const indexData = JSON.parse(indexDataString);
				
				// ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô admin format
				const adminData = convertIndexToAdminFormat(indexData);
				if (!adminData) {
					debugLog('‚ùå Failed to convert index data');
					return false;
				}
				
				// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkablePointsData
				if (typeof walkablePointsData !== 'undefined') {
					Object.assign(walkablePointsData, adminData);
					
					// Render ‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
					if (typeof renderWalkablePoints === 'function') {
						renderWalkablePoints();
					}
					if (typeof updateWalkableStats === 'function') {
						updateWalkableStats();
					}
					
					debugLog('‚úÖ walkablePointsData updated from index');
				}
				
				ADMIN_INDEX_BRIDGE.lastSyncTime = new Date().toISOString();
				
				debugLog('‚úÖ Index data synced to admin successfully');
				return true;
				
			} catch (error) {
				debugLog('‚ùå Error syncing index data to admin:', error);
				return false;
			}
		}

		// ========== 5. Automatic Sync Triggers ==========

		// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞ sync ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
		function autoSyncOnPageLoad() {
			if (!ADMIN_INDEX_BRIDGE.syncEnabled) return;
			
			const building = getCurrentBuilding();
			if (!building) return;
			
			debugLog('üîÑ Auto-sync on page load...', { 
				building, 
				isAdmin: ADMIN_INDEX_BRIDGE.isAdminMode(),
				isIndex: ADMIN_INDEX_BRIDGE.isIndexMode()
			});
			
			if (ADMIN_INDEX_BRIDGE.isIndexMode()) {
				// ‡πÉ‡∏ô index.html - ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å admin ‡∏Å‡πà‡∏≠‡∏ô
				const adminSynced = syncAdminDataToIndex(building);
				
				if (!adminSynced) {
					debugLog('üìã No admin data available, creating fixed grid for index');
					// ‡∏™‡∏£‡πâ‡∏≤‡∏á fixed grid ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
					if (typeof createFixedWalkableGrid === 'function') {
						createFixedWalkableGrid();
					}
				} else {
					debugLog('‚úÖ Using admin-created walkable points in index');
				}
				
			} else if (ADMIN_INDEX_BRIDGE.isAdminMode()) {
				// ‡πÉ‡∏ô admin.html - ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏Å‡∏ï‡∏¥
				debugLog('üìã Admin mode: Using standard admin data loading');
			}
		}

		// ========== 6. Enhanced Integration Functions ==========

		// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadWalkableData ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô index.html
		function loadWalkableDataWithAdminSync() {
			const building = getCurrentBuilding();
			const storageKey = `walkableData_${building}`;
			const indexStorageKey = `walkableData_${building}_index`;
			
			debugLog('üìÅ Loading walkable data with admin sync...', { building });
			
			// ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å admin ‡∏Å‡πà‡∏≠‡∏ô
			const adminSynced = syncAdminDataToIndex(building);
			
			if (adminSynced) {
				debugLog('‚úÖ Loaded admin-created walkable data');
				return;
			}
			
			// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å admin ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å index cache
			const indexDataString = localStorage.getItem(indexStorageKey);
			if (indexDataString) {
				try {
					const data = JSON.parse(indexDataString);
					Object.assign(walkableRoutingData, data);
					debugLog('üìÅ Loaded cached index walkable data');
					return;
				} catch (error) {
					debugLog('‚ö†Ô∏è Error loading cached data:', error);
				}
			}
			
			// ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÜ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á fixed grid
			debugLog('üèóÔ∏è No existing data, creating fixed grid');
			if (typeof createFixedWalkableGrid === 'function') {
				createFixedWalkableGrid();
			}
		}

		// ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô saveWalkableData ‡πÉ‡∏ô admin.html
		function enhancedSaveWalkableData() {
			// ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô infinite loop ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å saveWalkableData() ‡∏ã‡πâ‡∏≥
			if (_saveInProgress) {
				debugLog('‚ö†Ô∏è Enhanced save already in progress...');
				return;
			}
			
			// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ saveWalkableDataEnhanced ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
			return saveWalkableDataEnhanced();
		}

		// ========== 7. UI Integration Helpers ==========

		// ‡πÄ‡∏û‡∏¥‡πà‡∏° sync status indicator ‡πÉ‡∏ô admin
		function addSyncStatusIndicator() {
			if (!ADMIN_INDEX_BRIDGE.isAdminMode()) return;
			
			const header = document.querySelector('.walkable-header');
			if (!header || document.getElementById('syncStatus')) return;
			
			const syncStatus = document.createElement('div');
			syncStatus.id = 'syncStatus';
			syncStatus.className = 'sync-status';
			syncStatus.innerHTML = `
				<div class="sync-indicator">
					<i class="fas fa-sync"></i>
					<span>Sync Ready</span>
				</div>
			`;
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS
			const style = document.createElement('style');
			style.textContent = `
				.sync-status {
					display: flex;
					align-items: center;
					gap: 8px;
					font-size: 12px;
					color: var(--text-secondary);
				}
				
				.sync-indicator {
					display: flex;
					align-items: center;
					gap: 4px;
					padding: 4px 8px;
					background: #f0f9ff;
					border: 1px solid #bae6fd;
					border-radius: 4px;
				}
				
				.sync-indicator.syncing {
					background: #fef3c7;
					border-color: #fcd34d;
				}
				
				.sync-indicator.synced {
					background: #dcfce7;
					border-color: #86efac;
				}
				
				.sync-indicator i {
					font-size: 10px;
				}
				
				.sync-indicator.syncing i {
					animation: spin 1s linear infinite;
				}
				
				@keyframes spin {
					from { transform: rotate(0deg); }
					to { transform: rotate(360deg); }
				}
			`;
			document.head.appendChild(style);
			
			header.appendChild(syncStatus);
		}

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sync status
		function updateSyncStatus(status, message) {
			const indicator = document.querySelector('.sync-indicator');
			if (!indicator) return;
			
			indicator.className = `sync-indicator ${status}`;
			
			const statusMessages = {
				ready: 'üîÑ ‡∏û‡∏£‡πâ‡∏≠‡∏° sync',
				syncing: '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á sync...',
				synced: '‚úÖ Sync ‡πÅ‡∏•‡πâ‡∏ß',
				error: '‚ùå Sync ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'
			};
			
			indicator.querySelector('span').textContent = message || statusMessages[status] || status;
		}

		// ========== 8. Debug and Monitoring ==========

		// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ compatibility
		function debugCompatibilityStatus() {
			console.group('üîç Admin-Index Compatibility Status');
			
			console.log('Environment:', {
				isAdmin: ADMIN_INDEX_BRIDGE.isAdminMode(),
				isIndex: ADMIN_INDEX_BRIDGE.isIndexMode(),
				syncEnabled: ADMIN_INDEX_BRIDGE.syncEnabled
			});
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö global objects
			const adminDataExists = typeof walkablePointsData !== 'undefined';
			const indexDataExists = typeof walkableRoutingData !== 'undefined';
			
			console.log('Global Objects:', {
				walkablePointsData: adminDataExists ? 'EXISTS' : 'NOT FOUND',
				walkableRoutingData: indexDataExists ? 'EXISTS' : 'NOT FOUND'
			});
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
			const building = getCurrentBuilding();
			if (building) {
				const adminKey = `walkableData_${building}`;
				const indexKey = `walkableData_${building}_index`;
				
				const adminData = localStorage.getItem(adminKey);
				const indexData = localStorage.getItem(indexKey);
				
				console.log('LocalStorage Data:', {
					adminData: adminData ? 'EXISTS' : 'NOT FOUND',
					indexData: indexData ? 'EXISTS' : 'NOT FOUND',
					lastSync: ADMIN_INDEX_BRIDGE.lastSyncTime
				});
				
				if (adminData) {
					try {
						const parsed = JSON.parse(adminData);
						console.log('Admin Data Summary:', {
							nodes: Object.keys(parsed.nodes || {}).length,
							edges: (parsed.edges || []).length,
							source: parsed.dataSource,
							building: parsed.building || parsed.currentBuilding
						});
					} catch (e) {
						console.warn('‚ö†Ô∏è Admin data parsing error:', e);
					}
				}
			}
			
			console.log('Sync Status:', ADMIN_INDEX_BRIDGE);
			console.groupEnd();
		}

		// ========== 9. Auto-Initialize Integration ==========

		// Initialize integration bridge
		function initializeAdminIndexBridge() {
			debugLog('üåâ Initializing Admin-Index Integration Bridge...');
			
			try {
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö environment
				const isAdmin = ADMIN_INDEX_BRIDGE.isAdminMode();
				const isIndex = ADMIN_INDEX_BRIDGE.isIndexMode();
				
				debugLog('Environment detection:', { isAdmin, isIndex });
				
				if (isAdmin) {
					// Admin mode setup
					addSyncStatusIndicator();
					updateSyncStatus('ready');
					
					// Hook into save function (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô infinite loop)
					if (typeof window.saveWalkableData === 'function') {
						// Backup original function
						if (!window.originalSaveWalkableData) {
							window.originalSaveWalkableData = window.saveWalkableData;
						}
						
						// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
						window.saveWalkableData = saveWalkableDataEnhanced;
					}
										
				} else if (isIndex) {
					// Index mode setup
					autoSyncOnPageLoad();
					
					// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadWalkableData
					if (typeof window.loadWalkableData === 'function') {
						window.originalLoadWalkableData = window.loadWalkableData;
						window.loadWalkableData = loadWalkableDataWithAdminSync;
					}
				}
				
				debugLog('‚úÖ Admin-Index Integration Bridge initialized');
				
			} catch (error) {
				debugLog('‚ùå Error initializing bridge:', error);
			}
		}

		// Auto-initialize based on page type
		document.addEventListener('DOMContentLoaded', function() {
			setTimeout(() => {
				initializeAdminIndexBridge();
				
				// Debug compatibility after initialization
				setTimeout(() => {
					debugCompatibilityStatus();
				}, 2000);
				
			}, 1000);
		});

		// Export bridge functions
		window.adminIndexBridge = {
			sync: {
				adminToIndex: syncAdminDataToIndex,
				indexToAdmin: syncIndexDataToAdmin,
				auto: autoSyncOnPageLoad
			},
			convert: {
				adminToIndex: convertAdminToIndexFormat,
				indexToAdmin: convertIndexToAdminFormat
			},
			debug: debugCompatibilityStatus,
			config: ADMIN_INDEX_BRIDGE
		};
	//******************* End Admin-index Integration bridge *********************
	</script>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">üîê</div>
                <h2 class="login-title">Admin Panel Login</h2>
                <p class="login-subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡πÄ‡∏î‡∏ä‡∏≤ (‡∏™‡∏¥‡∏á‡∏´‡πå ‡∏™‡∏¥‡∏á‡∏´‡πÄ‡∏™‡∏ô‡∏µ) V1.3 <br>Enhanced: Dikstra Admin-Index Integrtaion Bridge (Fixed)</p>
            </div>
            
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="login-form-group">
                    <label class="login-label">Username</label>
                    <input type="text" class="login-input" id="loginUsername" placeholder="‡∏Å‡∏£‡∏≠‡∏Å username" required>
                </div>
                
                <div class="login-form-group">
                    <label class="login-label">Password</label>
                    <input type="password" class="login-input" id="loginPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å password" required>
                </div>
                
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
                
                <div class="login-error" id="loginError"></div>
                
                <div class="login-info">
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö:</strong><br>
                    Username: <code>admin</code><br>
                    Password: <code>1234</code>
                </div>
            </form>
        </div>
    </div>

    <!-- Sequential Loading Screen -->
    <div class="sequential-loading" id="sequentialLoading">
        <div class="loading-content">
            <h3 style="margin-bottom: 20px; color: var(--primary-color);">
                <i class="fas fa-cog fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö
            </h3>
            <div class="loading-steps" id="loadingSteps">
                <div class="loading-step" id="step-connection">
                    <div class="step-icon pending">1</div>
                    <div class="step-text">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</div>
                </div>
                <div class="loading-step" id="step-buildings">
                    <div class="step-icon pending">2</div>
                    <div class="step-text">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</div>
                </div>
                <div class="loading-step" id="step-rooms">
                    <div class="step-icon pending">3</div>
                    <div class="step-text">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á</div>
                </div>
                <div class="loading-step" id="step-ui">
                    <div class="step-icon pending">4</div>
                    <div class="step-text">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÅ‡∏•‡∏∞‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</div>
                </div>
            </div>
            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 20px;">
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö Sequential
            </p>
        </div>
    </div>

    <!-- Main Admin Interface -->
    <div class="admin-container" id="adminContainer" style="display: none;">
        <!-- Desktop Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <h2>üè´ Admin Panel</h2>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô V1.3 <br>Enhanced: Dikstra Admin-Index Integrtaion Bridge </p>
            </div>

            <!-- ======================== Updated Sidebar Menu ======================== -->
			<!-- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà sidebar-menu ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ô‡∏µ‡πâ -->
			<div class="sidebar-menu">
				<div class="menu-item active" onclick="showSection('dashboard')">
					<i class="fas fa-tachometer-alt"></i>
					<span class="menu-text">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</span>
				</div>
				<div class="menu-item" onclick="showSection('buildings')">
					<i class="fas fa-building"></i>
					<span class="menu-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</span>
				</div>
				<div class="menu-item" onclick="showSection('rooms')">
					<i class="fas fa-door-open"></i>
					<span class="menu-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á</span>
				</div>
				<div class="menu-item" onclick="showSection('maps')">
					<i class="fas fa-map"></i>
					<span class="menu-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</span>
				</div>
				<div class="menu-item" onclick="showSection('sheets')">
					<i class="fas fa-table"></i>
					<span class="menu-text">Google Sheets</span>
				</div>
				<div class="menu-item" onclick="showSection('deployment')">
					<i class="fas fa-rocket"></i>
					<span class="menu-text">Deploy Guide</span>
				</div>
				<div class="menu-item" onclick="openUserInterface()">
					<i class="fas fa-external-link-alt"></i>
					<span class="menu-text">‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span>
				</div>
			</div>
        </div>

       <!-- ======================== Updated Mobile Navigation ======================== -->
		<!-- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà mobile-nav ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ô‡∏µ‡πâ -->
		<div class="mobile-nav" id="mobileNav">
			<div class="mobile-nav-item active" onclick="showSection('dashboard')">
				<i class="fas fa-tachometer-alt"></i>
				<span>‡πÅ‡∏î‡∏ä</span>
			</div>
			<div class="mobile-nav-item" onclick="showSection('buildings')">
				<i class="fas fa-building"></i>
				<span>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</span>
			</div>
			<div class="mobile-nav-item" onclick="showSection('rooms')">
				<i class="fas fa-door-open"></i>
				<span>‡∏´‡πâ‡∏≠‡∏á</span>
			</div>
			<div class="mobile-nav-item" onclick="showSection('maps')">
				<i class="fas fa-map"></i>
				<span>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</span>
			</div>
			<div class="mobile-nav-item" onclick="showSection('sheets')">
				<i class="fas fa-table"></i>
				<span>Sheets</span>
			</div>
			<div class="mobile-nav-item" onclick="openMoreMenu()">
				<i class="fas fa-ellipsis-h"></i>
				<span>‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
			</div>
		</div>

		<!-- Mobile More Menu (Dropdown) -->
		<div id="mobileMoreMenu" class="mobile-more-menu" style="display: none; position: fixed; bottom: 70px; right: 10px; background: white; border-radius: 10px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); z-index: 2000; min-width: 150px;">
			<div class="more-menu-item" onclick="showSection('deployment'); closeMobileMoreMenu();" style="padding: 15px 20px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; gap: 10px;">
				<i class="fas fa-rocket" style="color: var(--primary-color);"></i>
				<span>Deploy Guide</span>
			</div>
			<div class="more-menu-item" onclick="openUserInterface(); closeMobileMoreMenu();" style="padding: 15px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
				<i class="fas fa-external-link-alt" style="color: var(--accent-color);"></i>
				<span>‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span>
			</div>
		</div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Header -->
            <div class="main-header">
                <!-- Global Status Indicator -->
                <div style="position: absolute; top: 5px; left: 30px; right: 30px; text-align: center; z-index: 200;">
                    <span id="globalStatusIndicator" class="status-indicator status-connected" style="font-size: 11px; padding: 4px 12px;">
                        <i class="fas fa-check-circle"></i> SYSTEM READY
                    </span>
                </div>
                <h1 class="header-title" id="pageTitle">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h1>
                <div class="header-actions">
                    <button class="header-btn primary" onclick="sequentialLoadData()">
                        <i class="fas fa-sync-alt"></i>
                        <span>Reload Data</span>
                    </button>
                    <button class="header-btn logout-btn" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- ======================== Dashboard Section ======================== -->
                <div class="page-section active" id="dashboard-section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üè¢</div>
                            <div class="stat-number" id="buildingCount">0</div>
                            <div class="stat-label">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üö™</div>
                            <div class="stat-number" id="roomCount">0</div>
                            <div class="stat-label">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-number" id="activeRooms">0</div>
                            <div class="stat-label">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üîó</div>
                            <div class="stat-number" id="connectionStatus">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
                            <div class="stat-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Google Sheets</div>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-line"></i>
                                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                            </h3>
                        </div>
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-chart-bar" style="font-size: 64px; color: var(--primary-color); opacity: 0.3; margin-bottom: 20px;"></i>
                            <p style="color: var(--text-secondary);">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                        </div>
                    </div>
                </div>

                <!-- ======================== Buildings Management Section ======================== -->
                <div class="page-section" id="buildings-section">
                    <div class="admin-card">
                         <div class="enhanced-card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); flex-wrap: wrap; gap: 15px;">
							<h3 class="card-title" style="margin: 0;">
								<i class="fas fa-building"></i>
								‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£
							</h3>
							
							<div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
								<!-- Quick Search -->
								<div style="position: relative;">
									<input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£..." 
										   style="padding: 8px 35px 8px 12px; border: 1px solid var(--border-color); border-radius: 20px; font-size: 14px; width: 200px;" 
										   id="buildingQuickSearch" 
										   oninput="quickSearchBuildings(this.value)">
									<i class="fas fa-search" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); font-size: 12px;"></i>
								</div>
								
								<!-- Filter Button -->
								<button class="btn btn-sm btn-info" onclick="openFilterModal()" title="‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á">
									<i class="fas fa-filter"></i>
								</button>
								
								<!-- Add Button -->
								<button class="btn btn-primary" onclick="openBuildingModal()">
									<i class="fas fa-plus"></i>
									‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
								</button>
							</div>
						</div>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</th>
                                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</th>
                                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πâ‡∏ô</th>
                                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡πâ‡∏≠‡∏á</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody id="buildingsTableBody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
							<div id="buildingsPagination"></div>
                        </div>
                    </div>
                </div>

                <!-- ======================== Rooms Management Section ======================== -->
                <div class="page-section" id="rooms-section">
                    <div class="admin-card">
                        <div class="enhanced-card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); flex-wrap: wrap; gap: 15px;">
							<h3 class="card-title" style="margin: 0;">
								<i class="fas fa-door-open"></i>
								‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á
							</h3>
							
							<div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
								<!-- Quick Search -->
								<div style="position: relative;">
									<input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á..." 
										   style="padding: 8px 35px 8px 12px; border: 1px solid var(--border-color); border-radius: 20px; font-size: 14px; width: 200px;" 
										   id="roomQuickSearch" 
										   oninput="quickSearchRooms(this.value)">
									<i class="fas fa-search" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); font-size: 12px;"></i>
								</div>
								
								<!-- Filter Button -->
								<button class="btn btn-sm btn-info" onclick="openFilterModal()" title="‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á">
									<i class="fas fa-filter"></i>
								</button>
								
								<!-- Add Button -->
								<button class="btn btn-primary" onclick="openRoomModal()">
									<i class="fas fa-plus"></i>
									‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
								</button>
							</div>
						</div>
				 
						
						
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á</th>
                                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á</th>
                                        <th>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</th>
                                        <th>‡∏ä‡∏±‡πâ‡∏ô</th>
                                        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                    </tr>
                                </thead>
                                <tbody id="roomsTableBody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
							<div id="roomsPagination"></div>
                        </div>						
					</div>
                </div>
<!-- ======================== Google Sheets Section ======================== -->
				<div class="page-section" id="sheets-section">
					<div class="admin-card">
						<div class="card-header">
							<h3 class="card-title">
								<i class="fas fa-table"></i>
								Google Sheets Integration
							</h3>
						 
						</div>
						
						<div class="form-group">
							<label class="form-label">Google Sheets Web App URL</label>
							<input type="url" class="form-input" id="sheetsUrl" 
								   placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
						</div>
						<div id="urlValidation" class="url-validation" style="margin-top: 5px; font-size: 12px;"></div>

						<div class="form-row-3">
							<div class="form-group">
								<label class="form-label">Buildings Sheet Name</label>
								<input type="text" class="form-input" id="buildingsSheetName" value="Buildings">
							</div>
							<div class="form-group">
								<label class="form-label">Rooms Sheet Name</label>
								<input type="text" class="form-input" id="roomsSheetName" value="Rooms">
							</div>
							<div class="form-group">
								<label class="form-label">MapImages Sheet Name</label>
								<input type="text" class="form-input" id="mapImagesSheetName" value="MapImages">
							</div>
						</div>
						
						<div style="display: flex; gap: 10px; margin-top: 20px;">
							<button class="btn btn-primary" onclick="testConnection()">
								<i class="fas fa-plug"></i>
								‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
							</button>
							<button class="btn btn-success" onclick="saveSheetConfig()">
								<i class="fas fa-save"></i>
								‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
							</button>
							<button class="btn btn-info" onclick="sequentialLoadData()">
								<i class="fas fa-sync-alt"></i>
								‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Sequential)
							</button>
						</div>
						
						<!-- 8. Enhanced Advanced Options Form - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Google Sheets section -->
						<div id="advancedOptionsContainer" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
							<h4 style="color: var(--secondary-color); margin-bottom: 15px;">
								<i class="fas fa-cogs"></i> Advanced Options
							</h4>
							
							<div class="form-row">
								<div class="form-group">
									<label class="form-label">Request Timeout (seconds)</label>
									<input type="number" class="form-input" id="requestTimeout" min="5" max="60" value="15">
								</div>
								
								<div class="form-group">
									<label class="form-label">Retry Attempts</label>
									<input type="number" class="form-input" id="retryAttempts" min="1" max="10" value="3">
								</div>
							</div>
							
							<div class="form-row">
								<div class="form-group">
									<label style="display: flex; align-items: center; cursor: pointer;">
										<input type="checkbox" id="autoSyncEnabled" style="margin-right: 8px;">
										<span>Auto-sync ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
									</label>
								</div>
								
								<div class="form-group">
									<label style="display: flex; align-items: center; cursor: pointer;">
										<input type="checkbox" id="debugModeEnabled" style="margin-right: 8px;">
										<span>Debug Mode (‡πÅ‡∏™‡∏î‡∏á Technical Details)</span>
									</label>
								</div>
							</div>
						</div>
							
						<!-- Setup Guide (Collapsible) -->
						<!-- 2. Enhanced Setup Guide Container - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á Google Sheets form -->
						<div id="setupGuideContainer" style="display: none; margin-top: 25px;">
							<div class="admin-card" style="background: #f8f9fa; border-left: 5px solid var(--info-color);">
								<h4 style="color: var(--info-color); margin-bottom: 20px;">
									<i class="fas fa-graduation-cap"></i> ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets ‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
								</h4>
								
								<!-- Progress Indicator -->
								<div class="setup-progress" style="margin-bottom: 25px;">
									<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
										<span style="font-size: 14px; font-weight: 600;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
										<span id="setupProgressPercent" style="font-size: 14px; color: var(--primary-color);">0%</span>
									</div>
									<div style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
										<div id="setupProgressBar" style="background: var(--primary-color); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
									</div>
								</div>
								
								<!-- Setup Steps Container -->
								<div class="setup-steps">
									<!-- Steps content will be populated by JavaScript -->
								</div>
								
								<!-- Completion Status -->
								<div id="setupCompleteStatus" style="display: none; background: #d4edda; padding: 20px; border-radius: 10px; text-align: center; margin-top: 20px;">
									<h5 style="color: #155724; margin-bottom: 10px;">
										<i class="fas fa-check-circle"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!
									</h5>
									<p style="color: #155724; margin: 0;">‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö Google Sheets ‡πÅ‡∏•‡πâ‡∏ß</p>
								</div>
							</div>
						</div>
							
						<!-- 4. Debug Panel Container - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Google Sheets section -->
						<div id="debugPanel" style="display: none; background: #1a1a1a; color: #00ff00; padding: 20px; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin-top: 20px;">
							<div style="margin-bottom: 10px; color: #fff; font-weight: bold;">üîç Debug Terminal</div>
							<div id="debugOutput"></div>
						</div>	

						<!-- Sync History -->
						<div style="margin-top: 30px;">				
							
							<!-- 6. Map Sync History Container - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Maps Management -->
							<div id="mapSyncHistory" style="background: #f8f9fa; padding: 15px; border-radius: 10px; max-height: 200px; overflow-y: auto; margin-top: 30px;">
								<h4 style="color: var(--info-color); margin-bottom: 15px;">
									<i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå
								</h4>
								 
							</div>
							 <!-- 5. Sync History Container - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Maps Management -->
							<div id="syncHistoryContainer" style="background: #f8f9fa; padding: 15px; border-radius: 10px; max-height: 200px; overflow-y: auto;">
								<p style="color: var(--text-secondary); text-align: center; margin: 0;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå</p>
							</div>
						</div>						
					</div>			
				</div>	
				
				<!-- ======================== Maps Management Section (Simplified) ======================== -->
				<div class="page-section" id="maps-section">
					<div class="admin-card">
						<div class="card-header">
							<h3 class="card-title">
								<i class="fas fa-map"></i>
								‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
							</h3>
							<button class="btn btn-success" onclick="uploadMapsToSheets()">
								<i class="fas fa-cloud-upload-alt"></i>
								‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets
							</button>
						</div>
						
						<!-- Upload Section -->
						<div class="upload-section" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
							<h4 style="color: var(--primary-color); margin-bottom: 15px;">
								<i class="fas fa-upload"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
							</h4>
							
							<div class="form-row">
								<div class="form-group">
									<label class="form-label">
										<i class="fas fa-drafting-compass"></i> ‡∏£‡∏π‡∏õ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á (Floor Plan)
									</label>
									<input type="file" class="form-input" id="floorplanUpload" 
										   accept="image/*" onchange="handleImageUpload(this, 'floorplan')">
									<small style="color: var(--text-secondary);">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: JPG, PNG, GIF (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB) ‡∏Ç‡∏ô‡∏≤‡∏î: 1400 √ó 1050px (4:3 ratio)</small>
								</div>
								<!--
								<div class="form-group">
									<label class="form-label">
										<i class="fas fa-camera"></i> ‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á (Real Photo)
									</label>
									<input type="file" class="form-input" id="realphotoUpload" 
										   accept="image/*" onchange="handleImageUpload(this, 'realphoto')">
									<small style="color: var(--text-secondary);">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: JPG, PNG, GIF (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB) ‡∏Ç‡∏ô‡∏≤‡∏î: 1400 √ó 1050px (4:3 ratio)</small>
								</div>
								-->
								
								<div class="preview-card" style="border: 2px dashed #ddd; border-radius: 10px; padding: 20px; text-align: center; min-height: 200px;">
								‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
									<div id="floorplanPreview">
										<i class="fas fa-drafting-compass" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
										<p style="color: var(--text-secondary);">‡∏£‡∏π‡∏õ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
								<textarea class="form-input" id="mapNotes" rows="3" 
										 placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ..."></textarea>
							</div>
							
							<div style="text-align: center; margin-top: 15px;">
								<button class="btn btn-primary" onclick="saveMapImages()">
									<i class="fas fa-save"></i>
									‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
								</button>
								<button class="btn btn-secondary" onclick="forceRefreshMaps()" title="‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets">
									<i class="fas fa-sync-alt"></i>
									‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
								</button>
								<button class="btn btn-secondary" onclick="clearMapForms()">
									<i class="fas fa-times"></i>
									‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
								</button>
							</div>
						</div>
						
						<!-- Preview Section
						<div class="preview-section">
							<h4 style="color: var(--primary-color); margin-bottom: 15px;">
								<i class="fas fa-eye"></i> ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
							</h4>
							
							<div class="image-previews" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
								<div class="preview-card" style="border: 2px dashed #ddd; border-radius: 10px; padding: 20px; text-align: center; min-height: 200px;">
									<div id="floorplanPreview">
										<i class="fas fa-drafting-compass" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
										<p style="color: var(--text-secondary);">‡∏£‡∏π‡∏õ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
									</div>
								</div>
							
								
								<div class="preview-card" style="border: 2px dashed #ddd; border-radius: 10px; padding: 20px; text-align: center; min-height: 200px;">
									<div id="realphotoPreview">
										<i class="fas fa-camera" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
										<p style="color: var(--text-secondary);">‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
									</div>
								</div>
								
							</div>
						</div>
						-->
						
						<!-- Sync History - ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ -->
						 
						<!-- Walkable Points Management Interface -->
						 
						<div class="admin-walkable-section" id="walkablePointsSection" style="display: none;">
							<div class="section-header">
								<h3><i class="fas fa-route"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</h3>
								<div class="header-actions">
									<button class="btn btn-primary" onclick="toggleWalkableMode()">
										<i class="fas fa-edit"></i> ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
									</button>
									<button class="btn btn-info" onclick="previewWalkablePoints()">
										<i class="fas fa-eye"></i> ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
									</button>
								</div>
							</div>
							
							<!-- Statistics Dashboard -->
							<div class="walkable-dashboard">
								<div class="stat-cards">
									<div class="stat-card primary">
										<div class="stat-icon">üö∂‚Äç‚ôÇÔ∏è</div>
										<div class="stat-content">
											<div class="stat-number" id="totalWalkablePoints">0</div>
											<div class="stat-label">‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
										</div>
									</div>
									<div class="stat-card success">
										<div class="stat-icon">üîó</div>
										<div class="stat-content">
											<div class="stat-number" id="totalConnections">0</div>
											<div class="stat-label">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á</div>
										</div>
									</div>
									<div class="stat-card warning">
										<div class="stat-icon">üìè</div>
										<div class="stat-content">
											<div class="stat-number" id="averageDistance">0m</div>
											<div class="stat-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
										</div>
									</div>
									<div class="stat-card info">
										<div class="stat-icon">üìä</div>
										<div class="stat-content">
											<div class="stat-number" id="coveragePercentage">0%</div>
											<div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</div>
										</div>
									</div>
								</div>
							</div>
							
							<!-- Walkable Points Canvas -->
							<div class="walkable-canvas-container">
								<div class="canvas-header">
									<h4>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô - <span id="currentBuildingName">-</span></h4>
									<div class="canvas-controls">
										<button class="canvas-btn" onclick="zoomIn()">
											<i class="fas fa-search-plus"></i>
										</button>
										<button class="canvas-btn" onclick="zoomOut()">
											<i class="fas fa-search-minus"></i>
										</button>
										<button class="canvas-btn" onclick="resetZoom()">
											<i class="fas fa-expand-arrows-alt"></i>
										</button>
										<button class="canvas-btn" onclick="toggleGrid()">
											<i class="fas fa-th"></i>
										</button>
									</div>
								</div>
								
								<div class="walkable-canvas" id="walkableCanvas">
									<!-- Background image -->
									<img class="canvas-background" id="canvasBackground" alt="Building Floor Plan">
									
									<!-- Grid overlay -->
									<div class="grid-overlay" id="gridOverlay"></div>
									
									<!-- Walkable points and connections -->
									<svg class="walkable-svg" id="walkableSvg" viewBox="0 0 100 100">
										<!-- Connections will be drawn here -->
									</svg>
									
									<!-- Interactive points -->
									<div class="points-layer" id="pointsLayer">
										<!-- Points will be added here -->
									</div>
									
									<!-- Selection tools -->
									<div class="selection-tools" id="selectionTools">
										<!-- Selection rectangle, etc. -->
									</div>
								</div>
								 
							</div>
						 
						</div>
					</div>
				</div>
				
				<!-- ========== ADMIN WALKABLE SECTION ========== -->
				<div class="admin-walkable-section" style="display: none;" id="walkablePointsSection">
					<!-- Walkable Dashboard -->
					<div class="walkable-dashboard">
						<h3 style="margin-bottom: 20px;">
							<i class="fas fa-walking"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô
						</h3>
						
						<!-- Stats Cards -->
						<div class="stat-cards">
							<div class="stat-card primary">
								<div class="stat-icon">üìç</div>
								<div class="stat-content">
									<div class="stat-number" id="totalNodes">0</div>
									<div class="stat-label">‡∏à‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
								</div>
							</div>
							<div class="stat-card success">
								<div class="stat-icon">üîó</div>
								<div class="stat-content">
									<div class="stat-number" id="totalConnections">0</div>
									<div class="stat-label">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
								</div>
							</div>
						</div>
					</div>

					<!-- ‚úÖ Fixed Walkable Canvas Container -->
					<div class="walkable-canvas-container">
						<div class="canvas-header">
							<h4>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô - <span id="currentBuildingName">-</span></h4>
							<div class="canvas-controls">
								<button class="canvas-btn" onclick="zoomIn()" title="‡∏Ç‡∏¢‡∏≤‡∏¢">
									<i class="fas fa-search-plus"></i>
								</button>
								<button class="canvas-btn" onclick="resetZoom()" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï">
									<i class="fas fa-expand-arrows-alt"></i>
								</button>
							</div>
						</div>
						
						<!-- ‚úÖ Fixed Map Container -->
						<div class="walkable-canvas" id="walkableCanvas" data-coordinate-system="percentage">
							<!-- Background image -->
							<div class="map-image-container">
								<img class="canvas-background" id="canvasBackground" 
									 alt="Building Floor Plan"
									 onerror="handleImageError(this)"
									 onload="handleImageLoad(this)">
							</div>
							
							<!-- ‚úÖ Fixed SVG with consistent viewBox -->
							<svg class="walkable-svg" id="walkableSvg" viewBox="0 0 100 100" preserveAspectRatio="none">
								<!-- Connections will be drawn here -->
							</svg>
							
							<!-- Interactive points layer -->
							<div class="points-layer" id="pointsLayer">
								<!-- Points will be added here -->
							</div>
						</div>
					</div>

					<!-- Action Buttons -->
					<div class="walkable-actions" style="margin-top: 20px; display: flex; gap: 10px;">
						<button class="btn primary" onclick="saveWalkableData()">
							<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
						</button>
						<button class="btn ghost" onclick="loadWalkableData()">
							<i class="fas fa-download"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
						</button>
					</div>
				</div>
 
				
				
				<!-- ======================== Deployment Guide Section ======================== -->

				<div class="page-section" id="deployment-section">
					<div class="admin-card">
						<div class="card-header">
							<h3 class="card-title">
								<i class="fas fa-rocket"></i>
								‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ Deploy ‡πÑ‡∏õ‡∏¢‡∏±‡∏á GitHub Pages
							</h3>
						 
						</div>
						
						<!-- Quick Start -->
						<div class="deployment-quick-start" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
							<h4 style="margin-bottom: 15px;">
								<i class="fas fa-bolt"></i> Quick Start Guide
							</h4>
							<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
								<div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
									<div style="font-size: 24px; margin-bottom: 5px;">1Ô∏è‚É£</div>
									<div style="font-weight: 600;">‡∏™‡∏£‡πâ‡∏≤‡∏á Repository</div>
									<div style="font-size: 13px; opacity: 0.9;">‡∏™‡∏£‡πâ‡∏≤‡∏á GitHub repo ‡πÉ‡∏´‡∏°‡πà</div>
								</div>
								<div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
									<div style="font-size: 24px; margin-bottom: 5px;">2Ô∏è‚É£</div>
									<div style="font-weight: 600;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</div>
									<div style="font-size: 13px; opacity: 0.9;">Upload index.html + admin.html</div>
								</div>
								<div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
									<div style="font-size: 24px; margin-bottom: 5px;">3Ô∏è‚É£</div>
									<div style="font-weight: 600;">‡πÄ‡∏õ‡∏¥‡∏î Pages</div>
									<div style="font-size: 13px; opacity: 0.9;">Settings ‚Üí Pages ‚Üí Deploy</div>
								</div>
								<div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
									<div style="font-size: 24px; margin-bottom: 5px;">4Ô∏è‚É£</div>
									<div style="font-weight: 600;">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!</div>
									<div style="font-size: 13px; opacity: 0.9;">‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
								</div>
							</div>
						</div>
						
						<!-- Detailed Steps -->
						<div class="deployment-steps">
							<h4 style="color: var(--primary-color); margin-bottom: 20px;">
								<i class="fas fa-list-ol"></i> ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£ Deploy ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
							</h4>
							
							<!-- Step 1 -->
							<div class="deployment-step" style="border: 2px solid var(--border-color); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
								<h5 style="color: var(--primary-color); margin-bottom: 15px;">
									<i class="fas fa-plus-circle"></i> ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á GitHub Repository
								</h5>
								
								<div style="margin-bottom: 15px;">
									<strong>1.1 ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà GitHub:</strong>
									<ul style="margin: 10px 0; padding-left: 20px;">
										<li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://github.com" target="_blank" style="color: var(--primary-color);">github.com</a></li>
										<li>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</li>
									</ul>
								</div>
								
								<div style="margin-bottom: 15px;">
									<strong>1.2 ‡∏™‡∏£‡πâ‡∏≤‡∏á Repository ‡πÉ‡∏´‡∏°‡πà:</strong>
									<ul style="margin: 10px 0; padding-left: 20px;">
										<li>‡∏Ñ‡∏•‡∏¥‡∏Å "New" ‡∏´‡∏£‡∏∑‡∏≠ "+" ‚Üí "New repository"</li>
										<li>‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠: <code style="background: #f1f3f4; padding: 2px 6px; border-radius: 4px;">school-map-system</code></li>
										<li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Public" (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö GitHub Pages ‡∏ü‡∏£‡∏µ)</li>
										<li>‚òëÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Add a README file"</li>
										<li>‡∏Ñ‡∏•‡∏¥‡∏Å "Create repository"</li>
									</ul>
								</div>
								
								<div class="code-example" style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; margin-top: 10px;">
									<div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠ Repository:</div>
									<div>your-username/school-map-system</div>
								</div>
							</div>
							
							<!-- Step 2 -->
							<div class="deployment-step" style="border: 2px solid var(--border-color); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
								<h5 style="color: var(--primary-color); margin-bottom: 15px;">
									<i class="fas fa-upload"></i> ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
								</h5>
								
								<div style="margin-bottom: 15px;">
									<strong>2.1 ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</strong>
									<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
										<div style="background: #e8f4fd; padding: 15px; border-radius: 8px; border-left: 4px solid var(--info-color);">
											<div style="font-weight: 600; color: var(--info-color);">üìÑ index.html</div>
											<div style="font-size: 13px; color: var(--text-secondary);">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
										</div>
										<div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning-color);">
											<div style="font-weight: 600; color: #856404;">üîê admin.html</div>
											<div style="font-size: 13px; color: var(--text-secondary);">‡∏´‡∏ô‡πâ‡∏≤ Admin Panel (‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ)</div>
										</div>
									</div>
								</div>
								
								<div style="margin-bottom: 15px;">
									<strong>2.2 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</strong>
									<ol style="margin: 10px 0; padding-left: 20px;">
										<li>‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Repository ‡∏Ñ‡∏•‡∏¥‡∏Å "Add file" ‚Üí "Upload files"</li>
										<li>‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå index.html ‡πÅ‡∏•‡∏∞ admin.html ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</li>
										<li>‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° commit: <code style="background: #f1f3f4; padding: 2px 6px; border-radius: 4px;">Add school map system files</code></li>
										<li>‡∏Ñ‡∏•‡∏¥‡∏Å "Commit changes"</li>
									</ol>
								</div>
								
								<div class="file-structure" style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; margin-top: 10px;">
									<div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:</div>
									<div>üìÅ your-repository/</div>
									<div>&nbsp;&nbsp;‚îú‚îÄ‚îÄ üìÑ README.md</div>
									<div>&nbsp;&nbsp;‚îú‚îÄ‚îÄ üìÑ index.html</div>
									<div>&nbsp;&nbsp;‚îî‚îÄ‚îÄ üìÑ admin.html</div>
								</div>
							</div>
							
							<!-- Step 3 -->
							<div class="deployment-step" style="border: 2px solid var(--border-color); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
								<h5 style="color: var(--primary-color); margin-bottom: 15px;">
									<i class="fas fa-cog"></i> ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô GitHub Pages
								</h5>
								
								<div style="margin-bottom: 15px;">
									<strong>3.1 ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:</strong>
									<ol style="margin: 10px 0; padding-left: 20px;">
										<li>‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Repository ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ó‡πá‡∏ö "Settings" (‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)</li>
										<li>‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏´‡∏≤‡∏™‡πà‡∏ß‡∏ô "Pages" ‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ã‡πâ‡∏≤‡∏¢</li>
										<li>‡∏Ñ‡∏•‡∏¥‡∏Å "Pages"</li>
									</ol>
								</div>
								
								<div style="margin-bottom: 15px;">
									<strong>3.2 ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Pages:</strong>
									<ul style="margin: 10px 0; padding-left: 20px;">
										<li><strong>Source:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Deploy from a branch"</li>
										<li><strong>Branch:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "main" (‡∏´‡∏£‡∏∑‡∏≠ "master")</li>
										<li><strong>Folder:</strong> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "/ (root)"</li>
										<li>‡∏Ñ‡∏•‡∏¥‡∏Å "Save"</li>
									</ul>
								</div>
								
								<div class="success-box" style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 8px; margin-top: 15px;">
									<div style="color: #155724; font-weight: 600;">‚úÖ ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>
									<div style="color: #155724; margin-top: 5px;">GitHub ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå ‡πÄ‡∏ä‡πà‡∏ô:</div>
									<div style="font-family: monospace; background: #fff; padding: 8px; border-radius: 4px; margin-top: 8px;">
										https://your-username.github.io/school-map-system/
									</div>
								</div>
							</div>
							
							<!-- Step 4 -->
							<div class="deployment-step" style="border: 2px solid var(--border-color); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
								<h5 style="color: var(--primary-color); margin-bottom: 15px;">
									<i class="fas fa-check-circle"></i> ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
								</h5>
								
								<div style="margin-bottom: 15px;">
									<strong>4.1 ‡∏£‡∏≠‡∏Å‡∏≤‡∏£ Deploy:</strong>
									<ul style="margin: 10px 0; padding-left: 20px;">
										<li>‡∏Å‡∏≤‡∏£ Deploy ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 5-10 ‡∏ô‡∏≤‡∏ó‡∏µ</li>
										<li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö "Actions"</li>
										<li>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚úÖ</li>
									</ul>
								</div>
								
								<div style="margin-bottom: 15px;">
									<strong>4.2 ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå:</strong>
									<ul style="margin: 10px 0; padding-left: 20px;">
										<li>‡πÄ‡∏õ‡∏¥‡∏î URL ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</li>
										<li>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å: <code>/index.html</code></li>
										<li>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Admin: <code>/admin.html</code></li>
									</ul>
								</div>
								
								<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
									<div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
										<div style="font-weight: 600; color: var(--info-color); margin-bottom: 5px;">üåê ‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
										<div style="font-size: 13px;">https://your-site.github.io/school-map-system/</div>
									</div>
									<div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
										<div style="font-weight: 600; color: #f57c00; margin-bottom: 5px;">üîê ‡∏´‡∏ô‡πâ‡∏≤ Admin</div>
										<div style="font-size: 13px;">https://your-site.github.io/school-map-system/admin.html</div>
									</div>
								</div>
							</div>
						</div>
						
					 
						
						<!-- Troubleshooting -->
						<div class="troubleshooting" style="margin-top: 25px;">
							<h4 style="color: var(--danger-color); margin-bottom: 15px;">
								<i class="fas fa-tools"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢
							</h4>
							
							<div class="accordion" style="border: 1px solid var(--border-color); border-radius: 10px;">
								<div class="accordion-item" style="border-bottom: 1px solid var(--border-color);">
									<div class="accordion-header" style="padding: 15px; cursor: pointer; background: #f8f9fa;" onclick="toggleAccordion(this)">
										<strong>‚ùå ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏™‡∏î‡∏á 404 Not Found</strong>
										<i class="fas fa-chevron-down" style="float: right; transition: transform 0.3s;"></i>
									</div>
									<div class="accordion-content" style="padding: 15px; display: none;">
										<ul style="margin: 0; padding-left: 20px;">
											<li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå index.html ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô root directory</li>
											<li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ GitHub Pages ‡πÉ‡∏ô Settings</li>
											<li>‡∏£‡∏≠‡∏Å‡∏≤‡∏£ deploy ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (5-10 ‡∏ô‡∏≤‡∏ó‡∏µ)</li>
											<li>‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ URL ‡πÅ‡∏ö‡∏ö https:// ‡πÅ‡∏ó‡∏ô http://</li>
										</ul>
									</div>
								</div>
								
								<div class="accordion-item" style="border-bottom: 1px solid var(--border-color);">
									<div class="accordion-header" style="padding: 15px; cursor: pointer; background: #f8f9fa;" onclick="toggleAccordion(this)">
										<strong>‚è≥ ‡∏Å‡∏≤‡∏£ Deploy ‡∏ä‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</strong>
										<i class="fas fa-chevron-down" style="float: right; transition: transform 0.3s;"></i>
									</div>
									<div class="accordion-content" style="padding: 15px; display: none;">
										<ul style="margin: 0; padding-left: 20px;">
											<li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô Actions tab</li>
											<li>‡∏î‡∏π error logs ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ deployment ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</li>
											<li>‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á commit ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠ trigger deployment</li>
											<li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1GB</li>
										</ul>
									</div>
								</div>
								
								<div class="accordion-item">
									<div class="accordion-header" style="padding: 15px; cursor: pointer; background: #f8f9fa;" onclick="toggleAccordion(this)">
										<strong>üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</strong>
										<i class="fas fa-chevron-down" style="float: right; transition: transform 0.3s;"></i>
									</div>
									<div class="accordion-content" style="padding: 15px; display: none;">
										<ul style="margin: 0; padding-left: 20px;">
											<li>‡πÉ‡∏ä‡πâ relative paths ‡πÅ‡∏ó‡∏ô absolute paths</li>
											<li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô (case-sensitive)</li>
											<li>‡πÉ‡∏ä‡πâ / ‡πÅ‡∏ó‡∏ô \ ‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠ path</li>
											<li>‡πÉ‡∏ä‡πâ base tag ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô: &lt;base href="/repository-name/"&gt;</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				
            </div>
        </div>
    </div>
	
	<!-- ======================== Modal Forms ======================== -->
	<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô closing </body> tag -->

	<!-- Building Modal -->
	<div id="buildingModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9999; backdrop-filter: blur(5px);">
		<div class="modal-content" style="background: white; margin: 50px auto; padding: 0; border-radius: 15px; max-width: 600px; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
			<!-- Modal Header -->
			<div class="modal-header" style="padding: 25px 30px; border-bottom: 2px solid var(--border-color); background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border-radius: 15px 15px 0 0;">
				<h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
					<i class="fas fa-building"></i>
					<span id="buildingModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</span>
				</h3>
				<button onclick="closeBuildingModal()" style="position: absolute; top: 20px; right: 25px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;">√ó</button>
			</div>
			
			<!-- Modal Body -->
			<div class="modal-body" style="padding: 30px;">
				<form id="buildingForm" onsubmit="saveBuildingForm(event)">
					<div class="form-row">
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-hashtag"></i> ‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£
								<span style="color: var(--danger-color);">*</span>
							</label>
							<input type="text" class="form-input" id="buildingCode" 
								   placeholder="B001" maxlength="10" required>
							<small style="color: var(--text-secondary);">‡∏£‡∏´‡∏±‡∏™‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</small>
						</div>
						
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-building"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£
								<span style="color: var(--danger-color);">*</span>
							</label>
							<input type="text" class="form-input" id="buildingName" 
								   placeholder="‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏ß‡∏°" required>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-layer-group"></i> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πâ‡∏ô
								<span style="color: var(--danger-color);">*</span>
							</label>
							<input type="number" class="form-input" id="buildingFloors" 
								   min="1" max="50" value="1" required>
						</div>
						
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-calendar-alt"></i> ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á
							</label>
							<input type="number" class="form-input" id="buildingYear" 
								   min="1900" max="2030" placeholder="2023">
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-door-open"></i> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡πâ‡∏≠‡∏á
							</label>
							<input type="number" class="form-input" id="buildingRooms" 
								   min="0" max="1000" value="0">
						</div>
						
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-toggle-on"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
								<span style="color: var(--danger-color);">*</span>
							</label>
							<select class="form-input" id="buildingStatus" required>
								<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
								<option value="active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
								<option value="inactive">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
								<option value="maintenance">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</option>
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label class="form-label">
							<i class="fas fa-align-left"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
						</label>
						<textarea class="form-input" id="buildingDescription" rows="3" 
								 placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£..."></textarea>
					</div>
					
					<!-- Form Actions -->
					<div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color);">
						<button type="button" class="btn btn-secondary" onclick="closeBuildingModal()">
							<i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
						</button>
						<button type="submit" class="btn btn-primary">
							<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Room Modal -->
	<div id="roomModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9999; backdrop-filter: blur(5px);">
		<div class="modal-content" style="background: white; margin: 30px auto; padding: 0; border-radius: 15px; max-width: 700px; max-height: 95vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
			<!-- Modal Header -->
			<div class="modal-header" style="padding: 25px 30px; border-bottom: 2px solid var(--border-color); background: linear-gradient(135deg, var(--accent-color), var(--info-color)); color: white; border-radius: 15px 15px 0 0;">
				<h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
					<i class="fas fa-door-open"></i>
					<span id="roomModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</span>
				</h3>
				<button onclick="closeRoomModal()" style="position: absolute; top: 20px; right: 25px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;">√ó</button>
			</div>
			
			<!-- Modal Body -->
			<div class="modal-body" style="padding: 30px;">
				<form id="roomForm" onsubmit="saveRoomForm(event)">
					<div class="form-row">
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-hashtag"></i> ‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á
								<span style="color: var(--danger-color);">*</span>
							</label>
							<input type="text" class="form-input" id="roomCode" 
								   placeholder="R0001" maxlength="10" required>
							<small style="color: var(--text-secondary);">‡∏£‡∏´‡∏±‡∏™‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</small>
						</div>
						
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-door-open"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á
								<span style="color: var(--danger-color);">*</span>
							</label>
							<input type="text" class="form-input" id="roomName" 
								   placeholder="‡∏´‡πâ‡∏≠‡∏á 101" required>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-building"></i> ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£
								<span style="color: var(--danger-color);">*</span>
							</label>
							<select class="form-input" id="roomBuilding" required>
								<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</option>
								<!-- Options will be populated by JavaScript -->
							</select>
						</div>
						
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-layer-group"></i> ‡∏ä‡∏±‡πâ‡∏ô
								<span style="color: var(--danger-color);">*</span>
							</label>
							<input type="number" class="form-input" id="roomFloor" 
								   min="1" max="50" value="1" required>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-tags"></i> ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á
							</label>
							<select class="form-input" id="roomType">
								<option value="‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
								<option value="‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£">‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£</option>
								<option value="‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
								<option value="‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°">‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</option>
								<option value="‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡∏Ñ‡∏£‡∏π">‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡∏Ñ‡∏£‡∏π</option>
								<option value="‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥">‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥</option>
								<option value="‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á</option>
								<option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
							</select>
						</div>
						
						<div class="form-group">
							<label class="form-label">
								<i class="fas fa-toggle-on"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
								<span style="color: var(--danger-color);">*</span>
							</label>
							<select class="form-input" id="roomStatus" required>
								<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
								<option value="active">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
								<option value="inactive">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
								<option value="maintenance">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</option>
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label class="form-label">
							<i class="fas fa-map-marked-alt"></i> ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
						</label>
						
						<div class="interactive-map-container">
							
							<!-- Header -->
							<div class="map-picker-header">
								<div class="map-picker-title">
									<i class="fas fa-crosshairs"></i>
									‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
								</div> 
							</div>

							<!-- Instructions -->
							<div class="map-instructions">
								<strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡πâ‡∏≠‡∏á ‚Ä¢ ‡πÄ‡∏õ‡∏¥‡∏î Grid ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ ‚Ä¢ ‡∏õ‡∏£‡∏±‡∏ö X,Y ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
							</div>
 

							<!-- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô map-canvas-container ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Room Modal -->
							<div class="map-canvas-container" id="roomMapContainer" onclick="selectRoomPosition(event)">
								<!-- Coordinate Display -->
								<div class="coordinate-display" id="roomCoordinateDisplay">
									X: 0.0, Y: 0.0
								</div>
							 
								<!-- NEW: Image Container -->
								<div class="map-image-container" id="mapImageContainer">
									<!-- Floorplan Image -->
									<img class="map-floorplan-image" id="mapFloorplanImage" style="display: none;" alt="Floor Plan">
									
									<!-- Loading Overlay -->
									<div class="map-loading-overlay" id="mapLoadingOverlay" style="display: none;">
										<div class="loading-spinner"></div>
										<p style="margin-top: 10px; font-size: 14px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà...</p>
									</div>
									
									<!-- Upload Zone -->
									<div class="map-upload-zone" id="mapUploadZone" style="display: none;">
										<i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: var(--primary-color); margin-bottom: 10px;"></i>
										<p style="font-weight: 600; margin-bottom: 5px;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</p>
										<p style="font-size: 12px; color: var(--text-secondary);">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
										<input type="file" id="floorplanFileInput" accept="image/*" style="display: none;">
									</div>
									
									<!-- Placeholder (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á) -->
									<div class="map-placeholder" id="roomMapPlaceholder">
										<i class="fas fa-map" style="font-size: 32px; margin-bottom: 8px; opacity: 0.5;"></i>
										<div style="font-size: 14px; margin-bottom: 4px;">‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</div>
										<div style="font-size: 11px; opacity: 0.7;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà!! ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</div>
									</div>			 
								</div>
								
								<!-- Position Marker -->
								<div class="position-marker" id="roomPositionMarker" style="display: none;"></div>
							</div>

							<!-- Coordinate Inputs -->
							<div class="coordinate-inputs-enhanced">
								<div class="coordinate-input-group-enhanced">
									<label style="font-size: 11px; font-weight: 600; margin-bottom: 4px; color: #555;">
										<i class="fas fa-arrows-alt-h"></i> X Coordinate
									</label>
									<input type="number" class="coordinate-input-enhanced" id="roomX" 
										   placeholder="0.0" step="0.1" 
										   oninput="updateRoomMarkerFromInput()" />
								</div>
								
								<div class="coordinate-input-group-enhanced">
									<label style="font-size: 11px; font-weight: 600; margin-bottom: 4px; color: #555;">
										<i class="fas fa-arrows-alt-v"></i> Y Coordinate
									</label>
									<input type="number" class="coordinate-input-enhanced" id="roomY" 
										   placeholder="0.0" step="0.1" 
										   oninput="updateRoomMarkerFromInput()" />
								</div>
								
								<button type="button" class="clear-position-btn" onclick="clearRoomPosition()">
									<i class="fas fa-times"></i>
									‡∏•‡πâ‡∏≤‡∏á
								</button>
							</div>

						</div>
					</div>
					
					<div class="form-group">
						<label class="form-label">
							<i class="fas fa-align-left"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
						</label>
						<textarea class="form-input" id="roomDescription" rows="3" 
								 placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á..."></textarea>
					</div>
					
					<!-- Image URLs Section -->
					<div class="form-group">
						<label class="form-label">
							<i class="fas fa-images"></i> ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URLs)
						</label>
						<div id="roomImagesContainer">
							<div class="image-url-input" style="display: flex; gap: 10px; margin-bottom: 10px;">
								<input type="url" class="form-input" placeholder="https://example.com/image.jpg" 
									   style="flex: 1;" onchange="validateImageUrl(this)">
								<button type="button" class="btn btn-sm btn-success" onclick="addImageUrl()">
									<i class="fas fa-plus"></i>
								</button>
							</div>
						</div>
						<small style="color: var(--text-secondary);">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏≤‡∏¢ URL ‡πÑ‡∏î‡πâ</small>
					</div>
					
					<!-- Form Actions -->
					<div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color);">
						<button type="button" class="btn btn-secondary" onclick="closeRoomModal()">
							<i class="fas fa-times"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
						</button>
						<button type="submit" class="btn btn-primary">
							<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Filter/Search Modal -->
	<div id="filterModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 9999; backdrop-filter: blur(5px);">
		<div class="modal-content" style="background: white; margin: 100px auto; padding: 0; border-radius: 15px; max-width: 500px; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
			<!-- Modal Header -->
			<div class="modal-header" style="padding: 20px 25px; border-bottom: 2px solid var(--border-color); background: linear-gradient(135deg, var(--info-color), var(--primary-color)); color: white; border-radius: 15px 15px 0 0;">
				<h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
					<i class="fas fa-filter"></i>
					<span>‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span>
				</h3>
				<button onclick="closeFilterModal()" style="position: absolute; top: 15px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 16px;">√ó</button>
			</div>
			
			<!-- Modal Body -->
			<div class="modal-body" style="padding: 25px;">
				<div class="form-group">
					<label class="form-label">
						<i class="fas fa-search"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
					</label>
					<input type="text" class="form-input" id="filterSearch" 
						   placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡∏£‡∏´‡∏±‡∏™ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." 
						   oninput="applyFilter()">
				</div>
				
				<div class="form-group">
					<label class="form-label">
						<i class="fas fa-sort"></i> ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°
					</label>
					<div style="display: flex; gap: 10px;">
						<select class="form-input" id="filterSortField" onchange="applySort()" style="flex: 2;">
							<option value="">‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á</option>
							<option value="name">‡∏ä‡∏∑‡πà‡∏≠</option>
							<option value="code">‡∏£‡∏´‡∏±‡∏™</option>
							<option value="created">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</option>
							<option value="updated">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</option>
						</select>
						<select class="form-input" id="filterSortDirection" onchange="applySort()" style="flex: 1;">
							<option value="asc">‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏°‡∏≤‡∏Å</option>
							<option value="desc">‡∏°‡∏≤‡∏Å ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢</option>
						</select>
					</div>
				</div>
				
				<div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
					<button type="button" class="btn btn-secondary" onclick="clearFilter()">
						<i class="fas fa-times"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
					</button>
					<button type="button" class="btn btn-primary" onclick="closeFilterModal()">
						<i class="fas fa-check"></i> ‡∏ï‡∏Å‡∏•‡∏á
					</button>
				</div>
			</div>
		</div>
	</div>	
	<!-- 1. Enhanced Google Sheets Section - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Google Sheets section -->
	<div id="connectionBanner" class="connection-banner disconnected" style="padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; border: 1px solid var(--border-color);">
		<i id="connectionIcon" class="fas fa-plug" style="font-size: 18px; margin-right: 10px;"></i>
		<span id="connectionText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
	</div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // =================== Global Variables ===================
        let currentVersion = 'live';
        let buildingsData = {};
        let roomsData = {};
        let sheetsConfig = {
            url: 'https://script.google.com/macros/s/AKfycbzpCFGZ_7kvyvAqiQGw3y_t6ROwUhh8Csp-I3xOPZZhP_XJ9Yyfyjsrl88s5qg3xx56/exec',
            buildingsSheet: 'Buildings',
            roomsSheet: 'Rooms',
            mapImagesSheet: 'MapImages',
            connected: false,
			requestTimeout: 15,
			retryAttempts: 3,
			autoSyncEnabled: false,
			debugModeEnabled: false			
        };
		const mapImageCache = new Map();		// ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Map Image Cache
		let imageLoadingAbortController = new AbortController();
        let isLoggedIn = false;
        let isSystemReady = false;
		// Global variables for image management 

 				
		// ========== Walkable Points Data Management ==========
		let walkablePointsData = {
			currentBuilding: null,
			nodes: {},
			edges: [],
			settings: {
				maxConnectionDistance: 25, // ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
				metersPerPercent: 1.2,
				autoConnect: true,
				snapToGrid: false,
				gridSize: 5
			},
			selectedNodes: new Set(),
			isDragging: false,
			dragNode: null
		};
        // =================== Sequential Loading System ===================
        
        class SequentialLoader {
            constructor() {
                this.steps = [
                    { id: 'connection', name: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', status: 'pending' },
                    { id: 'buildings', name: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£', status: 'pending' },
                    { id: 'rooms', name: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á', status: 'pending' },
                    { id: 'ui', name: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÅ‡∏•‡∏∞‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î', status: 'pending' }
                ];
                this.isLoading = false;
            }

            async startSequentialLoad() {
                if (this.isLoading) {
                    console.log('Sequential loading already in progress');
                    return false;
                }

                this.isLoading = true;
                this.showLoadingScreen();
                
                let allSuccess = true;
		 

                try {
                    // Step 1: Test Connection
                    this.updateStepStatus('connection', 'loading');
                    const connectionResult = await this.testConnectionStep();
                    this.updateStepStatus('connection', connectionResult ? 'success' : 'error');
                    
                    // Step 2: Load Buildings
                    this.updateStepStatus('buildings', 'loading');
                    const buildingsResult = await this.loadBuildingsStep();
                    this.updateStepStatus('buildings', buildingsResult ? 'success' : 'error');
                    if (!buildingsResult) allSuccess = false;

                    // Step 3: Load Rooms  
                    this.updateStepStatus('rooms', 'loading');
                    const roomsResult = await this.loadRoomsStep();
                    this.updateStepStatus('rooms', roomsResult ? 'success' : 'error');
                    if (!roomsResult) allSuccess = false;

                    // Step 4: Update UI (Always runs)
                    this.updateStepStatus('ui', 'loading');
                    await this.updateUIStep();
                    this.updateStepStatus('ui', 'success');

                    // Final status
                    isSystemReady = true;
                    this.updateGlobalStatus(allSuccess);

                    // Hide loading screen after delay
                    setTimeout(() => {
                        this.hideLoadingScreen();
                    }, 1500);
 

                    return allSuccess;

                } catch (error) {
                    console.error('Sequential loading failed:', error);
                    allSuccess = false;
                    this.updateGlobalStatus(false);
                    setTimeout(() => {
                        this.hideLoadingScreen();
                    }, 2000);
                    return false;
                } finally {
                    this.isLoading = false;
                }
				
            }

            async testConnectionStep() {
				 
                try {
                    if (!sheetsConfig.url) {
                        console.log('No Google Sheets URL configured');
                        sheetsConfig.connected = false;
                        return false;
                    }

                    const params = new URLSearchParams();
                    params.append('action', 'getData');
                    params.append('sheet', sheetsConfig.buildingsSheet);

                    const response = await Promise.race([
                        fetch(sheetsConfig.url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                            body: params.toString()
                        }),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Connection timeout')), 10000)
                        )
                    ]);

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success !== undefined) {
                            sheetsConfig.connected = true;
                            localStorage.setItem('sheetsConfig', JSON.stringify(sheetsConfig));
                            console.log('‚úÖ Google Sheets connected');
                            return true;
                        }
                    }

                    throw new Error('Invalid response from Google Sheets');

                } catch (error) {
                    console.log('‚ùå Connection failed:', error.message);
                    sheetsConfig.connected = false;
                    return false;
                }
            }

           async loadBuildingsStep() {
			try { 
				if (sheetsConfig.connected) { 
					// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å Google Sheets ‡πÄ‡∏™‡∏°‡∏≠
					console.log('üîÑ Force loading fresh buildings data...');
					
					const params = new URLSearchParams();
					params.append('action', 'getData');
					params.append('sheet', sheetsConfig.buildingsSheet);

					const response = await Promise.race([
						fetch(sheetsConfig.url, {
							method: 'POST',
							headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
							body: params.toString()
						}),
						new Promise((_, reject) => 
							setTimeout(() => reject(new Error('Buildings load timeout')), 15000)
						)
					]);

					if (response.ok) {
						const result = await response.json();
						if (result.success !== false && result.data) {
							buildingsData = {};
							result.data.forEach(row => {
								if (row.code) {
									buildingsData[row.code] = row;
								}
							});
							
							// ‡πÄ‡∏Å‡πá‡∏ö cache ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
							localStorage.setItem('buildingsData', JSON.stringify(buildingsData));
							console.log('‚úÖ Fresh buildings loaded from Google Sheets:', Object.keys(buildingsData).length);
							return true;
						}
					}
					
					throw new Error('Failed to load buildings from Google Sheets');
				} else {
					// ‡πÉ‡∏ä‡πâ localStorage ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets
					const saved = localStorage.getItem('buildingsData');
					buildingsData = saved ? JSON.parse(saved) : {};
					console.log('‚úÖ Using localStorage buildings (no connection):', Object.keys(buildingsData).length);
					return true;
				}
			} catch (error) {
				console.error('‚ùå Buildings loading failed:', error);
				// Fallback to localStorage ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
				const saved = localStorage.getItem('buildingsData');
				buildingsData = saved ? JSON.parse(saved) : {};
				return false;
			}
		}

            async loadRoomsStep() {
				 try {
					if (sheetsConfig.connected) {
						// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å Google Sheets ‡πÄ‡∏™‡∏°‡∏≠
						console.log('üîÑ Force loading fresh rooms data...');
						
						const params = new URLSearchParams();
						params.append('action', 'getData');
						params.append('sheet', sheetsConfig.roomsSheet);

						const response = await Promise.race([
							fetch(sheetsConfig.url, {
								method: 'POST',
								headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
								body: params.toString()
							}),
							new Promise((_, reject) => 
								setTimeout(() => reject(new Error('Rooms load timeout')), 15000)
							)
						]);

						if (response.ok) {
							const result = await response.json();
							if (result.success !== false && result.data) {
								roomsData = {};
								result.data.forEach(row => {
									if (row.code) {
										roomsData[row.code] = row;
									}
								});
								
								// ‡πÄ‡∏Å‡πá‡∏ö cache ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
								localStorage.setItem('roomsData', JSON.stringify(roomsData));
								console.log('‚úÖ Fresh rooms loaded from Google Sheets:', Object.keys(roomsData).length);
								return true;
							}
						}
						
						throw new Error('Failed to load rooms from Google Sheets');
					} else {
						// ‡πÉ‡∏ä‡πâ localStorage ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets
						const saved = localStorage.getItem('roomsData');
						roomsData = saved ? JSON.parse(saved) : {};
						console.log('‚úÖ Using localStorage rooms (no connection):', Object.keys(roomsData).length);
						return true;
					}
				} catch (error) {
					console.error('‚ùå Rooms loading failed:', error);
					// Fallback to localStorage ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
					const saved = localStorage.getItem('roomsData');
					roomsData = saved ? JSON.parse(saved) : {};
					return false;
				}
            }

            async updateUIStep() {
                // Simulate UI update delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Update dashboard stats
                updateDashboardStats();
                
                // Update tables
                loadBuildingsTable();
                loadRoomsTable();
                
                // Update connection status
                updateConnectionStatus();
                
                console.log('‚úÖ UI updated successfully');
                return true;
            }

            showLoadingScreen() {
                const screen = document.getElementById('sequentialLoading');
                if (screen) {
                    // Reset all steps to pending
                    this.steps.forEach(step => {
                        this.updateStepStatus(step.id, 'pending');
                    });
                    screen.classList.add('show');
                }
            }

            hideLoadingScreen() {
                const screen = document.getElementById('sequentialLoading');
                if (screen) {
                    screen.classList.remove('show');
                }
            }

            updateStepStatus(stepId, status) {
                const stepElement = document.getElementById(`step-${stepId}`);
                if (!stepElement) return;

                const icon = stepElement.querySelector('.step-icon');
                const text = stepElement.querySelector('.step-text');

                // Remove all status classes
                icon.classList.remove('pending', 'loading', 'success', 'error');
                text.classList.remove('loading', 'success', 'error');

                // Add new status class
                icon.classList.add(status);
                if (status !== 'pending') {
                    text.classList.add(status);
                }

                // Update icon content
                switch (status) {
                    case 'pending':
                        icon.textContent = stepElement.id.split('-')[1] === 'connection' ? '1' : 
                                          stepElement.id.split('-')[1] === 'buildings' ? '2' :
                                          stepElement.id.split('-')[1] === 'rooms' ? '3' : '4';
                        break;
                    case 'loading':
                        icon.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        break;
                    case 'success':
                        icon.innerHTML = '<i class="fas fa-check"></i>';
                        break;
                    case 'error':
                        icon.innerHTML = '<i class="fas fa-times"></i>';
                        break;
                }

                // Update step in array
                const step = this.steps.find(s => s.id === stepId);
                if (step) step.status = status;
            }

            updateGlobalStatus(success) {
                const indicator = document.getElementById('globalStatusIndicator');
                if (!indicator) return;

                if (success) {
                    indicator.innerHTML = '<i class="fas fa-check-circle"></i> SYSTEM READY';
                    indicator.className = 'status-indicator status-active';
                } else {
                    indicator.innerHTML = '<i class="fas fa-exclamation-triangle"></i> SYSTEM ISSUES';
                    indicator.className = 'status-indicator status-error';
                }
            }
        }

        // Create global sequential loader instance
        const sequentialLoader = new SequentialLoader();

        // =================== Public Functions ===================
        
        async function sequentialLoadData() {
            showNotification('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö Sequential...', 'info');
            const success = await sequentialLoader.startSequentialLoad();
            
            if (success) {
                showNotification('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!', 'success');
            } else {
                showNotification('‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'warning');
            }
        }
		
		// ============= 6. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö clear cache on page load =============
		function clearCacheOnPageLoad() {
			console.log('üóëÔ∏è Clearing cache for fresh data load...');
			
			// ‡∏•‡∏ö cache timestamps ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
			const cacheKeys = ['buildings', 'rooms', 'mapImages', 'batch'];
			
			cacheKeys.forEach(key => {
				//const timestampKey = getDataTimestampKey(key);
				//localStorage.removeItem(timestampKey);
				localStorage.removeItem(key + '_timestamp');  
			});
			
			// ‡∏•‡∏ö session storage ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
			sessionStorage.removeItem('temp_floorplan');
			sessionStorage.removeItem('temp_realphoto');
			sessionStorage.removeItem('floorplan_uploaded');
			sessionStorage.removeItem('realphoto_uploaded');
			
			console.log('‚úÖ Cache timestamps cleared for fresh load');
		}

		// ============= 7. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ clearCacheOnPageLoad ‡πÄ‡∏°‡∏∑‡πà‡∏≠ page load =============
		// ‡πÄ‡∏û‡∏¥‡πà‡∏° code ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô document.addEventListener('DOMContentLoaded', ...) ‡πÉ‡∏ô index.html
		document.addEventListener('DOMContentLoaded', async function() {
			// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å clearCacheOnPageLoad ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
			clearCacheOnPageLoad();
			
			// ... existing initialization code
		});

		// ‡πÄ‡∏û‡∏¥‡πà‡∏° code ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô window.addEventListener('load', ...) ‡πÉ‡∏ô admin.html
		window.addEventListener('load', async function() {
			// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å clearCacheOnPageLoad ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
			clearCacheOnPageLoad();
			
			// ... existing initialization code
		});

		// ============= 8. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç error handling ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô =============
		function handleDataLoadError(dataType, error, fallbackData = {}) {
			console.error(`‚ùå Failed to load fresh ${dataType}:`, error);
			console.log(`üîÑ Attempting fallback for ${dataType}...`);
			
			// ‡πÉ‡∏ä‡πâ fallback data ‡πÅ‡∏ï‡πà‡πÅ‡∏™‡∏î‡∏á warning
			showProgressiveStatus(`‚ö†Ô∏è ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á ${dataType} (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠)`, 'warning');
			
			return fallbackData;
		}

		// ============= 9. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö manual refresh =============
		async function forceRefreshAllData() {
			console.log('üîÑ Force refreshing all data...');
			
			// ‡∏•‡∏ö cache ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
			clearCacheOnPageLoad();
			
			// ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä page ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
			window.location.reload();
		}

        // =================== UI Update Functions ===================
        
        function updateDashboardStats() {
            const buildingCount = Object.keys(buildingsData).length;
            const roomCount = Object.keys(roomsData).length;
            const activeRooms = Object.values(roomsData).filter(room => room.status === 'active').length;

            document.getElementById('buildingCount').textContent = buildingCount;
            document.getElementById('roomCount').textContent = roomCount;
            document.getElementById('activeRooms').textContent = activeRooms;
        }

		// =================== Fixed Connection Status Update ===================

		function updateConnectionStatus() {
			const banner = document.getElementById('connectionBanner');
			const icon = document.getElementById('connectionIcon');
			const text = document.getElementById('connectionText');
			
			if (!banner || !icon || !text) return;
			
			if (sheetsConfig.connected) {
				banner.className = 'connection-banner connected';
				icon.className = 'fas fa-check-circle';
				text.textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
			} else if (sheetsConfig.url) {
				banner.className = 'connection-banner disconnected';
				icon.className = 'fas fa-exclamation-triangle';
				text.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ - ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠"';
			} else {
				banner.className = 'connection-banner disconnected';
				icon.className = 'fas fa-times-circle';
				text.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL';
			}
		}

		console.log('üñºÔ∏è Enhanced image processing system loaded!');

        function loadBuildingsTable() {
            const tbody = document.getElementById('buildingsTableBody');
            if (!tbody) return;

            const buildings = Object.values(buildingsData);

            if (buildings.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-building" style="font-size: 32px; margin-bottom: 10px; opacity: 0.3;"></i>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = buildings.map(building => `
                <tr>
                    <td><strong>${building.code}</strong></td>
                    <td>${building.name}</td>
                    <td>${building.floors} ‡∏ä‡∏±‡πâ‡∏ô</td>
                    <td>${building.rooms || 0} ‡∏´‡πâ‡∏≠‡∏á</td>
                    <td>
                        <span class="status-indicator ${building.status === 'active' ? 'status-active' : 'status-inactive'}">
                            ${building.status === 'active' ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="editBuilding('${building.code}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteBuilding('${building.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function loadRoomsTable() {
            const tbody = document.getElementById('roomsTableBody');
            if (!tbody) return;

            const rooms = Object.values(roomsData);

            if (rooms.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="fas fa-door-open" style="font-size: 32px; margin-bottom: 10px; opacity: 0.3;"></i>
                            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = rooms.map(room => {
                const building = buildingsData[room.building];
                return `
                    <tr>
                        <td><strong>${room.code}</strong></td>
                        <td>${room.name}</td>
                        <td>${building ? building.name : room.building}</td>
                        <td>‡∏ä‡∏±‡πâ‡∏ô ${room.floor || 'N/A'}</td>
                        <td>
                            <span style="background: rgba(102, 126, 234, 0.1); padding: 4px 8px; border-radius: 12px; font-size: 11px; color: var(--primary-color);">
                                ${room.type || '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'}
                            </span>
                        </td>
                        <td>
                            <span class="status-indicator ${getStatusClass(room.status)}">
                                ${getStatusText(room.status)}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="editRoom('${room.code}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRoom('${room.code}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // =================== Google Sheets Functions ===================
        
        async function testConnection() {
            const url = document.getElementById('sheetsUrl').value.trim();
            
            if (!url) {
                showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Sheets', 'error');
                return;
            }

            showNotification('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...', 'info');

            try {
                const params = new URLSearchParams();
                params.append('action', 'getData');
                params.append('sheet', 'Buildings');

                const response = await Promise.race([
                    fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: params.toString()
                    }),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Connection timeout')), 10000)
                    )
                ]);

                if (response.ok) {
                    const result = await response.json();
                    if (result.success !== undefined) {
                        sheetsConfig.url = url;
                        sheetsConfig.connected = true;
                        localStorage.setItem('sheetsConfig', JSON.stringify(sheetsConfig));
                        updateConnectionStatus();
                        showNotification('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        return true;
                    }
                }

                throw new Error('Invalid response from Google Sheets');

            } catch (error) {
                console.error('Connection test failed:', error);
                sheetsConfig.connected = false;
                updateConnectionStatus();
                showNotification(`‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
                return false;
            }
        }

        function saveSheetConfig() {
            const url = document.getElementById('sheetsUrl').value.trim();
            const buildingsSheet = document.getElementById('buildingsSheetName').value.trim();
            const roomsSheet = document.getElementById('roomsSheetName').value.trim();
            const mapImagesSheet = document.getElementById('mapImagesSheetName').value.trim();

            sheetsConfig.url = url;
            sheetsConfig.buildingsSheet = buildingsSheet || 'Buildings';
            sheetsConfig.roomsSheet = roomsSheet || 'Rooms';
            sheetsConfig.mapImagesSheet = mapImagesSheet || 'MapImages';

            localStorage.setItem('sheetsConfig', JSON.stringify(sheetsConfig));
            showNotification('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }

        function loadSheetsConfig() {
            try {
                const saved = localStorage.getItem('sheetsConfig');
				 
                if (saved) {
                    const config = JSON.parse(saved);
                    sheetsConfig = { ...sheetsConfig, ...config };
					
					//alert(sheetsConfig.url);

                    // Update UI
                    document.getElementById('sheetsUrl').value = sheetsConfig.url || '';
                    document.getElementById('buildingsSheetName').value = sheetsConfig.buildingsSheet || 'Buildings';
                    document.getElementById('roomsSheetName').value = sheetsConfig.roomsSheet || 'Rooms';
                    document.getElementById('mapImagesSheetName').value = sheetsConfig.mapImagesSheet || 'MapImages';
                }
            } catch (error) {
                console.error('Error loading sheets config:', error);
            }
        }

        // =================== Utility Functions ===================
        
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            if (!notification) return;

            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function getStatusClass(status) {
            const statusClasses = {
                'active': 'status-active',
                'inactive': 'status-inactive',
                'maintenance': 'status-error'
            };
            return statusClasses[status] || 'status-inactive';
        }

        function getStatusText(status) {
            const statusTexts = {
                'active': '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                'inactive': '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô',
                'maintenance': '‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á'
            };
            return statusTexts[status] || status;
        }

        // =================== Navigation Functions ===================
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');

            if (window.innerWidth > 768) {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            }
        }

      /*  function showSection(sectionId) {
		alert('x');
            // Hide all sections
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all menu items
            document.querySelectorAll('.menu-item, .mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show target section
            const targetSection = document.getElementById(sectionId + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Add active class to clicked menu item
            if (event && event.target) {
                const clickedItem = event.target.closest('.menu-item') || event.target.closest('.mobile-nav-item');
                if (clickedItem) {
                    clickedItem.classList.add('active');
                }
            }

            // Update page title
            const titles = {
                'dashboard': '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î',
                'buildings': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£',
                'rooms': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á',
                'sheets': 'Google Sheets'
            };

            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle && titles[sectionId]) {
                pageTitle.textContent = titles[sectionId];
            }

            // Close mobile sidebar if open
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.classList.remove('show');
                }
            }
        }*/

        function openUserInterface() {
            showNotification('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...', 'info');
            setTimeout(() => {
                window.open('index.html', '_blank');
                showNotification('‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà', 'success');
            }, 1000);
        }

        // =================== Login System ===================
        
        function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const errorDiv = document.getElementById('loginError');

            if (username === 'admin' && password === '1234') {
                isLoggedIn = true;
                sessionStorage.setItem('adminLoggedIn', 'true');

                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContainer').style.display = 'flex';

                initializeAdmin();
                showNotification('üéâ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            } else {
                errorDiv.style.display = 'block';
                errorDiv.textContent = '‚ùå Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';

                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        function handleLogout() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                isLoggedIn = false;
                sessionStorage.removeItem('adminLoggedIn');

                document.getElementById('adminContainer').style.display = 'none';
                document.getElementById('loginContainer').style.display = 'flex';

                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';

                showNotification('üëã ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'info');
            }
        }

        function checkLoginStatus() {
            const loggedIn = sessionStorage.getItem('adminLoggedIn');
            if (loggedIn === 'true') {
                isLoggedIn = true;
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContainer').style.display = 'flex';
                return true;
            }
            return false;
        }

        // =================== Event Handlers ===================
        
        function setupEventHandlers() {
            // Keyboard shortcuts
            /*document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // Close any open modals
                }

                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    sequentialLoadData();
                }
            });*/

            // Mobile menu toggle
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('sidebar-toggle') && window.innerWidth <= 768) {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar) {
                        sidebar.classList.toggle('show');
                    }
                }
            });
        }

        
		
		// =================== Deployment Guide Functions ===================

		// =================== Accordion Functions ===================

		function toggleAccordion(headerElement) {
			const content = headerElement.nextElementSibling;
			const icon = headerElement.querySelector('.fas');
			
			// Toggle display
			if (content.style.display === 'none' || !content.style.display) {
				content.style.display = 'block';
				headerElement.classList.add('active');
			} else {
				content.style.display = 'none';
				headerElement.classList.remove('active');
			}
		}
 
		 // =================== Enhanced Google Sheets Functions ===================

		let setupProgress = {
			steps: [false, false, false, false],
			currentStep: 0
		};

		let debugMode = false; 


		// Debug logging function
 

		function debugLog(message, type = 'info') {
			// Console logging
			const prefix = {
				'success': '‚úÖ',
				'error': '‚ùå', 
				'warning': '‚ö†Ô∏è',
				'info': 'üí°'
			}[type] || 'üìù';
			
			console.log(`${prefix} ${message}`);
			
			// UI debug panel (if exists)
			const output = document.getElementById('debugOutput');
			if (output && (debugMode || type === 'error')) {
				const timestamp = new Date().toLocaleTimeString();
				const line = document.createElement('div');
				line.className = `debug-line debug-${type}`;
				line.innerHTML = `<span class="debug-timestamp">[${timestamp}]</span>${message}`;
				
				output.appendChild(line);
				output.scrollTop = output.scrollHeight;
				
				// Keep only last 100 lines
				while (output.children.length > 100) {
					output.removeChild(output.firstChild);
				}
			}
		}

		function toggleStep(stepNumber) {
			const step = document.querySelector(`[data-step="${stepNumber}"]`);
			if (!step) return;
			
			const content = step.querySelector('.step-content');
			const header = step.querySelector('.step-header');
			const chevron = header?.querySelector('.step-chevron');
			
			if (content && header) {
				if (content.style.display === 'none') {
					content.style.display = 'block';
					if (chevron) chevron.style.transform = 'rotate(180deg)';
					header.classList.add('active');
				} else {
					content.style.display = 'none';
					if (chevron) chevron.style.transform = 'rotate(0deg)';
					header.classList.remove('active');
				}
			}
		}

		 
 

		// =================== Enhanced Configuration ===================

		function saveSheetConfigEnhanced() {
			const url = document.getElementById('sheetsUrl')?.value?.trim();
			const buildingsSheet = document.getElementById('buildingsSheetName')?.value?.trim();
			const roomsSheet = document.getElementById('roomsSheetName')?.value?.trim();
			const mapImagesSheet = document.getElementById('mapImagesSheetName')?.value?.trim();
			const autoSync = document.getElementById('autoSyncEnabled')?.checked;
			const debug = document.getElementById('debugModeEnabled')?.checked;
			
			// Validate URL format
			if (url && !isValidSheetsUrl(url)) {
				showNotification('‚ùå URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö', 'error');
				return;
			}
			
			sheetsConfig.url = url || '';
			sheetsConfig.buildingsSheet = buildingsSheet || 'Buildings';
			sheetsConfig.roomsSheet = roomsSheet || 'Rooms';
			sheetsConfig.mapImagesSheet = mapImagesSheet || 'MapImages';
			sheetsConfig.autoSync = autoSync !== false;
			sheetsConfig.debugMode = debug || false;
			
			// Save advanced settings
			sheetsConfig.timeout = parseInt(document.getElementById('requestTimeout')?.value || '15');
			sheetsConfig.retryAttempts = parseInt(document.getElementById('retryAttempts')?.value || '3');
			
			localStorage.setItem('sheetsConfig', JSON.stringify(sheetsConfig));
			
			// Update debug mode
			debugMode = debug || false;
			localStorage.setItem('debugMode', debugMode.toString());
			
			showNotification('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
			addSyncHistoryItem('‚öôÔ∏è ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö', 'info');
			
			debugLog('üíæ Configuration saved:', 'info');
			debugLog(JSON.stringify(sheetsConfig, null, 2), 'info');
		}

		// =================== Connection Status Functions ===================

		// Update connection status banner
		function updateConnectionBanner(status, message) {
			const banner = document.getElementById('connectionBanner');
			const icon = document.getElementById('connectionIcon');
			const text = document.getElementById('connectionText');
			
			if (!banner || !icon || !text) return;
			
			banner.classList.remove('connected', 'disconnected', 'testing');
			banner.classList.add(status);
			
			if (status === 'connected') {
				icon.style.color = 'var(--accent-color)';
			} else if (status === 'disconnected') {
				icon.style.color = 'var(--danger-color)';
			} else if (status === 'testing') {
				icon.style.color = 'var(--info-color)';
			}
			
			text.textContent = message;
		}

		// =================== Safe URL Validation ===================

		function validateUrlInput(input) {
			const validation = document.getElementById('urlValidation');
			if (!validation) return;
			
			const url = input.value.trim();
			
			if (!url) {
				validation.innerHTML = '';
				return;
			}
			
			if (isValidSheetsUrl(url)) {
				validation.innerHTML = '<i class="fas fa-check-circle"></i> URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
				validation.className = 'url-validation valid';
			} else {
				validation.innerHTML = '<i class="fas fa-times-circle"></i> URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Google Apps Script Web App URL';
				validation.className = 'url-validation invalid';
			}
		}

		function isValidSheetsUrl(url) {
			return url.includes('script.google.com') && 
				   url.includes('/macros/s/') && 
				   url.endsWith('/exec');
		}

		function clearUrl() {
			document.getElementById('sheetsUrl').value = '';
			document.getElementById('urlValidation').innerHTML = '';
			sheetsConfig.url = '';
			sheetsConfig.connected = false;
			updateConnectionBanner('disconnected', '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏ URL');
		}
		
		
		// Initialize missing elements after DOM load
		document.addEventListener('DOMContentLoaded', function() {
			// Add URL validation to sheets URL input
			const sheetsUrlInput = document.getElementById('sheetsUrl');
			if (sheetsUrlInput) {
				sheetsUrlInput.addEventListener('input', function() {
					validateUrlInput(this);
				});
			}
			
			// Initialize debug mode from localStorage
			const debugMode = localStorage.getItem('debugMode') === 'true';
			const debugCheckbox = document.getElementById('debugModeEnabled');
			if (debugCheckbox) {
				debugCheckbox.checked = debugMode;
			}
			
			console.log('‚úÖ Missing elements initialized');
		});

		// =================== Batch Sync Functions ===================

		async function batchSyncToSheets() {
			if (!sheetsConfig.connected || !sheetsConfig.url) {
				showNotification('‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', 'error');
				return;
			}
			
			try {
				showNotification('‚òÅÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets...', 'info');
				debugLog('üîÑ Starting batch sync...', 'info');
				
				let totalItems = 0;
				let successCount = 0;
				let errorCount = 0;
				
				// Sync Buildings
				const buildings = Object.values(buildingsData);
				totalItems += buildings.length;
				
				for (const building of buildings) {
					try {
						await syncBuildingToSheets(building, true);
						successCount++;
						debugLog(`‚úÖ Synced building: ${building.code}`, 'success');
					} catch (error) {
						errorCount++;
						debugLog(`‚ùå Failed to sync building ${building.code}: ${error.message}`, 'error');
					}
				}
				
				// Sync Rooms
				const rooms = Object.values(roomsData);
				totalItems += rooms.length;
				
				for (const room of rooms) {
					try {
						await syncRoomToSheets(room, true);
						successCount++;
						debugLog(`‚úÖ Synced room: ${room.code}`, 'success');
					} catch (error) {
						errorCount++;
						debugLog(`‚ùå Failed to sync room ${room.code}: ${error.message}`, 'error');
					}
				}
				
				const successMessage = `‚úÖ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount}/${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
				showNotification(successMessage, successCount === totalItems ? 'success' : 'warning');
				addSyncHistoryItem(successMessage, successCount === totalItems ? 'success' : 'warning');
				
				if (errorCount > 0) {
					addSyncHistoryItem(`‚ùå ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${errorCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'error');
				}
				
				debugLog(`üèÅ Batch sync completed: ${successCount} success, ${errorCount} errors`, 'info');
				
			} catch (error) {
				console.error('Batch sync error:', error);
				showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
				addSyncHistoryItem(`‚ùå Batch sync ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
				debugLog(`‚ùå Batch sync failed: ${error.message}`, 'error');
			}
		}

		// =================== Improved AddSyncHistoryItem ===================	
		function addSyncHistoryItem(message, type) {
			console.log(`üìä Map Sync History: ${message} (${type})`);
			
			try {
				const history = JSON.parse(localStorage.getItem('mapSyncHistory') || '[]');
				const item = {
					message,
					type,
					timestamp: new Date().toLocaleString('th-TH')
				};
				
				history.unshift(item);
				history.splice(10); // Keep only last 10 items
				localStorage.setItem('mapSyncHistory', JSON.stringify(history));
				
				// Update UI if container exists
				updateMapSyncHistoryUI();
				
			} catch (error) {
				console.error('‚ùå Error adding map sync history item:', error);
			}
		}
		
		function updateMapSyncHistoryUI() {
			const container = document.getElementById('mapSyncHistory');
			if (!container) return;
			
			try {
				const history = JSON.parse(localStorage.getItem('mapSyncHistory') || '[]');
				
				if (history.length === 0) {
					container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; margin: 0;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå</p>';
					return;
				}
				
				container.innerHTML = history.map(item => `
					<div style="
						padding: 10px 15px; margin-bottom: 8px; border-radius: 8px; font-size: 13px;
						background: ${item.type === 'success' ? 'rgba(40, 167, 69, 0.1)' : 
									 item.type === 'error' ? 'rgba(220, 53, 69, 0.1)' : 'rgba(23, 162, 184, 0.1)'};
						color: ${item.type === 'success' ? 'var(--accent-color)' : 
								 item.type === 'error' ? 'var(--danger-color)' : 'var(--info-color)'};
						border-left: 3px solid ${item.type === 'success' ? 'var(--accent-color)' : 
												 item.type === 'error' ? 'var(--danger-color)' : 'var(--info-color)'};
					">
						<div style="font-weight: 600;">${item.message}</div>
						<div style="font-size: 11px; opacity: 0.8; margin-top: 2px;">${item.timestamp}</div>
					</div>
				`).join('');
				
			} catch (error) {
				console.error('‚ùå Error updating map sync history UI:', error);
			}
		}		
		function updateSyncHistoryUI() {
			const container = document.getElementById('syncHistoryContainer');
			if (!container) return;
			
			try {
				const history = JSON.parse(localStorage.getItem('syncHistory') || '[]');
				
				if (history.length === 0) {
					container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; margin: 0;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå</p>';
					return;
				}
				
				container.innerHTML = history.map(item => `
					<div style="
						padding: 10px 15px; margin-bottom: 8px; border-radius: 8px; font-size: 13px;
						background: ${item.type === 'success' ? 'rgba(40, 167, 69, 0.1)' : 
									item.type === 'error' ? 'rgba(220, 53, 69, 0.1)' : 
									item.type === 'warning' ? 'rgba(255, 193, 7, 0.1)' : 'rgba(23, 162, 184, 0.1)'};
						color: ${item.type === 'success' ? 'var(--accent-color)' : 
								 item.type === 'error' ? 'var(--danger-color)' : 
								 item.type === 'warning' ? '#856404' : 'var(--info-color)'};
						border-left: 3px solid ${item.type === 'success' ? 'var(--accent-color)' : 
												 item.type === 'error' ? 'var(--danger-color)' : 
												 item.type === 'warning' ? '#ffc107' : 'var(--info-color)'};
					">
						<div style="font-weight: 600;">${item.message}</div>
						<div style="font-size: 11px; opacity: 0.8; margin-top: 2px;">${item.timestamp}</div>
					</div>
				`).join('');
				
			} catch (error) {
				console.error('‚ùå Error updating sync history UI:', error);
			}
		} 

		// =================== Apps Script Code Display ===================

		function showAppsScriptCode() {
			const modal = document.createElement('div');
			modal.style.cssText = `
				position: fixed; top: 0; left: 0; right: 0; bottom: 0;
				background: rgba(0,0,0,0.8); z-index: 9999;
				display: flex; align-items: center; justify-content: center;
				padding: 20px;
			`;
			
			modal.innerHTML = `
				<div style="background: white; border-radius: 15px; padding: 30px; max-width: 90%; max-height: 90%; overflow-y: auto;">
					<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
						<h4 style="color: var(--primary-color); margin: 0;">üìÑ Google Apps Script Code</h4>
						<button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
					</div>
					<p style="margin-bottom: 15px; color: var(--text-secondary);">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Google Apps Script Editor:</p>
					<textarea readonly style="width: 100%; height: 400px; font-family: monospace; font-size: 12px; border: 1px solid #ddd; border-radius: 5px; padding: 15px;" onclick="this.select()">
		// Google Apps Script Code for School Map System
		// Copy this entire code to your Google Apps Script project

		function doGet(e) {
			return handleRequest(e);
		}

		function doPost(e) {
			return handleRequest(e);
		}

		function handleRequest(e) {
			try {
				const action = e.parameter.action || e.parameters.action?.[0];
				
				switch (action) {
					case 'getData':
						return getData(e.parameter);
					case 'addData':
						return addData(e.parameter);
					case 'deleteData':
						return deleteData(e.parameter);
					case 'getBatchData':
						return getBatchData();
					case 'getMapImages':
						return getMapImages();
					case 'addMapImages':
						return addMapImages(e.parameter);
					default:
						return createErrorResponse('Invalid action');
				}
			} catch (error) {
				return createErrorResponse(error.toString());
			}
		}

		function createSuccessResponse(data, message = '') {
			return ContentService.createTextOutput(JSON.stringify({
				success: true,
				data: data,
				message: message,
				timestamp: new Date().toISOString()
			})).setMimeType(ContentService.MimeType.JSON);
		}

		function createErrorResponse(errorMessage) {
			return ContentService.createTextOutput(JSON.stringify({
				success: false,
				error: errorMessage,
				timestamp: new Date().toISOString()
			})).setMimeType(ContentService.MimeType.JSON);
		}

		// Add other functions from GoogleSheet_AppScripts.txt here...
					</textarea>
					<div style="text-align: center; margin-top: 15px;">
						<button onclick="navigator.clipboard.writeText(this.parentElement.previousElementSibling.value); alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!')" class="btn btn-primary">
							<i class="fas fa-copy"></i> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î
						</button>
					</div>
				</div>
			`;
			
			document.body.appendChild(modal);
		}

		// =================== Error Helper Functions ===================

		function getDetailedErrorMessage(error) {
			let errorMessage = '‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:\n\n';
			
			if (error.message.includes('Failed to fetch')) {
				errorMessage += '‚Ä¢ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Web App ‡∏ñ‡∏π‡∏Å Deploy ‡πÅ‡∏•‡πâ‡∏ß';
			} else if (error.message.includes('404')) {
				errorMessage += '‚Ä¢ ‡πÑ‡∏°‡πà‡∏û‡∏ö Web App (404)\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ Deploy ‡πÉ‡∏´‡∏°‡πà';
			} else if (error.message.includes('403')) {
				errorMessage += '‚Ä¢ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (403)\n‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Execute as: Me\n‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Who has access: Anyone';
			} else if (error.message.includes('timeout')) {
				errorMessage += '‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤\n‚Ä¢ ‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° Timeout ‡πÉ‡∏ô Advanced Options\n‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
			} else if (error.message.includes('HTML')) {
				errorMessage += '‚Ä¢ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö HTML ‡πÅ‡∏ó‡∏ô JSON\n‚Ä¢ Web App ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Deploy ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n‚Ä¢ ‡∏•‡∏≠‡∏á Deploy ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
			} else {
				errorMessage += error.message;
			}
			
			return errorMessage;
		}

		// =================== Fixed Enhanced Sheets Config Loading ===================

		function loadEnhancedSheetsConfig() {
			console.log('‚öôÔ∏è Loading Enhanced Sheets Config...');
			try {
				// ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å localStorage
				const saved = localStorage.getItem('sheetsConfig');
				if (saved) {
					const config = JSON.parse(saved);
					sheetsConfig = { ...sheetsConfig, ...config };
					console.log('‚úÖ Sheets config loaded');
				}
				return true;
			} catch (error) {
				console.error('‚ùå Error loading enhanced sheets config:', error);
				return false;
			}
		}
		
	 
		// =================== Initialize Enhanced Sheets Module ===================

		function initializeEnhancedSheetsModule() {
			console.log('üìä Initializing Enhanced Sheets Module...');
			try {
				// ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Sheets
				if (typeof loadSheetsConfig === 'function') {
					loadSheetsConfig();
				}
				
				console.log('‚úÖ Enhanced Sheets Module initialized');
				return true;
			} catch (error) {
				console.error('‚ùå Error initializing Enhanced Sheets module:', error);
				return false;
			}
		}


		// =================== Full CRUD Implementation ===================

		let currentPage = 1;
		let itemsPerPage = 20;
		let totalItems = 0;
		let currentFilter = '';
		let currentSortField = '';
		let currentSortDirection = 'asc';
		let isEditMode = false;
		let editingItemId = null;

		// =================== Building CRUD Functions ===================

		async function createBuilding(buildingData) {
			try {
				showNotification('üèóÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà...', 'info');
				
				// Generate code if not provided
				if (!buildingData.code) {
					buildingData.code = generateBuildingCode();
				}
				
				// Validate data
				const validation = validateBuildingData(buildingData);
				if (!validation.isValid) {
					throw new Error(validation.error);
				}
				
				// Add timestamps
				buildingData.created = new Date().toISOString();
				buildingData.updated = new Date().toISOString();
				
				// Save to local storage
				buildingsData[buildingData.code] = buildingData;
				localStorage.setItem('buildingsData', JSON.stringify(buildingsData));
				
				// Auto-sync to Google Sheets if enabled
				if (sheetsConfig.connected && sheetsConfig.autoSync) {
					await syncBuildingToSheets(buildingData, false);
				}
				
				// Update UI
				loadBuildingsTable();
				updateDashboardStats();
				
				showNotification(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingData.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
				addSyncHistoryItem(`üè¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingData.name}`, 'success');
				
				return buildingData;
				
			} catch (error) {
				console.error('Create building error:', error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
				throw error;
			}
		}

		async function updateBuilding(code, updatedData) {
			try {
				showNotification(`üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${code}...`, 'info');
				
				if (!buildingsData[code]) {
					throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï');
				}
				
				// Validate updated data
				const validation = validateBuildingData(updatedData);
				if (!validation.isValid) {
					throw new Error(validation.error);
				}
				
				// Preserve created timestamp and update timestamp
				updatedData.created = buildingsData[code].created;
				updatedData.updated = new Date().toISOString();
				
				// Update local storage
				buildingsData[code] = updatedData;
				localStorage.setItem('buildingsData', JSON.stringify(buildingsData));
				
				// Auto-sync to Google Sheets if enabled
				if (sheetsConfig.connected && sheetsConfig.autoSync) {
					await syncBuildingToSheets(updatedData, false);
				}
				
				// Update UI
				loadBuildingsTable();
				updateDashboardStats();
				
				showNotification(`‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${updatedData.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
				addSyncHistoryItem(`üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${updatedData.name}`, 'success');
				
				return updatedData;
				
			} catch (error) {
				console.error('Update building error:', error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
				throw error;
			}
		}

		async function deleteBuilding(code) {
			try {
				if (!buildingsData[code]) {
					throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö');
				}
				
				const buildingName = buildingsData[code].name;
				
				// Check if any rooms belong to this building
				const roomsInBuilding = Object.values(roomsData).filter(room => room.building === code);
				if (roomsInBuilding.length > 0) {
					throw new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á ${roomsInBuilding.length} ‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏µ‡πâ`);
				}
				
				showNotification(`üóëÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingName}...`, 'info');
				
				// Delete from local storage
				delete buildingsData[code];
				localStorage.setItem('buildingsData', JSON.stringify(buildingsData));
				
				// Delete from Google Sheets if connected
				if (sheetsConfig.connected) {
					await deleteBuildingFromSheets(code);
				}
				
				// Update UI
				loadBuildingsTable();
				updateDashboardStats();
				
				showNotification(`‚úÖ ‡∏•‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingName} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
				addSyncHistoryItem(`üóëÔ∏è ‡∏•‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingName}`, 'warning');
				
			} catch (error) {
				console.error('Delete building error:', error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
				throw error;
			}
		}

		// =================== Room CRUD Functions ===================

		async function createRoom(roomData) {
			try {
				showNotification('üö™ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà...', 'info');
				
				// Generate code if not provided
				if (!roomData.code) {
					roomData.code = generateRoomCode();
				}
				
				// Validate data
				const validation = validateRoomData(roomData);
				if (!validation.isValid) {
					throw new Error(validation.error);
				}
				
				// Add timestamps
				roomData.created = new Date().toISOString();
				roomData.updated = new Date().toISOString();
				
				// Ensure images is an array
				if (!roomData.images) {
					roomData.images = [];
				}
				
				// Save to local storage
				roomsData[roomData.code] = roomData;
				localStorage.setItem('roomsData', JSON.stringify(roomsData));
				
				// Auto-sync to Google Sheets if enabled
				if (sheetsConfig.connected && sheetsConfig.autoSync) {
					await syncRoomToSheets(roomData, false);
				}
				
				// Update UI
				loadRoomsTable();
				updateDashboardStats();
				
				showNotification(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á ${roomData.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
				addSyncHistoryItem(`üö™ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á ${roomData.name}`, 'success');
				
				return roomData;
				
			} catch (error) {
				console.error('Create room error:', error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
				throw error;
			}
		}

		async function updateRoom(code, updatedData) {
			try {
				showNotification(`üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡πâ‡∏≠‡∏á ${code}...`, 'info');
				
				if (!roomsData[code]) {
					throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï');
				}
				
				// Validate updated data
				const validation = validateRoomData(updatedData);
				if (!validation.isValid) {
					throw new Error(validation.error);
				}
				
				// Preserve created timestamp and update timestamp
				updatedData.created = roomsData[code].created;
				updatedData.updated = new Date().toISOString();
				
				// Ensure images is an array
				if (!updatedData.images) {
					updatedData.images = [];
				}
				
				// Update local storage
				roomsData[code] = updatedData;
				localStorage.setItem('roomsData', JSON.stringify(roomsData));
				
				// Auto-sync to Google Sheets if enabled
				if (sheetsConfig.connected && sheetsConfig.autoSync) {
					await syncRoomToSheets(updatedData, false);
				}
				
				// Update UI
				loadRoomsTable();
				updateDashboardStats();
				
				showNotification(`‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡πâ‡∏≠‡∏á ${updatedData.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
				addSyncHistoryItem(`üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡πâ‡∏≠‡∏á ${updatedData.name}`, 'success');
				
				return updatedData;
				
			} catch (error) {
				console.error('Update room error:', error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
				throw error;
			}
		}

		async function deleteRoom(code) {
			try {
				if (!roomsData[code]) {
					throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö');
				}
				
				const roomName = roomsData[code].name;
				
				showNotification(`üóëÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á ${roomName}...`, 'info');
				
				// Delete from local storage
				delete roomsData[code];
				localStorage.setItem('roomsData', JSON.stringify(roomsData));
				
				// Delete from Google Sheets if connected
				if (sheetsConfig.connected) {
					await deleteRoomFromSheets(code);
				}
				
				// Update UI
				loadRoomsTable();
				updateDashboardStats();
				
				showNotification(`‚úÖ ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á ${roomName} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
				addSyncHistoryItem(`üóëÔ∏è ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á ${roomName}`, 'warning');
				
			} catch (error) {
				console.error('Delete room error:', error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
				throw error;
			}
		}

		// =================== Pagination Functions ===================

		function paginateData(data, page, perPage) {
			const startIndex = (page - 1) * perPage;
			const endIndex = startIndex + perPage;
			return data.slice(startIndex, endIndex);
		}

		function createPaginationControls(totalItems, currentPage, itemsPerPage, containerId) {
			const container = document.getElementById(containerId);
			if (!container) return;
			
			const totalPages = Math.ceil(totalItems / itemsPerPage);
			
			if (totalPages <= 1) {
				container.innerHTML = '';
				return;
			}
			
			let paginationHTML = `
				<div class="pagination-controls" style="display: flex; align-items: center; justify-content: space-between; margin-top: 20px; flex-wrap: wrap; gap: 10px;">
					<div class="pagination-info" style="color: var(--text-secondary); font-size: 14px;">
						‡πÅ‡∏™‡∏î‡∏á ${((currentPage - 1) * itemsPerPage) + 1}-${Math.min(currentPage * itemsPerPage, totalItems)} ‡∏à‡∏≤‡∏Å ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
					</div>
					
					<div class="pagination-buttons" style="display: flex; gap: 5px; align-items: center;">
						<button class="btn btn-sm btn-secondary" onclick="changePage(1)" ${currentPage === 1 ? 'disabled' : ''}>
							<i class="fas fa-angle-double-left"></i>
						</button>
						<button class="btn btn-sm btn-secondary" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
							<i class="fas fa-angle-left"></i>
						</button>
			`;
			
			// Page numbers
			const maxVisiblePages = 5;
			let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
			let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
			
			if (endPage - startPage + 1 < maxVisiblePages) {
				startPage = Math.max(1, endPage - maxVisiblePages + 1);
			}
			
			for (let i = startPage; i <= endPage; i++) {
				paginationHTML += `
					<button class="btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-secondary'}" 
							onclick="changePage(${i})" ${i === currentPage ? 'disabled' : ''}>
						${i}
					</button>
				`;
			}
			
			paginationHTML += `
						<button class="btn btn-sm btn-secondary" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
							<i class="fas fa-angle-right"></i>
						</button>
						<button class="btn btn-sm btn-secondary" onclick="changePage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''}>
							<i class="fas fa-angle-double-right"></i>
						</button>
					</div>
					
					<div class="items-per-page" style="display: flex; align-items: center; gap: 5px;">
						<span style="font-size: 14px;">‡πÅ‡∏™‡∏î‡∏á:</span>
						<select onchange="changeItemsPerPage(this.value)" style="padding: 5px; border-radius: 5px; border: 1px solid var(--border-color);">
							<option value="10" ${itemsPerPage === 10 ? 'selected' : ''}>10</option>
							<option value="20" ${itemsPerPage === 20 ? 'selected' : ''}>20</option>
							<option value="50" ${itemsPerPage === 50 ? 'selected' : ''}>50</option>
							<option value="100" ${itemsPerPage === 100 ? 'selected' : ''}>100</option>
						</select>
						<span style="font-size: 14px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
					</div>
				</div>
			`;
			
			container.innerHTML = paginationHTML;
		}

		function changePage(newPage) {
			currentPage = newPage;
			const activeSection = document.querySelector('.page-section.active');
			
			if (activeSection && activeSection.id === 'rooms-section') {
				loadRoomsTable();
			} else if (activeSection && activeSection.id === 'buildings-section') {
				loadBuildingsTable();
			}
		}

		function changeItemsPerPage(newItemsPerPage) {
			itemsPerPage = parseInt(newItemsPerPage);
			currentPage = 1; // Reset to first page
			
			const activeSection = document.querySelector('.page-section.active');
			
			if (activeSection && activeSection.id === 'rooms-section') {
				loadRoomsTable();
			} else if (activeSection && activeSection.id === 'buildings-section') {
				loadBuildingsTable();
			}
		}

		// =================== Enhanced Table Loading with Pagination ===================

		function loadBuildingsTable() {
			const tbody = document.getElementById('buildingsTableBody');
			if (!tbody) return;
			
			let buildings = Object.values(buildingsData);
			
			// Apply filter
			if (currentFilter) {
				buildings = buildings.filter(building => 
					building.name.toLowerCase().includes(currentFilter.toLowerCase()) ||
					building.code.toLowerCase().includes(currentFilter.toLowerCase()) ||
					(building.description && building.description.toLowerCase().includes(currentFilter.toLowerCase()))
				);
			}
			
			// Apply sorting
			if (currentSortField) {
				buildings.sort((a, b) => {
					let aVal = a[currentSortField] || '';
					let bVal = b[currentSortField] || '';
					
					if (typeof aVal === 'string') {
						aVal = aVal.toLowerCase();
						bVal = bVal.toLowerCase();
					}
					
					if (currentSortDirection === 'asc') {
						return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
					} else {
						return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
					}
				});
			}
			
			totalItems = buildings.length;
			
			// Apply pagination
			const paginatedBuildings = paginateData(buildings, currentPage, itemsPerPage);
			
			if (paginatedBuildings.length === 0) {
				tbody.innerHTML = `
					<tr>
						<td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
							<i class="fas fa-building" style="font-size: 32px; margin-bottom: 10px; opacity: 0.3;"></i>
							<p>${buildings.length === 0 ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'}</p>
						</td>
					</tr>
				`;
			} else {
				tbody.innerHTML = paginatedBuildings.map(building => `
					<tr>
						<td><strong>${building.code}</strong></td>
						<td>${building.name}</td>
						<td>${building.floors} ‡∏ä‡∏±‡πâ‡∏ô</td>
						<td>${building.rooms || 0} ‡∏´‡πâ‡∏≠‡∏á</td>
						<td>
							<span class="status-indicator ${building.status === 'active' ? 'status-active' : 'status-inactive'}">
								${building.status === 'active' ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}
							</span>
						</td>
						<td>
							<button class="btn btn-sm btn-info" onclick="editBuilding('${building.code}')" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
								<i class="fas fa-edit"></i>
							</button>
							<button class="btn btn-sm btn-danger" onclick="confirmDeleteBuilding('${building.code}')" title="‡∏•‡∏ö">
								<i class="fas fa-trash"></i>
							</button>
						</td>
					</tr>
				`).join('');
			}
			
			// Update pagination controls
			createPaginationControls(totalItems, currentPage, itemsPerPage, 'buildingsPagination');
		}

		function loadRoomsTable() {
			const tbody = document.getElementById('roomsTableBody');
			if (!tbody) return;
			
			let rooms = Object.values(roomsData);
			
			// Apply filter
			if (currentFilter) {
				rooms = rooms.filter(room => 
					room.name.toLowerCase().includes(currentFilter.toLowerCase()) ||
					room.code.toLowerCase().includes(currentFilter.toLowerCase()) ||
					(room.type && room.type.toLowerCase().includes(currentFilter.toLowerCase())) ||
					(room.building && room.building.toLowerCase().includes(currentFilter.toLowerCase())) ||
					(room.description && room.description.toLowerCase().includes(currentFilter.toLowerCase()))
				);
			}
			
			// Apply sorting
			if (currentSortField) {
				rooms.sort((a, b) => {
					let aVal = a[currentSortField] || '';
					let bVal = b[currentSortField] || '';
					
					if (typeof aVal === 'string') {
						aVal = aVal.toLowerCase();
						bVal = bVal.toLowerCase();
					}
					
					if (currentSortDirection === 'asc') {
						return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
					} else {
						return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
					}
				});
			}
			
			totalItems = rooms.length;
			
			// Apply pagination
			const paginatedRooms = paginateData(rooms, currentPage, itemsPerPage);
			
			if (paginatedRooms.length === 0) {
				tbody.innerHTML = `
					<tr>
						<td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
							<i class="fas fa-door-open" style="font-size: 32px; margin-bottom: 10px; opacity: 0.3;"></i>
							<p>${rooms.length === 0 ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'}</p>
						</td>
					</tr>
				`;
			} else {
				tbody.innerHTML = paginatedRooms.map(room => {
					const building = buildingsData[room.building];
					return `
						<tr>
							<td><strong>${room.code}</strong></td>
							<td>${room.name}</td>
							<td>${building ? building.name : room.building}</td>
							<td>‡∏ä‡∏±‡πâ‡∏ô ${room.floor || 'N/A'}</td>
							<td>
								<span style="background: rgba(102, 126, 234, 0.1); padding: 4px 8px; border-radius: 12px; font-size: 11px; color: var(--primary-color);">
									${room.type || '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'}
								</span>
							</td>
							<td>
								<span class="status-indicator ${getStatusClass(room.status)}">
									${getStatusText(room.status)}
								</span>
							</td>
							<td>
								<button class="btn btn-sm btn-info" onclick="editRoom('${room.code}')" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
									<i class="fas fa-edit"></i>
								</button>
								<button class="btn btn-sm btn-danger" onclick="confirmDeleteRoom('${room.code}')" title="‡∏•‡∏ö">
									<i class="fas fa-trash"></i>
								</button>
							</td>
						</tr>
					`;
				}).join('');
			}
			
			// Update pagination controls
			createPaginationControls(totalItems, currentPage, itemsPerPage, 'roomsPagination');
		}

		// =================== Validation Functions ===================

		function validateBuildingData(data) {
			if (!data.name || data.name.trim() === '') {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£' };
			}
			
			if (!data.code || data.code.trim() === '') {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£' };
			}
			
			// Check for duplicate code (excluding current building if editing)
			const existingBuilding = buildingsData[data.code];
			if (existingBuilding && !isEditMode) {
				return { isValid: false, error: `‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${data.code} ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß` };
			}
			
			if (!data.floors || data.floors < 1) {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' };
			}
			
			if (!data.status) {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£' };
			}
			
			return { isValid: true };
		}

		function validateRoomData(data) {
			if (!data.name || data.name.trim() === '') {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á' };
			}
			
			if (!data.code || data.code.trim() === '') {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á' };
			}
			
			// Check for duplicate code (excluding current room if editing)
			const existingRoom = roomsData[data.code];
			if (existingRoom && !isEditMode) {
				return { isValid: false, error: `‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á ${data.code} ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß` };
			}
			
			if (!data.building || data.building.trim() === '') {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£' };
			}
			
			if (!data.floor || data.floor < 1) {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' };
			}
			
			if (!data.status) {
				return { isValid: false, error: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á' };
			}
			
			return { isValid: true };
		}

		// =================== Code Generation Functions ===================

		function generateBuildingCode() {
			const buildings = Object.keys(buildingsData);
			const existingNumbers = buildings
				.filter(code => code.startsWith('B'))
				.map(code => parseInt(code.substring(1)))
				.filter(num => !isNaN(num));
			
			const nextNumber = existingNumbers.length > 0 ? Math.max(...existingNumbers) + 1 : 1;
			return 'B' + nextNumber.toString().padStart(3, '0');
		}

		function generateRoomCode() {
			const rooms = Object.keys(roomsData);
			const existingNumbers = rooms
				.filter(code => code.startsWith('R'))
				.map(code => parseInt(code.substring(1)))
				.filter(num => !isNaN(num));
			
			const nextNumber = existingNumbers.length > 0 ? Math.max(...existingNumbers) + 1 : 1;
			return 'R' + nextNumber.toString().padStart(4, '0');
		}

		// =================== Delete Confirmation Functions ===================

		function confirmDeleteBuilding(code) {
			const building = buildingsData[code];
			if (!building) return;
			
			const roomsInBuilding = Object.values(roomsData).filter(room => room.building === code);
			
			let message = `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ "${building.name}" (${code}) ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`;
			
			if (roomsInBuilding.length > 0) {
				message += `\n\n‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á ${roomsInBuilding.length} ‡∏´‡πâ‡∏≠‡∏á ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ`;
				alert(message);
				return;
			}
			
			message += '\n\n‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ';
			
			if (confirm(message)) {
				deleteBuilding(code);
			}
		}

		function confirmDeleteRoom(code) {
			const room = roomsData[code];
			if (!room) return;
			
			const message = `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á "${room.name}" (${code}) ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ`;
			
			if (confirm(message)) {
				deleteRoom(code);
			}
		}

		// =================== Initialize CRUD Module ===================

		function initializeCRUDModule() {
			console.log('üîß Initializing CRUD Module...');
			try {
			
				// Add pagination containers to tables if not exist
				const buildingsSection = document.getElementById('buildings-section');
				if (buildingsSection && !document.getElementById('buildingsPagination')) {
					const tableContainer = buildingsSection.querySelector('.admin-card');
					const paginationDiv = document.createElement('div');
					paginationDiv.id = 'buildingsPagination';
					tableContainer.appendChild(paginationDiv);
				}
				
				const roomsSection = document.getElementById('rooms-section');
				if (roomsSection && !document.getElementById('roomsPagination')) {
					const tableContainer = roomsSection.querySelector('.admin-card');
					const paginationDiv = document.createElement('div');
					paginationDiv.id = 'roomsPagination';
					tableContainer.appendChild(paginationDiv);
				}
				
				console.log('‚úÖ CRUD Module initialized');
			} catch (error) {
				console.error('‚ùå Error initializing CRUD module:', error);
			}
		}
		
		
		// =================== Modal Management Functions ===================

		// =================== Building Modal Functions ===================

		function openBuildingModal(code = null) {
			const modal = document.getElementById('buildingModal');
			const title = document.getElementById('buildingModalTitle');
			const form = document.getElementById('buildingForm');
			
			// Reset form
			form.reset();
			
			if (code) {
				// Edit mode
				isEditMode = true;
				editingItemId = code;
				title.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£';
				
				const building = buildingsData[code];
				if (building) {
					document.getElementById('buildingCode').value = building.code;
					document.getElementById('buildingName').value = building.name;
					document.getElementById('buildingFloors').value = building.floors || 1;
					document.getElementById('buildingYear').value = building.year || '';
					document.getElementById('buildingRooms').value = building.rooms || 0;
					document.getElementById('buildingStatus').value = building.status || 'active';
					document.getElementById('buildingDescription').value = building.description || '';
					
					// Disable code editing in edit mode
					document.getElementById('buildingCode').readOnly = true;
				}
			} else {
				// Add mode
				isEditMode = false;
				editingItemId = null;
				title.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà';
				
				// Enable code editing in add mode
				document.getElementById('buildingCode').readOnly = false;
				
				// Auto-generate code
				document.getElementById('buildingCode').value = generateBuildingCode();
			}
			
			modal.style.display = 'block';
			document.body.style.overflow = 'hidden'; // Prevent background scrolling
		}

		function closeBuildingModal() {
			const modal = document.getElementById('buildingModal');
			modal.style.display = 'none';
			document.body.style.overflow = 'auto';
			
			// Reset form and mode
			document.getElementById('buildingForm').reset();
			isEditMode = false;
			editingItemId = null;
		}

		async function saveBuildingForm(event) {
			event.preventDefault();
			
			try {
				const formData = {
					code: document.getElementById('buildingCode').value.trim(),
					name: document.getElementById('buildingName').value.trim(),
					floors: parseInt(document.getElementById('buildingFloors').value),
					year: parseInt(document.getElementById('buildingYear').value) || null,
					rooms: parseInt(document.getElementById('buildingRooms').value) || 0,
					status: document.getElementById('buildingStatus').value,
					description: document.getElementById('buildingDescription').value.trim()
				};
				
				if (isEditMode && editingItemId) {
					await updateBuilding(editingItemId, formData);
				} else {
					await createBuilding(formData);
				}
				
				closeBuildingModal();
				
			} catch (error) {
				// Error is already handled in CRUD functions
				console.error('Save building form error:', error);
			}
		}

		// =================== Room Modal Functions ===================

		function openRoomModal(code = null) {
			const modal = document.getElementById('roomModal');
			const title = document.getElementById('roomModalTitle');
			const form = document.getElementById('roomForm');
			
			// Reset form
			form.reset();
			
			// Populate building dropdown
			populateBuildingDropdown();
			
			// Reset image container
			resetImageUrlContainer();
			
			if (code) {
				// Edit mode
				isEditMode = true;
				editingItemId = code;
				title.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡πâ‡∏≠‡∏á';
				
				const room = roomsData[code];
				if (room) {
					document.getElementById('roomCode').value = room.code;
					document.getElementById('roomName').value = room.name;
					document.getElementById('roomBuilding').value = room.building;
					document.getElementById('roomFloor').value = room.floor || 1;
					document.getElementById('roomType').value = room.type || '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
					document.getElementById('roomStatus').value = room.status || 'active';
					document.getElementById('roomX').value = room.x || '';
					document.getElementById('roomY').value = room.y || '';
					document.getElementById('roomDescription').value = room.description || '';
					
					// Load existing images
					if (room.images && Array.isArray(room.images)) {
						loadExistingImages(room.images);
					}
					
					// Disable code editing in edit mode
					document.getElementById('roomCode').readOnly = true;
				}
			} else {
				// Add mode
				isEditMode = false;
				editingItemId = null;
				title.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
				
				// Enable code editing in add mode
				document.getElementById('roomCode').readOnly = false;
				
				// Auto-generate code
				document.getElementById('roomCode').value = generateRoomCode();
			}
			
			modal.style.display = 'block';
			document.body.style.overflow = 'hidden';
		}

		function closeRoomModal() {
			const modal = document.getElementById('roomModal');
			modal.style.display = 'none';
			document.body.style.overflow = 'auto';
			
			// Reset form and mode
			document.getElementById('roomForm').reset();
			isEditMode = false;
			editingItemId = null;
		}

		async function saveRoomForm(event) {
			event.preventDefault();
			
			try {
				const formData = {
					code: document.getElementById('roomCode').value.trim(),
					name: document.getElementById('roomName').value.trim(),
					building: document.getElementById('roomBuilding').value,
					floor: parseInt(document.getElementById('roomFloor').value),
					type: document.getElementById('roomType').value,
					status: document.getElementById('roomStatus').value,
					x: parseFloat(document.getElementById('roomX').value) || null,
					y: parseFloat(document.getElementById('roomY').value) || null,
					description: document.getElementById('roomDescription').value.trim(),
					images: collectImageUrls()
				};
				
				if (isEditMode && editingItemId) {
					await updateRoom(editingItemId, formData);
				} else {
					await createRoom(formData);
				}
				
				closeRoomModal();
				
			} catch (error) {
				// Error is already handled in CRUD functions
				console.error('Save room form error:', error);
			}
		}

		// =================== Helper Functions ===================

		function populateBuildingDropdown() {
			const select = document.getElementById('roomBuilding');
			const buildings = Object.values(buildingsData);
			
			// Clear existing options except the first one
			select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</option>';
			
			buildings.forEach(building => {
				const option = document.createElement('option');
				option.value = building.code;
				option.textContent = `${building.name} (${building.code})`;
				select.appendChild(option);
			});
		}

		function resetImageUrlContainer() {
			const container = document.getElementById('roomImagesContainer');
			container.innerHTML = `
				<div class="image-url-input" style="display: flex; gap: 10px; margin-bottom: 10px;">
					<input type="url" class="form-input" placeholder="https://example.com/image.jpg" 
						   style="flex: 1;" onchange="validateImageUrl(this)">
					<button type="button" class="btn btn-sm btn-success" onclick="addImageUrl()">
						<i class="fas fa-plus"></i>
					</button>
				</div>
			`;
		}

		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 3: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç loadExistingImages() ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö image_urls ‡∏à‡∏≤‡∏Å Google Sheets
		function loadExistingImages(images) {
			const container = document.getElementById('roomImagesContainer');
			if (!container) {
				console.error('‚ùå roomImagesContainer not found');
				return;
			}
			
			container.innerHTML = '';
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö images data - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á images ‡πÅ‡∏•‡∏∞ image_urls
			let imageUrls = [];
			if (Array.isArray(images)) {
				imageUrls = images;
			} else if (typeof images === 'string') {
				try {
					imageUrls = JSON.parse(images);
				} catch (e) {
					imageUrls = [];
				}
			}
			
			console.log('üìã Loading existing images:', imageUrls);
			
			if (imageUrls.length === 0) {
				resetImageUrlContainer();
				return;
			}
			
			// ‡πÅ‡∏™‡∏î‡∏á existing URLs ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
			imageUrls.forEach((url, index) => {
				addImageUrlInput(url, index === imageUrls.length - 1);
			});
			
			console.log(`‚úÖ Loaded ${imageUrls.length} image URLs into form`);
		}

		function addImageUrl() {
			addImageUrlInput('', true);
		}

		function addImageUrlInput(value = '', isLast = false) {
			const container = document.getElementById('roomImagesContainer');
			
			const div = document.createElement('div');
			div.className = 'image-url-input';
			div.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
			
			div.innerHTML = `
				<input type="url" class="form-input" placeholder="https://example.com/image.jpg" 
					   value="${value}" style="flex: 1;" onchange="validateImageUrl(this)">
				<button type="button" class="btn btn-sm btn-danger" onclick="removeImageUrl(this)">
					<i class="fas fa-minus"></i>
				</button>
				${isLast ? `
				<button type="button" class="btn btn-sm btn-success" onclick="addImageUrl()">
					<i class="fas fa-plus"></i>
				</button>
				` : ''}
			`;
			
			container.appendChild(div);
		}

		function removeImageUrl(button) {
			const container = document.getElementById('roomImagesContainer');
			const inputDiv = button.closest('.image-url-input');
			
			inputDiv.remove();
			
			// If no inputs left, add one
			if (container.children.length === 0) {
				resetImageUrlContainer();
			} else {
				// Make sure the last input has an add button
				const lastInput = container.lastElementChild;
				if (!lastInput.querySelector('.btn-success')) {
					const addButton = document.createElement('button');
					addButton.type = 'button';
					addButton.className = 'btn btn-sm btn-success';
					addButton.onclick = addImageUrl;
					addButton.innerHTML = '<i class="fas fa-plus"></i>';
					lastInput.appendChild(addButton);
				}
			}
		}

		function collectImageUrls() {
			const container = document.getElementById('roomImagesContainer');
			const inputs = container.querySelectorAll('input[type="url"]');
			const urls = [];
			
			inputs.forEach(input => {
				const url = input.value.trim();
				if (url && isValidUrl(url)) {
					urls.push(url);
				}
			});
			
			return urls;
		}

		function validateImageUrl(input) {
			const url = input.value.trim();
			
			if (!url) {
				input.classList.remove('error', 'success');
				return;
			}
			
			if (isValidUrl(url)) {
				input.classList.remove('error');
				input.classList.add('success');
			} else {
				input.classList.remove('success');
				input.classList.add('error');
			}
		}

		function isValidUrl(string) {
			try {
				new URL(string);
				return true;
			} catch (_) {
				return false;
			}
		}

		// =================== Filter Modal Functions ===================

		function openFilterModal() {
			const modal = document.getElementById('filterModal');
			
			// Load current filter values
			document.getElementById('filterSearch').value = currentFilter;
			document.getElementById('filterSortField').value = currentSortField;
			document.getElementById('filterSortDirection').value = currentSortDirection;
			
			modal.style.display = 'block';
			document.body.style.overflow = 'hidden';
		}

		function closeFilterModal() {
			const modal = document.getElementById('filterModal');
			modal.style.display = 'none';
			document.body.style.overflow = 'auto';
		}

		function applyFilter() {
			currentFilter = document.getElementById('filterSearch').value.trim();
			currentPage = 1; // Reset to first page
			
			const activeSection = document.querySelector('.page-section.active');
			
			if (activeSection && activeSection.id === 'rooms-section') {
				loadRoomsTable();
			} else if (activeSection && activeSection.id === 'buildings-section') {
				loadBuildingsTable();
			}
		}

		function applySort() {
			currentSortField = document.getElementById('filterSortField').value;
			currentSortDirection = document.getElementById('filterSortDirection').value;
			currentPage = 1; // Reset to first page
			
			const activeSection = document.querySelector('.page-section.active');
			
			if (activeSection && activeSection.id === 'rooms-section') {
				loadRoomsTable();
			} else if (activeSection && activeSection.id === 'buildings-section') {
				loadBuildingsTable();
			}
		}

		function clearFilter() {
			currentFilter = '';
			currentSortField = '';
			currentSortDirection = 'asc';
			currentPage = 1;
			
			document.getElementById('filterSearch').value = '';
			document.getElementById('filterSortField').value = '';
			document.getElementById('filterSortDirection').value = 'asc';
			
			const activeSection = document.querySelector('.page-section.active');
			
			if (activeSection && activeSection.id === 'rooms-section') {
				loadRoomsTable();
			} else if (activeSection && activeSection.id === 'buildings-section') {
				loadBuildingsTable();
			}
		}

		// =================== Update CRUD Button Functions ===================

		function editBuilding(code) {
			openBuildingModal(code);
		}

		function editRoom(code) {
			openRoomModal(code);
		}

		// =================== Google Sheets Sync Functions ===================

		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 5: ‡∏õ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô syncBuildingToSheets() ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ñ‡∏£‡∏ö (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ year, status, rooms)
		async function syncBuildingToSheets(buildingData, isBatch = false) {
			if (!sheetsConfig.connected || !sheetsConfig.url) {
				const error = '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets';
				console.warn('‚ö†Ô∏è Sync skipped:', error);
				if (!isBatch) showNotification(`‚ö†Ô∏è ${error}`, 'warning');
				return false;
			}
			
			try {
				const params = new URLSearchParams();
				params.append('action', 'addData');
				params.append('sheet', sheetsConfig.buildingsSheet);
				params.append('code', buildingData.code);
				params.append('name', buildingData.name);
				params.append('floors', buildingData.floors);
				// üîß ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÉ‡∏ô Google Sheets ‡πÅ‡∏•‡πâ‡∏ß
				params.append('year', buildingData.year || new Date().getFullYear());
				params.append('description', buildingData.description || '');
				params.append('rooms', buildingData.rooms || 0);
				params.append('status', buildingData.status || 'active');
				params.append('created', buildingData.created);
				params.append('updated', buildingData.updated);

				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});

				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}

				const result = await response.json();
				
				if (result.success) {
					if (!isBatch) {
						showNotification(`‚úÖ ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingData.name} ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÅ‡∏•‡πâ‡∏ß`, 'success');
						addSyncHistoryItem(`üì§ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingData.name}`, 'success');
					}
					return true;
				} else {
					throw new Error(result.error || 'Unknown sync error');
				}

			} catch (error) {
				console.error('‚ùå Building sync error:', error);
				if (!isBatch) {
					showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingData.name}: ${error.message}`, 'error');
					addSyncHistoryItem(`‚ùå ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingData.name} ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß`, 'error');
				}
				return false;
			}
		}
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 8: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô forceEnableAutoSync() ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö manual activation
		function forceEnableAutoSync() {
			sheetsConfig.autoSync = true;
			localStorage.setItem('sheetsConfig', JSON.stringify(sheetsConfig));
			
			// Update UI checkbox if exists
			const autoSyncCheckbox = document.getElementById('autoSyncEnabled');
			if (autoSyncCheckbox) {
				autoSyncCheckbox.checked = true;
			}
			
			showNotification('‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î Auto-sync ‡πÅ‡∏•‡πâ‡∏ß', 'success');
			console.log('‚úÖ Auto-sync force enabled');
		}
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 9: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Auto-sync ‡πÉ‡∏ô initialization
		document.addEventListener('DOMContentLoaded', function() {
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î autoSync
			setTimeout(() => {
				ensureAutoSyncEnabled();
				
				// ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Auto-sync
				console.log('üîÑ Auto-sync status:', sheetsConfig.autoSync);
				console.log('üîó Sheets connected:', sheetsConfig.connected);
			}, 1000);
		});

		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 1: ‡∏õ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô syncRoomToSheets() ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ image_urls
		async function syncRoomToSheets(roomData, isBatch = false) {
			if (!sheetsConfig.connected || !sheetsConfig.url) {
				const error = '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets';
				console.warn('‚ö†Ô∏è Sync skipped:', error);
				if (!isBatch) showNotification(`‚ö†Ô∏è ${error}`, 'warning');
				return false;
			}
			
			try {
				const params = new URLSearchParams();
				params.append('action', 'addData');
				params.append('sheet', sheetsConfig.roomsSheet);
				params.append('code', roomData.code);
				params.append('name', roomData.name);
				params.append('building', roomData.building);
				params.append('floor', roomData.floor);
				params.append('type', roomData.type || '');
				params.append('description', roomData.description || '');
				params.append('status', roomData.status);
				params.append('x', roomData.x || '');
				params.append('y', roomData.y || '');
				// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ image_urls ‡πÅ‡∏ó‡∏ô images
				params.append('image_urls', JSON.stringify(roomData.images || []));
				params.append('created', roomData.created);
				params.append('updated', roomData.updated);

		        console.log(`params.toString: "${params.toString()}"`);
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});
 
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}

				const result = await response.json();
				
				if (result.success) {
					if (!isBatch) {
						showNotification(`‚úÖ ‡∏´‡πâ‡∏≠‡∏á ${roomData.name} ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÅ‡∏•‡πâ‡∏ß`, 'success');
						addSyncHistoryItem(`üì§ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏´‡πâ‡∏≠‡∏á ${roomData.name}`, 'success');
					}
					return true;
				} else {
					throw new Error(result.error || 'Unknown sync error');
				}

			} catch (error) {
				console.error('‚ùå Room sync error:', error);
				if (!isBatch) {
					showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏´‡πâ‡∏≠‡∏á ${roomData.name}: ${error.message}`, 'error');
					addSyncHistoryItem(`‚ùå ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏´‡πâ‡∏≠‡∏á ${roomData.name} ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß`, 'error');
				}
				return false;
			}
		}

		async function deleteBuildingFromSheets(code) {
			if (!sheetsConfig.connected || !sheetsConfig.url) {
				return; // Skip if not connected
			}
			
			try {
				const params = new URLSearchParams();
				params.append('action', 'deleteData');
				params.append('sheet', sheetsConfig.buildingsSheet);
				params.append('id', code);
				
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded',
					},
					body: params.toString()
				});
				
				if (response.ok) {
					const result = await response.json();
					if (result.success) {
						addSyncHistoryItem(`üóëÔ∏è ‡∏•‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${code} ‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
					}
				}
				
			} catch (error) {
				console.error('Delete building from sheets error:', error);
				addSyncHistoryItem(`‚ùå ‡∏•‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${code} ‡∏à‡∏≤‡∏Å Google Sheets ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß`, 'error');
			}
		}

		async function deleteRoomFromSheets(code) {
			if (!sheetsConfig.connected || !sheetsConfig.url) {
				return; // Skip if not connected
			}
			
			try {
				const params = new URLSearchParams();
				params.append('action', 'deleteData');
				params.append('sheet', sheetsConfig.roomsSheet);
				params.append('id', code);
				
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded',
					},
					body: params.toString()
				});
				
				if (response.ok) {
					const result = await response.json();
					if (result.success) {
						addSyncHistoryItem(`üóëÔ∏è ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á ${code} ‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
					}
				}
				
			} catch (error) {
				console.error('Delete room from sheets error:', error);
				addSyncHistoryItem(`‚ùå ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á ${code} ‡∏à‡∏≤‡∏Å Google Sheets ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß`, 'error');
			}
		}
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 1: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö valid image URL
		function isValidImageUrl(url) {
			if (!url || typeof url !== 'string') return false;
			
			const trimmedUrl = url.trim();
			if (trimmedUrl === '') return false;
			
			// ‚ö†Ô∏è ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡πà‡∏≤ placeholder ‡∏≠‡∏≠‡∏Å
			const invalidValues = ['available', 'none', 'null', 'undefined', 'error', 'pending'];
			if (invalidValues.includes(trimmedUrl.toLowerCase())) {
				console.log(`üö´ Invalid placeholder detected: "${trimmedUrl}"`);
				return false;
			}
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
			if (trimmedUrl.startsWith('data:image/')) return true;
			if (trimmedUrl.startsWith('http://') || trimmedUrl.startsWith('https://')) return true;
			
			// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Web Server - relative paths
			if (Environment.isWebServer && (trimmedUrl.startsWith('./') || trimmedUrl.startsWith('../'))) {
				return true;
			}
			
			// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Local PC - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô absolute URLs ‡∏´‡∏£‡∏∑‡∏≠ data URLs ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
			if (Environment.isLocalPC) {
				return false; // Local PC ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö relative paths
			}
			
			return false;
		}


		// =================== Keyboard Shortcuts ===================

		document.addEventListener('keydown', function(e) {
			// Close modals with Escape key
			if (e.key === 'Escape') {
				const modals = ['buildingModal', 'roomModal', 'filterModal'];
				modals.forEach(modalId => {
					const modal = document.getElementById(modalId);
					if (modal && modal.style.display === 'block') {
						modal.style.display = 'none';
						document.body.style.overflow = 'auto';
						
						// Reset forms
						if (modalId === 'buildingModal') {
							document.getElementById('buildingForm').reset();
						} else if (modalId === 'roomModal') {
							document.getElementById('roomForm').reset();
						}
						
						isEditMode = false;
						editingItemId = null;
					}
				});
			}
			
			// Quick add shortcuts (Ctrl/Cmd + specific keys)
			if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
				const activeSection = document.querySelector('.page-section.active');
				
				if (e.key === 'b' && activeSection && activeSection.id === 'buildings-section') {
					e.preventDefault();
					openBuildingModal();
				}
				
				if (e.key === 'r' && activeSection && activeSection.id === 'rooms-section') {
					e.preventDefault();
					openRoomModal();
				}
				
				if (e.key === 'f') {
					e.preventDefault();
					openFilterModal();
				}
			}
		});

		// =================== Initialize Modal Module ===================

		function initializeModalModule() {
			console.log('üîß Initializing Modal Module...');
			try {
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö modal elements
				const modals = document.querySelectorAll('.modal');
				console.log(`üìã Found ${modals.length} modals`);
				
				console.log('‚úÖ Modal Module initialized');
				return true;
			} catch (error) {
				console.error('‚ùå Error initializing Modal module:', error);
				return false;
			}
		}	

		// =================== Enhanced Navigation Functions ===================

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï showSection function ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà
		function showSection(sectionId) {
		 
			console.log(`üìç Switching to section: ${sectionId}`);
			
			// Hide all sections
			document.querySelectorAll('.page-section').forEach(section => {
				section.classList.remove('active');
			});

			// Remove active class from all menu items
			document.querySelectorAll('.menu-item, .mobile-nav-item').forEach(item => {
				item.classList.remove('active');
			});

			// Show target section
			const targetSection = document.getElementById(sectionId + '-section');
			if (targetSection) {
				targetSection.classList.add('active');
				
				// Initialize section-specific modules
				if (sectionId === 'maps') {
					initializeMapsModule();
				} else if (sectionId === 'deployment') {
					initializeDeploymentModule();
				} else if (sectionId === 'sheets') {
					initializeEnhancedSheetsModule();
				}
			}

			// Add active class to clicked menu item
			const menuSelectors = [
				`.menu-item[onclick="showSection('${sectionId}')"]`,
				`.mobile-nav-item[onclick="showSection('${sectionId}')"]`
			];
			
			menuSelectors.forEach(selector => {
				const menuItem = document.querySelector(selector);
				if (menuItem) {
					menuItem.classList.add('active');
				}
			});

			// Update page title
			const titles = {
				'dashboard': '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î',
				'buildings': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£',
				'rooms': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á',
				'maps': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà',
				'sheets': 'Google Sheets',
				'deployment': '‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ Deploy'
			};

			const pageTitle = document.getElementById('pageTitle');
			if (pageTitle && titles[sectionId]) {
				pageTitle.textContent = titles[sectionId];
			}

			// Close mobile sidebar and more menu if open
			if (window.innerWidth <= 768) {
				const sidebar = document.getElementById('sidebar');
				if (sidebar) {
					sidebar.classList.remove('show');
				}
				closeMobileMoreMenu();
			}
			
			// Reset current page for tables
			currentPage = 1;
			currentFilter = '';
			
			// Load appropriate table
			if (sectionId === 'buildings') {
				loadBuildingsTable();
			} else if (sectionId === 'rooms') {
				loadRoomsTable();
			}
		}

		// =================== Mobile More Menu Functions ===================

		function openMoreMenu() {
			const menu = document.getElementById('mobileMoreMenu');
			if (menu.style.display === 'none' || !menu.style.display) {
				menu.style.display = 'block';
				
				// Close menu when clicking outside
				setTimeout(() => {
					document.addEventListener('click', closeMoreMenuOnOutsideClick);
				}, 100);
			} else {
				closeMobileMoreMenu();
			}
		}

		function closeMobileMoreMenu() {
			const menu = document.getElementById('mobileMoreMenu');
			menu.style.display = 'none';
			document.removeEventListener('click', closeMoreMenuOnOutsideClick);
		}

		function closeMoreMenuOnOutsideClick(e) {
			const menu = document.getElementById('mobileMoreMenu');
			const moreButton = document.querySelector('.mobile-nav-item[onclick="openMoreMenu()"]');
			
			if (!menu.contains(e.target) && !moreButton.contains(e.target)) {
				closeMobileMoreMenu();
			}
		}

		// =================== Quick Search Functions ===================

		let searchTimeout = null;

		function quickSearchBuildings(query) {
			// Debounce search
			clearTimeout(searchTimeout);
			searchTimeout = setTimeout(() => {
				currentFilter = query.trim();
				currentPage = 1;
				loadBuildingsTable();
				
				if (query.trim()) {
					showNotification(`üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: "${query}"`, 'info');
				}
			}, 300);
		}

		function quickSearchRooms(query) {
			// Debounce search
			clearTimeout(searchTimeout);
			searchTimeout = setTimeout(() => {
				currentFilter = query.trim();
				currentPage = 1;
				loadRoomsTable();
				
				if (query.trim()) {
					showNotification(`üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: "${query}"`, 'info');
				}
			}, 300);
		}

		// =================== Enhanced Table Management ===================

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï loadBuildingsTable ‡πÉ‡∏´‡πâ‡∏°‡∏µ search highlight
		function loadBuildingsTableEnhanced() {
			const tbody = document.getElementById('buildingsTableBody');
			if (!tbody) return;
			
			let buildings = Object.values(buildingsData);
			
			// Apply filter
			if (currentFilter) {
				buildings = buildings.filter(building => 
					building.name.toLowerCase().includes(currentFilter.toLowerCase()) ||
					building.code.toLowerCase().includes(currentFilter.toLowerCase()) ||
					(building.description && building.description.toLowerCase().includes(currentFilter.toLowerCase()))
				);
			}
			
			// Apply sorting
			if (currentSortField) {
				buildings.sort((a, b) => {
					let aVal = a[currentSortField] || '';
					let bVal = b[currentSortField] || '';
					
					if (typeof aVal === 'string') {
						aVal = aVal.toLowerCase();
						bVal = bVal.toLowerCase();
					}
					
					if (currentSortDirection === 'asc') {
						return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
					} else {
						return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
					}
				});
			}
			
			totalItems = buildings.length;
			
			// Apply pagination
			const paginatedBuildings = paginateData(buildings, currentPage, itemsPerPage);
			
			if (paginatedBuildings.length === 0) {
				tbody.innerHTML = `
					<tr>
						<td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
							<i class="fas fa-building" style="font-size: 32px; margin-bottom: 10px; opacity: 0.3;"></i>
							<p>${buildings.length === 0 ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'}</p>
							${currentFilter ? `<p style="font-size: 14px; color: var(--info-color);">‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: "${currentFilter}"</p>` : ''}
						</td>
					</tr>
				`;
			} else {
				tbody.innerHTML = paginatedBuildings.map(building => `
					<tr>
						<td><strong>${highlightSearchTerm(building.code, currentFilter)}</strong></td>
						<td>${highlightSearchTerm(building.name, currentFilter)}</td>
						<td>${building.floors} ‡∏ä‡∏±‡πâ‡∏ô</td>
						<td>${building.rooms || 0} ‡∏´‡πâ‡∏≠‡∏á</td>
						<td>
							<span class="status-indicator ${building.status === 'active' ? 'status-active' : 'status-inactive'}">
								${building.status === 'active' ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}
							</span>
						</td>
						<td>
							<button class="btn btn-sm btn-info" onclick="editBuilding('${building.code}')" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
								<i class="fas fa-edit"></i>
							</button>
							<button class="btn btn-sm btn-danger" onclick="confirmDeleteBuilding('${building.code}')" title="‡∏•‡∏ö">
								<i class="fas fa-trash"></i>
							</button>
						</td>
					</tr>
				`).join('');
			}
			
			// Update pagination controls
			createPaginationControls(totalItems, currentPage, itemsPerPage, 'buildingsPagination');
			
			// Update search input if exists
			const searchInput = document.getElementById('buildingQuickSearch');
			if (searchInput && searchInput.value !== currentFilter) {
				searchInput.value = currentFilter;
			}
		}

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï loadRoomsTable ‡πÉ‡∏´‡πâ‡∏°‡∏µ search highlight
		function loadRoomsTableEnhanced() {
			const tbody = document.getElementById('roomsTableBody');
			if (!tbody) return;
			
			let rooms = Object.values(roomsData);
			
			// Apply filter
			if (currentFilter) {
				rooms = rooms.filter(room => 
					room.name.toLowerCase().includes(currentFilter.toLowerCase()) ||
					room.code.toLowerCase().includes(currentFilter.toLowerCase()) ||
					(room.type && room.type.toLowerCase().includes(currentFilter.toLowerCase())) ||
					(room.building && room.building.toLowerCase().includes(currentFilter.toLowerCase())) ||
					(room.description && room.description.toLowerCase().includes(currentFilter.toLowerCase()))
				);
			}
			
			// Apply sorting
			if (currentSortField) {
				rooms.sort((a, b) => {
					let aVal = a[currentSortField] || '';
					let bVal = b[currentSortField] || '';
					
					if (typeof aVal === 'string') {
						aVal = aVal.toLowerCase();
						bVal = bVal.toLowerCase();
					}
					
					if (currentSortDirection === 'asc') {
						return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
					} else {
						return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
					}
				});
			}
			
			totalItems = rooms.length;
			
			// Apply pagination
			const paginatedRooms = paginateData(rooms, currentPage, itemsPerPage);
			
			if (paginatedRooms.length === 0) {
				tbody.innerHTML = `
					<tr>
						<td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
							<i class="fas fa-door-open" style="font-size: 32px; margin-bottom: 10px; opacity: 0.3;"></i>
							<p>${rooms.length === 0 ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤'}</p>
							${currentFilter ? `<p style="font-size: 14px; color: var(--info-color);">‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: "${currentFilter}"</p>` : ''}
						</td>
					</tr>
				`;
			} else {
				tbody.innerHTML = paginatedRooms.map(room => {
					const building = buildingsData[room.building];
					return `
						<tr>
							<td><strong>${highlightSearchTerm(room.code, currentFilter)}</strong></td>
							<td>${highlightSearchTerm(room.name, currentFilter)}</td>
							<td>${building ? highlightSearchTerm(building.name, currentFilter) : room.building}</td>
							<td>‡∏ä‡∏±‡πâ‡∏ô ${room.floor || 'N/A'}</td>
							<td>
								<span style="background: rgba(102, 126, 234, 0.1); padding: 4px 8px; border-radius: 12px; font-size: 11px; color: var(--primary-color);">
									${highlightSearchTerm(room.type || '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', currentFilter)}
								</span>
							</td>
							<td>
								<span class="status-indicator ${getStatusClass(room.status)}">
									${getStatusText(room.status)}
								</span>
							</td>
							<td>
								<button class="btn btn-sm btn-info" onclick="editRoom('${room.code}')" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
									<i class="fas fa-edit"></i>
								</button>
								<button class="btn btn-sm btn-danger" onclick="confirmDeleteRoom('${room.code}')" title="‡∏•‡∏ö">
									<i class="fas fa-trash"></i>
								</button>
							</td>
						</tr>
					`;
				}).join('');
			}
			
			// Update pagination controls
			createPaginationControls(totalItems, currentPage, itemsPerPage, 'roomsPagination');
			
			// Update search input if exists
			const searchInput = document.getElementById('roomQuickSearch');
			if (searchInput && searchInput.value !== currentFilter) {
				searchInput.value = currentFilter;
			}
		}

		// =================== Search Highlighting Function ===================

		function highlightSearchTerm(text, searchTerm) {
			if (!searchTerm || !text) return text;
			
			const regex = new RegExp(`(${escapeRegExp(searchTerm)})`, 'gi');
			return text.replace(regex, '<mark style="background: #ffeb3b; padding: 1px 2px; border-radius: 2px;">$1</mark>');
		}

		function escapeRegExp(string) {
			return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
		}

		// =================== Enhanced Keyboard Shortcuts ===================

		document.addEventListener('keydown', function(e) {
			// Close modals with Escape key
			if (e.key === 'Escape') {
				const modals = ['buildingModal', 'roomModal', 'filterModal'];
				modals.forEach(modalId => {
					const modal = document.getElementById(modalId);
					if (modal && modal.style.display === 'block') {
						modal.style.display = 'none';
						document.body.style.overflow = 'auto';
						
						// Reset forms
						if (modalId === 'buildingModal') {
							document.getElementById('buildingForm').reset();
						} else if (modalId === 'roomModal') {
							document.getElementById('roomForm').reset();
						}
						
						isEditMode = false;
						editingItemId = null;
					}
				});
				
				// Close mobile more menu
				closeMobileMoreMenu();
			}
			
			// Section navigation shortcuts (Alt + number)
			if (e.altKey && !e.ctrlKey && !e.metaKey && !e.shiftKey) {
				const sectionKeys = {
					'1': 'dashboard',
					'2': 'buildings', 
					'3': 'rooms',
					'4': 'maps',
					'5': 'sheets',
					'6': 'deployment'
				};
				
				if (sectionKeys[e.key]) {
					e.preventDefault();
					showSection(sectionKeys[e.key]);
				}
			}
			
			// Quick add shortcuts (Ctrl/Cmd + specific keys)
			if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
				const activeSection = document.querySelector('.page-section.active');
				
				if (e.key === 'b' && activeSection && activeSection.id === 'buildings-section') {
					e.preventDefault();
					openBuildingModal();
				}
				
				if (e.key === 'r' && activeSection && activeSection.id === 'rooms-section') {
					e.preventDefault();
					openRoomModal();
				}
				
				if (e.key === 'f') {
					e.preventDefault();
					openFilterModal();
				}
				
				if (e.key === 's') {
					e.preventDefault();
					sequentialLoadData();
				}
				
				if (e.key === '/') {
					e.preventDefault();
					// Focus on search input
					const activeSection = document.querySelector('.page-section.active');
					if (activeSection && activeSection.id === 'buildings-section') {
						const searchInput = document.getElementById('buildingQuickSearch');
						if (searchInput) searchInput.focus();
					} else if (activeSection && activeSection.id === 'rooms-section') {
						const searchInput = document.getElementById('roomQuickSearch');
						if (searchInput) searchInput.focus();
					}
				}
			}
		});

		// =================== Update Original Functions ===================

		// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà loadBuildingsTable ‡πÄ‡∏î‡∏¥‡∏°
		function loadBuildingsTable() {
			loadBuildingsTableEnhanced();
		}

		// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà loadRoomsTable ‡πÄ‡∏î‡∏¥‡∏°  
		function loadRoomsTable() {
			loadRoomsTableEnhanced();
		}

		// =================== Search and Filter State Management ===================

		function clearAllFilters() {
			currentFilter = '';
			currentSortField = '';
			currentSortDirection = 'asc';
			currentPage = 1;
			
			// Clear search inputs
			const buildingSearch = document.getElementById('buildingQuickSearch');
			const roomSearch = document.getElementById('roomQuickSearch');
			
			if (buildingSearch) buildingSearch.value = '';
			if (roomSearch) roomSearch.value = '';
			
			// Reload current table
			const activeSection = document.querySelector('.page-section.active');
			if (activeSection && activeSection.id === 'buildings-section') {
				loadBuildingsTable();
			} else if (activeSection && activeSection.id === 'rooms-section') {
				loadRoomsTable();
			}
			
			showNotification('üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'info');
		}
 

		// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
		function initializeEnhancedNavigationModule() {
			console.log('üß≠ Initializing Enhanced Navigation Module...');
			try {
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö navigation elements
				const sidebar = document.getElementById('sidebar');
				const menuItems = document.querySelectorAll('.menu-item');
				
				if (sidebar && menuItems.length > 0) {
					console.log('‚úÖ Navigation elements found');
				}
				
				console.log('‚úÖ Enhanced Navigation Module initialized');
				return true;
			} catch (error) {
				console.error('‚ùå Error initializing Enhanced Navigation module:', error);
				return false;
			}
		}


		// =================== Show Keyboard Shortcuts Help ===================

		function showKeyboardShortcuts() {
			const shortcuts = [
				{ key: 'Alt + 1-6', desc: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î, ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£, ‡∏´‡πâ‡∏≠‡∏á, ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà, Sheets, Deploy)' },
				{ key: 'Ctrl + B', desc: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£)' },
				{ key: 'Ctrl + R', desc: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á)' },
				{ key: 'Ctrl + F', desc: '‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á' },
				{ key: 'Ctrl + S', desc: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets' },
				{ key: 'Ctrl + /', desc: '‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤' },
				{ key: 'Escape', desc: '‡∏õ‡∏¥‡∏î Modal ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤' }
			];
			
			const modal = document.createElement('div');
			modal.style.cssText = `
				position: fixed; top: 0; left: 0; right: 0; bottom: 0;
				background: rgba(0,0,0,0.8); z-index: 9999;
				display: flex; align-items: center; justify-content: center;
				padding: 20px;
			`;
			
			modal.innerHTML = `
				<div style="background: white; border-radius: 15px; padding: 30px; max-width: 600px; max-height: 80vh; overflow-y: auto;">
					<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
						<h3 style="color: var(--primary-color); margin: 0;">‚å®Ô∏è Keyboard Shortcuts</h3>
						<button onclick="this.closest('div').parentElement.remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
					</div>
					
					<div style="grid-template-columns: auto 1fr; gap: 15px; display: grid; align-items: center;">
						${shortcuts.map(shortcut => `
							<div style="background: #f1f3f4; padding: 8px 12px; border-radius: 6px; font-family: monospace; font-weight: 600; text-align: center; font-size: 14px;">
								${shortcut.key}
							</div>
							<div style="font-size: 14px;">
								${shortcut.desc}
							</div>
						`).join('')}
					</div>
					
					<div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center;">
						<button onclick="this.closest('div').parentElement.remove()" class="btn btn-primary">
							<i class="fas fa-check"></i> ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö
						</button>
					</div>
				</div>
			`;
			
			document.body.appendChild(modal);
		}

		// Add keyboard shortcuts help to header
		function addKeyboardShortcutsButton() {
			const headerActions = document.querySelector('.header-actions');
			if (headerActions) {
				const shortcutsBtn = document.createElement('button');
				shortcutsBtn.className = 'header-btn secondary';
				shortcutsBtn.innerHTML = '<i class="fas fa-keyboard"></i><span>Shortcuts</span>';
				shortcutsBtn.onclick = showKeyboardShortcuts;
				shortcutsBtn.title = '‡πÅ‡∏™‡∏î‡∏á Keyboard Shortcuts (Alt + H)';
				
				headerActions.insertBefore(shortcutsBtn, headerActions.lastElementChild);
			}
		}
		
		// =================== Enhanced Sequential Loader ===================

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï SequentialLoader ‡πÉ‡∏´‡πâ‡∏£‡∏ß‡∏° Maps module
		SequentialLoader.prototype.updateUIStep = async function() {
			// Simulate UI update delay
			await new Promise(resolve => setTimeout(resolve, 500));
			
			// Update dashboard stats
			updateDashboardStats();
			
			// Update tables
			loadBuildingsTable();
			loadRoomsTable();
			
			// Initialize Maps module
			initializeMapsModule();
			
			// Update connection status
			updateConnectionStatus();
			
			console.log('‚úÖ UI updated successfully with all modules');
			return true;
		};
		
		// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ functions ‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
		document.addEventListener('DOMContentLoaded', function() {
			// Initialize debug mode from localStorage
			const savedDebugMode = localStorage.getItem('debugMode') === 'true';
			debugMode = savedDebugMode;
			
			// Initialize enhanced sheets config
			setTimeout(() => {
				loadEnhancedSheetsConfig();
			}, 1000);
			
			console.log('‚úÖ Missing functions initialized');
		});


		// =================== Responsive Handlers ===================

		function setupResponsiveHandlers() {
			console.log('üì± Setting up responsive handlers...');
			try {
				// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ responsive handlers
				let resizeTimeout;
				window.addEventListener('resize', function() {
					clearTimeout(resizeTimeout);
					resizeTimeout = setTimeout(() => {
						console.log('üìê Window resized');
					}, 250);
				});
				
				console.log('‚úÖ Responsive handlers setup complete');
				return true;
			} catch (error) {
				console.error('‚ùå Error setting up responsive handlers:', error);
				return false;
			}
		}

		function handleWindowResize() {
			const width = window.innerWidth;
			
			if (width > 768) {
				const sidebar = document.getElementById('sidebar');
				if (sidebar) {
					sidebar.classList.remove('show');
				}
			}
		}

		function setupTouchHandlers() {
			// Add touch feedback to buttons
			const buttons = document.querySelectorAll('.btn, .menu-item, .mobile-nav-item');
			
			buttons.forEach(button => {
				button.addEventListener('touchstart', function() {
					this.style.transform = 'scale(0.95)';
				});
				
				button.addEventListener('touchend', function() {
					this.style.transform = 'scale(1)';
				});
				
				button.addEventListener('touchcancel', function() {
					this.style.transform = 'scale(1)';
				});
			});
		}

		function adjustTableResponsiveness() {
			const tables = document.querySelectorAll('.data-table');
			
			tables.forEach(table => {
				const container = table.parentElement;
				if (window.innerWidth <= 768) {
					container.style.overflowX = 'auto';
					table.style.minWidth = '600px';
				} else {
					container.style.overflowX = 'visible';
					table.style.minWidth = 'auto';
				}
			});
		}

		// =================== Welcome Message ===================

		function showWelcomeMessage() {
			const hasSeenWelcome = localStorage.getItem('adminWelcomeSeen');
			
			if (!hasSeenWelcome) {
				const modal = document.createElement('div');
				modal.style.cssText = `
					position: fixed; top: 0; left: 0; right: 0; bottom: 0;
					background: rgba(0,0,0,0.8); z-index: 9999;
					display: flex; align-items: center; justify-content: center;
					padding: 20px; backdrop-filter: blur(10px);
				`;
				
				modal.innerHTML = `
					<div style="background: white; border-radius: 20px; padding: 40px; max-width: 500px; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
						<div style="font-size: 64px; margin-bottom: 20px;">üéâ</div>
						
						<h2 style="color: var(--primary-color); margin-bottom: 15px;">
							‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Admin Panel V1.3 <br>Enhanced: Dikstra Admin-Index Integrtaion Bridge!
						</h2>
						
						<p style="color: var(--text-secondary); margin-bottom: 25px; line-height: 1.6;">
							‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô: CRUD, Pagination, Maps Management, Deploy Guide ‡πÅ‡∏•‡∏∞ Enhanced Google Sheets Integration
						</p>
						
						<div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 25px;">
							<h4 style="color: var(--info-color); margin-bottom: 15px;">
								<i class="fas fa-lightbulb"></i> ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
							</h4>
							<ul style="text-align: left; margin: 0; padding-left: 20px; color: var(--text-secondary);">
								<li>‡πÉ‡∏ä‡πâ <kbd>Alt + 1-6</kbd> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤</li>
								<li>‡πÉ‡∏ä‡πâ <kbd>Ctrl + /</kbd> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</li>
								<li>‡πÉ‡∏ä‡πâ <kbd>Ctrl + B/R</kbd> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
								<li>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° <i class="fas fa-keyboard"></i> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π shortcuts ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</li>
							</ul>
						</div>
						
						<div style="display: flex; gap: 10px; justify-content: center;">
							<button onclick="closeWelcomeMessage(false)" class="btn btn-secondary">
								‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á
							</button>
							<button onclick="closeWelcomeMessage(true)" class="btn btn-primary">
								<i class="fas fa-rocket"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
							</button>
						</div>
					</div>
				`;
				
				document.body.appendChild(modal);
				
				// Auto-close after 30 seconds
				setTimeout(() => {
					if (document.body.contains(modal)) {
						closeWelcomeMessage(true);
					}
				}, 30000);
			}
		}

		function closeWelcomeMessage(dontShowAgain = false) {
			const modal = document.querySelector('div[style*="position: fixed"][style*="backdrop-filter"]');
			if (modal) {
				modal.remove();
			}
			
			if (dontShowAgain) {
				localStorage.setItem('adminWelcomeSeen', 'true');
			}
		}

		// =================== System Health Check ===================

		function performSystemHealthCheck() {
			const healthStatus = {
				modules: {
					navigation: !!document.getElementById('sidebar'),
					crud: typeof createBuilding === 'function',
					modals: !!document.getElementById('buildingModal'),
					maps: typeof initializeMapsModule === 'function',
					deployment: typeof initializeDeploymentModule === 'function',
					sheets: typeof initializeEnhancedSheetsModule === 'function'
				},
				data: {
					buildings: Object.keys(buildingsData || {}).length,
					rooms: Object.keys(roomsData || {}).length,
					sheetsConnected: sheetsConfig?.connected || false
				},
				ui: {
					responsive: window.innerWidth > 0,
					localStorage: typeof Storage !== 'undefined',
					fetch: typeof fetch === 'function'
				}
			};
			
			const allModulesOk = Object.values(healthStatus.modules).every(status => status);
			const allUIFeaturesOk = Object.values(healthStatus.ui).every(status => status);
			
			console.log('üè• System Health Check:', healthStatus);
			
			if (allModulesOk && allUIFeaturesOk) {
				console.log('‚úÖ System health: EXCELLENT');
				return { status: 'excellent', details: healthStatus };
			} else if (allUIFeaturesOk) {
				console.log('‚ö†Ô∏è System health: GOOD (some modules missing)');
				return { status: 'good', details: healthStatus };
			} else {
				console.log('‚ùå System health: POOR (critical issues)');
				return { status: 'poor', details: healthStatus };
			}
		}

		// =================== Auto-save and Recovery ===================

		function setupAutoSave() {
			console.log('üíæ Setting up auto-save...');
			
			// Save state every 30 seconds
			setInterval(() => {
				const state = {
					currentPage,
					currentFilter,
					currentSortField,
					currentSortDirection,
					itemsPerPage,
					lastActive: new Date().toISOString()
				};
				
				localStorage.setItem('adminState', JSON.stringify(state));
			}, 30000);
			
			// Save on page unload
			window.addEventListener('beforeunload', function() {
				const state = {
					currentPage,
					currentFilter,
					currentSortField,
					currentSortDirection,
					itemsPerPage,
					lastActive: new Date().toISOString()
				};
				
				localStorage.setItem('adminState', JSON.stringify(state));
			});
		}

		function recoverState() {
			try {
				const saved = localStorage.getItem('adminState');
				if (saved) {
					const state = JSON.parse(saved);
					
					// Check if state is recent (less than 24 hours old)
					const lastActive = new Date(state.lastActive);
					const now = new Date();
					const hoursDiff = (now - lastActive) / (1000 * 60 * 60);
					
					if (hoursDiff < 24) {
						currentPage = state.currentPage || 1;
						currentFilter = state.currentFilter || '';
						currentSortField = state.currentSortField || '';
						currentSortDirection = state.currentSortDirection || 'asc';
						itemsPerPage = state.itemsPerPage || 20;
						
						console.log('‚ôªÔ∏è State recovered from auto-save');
						return true;
					}
				}
			} catch (error) {
				console.warn('‚ö†Ô∏è Could not recover state:', error);
			}
			
			return false;
		}

		// =================== Performance Monitoring ===================

		 

		 
		// =================== Updated Event Handlers ===================

		function setupEventHandlers() {
			console.log('üîó Setting up enhanced event handlers...');
			
			// Original keyboard shortcuts
			document.addEventListener('keydown', function(e) {
				// Global shortcuts
				if ((e.ctrlKey || e.metaKey) && e.key === 's') {
					e.preventDefault();
					sequentialLoadData();
				}
				
				if (e.altKey && e.key === 'h') {
					e.preventDefault();
					//showKeyboardShortcuts();
				}
			});
			
			// Enhanced mobile handling
			let touchStartY = 0;
			let touchEndY = 0;
			
			document.addEventListener('touchstart', function(e) {
				touchStartY = e.changedTouches[0].screenY;
			});
			
			document.addEventListener('touchend', function(e) {
				touchEndY = e.changedTouches[0].screenY;
				
				// Pull to refresh (swipe down from top)
				if (touchEndY - touchStartY > 100 && window.scrollY === 0) {
					sequentialLoadData();
				}
			});
			
			// Setup auto-save and monitoring
			setupAutoSave();  
		}

		// =================== Updated Main Initialization ===================

		document.addEventListener('DOMContentLoaded', function() {
			console.log('üéØ DOM Content Loaded - Starting initialization...');
			
			// Recover previous state if available
			recoverState();
			
			// Setup enhanced event handlers
			//setupEventHandlers();
			
			// Check login status and initialize if logged in
			if (checkLoginStatus()) {
				initializeAdmin();
				
				// Perform health check after initialization
				setTimeout(() => {
					const health = performSystemHealthCheck();
					if (health.status === 'poor') {
						showNotification('‚ö†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà', 'warning');
					}
				}, 3000);
			}
		});
		

		// ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç initializeMapsModule ‡πÉ‡∏´‡πâ‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Maps
		function initializeMapsModule() {
			console.log('üó∫Ô∏è Initializing Maps Management Module...');
			
			try {
				// ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á Maps
				loadMapsTable();
				
				// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Image Upload System
				initializeImageUploadSystem();
				
				console.log('‚úÖ Maps Management Module initialized');
			} catch (error) {
				console.error('‚ùå Error initializing Maps module:', error);
			}
		}
		
		// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Image Upload System
		function initializeImageUploadSystem() {
			console.log('üñºÔ∏è Initializing Image Upload System...');
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö
			if (!checkSystemReady()) {
				console.error('‚ùå System not ready for image processing');
				return;
			}
			
			// ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å localStorage
			loadSheetsConfigFromStorage();
			
			// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
			updateConnectionStatus();
			
		}
		
		// ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Maps ‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà initializeAdminWithMaps)
		function enhanceLoginHandling() {
			// ‡πÄ‡∏Å‡πá‡∏ö reference ‡∏Ç‡∏≠‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô handleLogin ‡πÄ‡∏î‡∏¥‡∏°
			const originalHandleLogin = window.handleLogin;
			
			// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô handleLogin ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏° Maps loading
			window.handleLogin = function(event) {
				// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°
				if (originalHandleLogin) {
					originalHandleLogin.call(this, event);
				} else {
					// ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÉ‡∏´‡πâ‡∏ó‡∏≥ login ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
					performBasicLogin(event);
				}
				
				// ‡πÇ‡∏´‡∏•‡∏î Maps ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
				setTimeout(() => {
					const isLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
					if (isLoggedIn) {
						console.log('üó∫Ô∏è Login successful, initializing Maps...');
						
						// ‡πÇ‡∏´‡∏•‡∏î Maps ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
						setTimeout(() => {
							initializeMapsModule();
						}, 1000);
					}
				}, 500);
			};
		}
		
		// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô login ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ handleLogin ‡πÄ‡∏î‡∏¥‡∏°
		function performBasicLogin(event) {
			event.preventDefault();
			
			const username = document.getElementById('loginUsername').value;
			const password = document.getElementById('loginPassword').value;
			const errorDiv = document.getElementById('loginError');
			
			if (username === 'admin' && password === '1234') {
				sessionStorage.setItem('adminLoggedIn', 'true');
				
				document.getElementById('loginContainer').style.display = 'none';
				document.getElementById('adminContainer').style.display = 'flex';
				
				// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å initializeAdmin ‡∏´‡∏≤‡∏Å‡∏°‡∏µ
				if (typeof initializeAdmin === 'function') {
					setTimeout(() => {
						initializeAdmin();
					}, 100);
				}
				
				console.log('‚úÖ Basic login successful');
			} else {
				errorDiv.style.display = 'block';
				errorDiv.textContent = '‚ùå Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
				
				setTimeout(() => {
					errorDiv.style.display = 'none';
				}, 3000);
			}
		}
		
		 
		
		 
		
		// ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Maps ‡πÉ‡∏ô initializeAdmin
		async function initializeAdminWithMaps() {
			try {
				console.log('üöÄ Initializing Complete Admin Panel System with Maps...');
				
				// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô initializeAdmin ‡πÄ‡∏î‡∏¥‡∏°
				if (typeof initializeAdmin === 'function') {
					await initializeAdmin();
				}
				
				// ‡πÇ‡∏´‡∏•‡∏î Maps ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
				setTimeout(() => {
					console.log('üó∫Ô∏è Loading Maps after admin initialization...');
					initializeMapsModule();
				}, 1000);
				
			} catch (error) {
				console.error('‚ùå Error initializing admin with maps:', error);
			}
		}

		 
		function loadMapSyncHistory() {
			// Maps sync history ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô addMapSyncHistoryItem function
			console.log('üìä Map sync history ready');
		}
		
		function addMapSyncHistoryItem(message, type) {
			console.log(`üó∫Ô∏è Map Sync History: ${message} (${type})`);
			// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ console.log ‡∏Å‡πà‡∏≠‡∏ô
		}
		
		
		 
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 5: ‡∏õ‡∏£‡∏±‡∏ö loadFloorplanFromSheets() ‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
		 async function loadFloorplanFromSheets(buildingCode) {
    if (!buildingCode) {
        showPlaceholderMap();
        return;
    }

    console.log(`üó∫Ô∏è Loading floorplan for building: ${buildingCode}`);
    
    try {
        // Show loading state
        showMapLoadingState(true);
        
        // üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å session storage ‡∏Å‡πà‡∏≠‡∏ô (‡∏à‡∏≤‡∏Å Maps section)
        const sessionFloorplan = sessionStorage.getItem('temp_floorplan');
        const sessionRealphoto = sessionStorage.getItem('temp_realphoto');
        
        if (sessionFloorplan && isValidImageUrl(sessionFloorplan)) {
            console.log(`üíæ Using floorplan from session storage for ${buildingCode}`);
            await loadFloorplanImage(sessionFloorplan, buildingCode);
            return;
        }
        
        // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å localStorage (‡∏à‡∏≤‡∏Å Maps section)
        const savedMap = localStorage.getItem('currentMap');
        if (savedMap) {
            try {
                const mapData = JSON.parse(savedMap);
                if (mapData.floorplan && isValidImageUrl(mapData.floorplan)) {
                    console.log(`üíæ Using floorplan from localStorage for ${buildingCode}`);
                    await loadFloorplanImage(mapData.floorplan, buildingCode);
                    return;
                } else if (mapData.realphoto && isValidImageUrl(mapData.realphoto)) {
                    console.log(`üíæ Using realphoto from localStorage for ${buildingCode}`);
                    await loadFloorplanImage(mapData.realphoto, buildingCode);
                    return;
                }
            } catch (error) {
                console.error('‚ùå Failed to parse saved map data:', error);
            }
        }
        
        // üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ - ‡πÅ‡∏™‡∏î‡∏á placeholder ‡πÅ‡∏ó‡∏ô
        console.log(`üìã No initial map available, showing placeholder for ${buildingCode}`);
		await tryLoadFromGoogleSheets(buildingCode);
        showPlaceholderMap();
        
    } catch (error) {
        console.error('‚ùå Error loading floorplan:', error);
        showPlaceholderMap();
    } finally {
        showMapLoadingState(false);
    }
}

		// üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏°: Universal Google Sheets Loader  
		async function tryLoadFromGoogleSheets(buildingCode) {
			try {
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö sheetsConfig
				if (!sheetsConfig.url) {
					console.log('‚ö†Ô∏è No Google Sheets URL configured, loading from storage...');
					loadSheetsConfigFromStorage();
				}
				
				if (!sheetsConfig.url) {
					console.log(`üìã No Google Sheets available, showing placeholder for ${buildingCode}`);
					showPlaceholderMap();
					return;
				}
				
				console.log('üîç Loading map from Google Sheets...');
				
				const params = new URLSearchParams();
				params.append('action', 'getData');
				params.append('sheet', sheetsConfig.mapImagesSheet);
				
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});
				
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				
				const result = await response.json();
				
				if (result.success && result.data && result.data.length > 0) {
					const mapData = result.data.find(row => row.id === 'main_map');
					
					if (mapData && (mapData.floorplan || mapData.realphoto)) {
						console.log(`‚úÖ Found map data from Google Sheets for ${buildingCode}`);
						
						// ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ floorplan ‡∏´‡∏£‡∏∑‡∏≠ realphoto
						const mapImage = mapData.floorplan || mapData.realphoto;
						
						if (isValidImageUrl(mapImage)) {
							await loadFloorplanImage(mapImage, buildingCode);
							
							// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
							localStorage.setItem('currentMap', JSON.stringify(mapData));
							return;
						}
					}
				}
				
				// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheets
				console.log(`üìã No map data found in Google Sheets, showing placeholder for ${buildingCode}`);
				showPlaceholderMap();
				
			} catch (error) {
				console.error('‚ùå Failed to load from Google Sheets:', error);
				console.log(`üìã Fallback to placeholder for ${buildingCode}`);
				showPlaceholderMap();
			}
		}

		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 2: ‡∏õ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchMapImageFromSheets() ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á buildingCode ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
		async function fetchMapImageFromSheets(buildingCode) {
		try {
			const params = new URLSearchParams();
			params.append('action', 'getMapImages');
			if (buildingCode) {
				params.append('buildingCode', buildingCode);
			}

			imageLoadingAbortController = new AbortController();
			 
			const response = await fetch(sheetsConfig.url, {
				method: 'POST',
				headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
				body: params.toString(),
				signal: imageLoadingAbortController.signal
			});

			if (!response.ok) {
				throw new Error(`HTTP ${response.status}: ${response.statusText}`);
			}

			const result = await response.json();
			console.log(`üó∫Ô∏è Map images response for ${buildingCode}:`, result);
			
			if (result.success && result.data && result.data.length > 0) {
				// ‡∏´‡∏≤ exact match ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö buildingCode ‡∏Å‡πà‡∏≠‡∏ô
				let mapData = result.data.find(item => item.id === buildingCode);
				
				// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏•‡∏≠‡∏á‡∏´‡∏≤ main_map ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å
				if (!mapData) {
					mapData = result.data.find(item => 
						item.id === 'main_map' || item.id === 'maps'
					) || result.data[0];
					
					console.log(`üìã No specific map for ${buildingCode}, using fallback:`, mapData?.id);
				}
				
				// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î URLs
				if (mapData) {
					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö floorplan URL
					if (mapData.floorplan && !isValidImageUrl(mapData.floorplan)) {
						console.log(`üö´ Invalid floorplan URL: "${mapData.floorplan}"`);
						mapData.floorplan = null;
					}
					
					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö realphoto URL
					if (mapData.realphoto && !isValidImageUrl(mapData.realphoto)) {
						console.log(`üö´ Invalid realphoto URL: "${mapData.realphoto}"`);
						mapData.realphoto = null;
					}
					
					// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ valid URLs ‡πÄ‡∏•‡∏¢
					if (!mapData.floorplan && !mapData.realphoto) {
						console.log(`‚ö†Ô∏è No valid image URLs found for ${buildingCode}`);
						return null;
					}
				}
				
				return mapData;
			}
			
			return null;
			
		} catch (error) {
			if (error.name === 'AbortError') {
				console.log('üö´ Image fetch aborted');
				return null;
			}
			console.error(`‚ùå Error fetching map for ${buildingCode}:`, error);
			throw error;
		}
	}
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 4: ‡∏õ‡∏£‡∏±‡∏ö loadFallbackFloorplan() ‡πÉ‡∏´‡πâ‡∏°‡∏µ validation ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
		async function loadFallbackFloorplan(buildingCode) {
			console.log(`üîÑ Loading fallback floorplan for building: ${buildingCode}`);
			
			try {
				const params = new URLSearchParams();
				params.append('action', 'getMapImages');
				// ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á buildingCode ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å maps
				
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});

				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}

				const result = await response.json();
				
				if (result.success && result.data && result.data.length > 0) {
					// ‡∏´‡∏≤ main_map ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ valid floorplan
					let mainMap = null;
					
					// ‡∏•‡∏≠‡∏á‡∏´‡∏≤ main_map ‡∏Å‡πà‡∏≠‡∏ô
					mainMap = result.data.find(item => 
						(item.id === 'main_map' || item.id === 'maps') && 
						isValidImageUrl(item.floorplan)
					);
					
					// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏≠‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ valid floorplan
					if (!mainMap) {
						mainMap = result.data.find(item => isValidImageUrl(item.floorplan));
					}
					
					if (mainMap && mainMap.floorplan) {
						console.log(`üìê Using fallback map: ${mainMap.id}`);
						
						// Cache the data
						mapImageCache.set(buildingCode, {
							url: mainMap.floorplan,
							realphoto: mainMap.realphoto,
							timestamp: Date.now()
						});
						
						// Load the image
						await loadFloorplanImage(mainMap.floorplan, buildingCode);
						showNotification(`üìê ‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingCode}`, 'info');
						return true;
					}
				}
				
				console.log('‚ùå No valid fallback floorplan found');
				return false;
				
			} catch (error) {
				console.error('‚ùå Fallback floorplan loading failed:', error);
				return false;
			}
		}

		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 3: ‡∏õ‡∏£‡∏±‡∏ö loadFloorplanImage() ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Environment ‡πÅ‡∏•‡∏∞‡∏°‡∏µ validation ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
		async function loadFloorplanImage(imageUrl, buildingCode) {
			return new Promise((resolve, reject) => {
				const img = document.getElementById('mapFloorplanImage');
				const placeholder = document.getElementById('roomMapPlaceholder');
				const controls = document.getElementById('imageControls');
				
				if (!img) {
					reject(new Error('Missing map image element'));
					return;
				}

				// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
				if (!isValidImageUrl(imageUrl)) {
					console.error(`‚ùå Invalid image URL: "${imageUrl}"`);
					reject(new Error(`Invalid image URL: ${imageUrl}`));
					return;
				}

				console.log(`üñºÔ∏è Loading image for ${buildingCode}: ${imageUrl.substring(0, 100)}...`);

				// Create new image to test loading
				const testImg = new Image();
				
				// ‚è∞ ‡∏ï‡∏±‡πâ‡∏á timeout ‡∏Å‡πà‡∏≠‡∏ô - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô memory leak
				const timeoutId = setTimeout(() => {
					testImg.onload = null;
					testImg.onerror = null;
					console.error(`‚è∞ Image loading timeout for ${buildingCode}`);
					reject(new Error('Image loading timeout'));
				}, 10000); // 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
				
				testImg.onload = function() {
					clearTimeout(timeoutId);
					
					// Image loaded successfully
					img.src = imageUrl;
					img.style.display = 'block';
					
					if (placeholder) placeholder.style.display = 'none';
					if (controls) controls.style.display = 'flex';
					
					console.log(`‚úÖ Image loaded successfully for ${buildingCode}`);
					showNotification(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ${buildingCode} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
					resolve();
				};
				
				testImg.onerror = function(event) {
					clearTimeout(timeoutId);
					
					console.error(`‚ùå Failed to load image for ${buildingCode}: ${imageUrl}`);
					console.error('Error event:', event);
					
					// ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£
					let errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ';
					if (Environment.isLocalPC && !imageUrl.startsWith('data:')) {
						errorMessage = 'Local PC ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Base64 images ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô';
					}
					
					showMapError(errorMessage, buildingCode);
					reject(new Error(`Failed to load image: ${imageUrl}`));
				};
				
				// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
				testImg.src = imageUrl;
			});
		}
		
		

		// =================== Method 3: Upload & Preview ===================

		function initializeImageUpload() {
			const uploadZone = document.getElementById('mapUploadZone');
			const fileInput = document.getElementById('floorplanFileInput');
			
			if (!uploadZone || !fileInput) return;

			// Click to upload
			uploadZone.addEventListener('click', () => {
				fileInput.click();
			});

			// File input change
			fileInput.addEventListener('change', (e) => {
				if (e.target.files && e.target.files[0]) {
					handleImageUpload(e.target.files[0]);
				}
			});

			// Drag and drop
			uploadZone.addEventListener('dragover', (e) => {
				e.preventDefault();
				uploadZone.classList.add('dragover');
			});

			uploadZone.addEventListener('dragleave', (e) => {
				e.preventDefault();
				uploadZone.classList.remove('dragover');
			});

			uploadZone.addEventListener('drop', (e) => {
				e.preventDefault();
				uploadZone.classList.remove('dragover');
				
				const files = e.dataTransfer.files;
				if (files && files[0]) {
					handleImageUpload(files[0]);
				}
			});

			console.log('üì§ Image upload initialized');
		}
		
		
		// ===== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û =====
		//function checkImageSize(base64Data, maxSizeKB = 45) {
		function checkImageSize(base64Data, maxSizeKB = 100) {
			if (!base64Data) return { valid: true, size: 0, sizeKB: 0 };
			
			const sizeBytes = base64Data.length;
			const sizeKB = Math.round(sizeBytes / 1024);
			const valid = sizeKB <= maxSizeKB;
			
			return {
				valid: valid,
				size: sizeBytes,
				sizeKB: sizeKB,
				maxSizeKB: maxSizeKB
			};
		}

		//function compressImage(canvas, quality = 0.7, maxSizeKB = 45) {
		function compressImage(canvas, quality = 0.7, maxSizeKB = 100) {
			return new Promise((resolve) => {
				const tryCompress = (currentQuality) => {
					const base64 = canvas.toDataURL('image/jpeg', currentQuality);
					const check = checkImageSize(base64, maxSizeKB);
					
					console.log(`üîÑ Compression attempt: quality=${currentQuality}, size=${check.sizeKB}KB`);
					
					if (check.valid || currentQuality <= 0.1) {
						resolve({
							base64: base64,
							quality: currentQuality,
							finalSize: check.sizeKB,
							compressed: currentQuality < quality
						});
					} else {
						// ‡∏•‡∏î‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏•‡∏á 10%
						tryCompress(Math.max(0.1, currentQuality - 0.1));
					}
				};
				
				tryCompress(quality);
			});
		}

		//async function processImageFile(file, maxSizeKB = 45, maxWidth = 1200, maxHeight = 800) {
		async function processImageFile(file, maxSizeKB = 100, maxWidth = 1200, maxHeight = 800) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				
				reader.onload = async (e) => {
					try {
						const img = new Image();
						
						img.onload = async () => {
							try {
								console.log(`üìê Original image: ${img.width}x${img.height}`);
								
								// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
								let { width, height } = calculateNewDimensions(img.width, img.height, maxWidth, maxHeight);
								
								// ‡∏™‡∏£‡πâ‡∏≤‡∏á canvas
								const canvas = document.createElement('canvas');
								const ctx = canvas.getContext('2d');
								canvas.width = width;
								canvas.height = height;
								
								// ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏•‡∏á‡πÉ‡∏ô canvas
								ctx.drawImage(img, 0, 0, width, height);
								
								// ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
								//const result = await compressImage(canvas, 0.8, maxSizeKB);
								const result = await compressImage(canvas, 0.7, maxSizeKB);
								
								console.log(`‚úÖ Image processed: ${width}x${height}, quality=${result.quality}, size=${result.finalSize}KB`);
								
								resolve({
									base64: result.base64,
									width: width,
									height: height,
									quality: result.quality,
									finalSize: result.finalSize,
									compressed: result.compressed,
									originalSize: Math.round(file.size / 1024)
								});
								
							} catch (error) {
								reject(error);
							}
						};
						
						img.onerror = () => reject(new Error('Failed to load image'));
						img.src = e.target.result;
						
					} catch (error) {
						reject(error);
					}
				};
				
				reader.onerror = () => reject(new Error('Failed to read file'));
				reader.readAsDataURL(file);
			});
		}

		function calculateNewDimensions(originalWidth, originalHeight, maxWidth, maxHeight) {
			let width = originalWidth;
			let height = originalHeight;
			
			// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î
			const widthRatio = maxWidth / originalWidth;
			const heightRatio = maxHeight / originalHeight;
			const ratio = Math.min(widthRatio, heightRatio, 1); // ‡πÑ‡∏°‡πà‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏π‡∏õ
			
			width = Math.round(originalWidth * ratio);
			height = Math.round(originalHeight * ratio);
			
			return { width, height };
		}

		// =================== Placeholder Functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Maps ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ implement ===================
		// ===== ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô handleImageUpload =====
		async function handleImageUpload(input, type) {
			const file = input.files[0];
			if (!file) return;
			
			try {
				console.log(`üì§ Processing ${type} image:`, file.name, `(${Math.round(file.size/1024)}KB)`);
				showNotification(`üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•${type === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á'}...`, 'info');
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå
				if (!file.type.startsWith('image/')) {
					throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
				}
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB)
				const maxFileSize = 10 * 1024 * 1024; // 10MB
				if (file.size > maxFileSize) {
					throw new Error('‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡πÄ‡∏Å‡∏¥‡∏ô 10MB)');
				}
				
				// ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
				//const result = await processImageFile(file, 45, 1200, 800);
				const result = await processImageFile(file, 390, 1200, 800);
				
				// ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô sessionStorage
				sessionStorage.setItem(`temp_${type}`, result.base64);
				sessionStorage.setItem(`${type}_uploaded`, 'true');
				
				// ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
				const previewId = type === 'floorplan' ? 'floorplanPreview' : 'realphotoPreview';
				updateImagePreview(previewId, result.base64, type);
				
				// ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
				let message = `‚úÖ ${type === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á'}‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`;
				if (result.compressed) {
					message += ` (‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏à‡∏≤‡∏Å ${result.originalSize}KB ‡πÄ‡∏õ‡πá‡∏ô ${result.finalSize}KB)`;
				} else {
					message += ` (${result.finalSize}KB)`;
				}
				
				showNotification(message, 'success');
				console.log(`‚úÖ ${type} upload complete:`, result);
				
			} catch (error) {
				console.error(`‚ùå ${type} upload error:`, error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î${type === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á'}‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
				
				// ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
				input.value = '';
				sessionStorage.removeItem(`temp_${type}`);
				sessionStorage.removeItem(`${type}_uploaded`);
			}
		}
						
		 
		// =================== UI State Management ===================

		function showMapLoadingState(show, message = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà...') {
			const overlay = document.getElementById('mapLoadingOverlay');
			if (overlay) {
				if (show) {
					overlay.style.display = 'flex';
					const text = overlay.querySelector('p');
					if (text) text.textContent = message;
				} else {
					overlay.style.display = 'none';
				}
			}
		}

		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 2: ‡∏õ‡∏£‡∏±‡∏ö showPlaceholderMap() ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° upload
		function showPlaceholderMap() {
			const img = document.getElementById('mapFloorplanImage');
			const placeholder = document.getElementById('roomMapPlaceholder');
			const controls = document.getElementById('imageControls');
			
			if (img) img.style.display = 'none';
			if (controls) controls.style.display = 'none';
			
			if (placeholder) {
				placeholder.style.display = 'block';
				placeholder.innerHTML = `
					<div style="text-align: center; padding: 40px; color: #666;">
						<i class="fas fa-map" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
						<p style="margin: 0; font-size: 16px;">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</p>
						<small style="opacity: 0.7;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</small>
					</div>
				`;
			}
		}
		
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 4: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î image_urls ‡∏à‡∏≤‡∏Å rooms data
		function loadRoomImageUrls(roomCode) {
			if (!roomCode || !roomsData[roomCode]) {
				console.log('‚ö†Ô∏è No room data found for:', roomCode);
				return;
			}
			
			const room = roomsData[roomCode];
			console.log(`üìã Loading image URLs for room ${roomCode}:`, room);
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ images ‡∏´‡∏£‡∏∑‡∏≠ image_urls
			const imageUrls = room.images || room.image_urls || [];
			
			if (Array.isArray(imageUrls) && imageUrls.length > 0) {
				console.log(`üñºÔ∏è Found ${imageUrls.length} image URLs for room ${roomCode}`);
				
				// ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô form - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á image URLs
				displayRoomImages(imageUrls, roomCode);
			} else {
				console.log(`üì∑ No image URLs found for room ${roomCode}`);
				clearRoomImages();
			}
		}
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 5: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á room images ‡πÉ‡∏ô form
		function displayRoomImages(imageUrls, roomCode) {
			// ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á images ‡πÉ‡∏ô room form
			const imageContainer = document.getElementById('roomImageContainer') || 
								  document.querySelector('.room-images') ||
								  document.querySelector('#roomModal .modal-body');
			
			if (!imageContainer) {
				console.log('‚ö†Ô∏è No image container found in room form');
				return;
			}
			
			// ‡∏•‡∏ö existing images
			const existingImages = imageContainer.querySelectorAll('.room-image-preview');
			existingImages.forEach(img => img.remove());
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° images ‡πÉ‡∏´‡∏°‡πà
			imageUrls.forEach((url, index) => {
				if (isValidImageUrl(url)) {
					const imageDiv = document.createElement('div');
					imageDiv.className = 'room-image-preview';
					imageDiv.style.cssText = `
						display: inline-block; margin: 5px; 
						border: 1px solid #ddd; border-radius: 5px; 
						padding: 5px; background: #f9f9f9;
						max-width: 150px;
					`;
					
					imageDiv.innerHTML = `
						<img src="${url}" style="max-width: 100%; height: 80px; object-fit: cover; border-radius: 3px;">
						<p style="margin: 5px 0 0 0; font-size: 11px; text-align: center;">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${index + 1}</p>
					`;
					
					imageContainer.appendChild(imageDiv);
				}
			});
			
			console.log(`‚úÖ Displayed ${imageUrls.length} images for room ${roomCode}`);
		}
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 6: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á room images
		function clearRoomImages() {
			const imageContainer = document.getElementById('roomImageContainer') || 
								  document.querySelector('.room-images') ||
								  document.querySelector('#roomModal .modal-body');
			
			if (imageContainer) {
				const existingImages = imageContainer.querySelectorAll('.room-image-preview');
				existingImages.forEach(img => img.remove());
			}
		}


		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 3: ‡∏•‡∏ö showUploadPrompt() ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° upload
		function showUploadPrompt(buildingCode) {
			console.log(`üìã Building ${buildingCode} - showing simple placeholder instead of upload prompt`);
			showPlaceholderMap();
		}

		function showMapError(message, buildingCode) {
			const placeholder = document.getElementById('roomMapPlaceholder');
			if (placeholder) {
				placeholder.innerHTML = `
					<i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 8px; color: var(--danger-color);"></i>
					<div style="font-size: 14px; margin-bottom: 4px; color: var(--danger-color);">${message}</div>
					<div style="font-size: 11px; opacity: 0.7;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
				`;
				placeholder.style.display = 'block';
			}
			
			showNotification(message, 'error');
		}		
		// =================== Control Functions ===================

	
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 4: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô clearMapImageCache() ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debug
		function clearMapImageCache() {
			mapImageCache.clear();
			console.log('üóëÔ∏è Map image cache cleared');
			showNotification('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á cache ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß', 'info');
		}		
		
		// 3. ‚úÖ Helper Functions
		function fileToBase64(file) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				reader.onload = () => resolve(reader.result);
				reader.onerror = reject;
				reader.readAsDataURL(file);
			});
		}
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 5: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CRUD ‡πÑ‡∏°‡πà sync ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡∏õ‡∏£‡∏±‡∏ö sheetsConfig ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î autoSync ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
		function ensureAutoSyncEnabled() {
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î autoSync ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
			if (sheetsConfig.autoSync === undefined || sheetsConfig.autoSync === null) {
				sheetsConfig.autoSync = true;
				localStorage.setItem('sheetsConfig', JSON.stringify(sheetsConfig));
				console.log('‚úÖ Auto-sync enabled by default');
			}
		}
		async function compressImageIfNeeded(base64, maxSizeKB = 500) {
			const currentSizeKB = Math.round(base64.length / 1024);
			
			if (currentSizeKB <= maxSizeKB) {
				return base64; // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î
			}
			
			try {
				// ‡∏™‡∏£‡πâ‡∏≤‡∏á canvas ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î
				const img = new Image();
				await new Promise((resolve, reject) => {
					img.onload = resolve;
					img.onerror = reject;
					img.src = base64;
				});
				
				const canvas = document.createElement('canvas');
				const ctx = canvas.getContext('2d');
				
				// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô)
				const maxDimension = 1200;
				let { width, height } = img;
				
				if (width > height && width > maxDimension) {
					height = (height * maxDimension) / width;
					width = maxDimension;
				} else if (height > maxDimension) {
					width = (width * maxDimension) / height;
					height = maxDimension;
				}
				
				canvas.width = width;
				canvas.height = height;
				
				// ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà
				ctx.drawImage(img, 0, 0, width, height);
				
				// ‡∏•‡∏î‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
				let quality = 0.8;
				let compressed;
				
				do {
					compressed = canvas.toDataURL('image/jpeg', quality);
					const compressedSizeKB = Math.round(compressed.length / 1024);
					
					if (compressedSizeKB <= maxSizeKB || quality <= 0.1) {
						break;
					}
					
					quality -= 0.1;
				} while (quality > 0.1);
				
				console.log(`üóúÔ∏è ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î: ${currentSizeKB}KB ‚Üí ${Math.round(compressed.length / 1024)}KB`);
				return compressed;
				
			} catch (error) {
				console.error('Compression error:', error);
				return base64; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏ñ‡πâ‡∏≤‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
			}
		}
		
		// 4. ‚úÖ Local Storage Management
		function saveToLocal(key, data) {
			try {
				localStorage.setItem(key, JSON.stringify(data));
				return true;
			} catch (error) {
				console.error('Local storage error:', error);
				return false;
			}
		}
		
		function loadFromLocal(key, defaultValue = null) {
		try {
			const data = localStorage.getItem(key);
			return data ? JSON.parse(data) : defaultValue;
		} catch (error) {
			console.error('Local storage load error:', error);
			return defaultValue;
		}
	}
			
		// ===== ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î =====
		function showCompressionInfo(originalSize, finalSize, quality) {
			const compressionRatio = Math.round((1 - finalSize/originalSize) * 100);
			console.log(`üìä Compression: ${originalSize}KB ‚Üí ${finalSize}KB (${compressionRatio}% reduced, quality: ${Math.round(quality*100)}%)`);
			
			if (compressionRatio > 0) {
				showNotification(`üóúÔ∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ñ‡∏π‡∏Å‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î ${compressionRatio}% (${originalSize}KB ‚Üí ${finalSize}KB)`, 'info');
			}
		}

		// ===== ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö =====
		function checkSystemReady() {
			const canvas = document.createElement('canvas');
			const canvasSupported = canvas.getContext && canvas.getContext('2d');
			
			if (!canvasSupported) {
				console.error('‚ùå Canvas not supported');
				showNotification('‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
				return false;
			}
			
			console.log('‚úÖ Image processing system ready');
			return true;
		}

		// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ page ‡πÇ‡∏´‡∏•‡∏î
		document.addEventListener('DOMContentLoaded', function() {
			checkSystemReady();
			
			// ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets ‡∏à‡∏≤‡∏Å localStorage
			loadSheetsConfigFromStorage();
			
			// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
			updateConnectionStatus();
		});

		// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å localStorage
		function loadSheetsConfigFromStorage() {
			try {
				const saved = localStorage.getItem('sheetsConfig');
				if (saved) {
					const config = JSON.parse(saved);
					sheetsConfig = { ...sheetsConfig, ...config };
					
					// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ element
					const urlInput = document.getElementById('sheetsUrl');
					if (urlInput && sheetsConfig.url) {
						urlInput.value = sheetsConfig.url;
					}
					
					console.log('‚úÖ Sheets config loaded from storage');
				}
			} catch (error) {
				console.error('‚ùå Failed to load sheets config:', error);
			}
		}

		
		
		// 4. ‡πÄ‡∏û‡∏¥‡πà‡∏° Function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
		function removeImagePreview(previewId, imageType) {
			console.log('üóëÔ∏è Removing preview:', previewId, imageType);
			
			// ‡∏•‡∏ö‡∏à‡∏≤‡∏Å sessionStorage
			const type = previewId.includes('floorplan') ? 'floorplan' : 'realphoto';
			sessionStorage.removeItem(`temp_${type}`);
			sessionStorage.removeItem(`${type}_uploaded`);
			
			// ‡∏•‡πâ‡∏≤‡∏á file input
			const inputId = type === 'floorplan' ? 'floorplanUpload' : 'realphotoUpload';
			const inputElement = document.getElementById(inputId);
			if (inputElement) {
				inputElement.value = '';
			}
			
			// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
			resetImagePreview(previewId, imageType);
			
			showNotification(`üóëÔ∏è ‡∏•‡∏ö${imageType}‡πÅ‡∏•‡πâ‡∏ß`, 'info');
		}

	 		
		// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ form ‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
		function updateMapFormsAfterSave() {
			console.log('üìù Updating map forms after successful save...');
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß" ‡πÉ‡∏ô preview
			const floorplanPreview = document.getElementById('floorplanPreview');
			const realphotoPreview = document.getElementById('realphotoPreview');
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° badge "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß" ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
			if (floorplanPreview && sessionStorage.getItem('floorplan_uploaded') === 'true') {
				addSavedBadge(floorplanPreview);
			}
			
			if (realphotoPreview && sessionStorage.getItem('realphoto_uploaded') === 'true') {
				addSavedBadge(realphotoPreview);
			}
			
			// ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
			const saveButton = document.querySelector('button[onclick="saveMapImages()"]');
			if (saveButton) {
				const originalText = saveButton.innerHTML;
				saveButton.innerHTML = '<i class="fas fa-check"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß';
				saveButton.disabled = true;
				
				// ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
				setTimeout(() => {
					saveButton.innerHTML = originalText;
					saveButton.disabled = false;
				}, 3000);
			}
			
			console.log('‚úÖ Map forms updated after save');
		}

		// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° badge "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß"
		function addSavedBadge(previewElement) {
			// ‡∏•‡∏ö badge ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
			const existingBadge = previewElement.querySelector('.saved-badge');
			if (existingBadge) {
				existingBadge.remove();
			}
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° badge ‡πÉ‡∏´‡∏°‡πà
			const badge = document.createElement('div');
			badge.className = 'saved-badge';
			badge.style.cssText = `
				position: absolute; top: 5px; right: 25px;
				background: var(--accent-color); color: white;
				padding: 2px 8px; border-radius: 12px; font-size: 10px;
				font-weight: bold; z-index: 10;
			`;
			badge.innerHTML = '<i class="fas fa-check"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß';
			
			const container = previewElement.querySelector('div[style*="position: relative"]');
			if (container) {
				container.appendChild(badge);
			}
		}

		// =================== ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà 2: ‡πÇ‡∏´‡∏•‡∏î Maps ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Admin ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ===================

		 
		// 4. ‚úÖ Enhanced addLoadedFromSheetsBadge
		function addLoadedFromSheetsBadge() {
			const previews = ['floorplanPreview', 'realphotoPreview'];
			
			previews.forEach(previewId => {
				const preview = document.getElementById(previewId);
				if (preview && preview.querySelector('img')) {
					// ‡∏•‡∏ö badge ‡πÄ‡∏Å‡πà‡∏≤
					const existingBadge = preview.querySelector('.loaded-badge');
					if (existingBadge) existingBadge.remove();
					
					const badge = document.createElement('div');
					badge.className = 'loaded-badge';
					badge.style.cssText = `
						position: absolute; bottom: 5px; left: 5px;
						background: linear-gradient(45deg, #17a2b8, #007bff);
						color: white; padding: 2px 6px; border-radius: 8px; 
						font-size: 10px; font-weight: bold; z-index: 10;
						box-shadow: 0 2px 4px rgba(0,0,0,0.2);
						border: 1px solid rgba(255,255,255,0.3);
					`;
					badge.innerHTML = '<i class="fas fa-cloud-download-alt"></i> Google Sheets';
					
					const container = preview.querySelector('.image-preview-container');
					if (container) {
						container.appendChild(badge);
					}
				}
			});
		}


		// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadMapsTable  
		function loadMapsTable() {
			console.log('üó∫Ô∏è Loading Maps table...');
			
			try {
				// ‚úÖ ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets
				loadExistingMaps();  // ‚Üê ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
				
				// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô session storage ‡∏î‡πâ‡∏ß‡∏¢
				loadSavedImages();
				
				// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Sync History UI
				updateMapSyncHistoryUI();
				
				console.log('‚úÖ Maps table loaded successfully');
				
			} catch (error) {
				console.error('‚ùå Error loading maps table:', error);
			}
		}


		// 2. ‚úÖ Fixed loadExistingMaps - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô Universal Code ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á status ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
		async function loadExistingMaps() {
		try {
			console.log('üó∫Ô∏è Loading existing maps...');
			
			if (!sheetsConfig.url) {
				console.log('‚ùå No Google Sheets URL configured');
				loadSavedImages(); // ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage
				return;
			}

			showNotification('üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å Google Sheets...', 'info');

			const params = new URLSearchParams();
			params.append('action', 'getData');
			params.append('sheet', sheetsConfig.mapImagesSheet);

			const response = await fetch(sheetsConfig.url, {
				method: 'POST',
				headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
				body: params.toString()
			});

			if (!response.ok) {
				throw new Error(`HTTP ${response.status}: ${response.statusText}`);
			}

			const result = await response.json();
			console.log('üó∫Ô∏è Found map data:', result);

			if (result.success && result.data && result.data.length > 0) {
				const mapData = result.data.find(row => row.id === 'main_map');
				
				if (mapData) {
					console.log('üó∫Ô∏è Found map data:', {
						id: mapData.id,
						hasFloorplan: !!mapData.floorplan,
						hasRealphoto: !!mapData.realphoto,
						floorplanValid: isValidImageData(mapData.floorplan),
						realphotoValid: isValidImageData(mapData.realphoto)
					});

					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î floorplan
					const floorplanStatus = isValidImageData(mapData.floorplan);
					if (floorplanStatus === true) {
						console.log('üìê Loading valid floorplan...');
						updateImagePreview('floorplanPreview', mapData.floorplan, 'floorplan');				 
					} else if (floorplanStatus === 'pending') {
						console.log('üìê Floorplan marked as available but not loaded');
						// ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô handlePendingImages()
					}
					

					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î realphoto
					const realphotoStatus = isValidImageData(mapData.realphoto);
					if (realphotoStatus === true) {
						console.log('üì∑ Loading valid realphoto...');
						updateImagePreview('realphotoPreview', mapData.realphoto, 'realphoto');
					} else if (realphotoStatus === 'pending') {
						console.log('üì∑ Realphoto marked as available but not loaded');
						// ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô handlePendingImages()
					}

					// ‡πÄ‡∏ï‡∏¥‡∏° notes ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
					if (mapData.notes) {
						const notesField = document.getElementById('mapNotes');
						if (notesField) notesField.value = mapData.notes;
					}

					// ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ pending
					await handlePendingImages();
				}
			}

			showNotification('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');

		} catch (error) {
			console.error('‚ùå Failed to load existing maps:', error);
			showNotification(`‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}`, 'warning');
			
			// Fallback ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ localStorage
			loadSavedImages();
		}
	}
		
		
		// 3. ‚úÖ Fallback function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö local storage
		function loadFromLocalStorage() {
			try {
				console.log('üìÇ Loading from local storage with validation...');
				
				const savedMap = localStorage.getItem('currentMap');
				if (savedMap) {
					const mapData = JSON.parse(savedMap);
					
					// ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞ validate floorplan
					if (mapData.floorplan && isValidImageData(mapData.floorplan)) {
						sessionStorage.setItem('temp_floorplan', mapData.floorplan);
						sessionStorage.setItem('floorplan_uploaded', 'true');
						updateImagePreview('floorplanPreview', mapData.floorplan, 'floorplan');
					} else {
						resetImagePreview('floorplanPreview', 'floorplan');
					}
					
					// ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞ validate realphoto
					if (mapData.realphoto && isValidImageData(mapData.realphoto)) {
						sessionStorage.setItem('temp_realphoto', mapData.realphoto);
						sessionStorage.setItem('realphoto_uploaded', 'true');
						updateImagePreview('realphotoPreview', mapData.realphoto, 'realphoto');
					} else {
						resetImagePreview('realphotoPreview', 'realphoto');
					}
					
					if (mapData.notes) {
						const notesInput = document.getElementById('mapNotes');
						if (notesInput) notesInput.value = mapData.notes;
					}
					
					showNotification('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
					console.log('‚úÖ Loaded from local storage');
				} else {
					console.log('üìù No local data found');
					resetImagePreview('floorplanPreview', 'floorplan');
					resetImagePreview('realphotoPreview', 'realphoto');
					showNotification('üìù ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ', 'info');
				}
				
			} catch (error) {
				console.error('‚ùå Local storage error:', error);
				resetImagePreview('floorplanPreview', 'floorplan');
				resetImagePreview('realphotoPreview', 'realphoto');
			}
		}
		
		//  ‚úÖ Function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Emergency cleanup)
		function cleanupAllImageData() {
			console.log('üßπ Performing complete image data cleanup...');
			
			// ‡∏•‡πâ‡∏≤‡∏á sessionStorage
			const sessionKeys = ['temp_floorplan', 'temp_realphoto', 'floorplan_uploaded', 'realphoto_uploaded'];
			sessionKeys.forEach(key => sessionStorage.removeItem(key));
			
			// ‡∏•‡πâ‡∏≤‡∏á file inputs
			const inputs = ['floorplanFileInput', 'realphotoFileInput'];
			inputs.forEach(id => {
				const input = document.getElementById(id);
				if (input) input.value = '';
			});
			
			// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï previews
			resetImagePreview('floorplanPreview', 'floorplan');
			resetImagePreview('realphotoPreview', 'realphoto');
			
			// ‡∏•‡πâ‡∏≤‡∏á notes
			const notesInput = document.getElementById('mapNotes');
			if (notesInput) notesInput.value = '';
			
			showNotification('üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'info');
		}
		
		// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ form ‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
		function updateMapFormsAfterSave() {
			console.log('üìù Updating map forms after successful save...');
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß" ‡πÉ‡∏ô preview
			const floorplanPreview = document.getElementById('floorplanPreview');
			const realphotoPreview = document.getElementById('realphotoPreview');
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° badge "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß" ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
			if (floorplanPreview && sessionStorage.getItem('floorplan_uploaded') === 'true') {
				addSavedBadge(floorplanPreview);
			}
			
			if (realphotoPreview && sessionStorage.getItem('realphoto_uploaded') === 'true') {
				addSavedBadge(realphotoPreview);
			}
			
			// ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
			const saveButton = document.querySelector('button[onclick="saveMapImages()"]');
			if (saveButton) {
				const originalText = saveButton.innerHTML;
				saveButton.innerHTML = '<i class="fas fa-check"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß';
				saveButton.disabled = true;
				
				// ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
				setTimeout(() => {
					saveButton.innerHTML = originalText;
					saveButton.disabled = false;
				}, 3000);
			}
			
			console.log('‚úÖ Map forms updated after save');
		}

		// ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° badge "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß"
		function addSavedBadge(previewElement) {
			// ‡∏•‡∏ö badge ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
			const existingBadge = previewElement.querySelector('.saved-badge');
			if (existingBadge) {
				existingBadge.remove();
			}
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° badge ‡πÉ‡∏´‡∏°‡πà
			const badge = document.createElement('div');
			badge.className = 'saved-badge';
			badge.style.cssText = `
				position: absolute; top: 5px; right: 25px;
				background: var(--accent-color); color: white;
				padding: 2px 8px; border-radius: 12px; font-size: 10px;
				font-weight: bold; z-index: 10;
			`;
			badge.innerHTML = '<i class="fas fa-check"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß';
			
			const container = previewElement.querySelector('div[style*="position: relative"]');
			if (container) {
				container.appendChild(badge);
			}
		}		

		// ===== üîß FIXED: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô clearMapForms() =====
		function clearMapForms() {
			console.log('üßπ Clearing map forms...');
			
			// ‡∏•‡πâ‡∏≤‡∏á file inputs
			const floorplanInput = document.getElementById('floorplanUpload');
			const realphotoInput = document.getElementById('realphotoUpload');
			const notesInput = document.getElementById('mapNotes');
			
			if (floorplanInput) floorplanInput.value = '';
			if (realphotoInput) realphotoInput.value = '';
			if (notesInput) notesInput.value = '';
			
			// ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏•‡πâ‡∏≤‡∏á sessionStorage ‡∏î‡πâ‡∏ß‡∏¢ key ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
			sessionStorage.removeItem('temp_floorplan');
			sessionStorage.removeItem('temp_realphoto');
			sessionStorage.removeItem('floorplan_uploaded');
			sessionStorage.removeItem('realphoto_uploaded');
			
			// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
			resetImagePreview('floorplanPreview', '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á');
			resetImagePreview('realphotoPreview', '‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á');
			
			console.log('‚úÖ Map forms cleared successfully');
			showNotification('üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'info');
		}

		// ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô resetImagePreview()
		
		function resetImagePreview(previewId, imageType) {
			const previewElement = document.getElementById(previewId);
			if (!previewElement) return;
			
			const displayType = imageType === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á';
			
			previewElement.innerHTML = `
				<div style="
					text-align: center; padding: 30px; 
					border: 2px dashed #ddd; border-radius: 8px;
					background: #f8f9fa; color: #6c757d;
				">
					<i class="fas fa-image" style="font-size: 32px; margin-bottom: 10px; opacity: 0.5;"></i>
					<p style="margin: 0; font-size: 14px;">‡πÑ‡∏°‡πà‡∏°‡∏µ${displayType}</p>
					<small style="opacity: 0.7;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</small>
				</div>
			`;
		}

		// 3. ‚úÖ Function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
		function cleanupInvalidImageData(imageType) {
			console.log(`üßπ Cleaning up invalid ${imageType} data...`);
			
			const keys = [`temp_${imageType}`, `${imageType}_uploaded`];
			keys.forEach(key => {
				sessionStorage.removeItem(key);
			});
			
			// ‡∏•‡πâ‡∏≤‡∏á input ‡∏î‡πâ‡∏ß‡∏¢
			const inputId = imageType === 'floorplan' ? 'floorplanFileInput' : 'realphotoFileInput';
			const input = document.getElementById(inputId);
			if (input) {
				input.value = '';
			}
		}
		
		// 10. Update Map Sync History Function
		function updateMapSyncHistory(syncData) {
			const historyContainer = document.getElementById('mapSyncHistory');
			if (!historyContainer) return;
			
			const timestamp = new Date().toLocaleString('th-TH');
			
			const historyItem = document.createElement('div');
			historyItem.style.cssText = `
				background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px;
				border-left: 4px solid var(--success-color);
			`;
			
			historyItem.innerHTML = `
				<div style="display: flex; justify-content: space-between; align-items: center;">
					<div>
						<strong>üîÑ ‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</strong>
						<p style="margin: 5px 0; color: var(--text-secondary); font-size: 14px;">
							‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á: ${syncData.floorplan} | ‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á: ${syncData.realphoto}
						</p>
						${syncData.notes ? `<p style="margin: 0; font-style: italic;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${syncData.notes}</p>` : ''}
					</div>
					<small style="color: var(--text-secondary);">${timestamp}</small>
				</div>
			`;
			
			historyContainer.insertBefore(historyItem, historyContainer.firstChild);
			
			// Keep only last 5 history items
			const historyItems = historyContainer.children;
			while (historyItems.length > 5) {
				historyContainer.removeChild(historyItems[historyItems.length - 1]);
			}
		}
		 
		 
		// ===== üåê Universal Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á Local PC ‡πÅ‡∏•‡∏∞ Web Server =====

		// 1. ‚úÖ Environment Detection System
		const Environment = {
			isLocalPC: window.location.protocol === 'file:',
			isWebServer: window.location.protocol.startsWith('http'),
			isLocalhost: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1',
			
			init() {
				console.log(`üåê Environment: ${this.getType()}`);
				console.log(`üìç Protocol: ${window.location.protocol}`);
				console.log(`üè† Host: ${window.location.hostname}`);
				
				// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ storage strategy
				this.setupStorageStrategy();
				
				// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ image handling strategy
				this.setupImageStrategy();
			},
			
			getType() {
				if (this.isLocalPC) return 'Local PC';
				if (this.isLocalhost) return 'Local Web Server';
				return 'Remote Web Server';
			},
			
			setupStorageStrategy() {
				this.storageMethod = this.isLocalPC ? 'localStorage' : 'hybrid';
				this.imageMethod = this.isLocalPC ? 'base64only' : 'smart';
			},
			
			setupImageStrategy() {
				this.maxImageSize = this.isLocalPC ? 500 : 1000; // KB
				this.preferredFormat = this.isLocalPC ? 'jpeg' : 'auto';
			}
		};

		// ‚úÖ 1. ‡πÄ‡∏û‡∏¥‡πà‡∏° Base64 Validation Function ‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á
		function validateBase64Data(data) {
			if (!data || typeof data !== 'string' || data.trim() === '') {
				return { valid: false, error: 'Empty data' };
			}
			
			const trimmedData = data.trim();
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö data URL format
			if (!trimmedData.startsWith('data:image/')) {
				return { valid: false, error: 'Not a data URL' };
			}
			
			try {
				// ‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô base64 ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å data URL
				const base64Part = trimmedData.split(',')[1];
				if (!base64Part) {
					return { valid: false, error: 'Missing base64 data' };
				}
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÅ‡∏•‡∏∞ padding
				if (base64Part.length < 100) {
					return { valid: false, error: 'Base64 too short (truncated)' };
				}
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö characters ‡∏ó‡∏µ‡πà valid
				const base64Regex = /^[A-Za-z0-9+/]*={0,2}$/;
				if (!base64Regex.test(base64Part)) {
					return { valid: false, error: 'Invalid base64 characters' };
				}
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö padding ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
				const paddingCount = (base64Part.match(/=/g) || []).length;
				if (paddingCount > 2) {
					return { valid: false, error: 'Invalid base64 padding' };
				}
				
				// ‡∏•‡∏≠‡∏á decode ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
				const binaryString = atob(base64Part.substring(0, Math.min(100, base64Part.length)));
				if (binaryString.length === 0) {
					return { valid: false, error: 'Base64 decode failed' };
				}
				
				return { 
					valid: true, 
					size: Math.round(trimmedData.length / 1024),
					mimeType: trimmedData.substring(5, trimmedData.indexOf(';'))
				};
				
			} catch (error) {
				return { valid: false, error: `Base64 validation error: ${error.message}` };
			}
		}

		// ‚úÖ 2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç updateImagePreview Function ‡πÉ‡∏´‡πâ‡∏°‡∏µ Validation ‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á
		function updateImagePreview(previewId, imageData, imageType) {
			const previewElement = document.getElementById(previewId);
			if (!previewElement) {
				console.error('‚ùå Preview element not found:', previewId);
				return;
			}
			
			const displayType = imageType === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á';
			
			// üÜï Enhanced validation with better error handling
			if (!imageData || typeof imageData !== 'string' || imageData.trim() === '') {
				console.log(`üîç No ${imageType} data provided`);
				resetImagePreview(previewId, imageType);
				return;
			}
			
			// üÜï ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö invalid values
			const invalidValues = ['available', 'none', 'null', 'undefined', '', 'error'];
			if (invalidValues.includes(imageData.toLowerCase().trim())) {
				console.warn(`‚ö†Ô∏è Invalid ${imageType} data detected:`, imageData);
				cleanupInvalidImageData(imageType);
				resetImagePreview(previewId, imageType);
				return;
			}
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ image source
			let imageSrc = '';
			let sizeKB = 0;
			let isValid = false;
			
			if (imageData.startsWith('data:image/')) {
				// üÜï ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Base64 ‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
				const validation = validateBase64Data(imageData);
				
				if (!validation.valid) {
					console.error(`‚ùå Invalid Base64 data for ${imageType}:`, validation.error);
					showNotification(`‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û${displayType}‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢: ${validation.error}`, 'error');
					
					// ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å
					cleanupCorruptedImageData(imageType);
					resetImagePreview(previewId, imageType);
					return;
				}
				
				imageSrc = imageData;
				sizeKB = validation.size;
				isValid = true;
				console.log(`‚úÖ Valid Base64 data for ${imageType}: ${sizeKB}KB, ${validation.mimeType}`);
				
			} else if (imageData.startsWith('http://') || imageData.startsWith('https://')) {
				// HTTP URLs - ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å environment
				imageSrc = imageData;
				sizeKB = 0;
				isValid = true;
			} else if (Environment.isWebServer && (imageData.startsWith('./') || imageData.startsWith('../') || !imageData.includes('://'))) {
				// Relative paths - ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô web server
				imageSrc = imageData;
				sizeKB = 0;
				isValid = true;
			} else {
				console.warn(`‚ö†Ô∏è Unsupported image source format for ${imageType}:`, imageData.substring(0, 100));
				cleanupInvalidImageData(imageType);
				isValid = false;
			}
			
			if (!isValid) {
				resetImagePreview(previewId, imageType);
				return;
			}
			
		   // ‚úÖ 4. ‡πÄ‡∏û‡∏¥‡πà‡∏° Function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢
			function cleanupCorruptedImageData(imageType) {
				console.log(`üßπ Cleaning up corrupted ${imageType} data...`);
				
				try {
					// ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏à‡∏≤‡∏Å sessionStorage
					sessionStorage.removeItem(`temp_${imageType}`);
					sessionStorage.removeItem(`${imageType}_uploaded`);
					
					// ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
					const localData = localStorage.getItem('currentMap');
					if (localData) {
						try {
							const mapData = JSON.parse(localData);
							if (mapData[imageType]) {
								delete mapData[imageType];
								localStorage.setItem('currentMap', JSON.stringify(mapData));
								console.log(`üßπ Removed corrupted ${imageType} from localStorage`);
							}
						} catch (e) {
							console.warn('Error cleaning localStorage:', e);
						}
					}
					
					console.log(`‚úÖ Corrupted ${imageType} data cleaned up`);
					
				} catch (error) {
					console.error('Error cleaning corrupted data:', error);
				}
			}
			
			// ‡∏™‡∏£‡πâ‡∏≤‡∏á preview HTML ‡∏û‡∏£‡πâ‡∏≠‡∏° error handling ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
			previewElement.innerHTML = `
				<div style="position: relative;" class="image-preview-container">
					<img src="${imageSrc}" 
						 style="max-width: 100%; max-height: 150px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" 
						 alt="${displayType}"
						 onload="handleImageLoadSuccess(this, '${previewId}')"
						 onerror="handleImageLoadError(this, '${previewId}', '${displayType}')">
					<div class="image-size-badge" style="
						position: absolute; top: 5px; right: 5px; 
						background: rgba(0,0,0,0.7); color: white; 
						padding: 2px 6px; border-radius: 4px; font-size: 11px; display: none;
					">
						${sizeKB > 0 ? sizeKB + 'KB' : 'External'}
					</div>
					<button onclick="removeImagePreview('${previewId}', '${imageType}')" 
							class="remove-image-btn"
							style="
								position: absolute; top: 5px; left: 5px;
								background: rgba(220, 53, 69, 0.8); color: white;
								border: none; border-radius: 50%; width: 24px; height: 24px;
								font-size: 12px; cursor: pointer; display: none;
								align-items: center; justify-content: center;
							">√ó</button>
				</div>
				<p style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
					<span class="loading-text">üìÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î ${displayType}...</span>
					<span class="success-text" style="display: none;">‚úÖ ${displayType} 
						${sizeKB > 0 ? '(' + sizeKB + 'KB)' : '(External)'}</span>
					<span class="error-text" style="display: none;">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î${displayType}‡πÑ‡∏î‡πâ</span>
				</p>
			`;
		}

		// 3. ‚úÖ Universal Image Loading Handlers
		function handleImageLoadSuccess(imgElement, previewId) {
			console.log(`‚úÖ Image loaded successfully: ${previewId} (${Environment.getType()})`);
			
			const container = imgElement.closest('.image-preview-container');
			if (container) {
				const sizeBadge = container.querySelector('.image-size-badge');
				const removeBtn = container.querySelector('.remove-image-btn');
				if (sizeBadge) sizeBadge.style.display = 'block';
				if (removeBtn) removeBtn.style.display = 'flex';
			}
			
			const previewElement = document.getElementById(previewId);
			if (previewElement) {
				const loadingText = previewElement.querySelector('.loading-text');
				const successText = previewElement.querySelector('.success-text');
				if (loadingText) loadingText.style.display = 'none';
				if (successText) successText.style.display = 'inline';
			}
		}

		// ‚úÖ 3. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á handleImageLoadError ‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Base64 Error ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
		function handleImageLoadError(imgElement, previewId, displayType) {
			console.error(`‚ùå Image failed to load: ${previewId} (${Environment.getType()})`);
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö src ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î error
			const imgSrc = imgElement.src || '';
			let errorDetail = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
			
			if (imgSrc.startsWith('data:image/')) {
				// Base64 error - ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô truncated ‡∏´‡∏£‡∏∑‡∏≠ corrupted
				if (imgSrc.includes('TRUNCATED') || imgSrc.length < 500) {
					errorDetail = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå (Truncated)';
				} else {
					errorDetail = '‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û Base64 ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢';
				}
				
				// ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å
				const imageType = previewId.includes('floorplan') ? 'floorplan' : 'realphoto';
				cleanupCorruptedImageData(imageType);
			}
			
			const container = imgElement.closest('.image-preview-container');
			if (container) {
				container.innerHTML = `
					<div style="text-align: center; padding: 20px; border: 2px dashed #dc3545; 
								border-radius: 8px; background: rgba(220, 53, 69, 0.1);">
						<i class="fas fa-broken-image" style="font-size: 24px; color: #dc3545; margin-bottom: 8px;"></i>
						<p style="color: #dc3545; margin: 0; font-size: 12px;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î${displayType}‡πÑ‡∏î‡πâ</p>
						<small style="color: #666;">${errorDetail}</small>
					</div>
				`;
			}
			
			showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î${displayType}‡πÑ‡∏î‡πâ`, 'error');
		}

		// 4. ‚úÖ Universal Image File Handler (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°)
		async function handleImageFile(file, imageType = 'floorplan') {
			if (!file || !file.type.startsWith('image/')) {
				showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
				return false;
			}
			
			const maxFileSize = 10 * 1024 * 1024; // 10MB
			if (file.size > maxFileSize) {
				showNotification('‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡πÄ‡∏Å‡∏¥‡∏ô 10MB)', 'error');
				return false;
			}
			
			try {
				showNotification('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...', 'info');
				
				// üÜï Smart processing based on environment
				let processedImage;
				
				if (Environment.isLocalPC) {
					// Local PC: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ base64 + compress
					processedImage = await processImageForLocal(file);
				} else {
					// Web Server: ‡πÉ‡∏ä‡πâ strategy ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
					processedImage = await processImageForWeb(file, imageType);
				}
				
				// ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö environment
				await saveImageData(imageType, processedImage);
				
				// ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
				const previewId = imageType === 'floorplan' ? 'floorplanPreview' : 'realphotoPreview';
				updateImagePreview(previewId, processedImage.src, imageType);
				
				showNotification(
					`‚úÖ ${imageType === 'floorplan' ? '‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á' : '‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á'}‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${processedImage.size})`,
					'success'
				);
				
				return true;
				
			} catch (error) {
				console.error('Image processing error:', error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
				return false;
			}
		}

		// 5. ‚úÖ Environment-Specific Image Processing
		async function processImageForLocal(file) {
			// Local PC: ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô base64 ‡πÅ‡∏•‡∏∞‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î
			const base64 = await fileToBase64(file);
			const compressed = await compressImageIfNeeded(base64, Environment.maxImageSize);
			
			return {
				src: compressed,
				size: Math.round(compressed.length / 1024) + 'KB',
				method: 'base64'
			};
		}

		async function processImageForWeb(file, imageType) {
			// Web Server: ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ multiple strategies
			
			// Strategy 1: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô localhost ‡πÅ‡∏•‡∏∞‡∏°‡∏µ upload endpoint
			if (Environment.isLocalhost && await checkUploadEndpoint()) {
				try {
					const uploaded = await uploadToServer(file, imageType);
					return {
						src: uploaded.url,
						size: uploaded.size,
						method: 'server'
					};
				} catch (error) {
					console.log('üìù Server upload failed, using base64 fallback');
				}
			}
			
			// Strategy 2: Fallback to base64 (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Local PC)
			return await processImageForLocal(file);
		}

		// 6. ‚úÖ Universal Storage System
		async function saveImageData(imageType, processedImage) {
			const storageKey = `temp_${imageType}`;
			const uploadedKey = `${imageType}_uploaded`;
			
			if (Environment.isLocalPC) {
				// Local PC: ‡πÉ‡∏ä‡πâ sessionStorage ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
				sessionStorage.setItem(storageKey, processedImage.src);
				sessionStorage.setItem(uploadedKey, 'true');
			} else {
				// Web Server: ‡πÉ‡∏ä‡πâ hybrid storage
				sessionStorage.setItem(storageKey, processedImage.src);
				sessionStorage.setItem(uploadedKey, 'true');
				
				// ‡πÄ‡∏Å‡πá‡∏ö metadata ‡πÉ‡∏ô localStorage ‡∏î‡πâ‡∏ß‡∏¢
				const metadata = {
					type: imageType,
					size: processedImage.size,
					method: processedImage.method,
					timestamp: new Date().toISOString()
				};
				localStorage.setItem(`${imageType}_metadata`, JSON.stringify(metadata));
			}
		}

		// 7. ‚úÖ Server Upload Functions (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Web Server)
		async function checkUploadEndpoint() {
			try {
				const response = await fetch('/api/upload/check', { method: 'HEAD' });
				return response.ok;
			} catch {
				return false;
			}
		}

		async function uploadToServer(file, imageType) {
			const formData = new FormData();
			formData.append('image', file);
			formData.append('type', imageType);
			
			const response = await fetch('/api/upload/image', {
				method: 'POST',
				body: formData
			});
			
			if (!response.ok) {
				throw new Error(`Upload failed: ${response.status}`);
			}
			
			return await response.json(); // { url, size }
		} 

		async function compressImageIfNeeded(base64, maxSizeKB) {
			const currentSizeKB = Math.round(base64.length / 1024);
			
			if (currentSizeKB <= maxSizeKB) {
				return base64;
			}
			
			try {
				const img = new Image();
				await new Promise((resolve, reject) => {
					img.onload = resolve;
					img.onerror = reject;
					img.src = base64;
				});
				
				const canvas = document.createElement('canvas');
				const ctx = canvas.getContext('2d');
				
				// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
				const maxDimension = Environment.isLocalPC ? 1000 : 1500;
				let { width, height } = img;
				
				if (width > height && width > maxDimension) {
					height = (height * maxDimension) / width;
					width = maxDimension;
				} else if (height > maxDimension) {
					width = (width * maxDimension) / height;
					height = maxDimension;
				}
				
				canvas.width = width;
				canvas.height = height;
				ctx.drawImage(img, 0, 0, width, height);
				
				// ‡∏õ‡∏£‡∏±‡∏ö quality ‡∏ï‡∏≤‡∏° environment
				let quality = Environment.isLocalPC ? 0.7 : 0.8;
				let compressed;
				
				do {
					compressed = canvas.toDataURL('image/jpeg', quality);
					const compressedSizeKB = Math.round(compressed.length / 1024);
					
					if (compressedSizeKB <= maxSizeKB || quality <= 0.1) {
						break;
					}
					quality -= 0.1;
				} while (quality > 0.1);
				
				console.log(`üóúÔ∏è ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î (${Environment.getType()}): ${currentSizeKB}KB ‚Üí ${Math.round(compressed.length / 1024)}KB`);
				return compressed;
				
			} catch (error) {
				console.error('Compression error:', error);
				return base64;
			}
		}

		// 9. ‚úÖ Universal Google Sheets Integration
		async function saveMapToSheets(mapData) {
			if (!sheetsConfig.url || !sheetsConfig.connected) {
				console.log(`üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (${Environment.getType()})`);
				
				if (Environment.isLocalPC) {
					localStorage.setItem('currentMap', JSON.stringify(mapData));
				} else {
					localStorage.setItem('currentMap', JSON.stringify(mapData));
					await saveToServerIfAvailable(mapData);
				}
				
				return { success: true, method: 'local' };
			}
			
			try {
				console.log('üíæ Saving to Google Sheets...');
				
				// üÜï ‡πÉ‡∏ä‡πâ addMapImages ‡πÅ‡∏ó‡∏ô saveMap ‡∏ï‡∏≤‡∏° Apps Script
				const params = new URLSearchParams();
				params.append('action', 'addMapImages');  // ‚Üê ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å 'saveMap'
				params.append('id', mapData.id || 'main_map');
				params.append('floorplan', mapData.floorplan || '');
				params.append('realphoto', mapData.realphoto || '');
				params.append('notes', mapData.notes || '');
				params.append('environment', Environment.getType());
				
				console.log('üì§ Request data:', {
					action: 'addMapImages',
					id: mapData.id || 'main_map',
					hasFloorplan: !!mapData.floorplan,
					hasRealphoto: !!mapData.realphoto,
					floorplanSize: mapData.floorplan ? `${Math.round(mapData.floorplan.length / 1024)}KB` : 'None',
					realphotoSize: mapData.realphoto ? `${Math.round(mapData.realphoto.length / 1024)}KB` : 'None'
				});
				
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});
				
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				
				const result = await response.json();
				console.log('üì® Sheets response:', result);
				
				if (result.success) {
					showNotification('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
					
					// ‡πÄ‡∏Å‡πá‡∏ö backup local ‡∏î‡πâ‡∏ß‡∏¢
					localStorage.setItem('currentMap', JSON.stringify(mapData));
					
					return { success: true, method: 'sheets' };
				} else {
					throw new Error(result.error || 'Unknown sheets error');
				}
				
			} catch (error) {
				console.error('‚ùå Sheets save error:', error);
				
				// Universal fallback - ‡πÄ‡∏Å‡πá‡∏ö local ‡πÄ‡∏™‡∏°‡∏≠
				if (Environment.isLocalPC) {
					localStorage.setItem('currentMap', JSON.stringify(mapData));
				} else {
					localStorage.setItem('currentMap', JSON.stringify(mapData));
					await saveToServerIfAvailable(mapData);
				}
				
				showNotification(`‚ö†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ó‡∏ô: ${error.message}`, 'warning');
				return { success: true, method: 'local' };
			}
		}

		async function saveToServerIfAvailable(mapData) {
			try {
				const response = await fetch('/api/maps/save', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(mapData)
				});
				
				if (response.ok) {
					console.log('‚úÖ Backup saved to server');
				}
			} catch {
				console.log('üìù Server backup not available');
			}
		}

		// 10. ‚úÖ Universal Initialization 
		document.addEventListener('DOMContentLoaded', function() {
			console.log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Universal...');
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ environment
			Environment.init();
			
			// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Image Inputs
			setupImageInput('floorplanFileInput', 'floorplan');
			setupImageInput('realphotoFileInput', 'realphoto');
			
			// ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets ‡∏à‡∏≤‡∏Å localStorage
			loadSheetsConfigFromStorage();
			
			// ‚≠ê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
			setTimeout(() => {
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
				initializeConnections().then(() => {
					// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
					loadMapsTable();
				});
			}, 1500); // ‡∏£‡∏≠ 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°
	 
		});

		function setupImageInput(inputId, imageType) {
			const input = document.getElementById(inputId);
			if (input) {
				input.addEventListener('change', async (e) => {
					const file = e.target.files[0];
					if (file) {
						await handleImageFile(file, imageType);
					}
				});
			}
		}

		// ‚úÖ 6. ‡πÄ‡∏û‡∏¥‡πà‡∏° Safety Check ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö loadSavedImages
		function loadSavedImages() {
			console.log('üîÑ Loading saved images with enhanced validation...');
			
			// ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞ validate floorplan
			const floorplan = sessionStorage.getItem('temp_floorplan');
			if (floorplan) {
				const validationResult = isValidImageData(floorplan);
				
				if (validationResult === true) {
					updateImagePreview('floorplanPreview', floorplan, 'floorplan');
					sessionStorage.setItem('floorplan_uploaded', 'true');
					console.log('‚úÖ Floorplan loaded and validated');
				} else if (validationResult === 'sheets_flag') {
					console.log('üìã Floorplan marked for Google Sheets loading');
					// ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Google Sheets
				} else {
					console.warn('‚ö†Ô∏è Invalid floorplan data found, cleaning up');
					cleanupCorruptedImageData('floorplan');
					resetImagePreview('floorplanPreview', 'floorplan');
				}
			} else {
				resetImagePreview('floorplanPreview', 'floorplan');
			}
			
			// ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞ validate realphoto
			const realphoto = sessionStorage.getItem('temp_realphoto');
			if (realphoto) {
				const validationResult = isValidImageData(realphoto);
				
				if (validationResult === true) {
					updateImagePreview('realphotoPreview', realphoto, 'realphoto');
					sessionStorage.setItem('realphoto_uploaded', 'true');
					console.log('‚úÖ Real photo loaded and validated');
				} else if (validationResult === 'sheets_flag') {
					console.log('üìã Realphoto marked for Google Sheets loading');
					// ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Google Sheets
				} else {
					console.warn('‚ö†Ô∏è Invalid realphoto data found, cleaning up');
					cleanupCorruptedImageData('realphoto');
					resetImagePreview('realphotoPreview', 'realphoto');
				}
			} else {
				resetImagePreview('realphotoPreview', 'realphoto');
			}
		}
		
		// ‚úÖ 7. ‡πÄ‡∏û‡∏¥‡πà‡∏° Emergency Recovery Function
		function recoverFromImageErrors() {
			console.log('üö® Attempting emergency recovery from image errors...');
			
			// ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
			cleanupCorruptedImageData('floorplan');
			cleanupCorruptedImageData('realphoto');
			
			// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï previews
			resetImagePreview('floorplanPreview', 'floorplan');
			resetImagePreview('realphotoPreview', 'realphoto');
			
			// ‡∏•‡πâ‡∏≤‡∏á file inputs
			const inputs = ['floorplanFileInput', 'realphotoFileInput'];
			inputs.forEach(id => {
				const input = document.getElementById(id);
				if (input) input.value = '';
			});
			
			showNotification('üîÑ ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà', 'info');
		}
		
		// ‚úÖ 8. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô window.onerror ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏ö JavaScript errors
		window.addEventListener('error', function(event) {
			const errorMsg = event.message || '';
			const source = event.filename || '';
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö error ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
			if (errorMsg.includes('ERR_INVALID_URL') || 
				errorMsg.includes('Failed to load') ||
				source.includes('data:image/')) {
				
				console.error('üö® Image-related error detected:', errorMsg);
				
				// ‡∏•‡∏≠‡∏á recovery ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
				setTimeout(() => {
					recoverFromImageErrors();
				}, 1000);
			}
		});
		
		// ‚úÖ 5. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á isValidImageData Function
		function isValidImageData(data) {
			if (!data || typeof data !== 'string') return false;
			
			const trimmedData = data.trim();
			if (trimmedData === '') return false;
			
			// ‚ö†Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö "available" flag
			if (trimmedData.toLowerCase() === 'available') {
				console.log('üìã Found "available" flag - will attempt to load from sheets');
				return 'sheets_flag'; // ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ß‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets
			}
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö invalid values ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
			const invalidValues = ['none', 'null', 'undefined', 'error', '[]', '{}'];
			if (invalidValues.includes(trimmedData.toLowerCase())) {
				return false;
			}
			
			// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Base64 - ‡πÉ‡∏ä‡πâ validateBase64Data
			if (trimmedData.startsWith('data:image/')) {
				const validation = validateBase64Data(trimmedData);
				return validation.valid;
			}
			
			// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HTTP URLs
			if (trimmedData.startsWith('http://') || trimmedData.startsWith('https://')) {
				return true;
			}
			
			// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö relative paths (web server ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
			if (Environment.isWebServer && (
				trimmedData.startsWith('./') || 
				trimmedData.startsWith('../') || 
				trimmedData.match(/\.(jpg|jpeg|png|gif|webp)$/i)
			)) {
				return true;
			}
			
			return false;
		}
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 3: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô handlePendingImages() ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ "available"
		async function handlePendingImages() {
			console.log('üîÑ Checking for pending images from Google Sheets...');
			
			try {
				if (!sheetsConfig.url) {
					console.log('‚ùå No Google Sheets URL configured');
					return;
				}

				// ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å Google Sheets
				const params = new URLSearchParams();
				params.append('action', 'getMapImages');
				params.append('mapId', 'main_map');

				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});

				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}

				const result = await response.json();
				console.log('üñºÔ∏è Map images response:', result);

				if (result.success && result.data) {
					const mapData = result.data;
					
					// ‡πÇ‡∏´‡∏•‡∏î floorplan ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô "available"
					if (mapData.floorplan && mapData.floorplan !== 'available') {
						console.log('üìê Loading floorplan from sheets...');
						updateImagePreview('floorplanPreview', mapData.floorplan, 'floorplan'); 
					}
					
					// ‡πÇ‡∏´‡∏•‡∏î realphoto ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô "available"
					if (mapData.realphoto && mapData.realphoto !== 'available') {
						console.log('üì∑ Loading realphoto from sheets...');
						updateImagePreview('realphotoPreview', mapData.realphoto, 'realphoto'); 
					}

					showNotification('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
					 // üÜï ‡πÄ‡∏û‡∏¥‡πà‡∏° badge ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß  
					setTimeout(() => {
						addLoadedFromSheetsBadge(); // üîß ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
					}, 500);
				}

			} catch (error) {
				console.error('‚ùå Failed to load pending images:', error);
				// ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á notification error ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
			}
		}

		// 3. ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô initializeConnections ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
		async function initializeConnections() {
			try {
				console.log('üîó Initializing connections...');
				
				// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÄ‡∏™‡∏°‡∏≠
				let sheetsOk = false;
				if (sheetsConfig.url) {
					sheetsOk = await testSheetsConnection();
				}
				
				// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Server APIs ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Web Server
				let serverOk = false;
				if (!Environment.isLocalPC) {
					serverOk = await testServerAPIs();
				} else {
					console.log('üè† Local PC - skipping server API test');
				}
				
				console.log('üîó Connection results:', { sheetsOk, serverOk, environment: Environment.getType() });
				
				return sheetsOk || serverOk; // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ñ‡πâ‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏∞‡∏ö‡∏ö
				
			} catch (error) {
				console.warn('‚ö†Ô∏è Some connections failed:', error);
				return false;
			}
		}
		
		// 4. ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
		async function forceRefreshMaps() { 
		
		// ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÉ‡∏ô session
		sessionStorage.removeItem('temp_floorplan');
		sessionStorage.removeItem('temp_realphoto');
		sessionStorage.removeItem('floorplan_uploaded');
		sessionStorage.removeItem('realphoto_uploaded');
		
		// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï preview
		resetImagePreview('floorplanPreview', 'floorplan');
		resetImagePreview('realphotoPreview', 'realphoto');
		
		// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å Google Sheets (‡∏£‡∏ß‡∏° pending images)
		setTimeout(async () => {
			await loadExistingMaps();
			await handlePendingImages(); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î pending images
		}, 500);
		
		showNotification('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...', 'info');
	}

		
		
		// 7. ‚úÖ Updated Universal Initialization
		document.addEventListener('DOMContentLoaded', function() {
			console.log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Universal...');
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ environment
			Environment.init();
			
			// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Image Inputs
			setupImageInput('floorplanFileInput', 'floorplan');
			setupImageInput('realphotoFileInput', 'realphoto');
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ï‡πà‡∏≤‡∏á‡πÜ
			initializeConnections();
			
			// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö maps
			initializeUniversalMaps();
			
			console.log(`‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö Universal ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (${Environment.getType()})`);
		});

		// 8. ‚úÖ Connection testing with proper error handling
		async function testSheetsConnection() {
			if (!sheetsConfig.url) {
				console.log(`üìù ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Local ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (${Environment.getType()})`);
				return;
			}
			
			try {
				console.log('üîó Testing Google Sheets connection...');
				
				const params = new URLSearchParams();
				params.append('action', 'getMapImages'); // ‡πÉ‡∏ä‡πâ action ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
				params.append('environment', Environment.getType());
				
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});
				
				if (response.ok) {
					const result = await response.json();
					if (result.success !== false) { // ‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á success: true ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ success field
						sheetsConfig.connected = true;
						console.log(`‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${Environment.getType()})`);
						return true;
					}
				}
				
				throw new Error(`Connection test failed: ${response.status}`);
				
			} catch (error) {
				sheetsConfig.connected = false;
				console.log(`üìù ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Local ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (${Environment.getType()}): ${error.message}`);
				return false;
			}
		}
		
		// 9. ‚úÖ Manual refresh function
		async function refreshMapsFromSheets() {
			showNotification('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...', 'info');
			
			// ‡∏•‡πâ‡∏≤‡∏á session storage
			sessionStorage.removeItem('temp_floorplan');
			sessionStorage.removeItem('temp_realphoto');
			sessionStorage.removeItem('floorplan_uploaded');
			sessionStorage.removeItem('realphoto_uploaded');
			
			// ‡∏•‡πâ‡∏≤‡∏á previews
			const floorplanPreview = document.getElementById('floorplanPreview');
			const realphotoPreview = document.getElementById('realphotoPreview');
			if (floorplanPreview) floorplanPreview.innerHTML = '';
			if (realphotoPreview) realphotoPreview.innerHTML = '';
			
			// ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
			await loadExistingMaps();
			
			showNotification('‚úÖ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
		}		

		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 1: ‡∏õ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô testServerAPIs() ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Environment
		async function testServerAPIs() {
			try {
				// ‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Environment ‡∏Å‡πà‡∏≠‡∏ô - ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á CORS ‡∏ö‡∏ô Local PC
				if (Environment.isLocalPC) {
					console.log('üè† Local PC detected - skipping server API test');
					Environment.serverAPIs = false;
					return false;
				}

				// ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Web Server ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö APIs
				const response = await fetch('/api/status', {
					method: 'GET',
					headers: { 'Accept': 'application/json' }
				});
				
				if (response.ok) {
					console.log('‚úÖ Server APIs available');
					Environment.serverAPIs = true;
					return true;
				} else {
					throw new Error(`Server returned ${response.status}`);
				}
			} catch (error) {
				console.log(`üìü Server APIs not available: ${error.message}`);
				Environment.serverAPIs = false;
				return false;
			}
		}

		// 5. ‚úÖ Universal saveMapImages - ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°
		async function saveMapImages() {
			try {
				console.log('üíæ Starting universal saveMapImages...');
				showNotification('üíæ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà...', 'info');
				
				const floorplan = sessionStorage.getItem('temp_floorplan');
				const realphoto = sessionStorage.getItem('temp_realphoto');
				const notes = document.getElementById('mapNotes')?.value || '';
				
				if (!floorplan && !realphoto) {
					showNotification('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'warning');
					return;
				}
				
				const mapData = {
					id: 'main_map', // ‡πÉ‡∏ä‡πâ fixed ID
					floorplan: floorplan || '',
					realphoto: realphoto || '',
					notes: notes,
					timestamp: new Date().toISOString(),
					environment: Environment.getType(),
					method: Environment.storageMethod
				};
				
				console.log('üìã Saving map data:', {
					hasFloorplan: !!mapData.floorplan,
					hasRealphoto: !!mapData.realphoto,
					floorplanSize: mapData.floorplan ? `${Math.round(mapData.floorplan.length / 1024)}KB` : 'None',
					realphotoSize: mapData.realphoto ? `${Math.round(mapData.realphoto.length / 1024)}KB` : 'None',
					environment: mapData.environment
				});
				
				const result = await saveMapToSheets(mapData);
				
				if (result.success) {
					const methodText = result.method === 'sheets' ? 'Google Sheets' : 
									  result.method === 'server' ? 'Server' : '‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á';
					showNotification(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${methodText}) - ${Environment.getType()}`, 'success');
					
					// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
					if (typeof updateMapFormsAfterSave === 'function') {
						updateMapFormsAfterSave();
					}
				}
				
			} catch (error) {
				console.error('‚ùå Save error:', error);
				showNotification(`‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
			}
		}		 
		 
		 // 6. ‚úÖ Auto-load ‡πÉ‡∏ô initialization
		function initializeUniversalMaps() {
			console.log('üó∫Ô∏è Initializing universal maps system...');
			
			// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å loadExistingMaps ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å environment setup
			setTimeout(async () => {
				await loadExistingMaps();
			}, 1000);
		}			 

		// =================== Interactive Map Picker JavaScript ===================
	
		// Global variables for room map picker
		let roomMapPicker = {
			currentX: 0,
			currentY: 0,
			zoomLevel: 1,
			gridVisible: false,
			mapContainer: null,
			marker: null,
			isDragging: false,
			hasFloorplan: false,
			buildingCode: ''
		};

		// =================== Core Map Picker Functions ===================

		 function initializeRoomMapPicker() {
			console.log('üó∫Ô∏è Initializing Room Map Picker...');
			
			roomMapPicker.mapContainer = document.getElementById('roomMapContainer');
			roomMapPicker.marker = document.getElementById('roomPositionMarker');
			
			if (roomMapPicker.mapContainer) {
				setupRoomMapEventListeners();
				updateRoomCoordinateDisplay();
				console.log('‚úÖ Room Map Picker initialized');
				return true;
			} else {
				console.warn('‚ö†Ô∏è Room Map Container not found');
				return false;
			}
		}

		function setupRoomMapEventListeners() {
			const container = roomMapPicker.mapContainer;
			if (!container) return;

			// Remove existing listeners to prevent duplicates
			container.removeEventListener('click', selectRoomPosition);
			container.removeEventListener('mousemove', showRoomPreviewPosition);
			container.removeEventListener('mouseleave', hideRoomPreviewPosition);

			// Add new listeners
			container.addEventListener('click', selectRoomPosition);
			container.addEventListener('mousemove', showRoomPreviewPosition);
			container.addEventListener('mouseleave', hideRoomPreviewPosition);

			// Touch events for mobile
			container.addEventListener('touchstart', handleRoomTouchStart, { passive: false });
			container.addEventListener('touchmove', handleRoomTouchMove, { passive: false });
			container.addEventListener('touchend', handleRoomTouchEnd, { passive: false });

			// Prevent context menu
			container.addEventListener('contextmenu', (e) => e.preventDefault());
		}

		function selectRoomPosition(event) {
			event.preventDefault();
			event.stopPropagation();
			
			const rect = roomMapPicker.mapContainer.getBoundingClientRect();
			const x = ((event.clientX - rect.left) / rect.width) * 100;
			const y = ((event.clientY - rect.top) / rect.height) * 100;
			
			setRoomPosition(x, y);
			animateRoomMarkerSelection();
			
			console.log(`üìç Room position selected: X=${x.toFixed(1)}, Y=${y.toFixed(1)}`);
		}

		function setRoomPosition(x, y) {
			// Constrain to map bounds
			roomMapPicker.currentX = Math.max(0, Math.min(100, x));
			roomMapPicker.currentY = Math.max(0, Math.min(100, y));
			
			// Update marker position
			updateRoomMarkerPosition();
			
			// Update form inputs
			updateRoomInputValues();
			
			// Update displays
			updateRoomCoordinateDisplay();
			
			// Show marker
			if (roomMapPicker.marker) {
				roomMapPicker.marker.style.display = 'block';
			}
		}

		function updateRoomMarkerPosition() {
			if (!roomMapPicker.marker || !roomMapPicker.mapContainer) return;
			
			roomMapPicker.marker.style.left = roomMapPicker.currentX + '%';
			roomMapPicker.marker.style.top = roomMapPicker.currentY + '%';
		}

		function updateRoomInputValues() {
			const xInput = document.getElementById('roomX');
			const yInput = document.getElementById('roomY');
			
			if (xInput) xInput.value = roomMapPicker.currentX.toFixed(1);
			if (yInput) yInput.value = roomMapPicker.currentY.toFixed(1);
		}

		function updateRoomCoordinateDisplay() {
			const display = document.getElementById('roomCoordinateDisplay');
			if (display) {
				display.textContent = `X: ${roomMapPicker.currentX.toFixed(1)}, Y: ${roomMapPicker.currentY.toFixed(1)}`;
			}
		}

		function updateRoomMarkerFromInput() {
			const xInput = document.getElementById('roomX');
			const yInput = document.getElementById('roomY');
			
			if (xInput && yInput) {
				const x = parseFloat(xInput.value) || 0;
				const y = parseFloat(yInput.value) || 0;
				
				if (x > 0 || y > 0) {
					setRoomPosition(x, y);
				} else {
					clearRoomPosition();
				}
			}
		}

		function clearRoomPosition() {
			roomMapPicker.currentX = 0;
			roomMapPicker.currentY = 0;
			
			// Hide marker
			if (roomMapPicker.marker) {
				roomMapPicker.marker.style.display = 'none';
			}
			
			// Update displays
			updateRoomCoordinateDisplay();
			
			console.log('üßπ Room position cleared');
		}

		// =================== Map Tools Functions ===================

		function animateRoomMarkerSelection() {
			if (!roomMapPicker.marker) return;
			
			// Add selection animation
			roomMapPicker.marker.style.animation = 'none';
			setTimeout(() => {
				roomMapPicker.marker.style.animation = 'markerPulse 2s infinite';
			}, 10);
		}

		// =================== Touch Event Handlers ===================

		function handleRoomTouchStart(event) {
			event.preventDefault();
			roomMapPicker.isDragging = true;
		}

		function handleRoomTouchMove(event) {
			if (!roomMapPicker.isDragging) return;
			event.preventDefault();
			
			const touch = event.touches[0];
			const rect = roomMapPicker.mapContainer.getBoundingClientRect();
			const x = ((touch.clientX - rect.left) / rect.width) * 100;
			const y = ((touch.clientY - rect.top) / rect.height) * 100;
			
			setRoomPosition(x, y);
		}

		function handleRoomTouchEnd(event) {
			event.preventDefault();
			roomMapPicker.isDragging = false;
			animateRoomMarkerSelection();
		}

		function showRoomPreviewPosition(event) {
			// Optional: Show preview marker on hover
		}

		function hideRoomPreviewPosition(event) {
			// Optional: Hide preview marker
		}
		
		
		// =================== Enhanced Integration (NO OVERRIDE) ===================

		// ‚úÖ FIX: ‡πÉ‡∏ä‡πâ MutationObserver ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ override function
		function setupRoomMapPickerIntegration() {
			console.log('üîß Setting up Room Map Picker integration...');
			
			// Monitor for room modal opening
			const observer = new MutationObserver(function(mutations) {
				mutations.forEach(function(mutation) {
					if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
						const modal = document.getElementById('roomModal');
						if (modal && modal.style.display === 'block') {
							// Modal opened - initialize map picker
							setTimeout(() => {
								if (initializeRoomMapPicker()) {
									loadExistingRoomPosition();
								}
							}, 200);
						}
					}
				});
			});
			
			// Start observing room modal
			const roomModal = document.getElementById('roomModal');
			if (roomModal) {
				observer.observe(roomModal, { 
					attributes: true, 
					attributeFilter: ['style'] 
				});
				console.log('‚úÖ Room modal observer active');
			}
		}

		function loadExistingRoomPosition() {
			try {
				// Check if we're in edit mode
				if (isEditMode && editingItemId && roomsData[editingItemId]) {
					const room = roomsData[editingItemId];
					if (room.x && room.y) {
						console.log(`üìç Loading existing position: X=${room.x}, Y=${room.y}`);
						setRoomPosition(parseFloat(room.x), parseFloat(room.y));
					}
					
					// Update building display
					if (room.building) {
						updateRoomMapBuilding(room.building);
					}
				}
			} catch (error) {
				console.warn('‚ö†Ô∏è Could not load existing room position:', error);
			}
		}

		// =================== Enhanced saveRoomForm Integration ===================

		// Store original saveRoomForm reference safely
		let originalSaveRoomFormRef = null;

		function initializeSaveRoomFormIntegration() {
			// Get reference to original function without overriding
			if (typeof saveRoomForm === 'function' && !originalSaveRoomFormRef) {
				originalSaveRoomFormRef = saveRoomForm;
				
				// Replace the function safely
				window.saveRoomForm = function(event) {
					event.preventDefault();
					
					try {
						const formData = {
							code: document.getElementById('roomCode').value.trim(),
							name: document.getElementById('roomName').value.trim(),
							building: document.getElementById('roomBuilding').value,
							floor: parseInt(document.getElementById('roomFloor').value),
							type: document.getElementById('roomType').value,
							status: document.getElementById('roomStatus').value,
							// ‚úÖ ADD: Map picker coordinates
							x: roomMapPicker.currentX > 0 ? roomMapPicker.currentX : null,
							y: roomMapPicker.currentY > 0 ? roomMapPicker.currentY : null,
							description: document.getElementById('roomDescription').value.trim(),
							images: typeof collectImageUrls === 'function' ? collectImageUrls() : []
						};
						
						console.log('üíæ Saving room with map coordinates:', {x: formData.x, y: formData.y});
						
						if (isEditMode && editingItemId) {
							updateRoom(editingItemId, formData);
						} else {
							createRoom(formData);
						}
						
						closeRoomModal();
						
					} catch (error) {
						console.error('‚ùå Save room form error:', error);
						showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ', 'error');
					}
				};
				
				console.log('‚úÖ saveRoomForm integration complete');
			}
		}

		// =================== Integration with Room Modal ===================

		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç openRoomModal() ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î image_urls ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
		function openRoomModal(code = null) {
			const modal = document.getElementById('roomModal');
			const title = document.getElementById('roomModalTitle');
			const form = document.getElementById('roomForm');
			
			// Reset form
			form.reset();
			
			// Populate building dropdown
			populateBuildingDropdown();
			
			// Reset image container
			resetImageUrlContainer();
			
			if (code) {
				// Edit mode
				isEditMode = true;
				editingItemId = code;
				title.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡πâ‡∏≠‡∏á';
				
				const room = roomsData[code];
				if (room) {
					document.getElementById('roomCode').value = room.code;
					document.getElementById('roomName').value = room.name;
					document.getElementById('roomBuilding').value = room.building;
					document.getElementById('roomFloor').value = room.floor || 1;
					document.getElementById('roomType').value = room.type || '‡∏´‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
					document.getElementById('roomStatus').value = room.status || 'active';
					document.getElementById('roomX').value = room.x || '';
					document.getElementById('roomY').value = room.y || '';
					document.getElementById('roomDescription').value = room.description || '';
					
					// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÇ‡∏´‡∏•‡∏î image URLs - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á images ‡πÅ‡∏•‡∏∞ image_urls
					const imageData = room.image_urls || room.images || [];
					console.log(`üìã Room ${code} image data:`, imageData);
					
					setTimeout(() => {
						loadExistingImages(imageData);
					}, 100);
					
					// Disable code editing in edit mode
					document.getElementById('roomCode').readOnly = true;
				}
			} else {
				// Add mode
				isEditMode = false;
				editingItemId = null;
				title.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
				
				// Enable code editing in add mode
				document.getElementById('roomCode').readOnly = false;
				
				// Auto-generate code
				document.getElementById('roomCode').value = generateRoomCode();
			}
			
			modal.style.display = 'block';
			document.body.style.overflow = 'hidden';
		}

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï saveRoomForm function ‡πÉ‡∏´‡πâ‡∏£‡∏ß‡∏° coordinates ‡∏à‡∏≤‡∏Å map picker
		function saveRoomFormWithMap(event) {
			event.preventDefault();
			
			try {
				const formData = {
					code: document.getElementById('roomCode').value.trim(),
					name: document.getElementById('roomName').value.trim(),
					building: document.getElementById('roomBuilding').value,
					floor: parseInt(document.getElementById('roomFloor').value),
					type: document.getElementById('roomType').value,
					status: document.getElementById('roomStatus').value,
					x: roomMapPicker.currentX > 0 ? roomMapPicker.currentX : null,
					y: roomMapPicker.currentY > 0 ? roomMapPicker.currentY : null,
					description: document.getElementById('roomDescription').value.trim(),
					images: collectImageUrls()
				};
				
				if (isEditMode && editingItemId) {
					updateRoom(editingItemId, formData);
				} else {
					createRoom(formData);
				}
				
				closeRoomModal();
				
			} catch (error) {
				console.error('Save room form with map error:', error);
			}
		}

		// 2. Fix updateRoomMapBuilding function (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
		function updateRoomMapBuilding(buildingCode) {
			const buildingName = document.getElementById('currentBuildingName');
			if (buildingName && buildingsData && buildingsData[buildingCode]) {
				buildingName.textContent = buildingsData[buildingCode].name;
			}
			
			// Store building code for map picker
			roomMapPicker.buildingCode = buildingCode;
			
			console.log(`üè¢ Building updated: ${buildingsData[buildingCode]?.name || buildingCode}`);
		}

		// 3. Fix openRoomModal integration (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
		let originalOpenRoomModal = null;

		function enhanceOpenRoomModal() {
			// Store original function reference
			if (typeof openRoomModal === 'function' && !originalOpenRoomModal) {
				originalOpenRoomModal = openRoomModal;
				
				// Replace with enhanced version
				window.openRoomModal = function(code = null) {
					console.log(`üö™ Opening room modal: ${code || 'new'}`);
					
					// Call original function
					if (originalOpenRoomModal) {
						originalOpenRoomModal.call(this, code);
					}
					
					// Initialize map system after modal opens
					setTimeout(() => {
						try {
							// Initialize room map picker
							if (initializeRoomMapPicker()) {
								console.log('‚úÖ Room map picker initialized');
								
								// Initialize image upload system
								initializeMapImageSystem();
								
								// Load existing position if editing
								if (code && roomsData[code]) {
									const room = roomsData[code];
									
									// Load position
									if (room.x && room.y) {
										setRoomPosition(parseFloat(room.x), parseFloat(room.y));
									}
									
									// Load building floorplan
									if (room.building) {
										loadBuildingFloorplan(room.building);
									}
								}
							}
						} catch (error) {
							console.error('‚ùå Room modal enhancement error:', error);
						}
					}, 300);
				};
				
				console.log('‚úÖ openRoomModal enhanced');
			}
		}

		// 4. Fix saveRoomForm integration (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
		let originalSaveRoomForm = null;

		function enhanceSaveRoomForm() {
			// Store original function reference
			if (typeof saveRoomForm === 'function' && !originalSaveRoomForm) {
				originalSaveRoomForm = saveRoomForm;
				
				// Replace with enhanced version
				window.saveRoomForm = function(event) {
					event.preventDefault();
					
					try {
						const formData = {
							code: document.getElementById('roomCode').value.trim(),
							name: document.getElementById('roomName').value.trim(),
							building: document.getElementById('roomBuilding').value,
							floor: parseInt(document.getElementById('roomFloor').value),
							type: document.getElementById('roomType').value,
							status: document.getElementById('roomStatus').value,
							// Add map coordinates
							x: roomMapPicker.currentX > 0 ? roomMapPicker.currentX : null,
							y: roomMapPicker.currentY > 0 ? roomMapPicker.currentY : null,
							description: document.getElementById('roomDescription').value.trim(),
							images: typeof collectImageUrls === 'function' ? collectImageUrls() : []
						};
						
						console.log('üíæ Saving room with map coordinates:', {
							x: formData.x, 
							y: formData.y,
							building: formData.building
						});
						
						if (isEditMode && editingItemId) {
							updateRoom(editingItemId, formData);
						} else {
							createRoom(formData);
						}
						
						closeRoomModal();
						
					} catch (error) {
						console.error('‚ùå Enhanced save room form error:', error);
						showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ', 'error');
					}
				};
				
				console.log('‚úÖ saveRoomForm enhanced');
			}
		}

		// 5. Fix building dropdown integration
		function enhanceBuildingDropdown() {
			// Remove existing listener to prevent duplicates
			document.removeEventListener('change', handleBuildingChange);
			
			// Add new enhanced listener
			document.addEventListener('change', handleBuildingChange);
			
			console.log('‚úÖ Building dropdown enhanced');
		}

		function handleBuildingChange(e) {
			if (e.target && e.target.id === 'roomBuilding') {
				const buildingCode = e.target.value;
				console.log(`üè¢ Building selected: ${buildingCode}`);
				
				if (buildingCode) {
					updateRoomMapBuilding(buildingCode);
					loadBuildingFloorplan(buildingCode);
				} else {
					showPlaceholderMap();
				}
			}
		}

		// 6. Complete initialization function
		function initializeEnhancedMapPicker() {
			console.log('üó∫Ô∏è Initializing Enhanced Map Picker...');
			
			try {
				// Enhance existing functions
				enhanceOpenRoomModal();
				enhanceSaveRoomForm();
				enhanceBuildingDropdown();
				
				console.log('‚úÖ Enhanced Map Picker initialized successfully');
				return true;
			} catch (error) {
				console.error('‚ùå Enhanced Map Picker initialization failed:', error);
				return false;
			}
		}

		// 7. Auto-initialize when admin panel is ready
		function initializeMapPickerWhenReady() {
			// Wait for admin panel to be fully loaded
			if (typeof isLoggedIn !== 'undefined' && isLoggedIn) {
				initializeEnhancedMapPicker();
			} else {
				// Retry after 1 second
				setTimeout(initializeMapPickerWhenReady, 1000);
			}
		}

		// 8. Start initialization process
		document.addEventListener('DOMContentLoaded', function() {
			setTimeout(() => {
				console.log('üéØ Starting Enhanced Map Picker initialization...');
				initializeMapPickerWhenReady();
			}, 2000);
		});

		// 9. Backup initialization for late loading
		window.addEventListener('load', function() {
			setTimeout(() => {
				if (typeof initializeEnhancedMapPicker === 'function') {
					initializeEnhancedMapPicker();
					console.log('üîÑ Backup Enhanced Map Picker initialization complete');
				}
			}, 3000);
		});
		// =================== INTEGRATION FIXES ===================

		// 1. Fix loadBuildingFloorplan function (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
		function loadBuildingFloorplan(buildingCode) {
			console.log(`üè¢ Loading floorplan for building: ${buildingCode}`);
			
			if (!buildingCode) {
				showPlaceholderMap();
				return;
			}
			
			// Update building info first
			updateRoomMapBuilding(buildingCode);
			
			// Load from Google Sheets
			loadFloorplanFromSheets(buildingCode);
		}

		// Initialize when modal opens
		function initializeMapImageSystem() {
			try {
				initializeImageUpload();
				console.log('‚úÖ Map Image System initialized');
			} catch (error) {
				console.error('‚ùå Map Image System initialization error:', error);
			}
		}
		
		// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 8: ‡∏õ‡∏£‡∏±‡∏ö enhanceRoomModalIntegration() ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å initial load
		function enhanceRoomModalIntegration() {
			const originalOpenRoomModal = window.openRoomModal;
			
			window.openRoomModal = function(code = null) {
				// Call original function
				if (originalOpenRoomModal) {
					originalOpenRoomModal.call(this, code);
				} else {
					// ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
					openRoomModal(code);
				}
				
				// Initialize map system after modal opens
				setTimeout(() => {
					initializeMapImageSystem();
					
					// üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å initial load ‡πÄ‡∏™‡∏°‡∏≠ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£
					if (code && roomsData[code] && roomsData[code].building) {
						const buildingCode = roomsData[code].building;
						console.log(`üè¢ Opening room modal for building: ${buildingCode}`);
						
						// ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å session/localStorage)
						loadFloorplanFromSheets(buildingCode);
						
						// ‡πÇ‡∏´‡∏•‡∏î room images
						loadRoomImageUrls(code);
					} else {
						// ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö add mode - ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
						loadFloorplanFromSheets('general');
					}
				}, 200);
			};
			
			console.log('‚úÖ Enhanced room modal integration with initial maps');
		}

		// Auto-initialize when document ready
		document.addEventListener('DOMContentLoaded', function() {
			setTimeout(() => {
				enhanceRoomModalIntegration();
				console.log('üó∫Ô∏è Enhanced Map Picker with Google Sheets & Upload ready');
			}, 1000);
		});
		
		// =================== Event Listeners ===================

		// Building dropdown change handler
		document.addEventListener('change', function(e) {
			if (e.target && e.target.id === 'roomBuilding') {
				const buildingCode = e.target.value;
				updateRoomMapBuilding(buildingCode);
				loadBuildingFloorplan(buildingCode);
			}
		});
		
		// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î Maps ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÅ‡∏ó‡πá‡∏ö Maps
		function enhanceNavigationWithMaps() {
			// ‡πÄ‡∏Å‡πá‡∏ö reference ‡∏Ç‡∏≠‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô showSection ‡πÄ‡∏î‡∏¥‡∏°
			const originalShowSection = window.showSection;
			
			// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô showSection ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏° Maps loading
			window.showSection = function(sectionId) {
				// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°
				if (originalShowSection) {
					originalShowSection.call(this, sectionId);
				}
				
				// ‡πÇ‡∏´‡∏•‡∏î Maps ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ó‡πá‡∏ö Maps
				if (sectionId === 'maps') {
					setTimeout(() => {
						console.log('üó∫Ô∏è Loading Maps for Maps section...');
						initializeMapsModule();
					}, 500);
				}
			};
		}
		// Update the building dropdown change handler
		document.addEventListener('change', function(e) {
			if (e.target && e.target.id === 'roomBuilding') {
				const buildingCode = e.target.value;
				updateRoomMapBuilding(buildingCode);
				loadBuildingFloorplan(buildingCode);
			}
		});



		// =================== Utility Functions ===================

		//function getRoomMapPickerValues() {
		//	return {
		//		x: roomMapPicker.currentX,
		//		y: roomMapPicker.currentY,
		//		hasPosition: roomMapPicker.currentX > 0 || roomMapPicker.currentY > 0,
		//		building: roomMapPicker.buildingCode
		//	};
		//}

		//function setRoomMapPickerValues(x, y, buildingCode = '') {
		//	if (x && y) {
		//		setRoomPosition(parseFloat(x), parseFloat(y));
		//	}	
		//	if (buildingCode) {
		//		updateRoomMapBuilding(buildingCode);
		//		loadBuildingFloorplan(buildingCode);
		//	}
		//}

		//function resetRoomMapPicker() {
		//	clearRoomPosition(); 
		//	roomMapPicker.gridVisible = false;	
		//	const gridOverlay = document.getElementById('roomGridOverlay');
		//	if (gridOverlay) {
		//		gridOverlay.classList.remove('show');
		//	}	
		//}
		
		// =================== Safe Initialization ===================

		// ‚úÖ SAFE: Initialize when DOM is ready without overriding
		document.addEventListener('DOMContentLoaded', function() {
			// Wait for admin panel to be ready
			setTimeout(() => {
				try {
					setupRoomMapPickerIntegration();
					initializeSaveRoomFormIntegration();
					console.log('‚úÖ Room Map Picker integration ready (safe mode)');
				} catch (error) {
					console.error('‚ùå Room Map Picker integration error:', error);
				}
			}, 1000);
		});	
		

		// ‚úÖ SAFE: Also initialize after admin initialization
		window.addEventListener('load', function() {
			setTimeout(() => {
				try {
					if (typeof isLoggedIn !== 'undefined' && isLoggedIn) {
						setupRoomMapPickerIntegration();
						initializeSaveRoomFormIntegration();
						console.log('‚úÖ Room Map Picker late initialization complete');
					}
				} catch (error) {
					console.warn('‚ö†Ô∏è Late initialization warning:', error);
				}
			}, 2000);
		});		
				

		// ========== Core Management Functions ==========

		// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Walkable Points
		function addWalkablePointsSection() {
			const mapsSection = document.getElementById('maps-section');
			if (!mapsSection) return;
			
			const walkableSection = document.createElement('div');
			walkableSection.className = 'walkable-section';
			walkableSection.innerHTML = `
				 
				
				<div class="walkable-stats" id="walkableStats">
					<div class="stat-card">
						<div class="stat-value" id="nodesCount">0</div>
						<div class="stat-label">‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô</div>
					</div>
					<div class="stat-card">
						<div class="stat-value" id="edgesCount">0</div>
						<div class="stat-label">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á</div>
					</div>
					<div class="stat-card">
						<div class="stat-value" id="avgDistance">0m</div>
						<div class="stat-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
					</div>
					<div class="stat-card">
						<div class="stat-value" id="coveragePercent">0%</div>
						<div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</div>
					</div>
				</div>
				
				<div class="walkable-controls">
				<!--
					<button class="walkable-btn" onclick="addWalkableNode()">
						<i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô
					</button>
				-->
					<button class="walkable-btn secondary" onclick="generateAutoNodes()">
						<i class="fas fa-magic"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
					</button>
					<button class="walkable-btn secondary" onclick="connectSelectedNodes()">
						<i class="fas fa-link"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á
					</button>
					<button class="walkable-btn danger" onclick="deleteSelectedNodes()">
						<i class="fas fa-trash"></i> ‡∏•‡∏ö‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
					</button>
					<button class="walkable-btn" onclick="optimizeConnections()">
						<i class="fas fa-cogs"></i> ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á
					</button>
					<button class="walkable-btn success" onclick="saveWalkableData()">
						<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
					</button>
				</div>
				
				<div class="walkable-settings">
					<div class="setting-group">
						<div class="setting-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
						<input type="number" class="setting-input" id="maxDistance" value="25" min="10" max="50">
						<div class="setting-help">‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (%)</div>
					</div>
					<div class="setting-group">
						<div class="setting-label">‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</div>
						<input type="number" class="setting-input" id="metersPerPercent" value="1.2" step="0.1" min="0.5" max="5">
						<div class="setting-help">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ï‡∏£</div>
					</div>
					<div class="setting-group">
						<div class="setting-label">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
						<select class="setting-input" id="autoConnect">
							<option value="true">‡πÄ‡∏õ‡∏¥‡∏î</option>
							<option value="false">‡∏õ‡∏¥‡∏î</option>
						</select>
						<div class="setting-help">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏±‡∏ö‡∏à‡∏∏‡∏î‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
					</div>
					<div class="setting-group">
						<div class="setting-label">‡πÅ‡∏ô‡∏ö‡∏Å‡∏£‡∏¥‡∏î</div>
						<select class="setting-input" id="snapToGrid">
							<option value="false">‡∏õ‡∏¥‡∏î</option>
							<option value="true">‡πÄ‡∏õ‡∏¥‡∏î</option>
						</select>
						<div class="setting-help">‡∏à‡∏±‡∏î‡∏à‡∏∏‡∏î‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡∏£‡∏¥‡∏î</div>
					</div>
				</div>
				
		 		
				<div class="walkable-map-controls">
				
					<button class="walkable-map-type-btn active" id="walkableFloorplanBtn" onclick="switchWalkableMapView('floorplan')">
						<i class="fas fa-drafting-compass"></i>
						‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á
					</button>
					<!--
					
					<button class="walkable-map-type-btn" id="walkableRealphotonBtn" onclick="switchWalkableMapView('realphoto')">
						<i class="fas fa-camera"></i>
						‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á
					</button>
					
					<span style="margin-left: 15px; font-size: 12px; color: #666;">
						<i class="fas fa-info-circle"></i> ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
					</span>
					-->
				</div>

				<!-- Container ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà -->
				<div class="walkable-map-container" id="walkableMapContainer">
					<!-- Background Images -->
					<img class="walkable-bg-image" id="walkableFloorplanImage" style="display: block;" alt="Floor Plan">
					<img class="walkable-bg-image" id="walkableRealphotoImage" style="display: none;" alt="Real Photo">
					
					<!-- No map message -->
					<div class="walkable-no-map" id="walkableNoMapMsg" style="display: none;">
						<i class="fas fa-map" style="font-size: 32px; color: #ccc; margin-bottom: 10px;"></i>
						<p style="margin: 0; font-size: 14px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</p>
						<small style="color: #999;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</small>
					</div>
					
					<!-- Walkable Overlay (existing) -->
					<div class="walkable-overlay" id="walkableOverlay"></div>
				</div>
				<!--
				<div class="export-section">
					<h4><i class="fas fa-download"></i> Export/Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô</h4>
					<textarea class="export-textarea" id="walkableExportData" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
					<div style="margin-top: 10px; display: flex; gap: 10px;">
						<button class="walkable-btn" onclick="exportWalkableData()">
							<i class="fas fa-download"></i> Export
						</button>
						<button class="walkable-btn secondary" onclick="importWalkableData()">
							<i class="fas fa-upload"></i> Import
						</button>
						<button class="walkable-btn secondary" onclick="copyWalkableData()">
							<i class="fas fa-copy"></i> Copy
						</button>
					</div>
				</div>
				-->
			`;
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô export section ‡πÉ‡∏ô maps
			const exportSection = mapsSection.querySelector('.export-section');
			if (exportSection) {
				mapsSection.insertBefore(walkableSection, exportSection);
			} else {
				mapsSection.appendChild(walkableSection);
			}
			
			// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
			initializeWalkablePointsSystem();
		}

		// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô
		function initializeWalkablePointsSystem() {
			console.log('üö∂ Initializing Walkable Points Management System...');
			
			// ‡πÇ‡∏´‡∏•‡∏î settings
			loadWalkableSettings();
			
			// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ event listeners
			setupWalkableEventListeners();
			
			// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
			const currentBuilding = getCurrentSelectedBuilding();
			if (currentBuilding) {
				loadWalkableDataForBuilding(currentBuilding);
			}
			
			console.log('‚úÖ Walkable Points Management System initialized');
		}

		// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Event Listeners
		function setupWalkableEventListeners() {
			const mapContainer = document.getElementById('walkableMapContainer');
			if (!mapContainer) return;
			
			// Click ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î
			mapContainer.addEventListener('click', handleMapClick);
			
			// Settings change listeners
			document.getElementById('maxDistance')?.addEventListener('change', updateSettings);
			document.getElementById('metersPerPercent')?.addEventListener('change', updateSettings);
			document.getElementById('autoConnect')?.addEventListener('change', updateSettings);
			document.getElementById('snapToGrid')?.addEventListener('change', updateSettings);
		}

		// ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
		function handleMapClick(event) {
			const rect = event.currentTarget.getBoundingClientRect();
			const x = ((event.clientX - rect.left) / rect.width) * 100;
			const y = ((event.clientY - rect.top) / rect.height) * 100;
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
			const clickedNode = findNodeAtPosition(x, y, 2); // tolerance 2%
			
			if (clickedNode) {
				toggleNodeSelection(clickedNode.id);
			} else {
				// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà
				addWalkableNodeAt(x, y);
			}
		}

		// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
		function addWalkableNodeAt(x, y) {
			// ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏£‡∏¥‡∏î‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ
			if (walkablePointsData.settings.snapToGrid) {
				const gridSize = walkablePointsData.settings.gridSize;
				x = Math.round(x / gridSize) * gridSize;
				y = Math.round(y / gridSize) * gridSize;
			}
			
			// ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡πÉ‡∏´‡∏°‡πà
			const nodeId = Date.now().toString();
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà
			walkablePointsData.nodes[nodeId] = {
				id: nodeId,
				x: x,
				y: y,
				building: walkablePointsData.currentBuilding
			};
			
			// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ
			if (walkablePointsData.settings.autoConnect) {
				autoConnectNode(nodeId);
			}
			
			// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
			renderWalkablePoints();
			updateWalkableStats();
			
			console.log('Added walkable node:', nodeId, 'at', x, y);
		}

		// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏à‡∏∏‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
		function autoConnectNode(nodeId) {
			const node = walkablePointsData.nodes[nodeId];
			const maxDistance = walkablePointsData.settings.maxConnectionDistance;
			
			Object.values(walkablePointsData.nodes).forEach(otherNode => {
				if (otherNode.id === nodeId) return;
				
				const distance = calculateDistance(node, otherNode);
				
				if (distance <= maxDistance) {
					addEdgeIfNotExists(nodeId, otherNode.id, distance);
				}
			});
		}

		// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏∏‡∏î
		function calculateDistance(nodeA, nodeB) {
			return Math.sqrt(
				Math.pow(nodeA.x - nodeB.x, 2) + 
				Math.pow(nodeA.y - nodeB.y, 2)
			);
		}

		// ‡πÄ‡∏û‡∏¥‡πà‡∏° edge ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
		function addEdgeIfNotExists(fromId, toId, distance) {
			const existingEdge = walkablePointsData.edges.find(edge => 
				(edge.from === fromId && edge.to === toId) ||
				(edge.from === toId && edge.to === fromId)
			);
			
			if (!existingEdge) {
				walkablePointsData.edges.push({
					from: fromId,
					to: toId,
					weight: distance * walkablePointsData.settings.metersPerPercent,
					bidirectional: true
				});
			}
		}

		// ========== Rendering Functions ==========

		// ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
		function renderWalkablePoints() {
			const overlay = document.getElementById('walkableOverlay');
			if (!overlay) return;
			
			overlay.innerHTML = '';
			
			// ‡∏™‡∏£‡πâ‡∏≤‡∏á SVG ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö edges
			const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
			svg.style.position = 'absolute';
			svg.style.top = '0';
			svg.style.left = '0';
			svg.style.width = '100%';
			svg.style.height = '100%';
			svg.setAttribute('viewBox', '0 0 100 100');
			svg.setAttribute('preserveAspectRatio', 'none');
			
			// ‡πÅ‡∏™‡∏î‡∏á edges
			walkablePointsData.edges.forEach(edge => {
				const fromNode = walkablePointsData.nodes[edge.from];
				const toNode = walkablePointsData.nodes[edge.to];
				
				if (fromNode && toNode) {
					const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
					line.setAttribute('x1', fromNode.x);
					line.setAttribute('y1', fromNode.y);
					line.setAttribute('x2', toNode.x);
					line.setAttribute('y2', toNode.y);
					line.setAttribute('class', 'walkable-edge');
					line.style.cursor = 'pointer';
					line.addEventListener('click', () => selectEdge(edge));
					svg.appendChild(line);
				}
			});
			
			overlay.appendChild(svg);
			
			// ‡πÅ‡∏™‡∏î‡∏á nodes
			Object.values(walkablePointsData.nodes).forEach(node => {
				const nodeElement = document.createElement('div');
				nodeElement.className = 'walkable-node';
				nodeElement.style.left = `${node.x}%`;
				nodeElement.style.top = `${node.y}%`;
				nodeElement.dataset.nodeId = node.id;
				
				if (walkablePointsData.selectedNodes.has(node.id)) {
					nodeElement.classList.add('selected');
				}
				
				// Event listeners
				nodeElement.addEventListener('click', (e) => {
					e.stopPropagation();
					toggleNodeSelection(node.id);
				});
				
				overlay.appendChild(nodeElement);
			});
		}

		// ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î
		function toggleNodeSelection(nodeId) {
			if (walkablePointsData.selectedNodes.has(nodeId)) {
				walkablePointsData.selectedNodes.delete(nodeId);
			} else {
				walkablePointsData.selectedNodes.add(nodeId);
			}
			
			renderWalkablePoints();
			updateSelectionInfo();
		}

		// ========== Statistics and Info ==========

		// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
		function updateWalkableStats() {
			const nodesCount = Object.keys(walkablePointsData.nodes).length;
			const edgesCount = walkablePointsData.edges.length;
			
			// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
			let totalDistance = 0;
			if (edgesCount > 0) {
				totalDistance = walkablePointsData.edges.reduce((sum, edge) => sum + edge.weight, 0);
			}
			const avgDistance = edgesCount > 0 ? (totalDistance / edgesCount).toFixed(1) : 0;
			
			// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)
			const coveragePercent = Math.min(Math.round((nodesCount / 25) * 100), 100);
			
			// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI
			const nodesCountEl = document.getElementById('nodesCount');
			const edgesCountEl = document.getElementById('edgesCount');
			const avgDistanceEl = document.getElementById('avgDistance');
			const coveragePercentEl = document.getElementById('coveragePercent');
			
			if (nodesCountEl) nodesCountEl.textContent = nodesCount;
			if (edgesCountEl) edgesCountEl.textContent = edgesCount;
			if (avgDistanceEl) avgDistanceEl.textContent = avgDistance + 'm';
			if (coveragePercentEl) coveragePercentEl.textContent = coveragePercent + '%';
		}

		// ========== Advanced Functions ==========

		// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
		function generateAutoNodes() {
			if (!confirm('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥? ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà')) return;
			
			// ‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏Å‡πà‡∏≤
			walkablePointsData.nodes = {};
			walkablePointsData.edges = [];
			
			let nodeId = 1;
			
			// ‡∏™‡∏£‡πâ‡∏≤‡∏á grid pattern
			for (let x = 15; x <= 85; x += 20) {
				for (let y = 15; y <= 85; y += 20) {
					walkablePointsData.nodes[nodeId] = {
						id: nodeId.toString(),
						x: x,
						y: y,
						building: walkablePointsData.currentBuilding
					};
					nodeId++;
				}
			}
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡πÉ‡∏Å‡∏•‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ
			if (window.roomsData) {
				window.roomsData.forEach(room => {
					if (room.building === walkablePointsData.currentBuilding) {
						const roomX = parseFloat(room.x);
						const roomY = parseFloat(room.y);
						
						// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏£‡∏≠‡∏ö‡πÜ ‡∏´‡πâ‡∏≠‡∏á
						const nearbyPoints = [
							{x: roomX - 5, y: roomY},
							{x: roomX + 5, y: roomY}
						];
						
						nearbyPoints.forEach(point => {
							if (point.x >= 10 && point.x <= 90 && point.y >= 10 && point.y <= 90) {
								walkablePointsData.nodes[nodeId] = {
									id: nodeId.toString(),
									x: point.x,
									y: point.y,
									building: walkablePointsData.currentBuilding
								};
								nodeId++;
							}
						});
					}
				});
			}
			
			// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
			optimizeConnections();
			
			renderWalkablePoints();
			updateWalkableStats();
			
			showNotification(`üéØ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô ${Object.keys(walkablePointsData.nodes).length} ‡∏à‡∏∏‡∏î`, 'success');
		}

		// ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á
		function optimizeConnections() {
			walkablePointsData.edges = [];
			
			const nodes = Object.values(walkablePointsData.nodes);
			const maxDistance = walkablePointsData.settings.maxConnectionDistance;
			
			for (let i = 0; i < nodes.length; i++) {
				for (let j = i + 1; j < nodes.length; j++) {
					const distance = calculateDistance(nodes[i], nodes[j]);
					
					if (distance <= maxDistance) {
						addEdgeIfNotExists(nodes[i].id, nodes[j].id, distance);
					}
				}
			}
			
			renderWalkablePoints();
			updateWalkableStats();
			
			showNotification(`üîó ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á ${walkablePointsData.edges.length} ‡πÄ‡∏™‡πâ‡∏ô`, 'success');
		}

		// ========== Data Management ==========

		// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
		async function saveWalkableData() {
			try {
				const data = {
					building: walkablePointsData.currentBuilding,
					nodes: walkablePointsData.nodes,
					edges: walkablePointsData.edges,
					settings: walkablePointsData.settings,
					timestamp: new Date().toISOString()
				};
				
				// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô localStorage
				const storageKey = `walkableData_${walkablePointsData.currentBuilding}`;
				localStorage.setItem(storageKey, JSON.stringify(data));
				
				// ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
				if (window.sheetsConfig && window.sheetsConfig.connected) {
					await saveWalkableDataToSheets(data);
				}
				
				showNotification('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
				
			} catch (error) {
				console.error('Error saving walkable data:', error);
				showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
			}
		}

		// Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
		function exportWalkableData() {
			const data = {
				building: walkablePointsData.currentBuilding,
				nodes: walkablePointsData.nodes,
				edges: walkablePointsData.edges,
				settings: walkablePointsData.settings,
				exported: new Date().toISOString()
			};
			
			const textarea = document.getElementById('walkableExportData');
			if (textarea) {
				textarea.value = JSON.stringify(data, null, 2);
			}
		}

		// Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
		function importWalkableData() {
			const textarea = document.getElementById('walkableExportData');
			if (!textarea || !textarea.value.trim()) {
				showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON', 'error');
				return;
			}
			
			try {
				const data = JSON.parse(textarea.value);
				
				if (!data.nodes || !data.edges) {
					throw new Error('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
				}
				
				walkablePointsData.nodes = data.nodes;
				walkablePointsData.edges = data.edges;
				
				if (data.settings) {
					walkablePointsData.settings = { ...walkablePointsData.settings, ...data.settings };
					loadWalkableSettings();
				}
				
				renderWalkablePoints();
				updateWalkableStats();
				
				showNotification('üì• Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
				
			} catch (error) {
				console.error('Import error:', error);
				showNotification('‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
			}
		}

		// ========== Integration with Admin System ==========

		// Hook ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö building selection ‡∏Ç‡∏≠‡∏á admin
		const originalShowSection = window.showSection;
		window.showSection = function(section) {
			if (originalShowSection) {
				originalShowSection(section);
			}
			
			if (section === 'maps') {
				// ‡πÄ‡∏û‡∏¥‡πà‡∏° walkable points section ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
				setTimeout(() => {
					if (!document.querySelector('.walkable-section')) {
						addWalkablePointsSection();
					}
				}, 500);
			}
		};

		// Hook ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô building
		const originalLoadMapsForBuilding = window.loadMapsForBuilding;
		window.loadMapsForBuilding = function(building) {
			if (originalLoadMapsForBuilding) {
				originalLoadMapsForBuilding(building);
			}
			
			// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• walkable points ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
			walkablePointsData.currentBuilding = building;
			loadWalkableDataForBuilding(building);
		};

		// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
		function loadWalkableDataForBuilding(building) {
			walkablePointsData.currentBuilding = building;
			
			// ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage
			const storageKey = `walkableData_${building}`;
			const saved = localStorage.getItem(storageKey);
			
			if (saved) {
				try {
					const data = JSON.parse(saved);
					walkablePointsData.nodes = data.nodes || {};
					walkablePointsData.edges = data.edges || [];
					
					if (data.settings) {
						walkablePointsData.settings = { ...walkablePointsData.settings, ...data.settings };
						loadWalkableSettings();
					}
					
					renderWalkablePoints();
					updateWalkableStats();
					
					console.log('Loaded walkable data for building:', building);
					
				} catch (error) {
					console.error('Error loading walkable data:', error);
				}
			} else {
				// ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
				walkablePointsData.nodes = {};
				walkablePointsData.edges = [];
				renderWalkablePoints();
				updateWalkableStats();
			}
		}

		// ‡πÇ‡∏´‡∏•‡∏î settings ‡∏à‡∏≤‡∏Å UI
		function loadWalkableSettings() {
			try {
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ settings ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô object
				if (!walkablePointsData.settings || typeof walkablePointsData.settings !== 'object') {
					console.warn('Invalid walkablePointsData.settings, using defaults');
					walkablePointsData.settings = {
						maxConnectionDistance: 25,
						metersPerPercent: 1.2,
						autoConnect: true,
						snapToGrid: false
					};
				}
				
				const settings = walkablePointsData.settings;
				
				// Safe value extraction with fallbacks
				const maxDistance = extractNumber(settings.maxConnectionDistance, 25);
				const metersPerPercent = extractNumber(settings.metersPerPercent, 1.2);
				const autoConnect = extractBoolean(settings.autoConnect, true);
				const snapToGrid = extractBoolean(settings.snapToGrid, false);
				
				// Set values safely
				const maxDistanceInput = document.getElementById('maxDistance');
				const metersPerPercentInput = document.getElementById('metersPerPercent');
				const autoConnectSelect = document.getElementById('autoConnect');
				const snapToGridSelect = document.getElementById('snapToGrid');
				
				if (maxDistanceInput) maxDistanceInput.value = maxDistance;
				if (metersPerPercentInput) metersPerPercentInput.value = metersPerPercent;
				if (autoConnectSelect) autoConnectSelect.value = autoConnect.toString();
				if (snapToGridSelect) snapToGridSelect.value = snapToGrid.toString();
				
				console.log('‚úÖ Walkable settings loaded:', {
					maxDistance,
					metersPerPercent,
					autoConnect,
					snapToGrid
				});
				
			} catch (error) {
				console.error('Error in loadWalkableSettings:', error);
				
				// Emergency fallback - set default values
				const maxDistanceInput = document.getElementById('maxDistance');
				const metersPerPercentInput = document.getElementById('metersPerPercent');
				const autoConnectSelect = document.getElementById('autoConnect');
				const snapToGridSelect = document.getElementById('snapToGrid');
				
				if (maxDistanceInput) maxDistanceInput.value = '25';
				if (metersPerPercentInput) metersPerPercentInput.value = '1.2';
				if (autoConnectSelect) autoConnectSelect.value = 'true';
				if (snapToGridSelect) snapToGridSelect.value = 'false';
			}
		}
		
		// Helper functions ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö safe value extraction
		function extractNumber(value, fallback) {
			if (typeof value === 'number' && !isNaN(value)) return value;
			if (typeof value === 'string') {
				const parsed = parseFloat(value);
				if (!isNaN(parsed)) return parsed;
			}
			if (typeof value === 'object' && value !== null && typeof value.value === 'number') {
				return value.value;
			}
			return fallback;
		}

		function extractBoolean(value, fallback) {
			if (typeof value === 'boolean') return value;
			if (typeof value === 'string') {
				return value.toLowerCase() === 'true';
			}
			if (typeof value === 'object' && value !== null && typeof value.value === 'boolean') {
				return value.value;
			}
			return fallback;
		}

		// ========== ‡πÄ‡∏û‡∏¥‡πà‡∏° Settings Validator ==========
		function validateWalkableSettings() {
			if (!walkablePointsData.settings) {
				walkablePointsData.settings = {};
			}
			
			const s = walkablePointsData.settings;
			
			// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç nested objects
			if (typeof s.maxConnectionDistance === 'object') {
				s.maxConnectionDistance = extractNumber(s.maxConnectionDistance, 25);
			}
			if (typeof s.metersPerPercent === 'object') {
				s.metersPerPercent = extractNumber(s.metersPerPercent, 1.2);
			}
			if (typeof s.autoConnect === 'object') {
				s.autoConnect = extractBoolean(s.autoConnect, true);
			}
			if (typeof s.snapToGrid === 'object') {
				s.snapToGrid = extractBoolean(s.snapToGrid, false);
			}
			
			console.log('‚úÖ Settings validated:', s);
		}

		// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ validator ‡∏Å‡πà‡∏≠‡∏ô loadWalkableSettings
		const originalRenderUI = window.renderUI;
		window.renderUI = function() {
			validateWalkableSettings();
			if (originalRenderUI) {
				originalRenderUI();
			} else {
				if (typeof renderWalkablePoints === 'function') renderWalkablePoints();
				if (typeof updateWalkableStats === 'function') updateWalkableStats();
				if (typeof loadWalkableSettings === 'function') loadWalkableSettings();
			}
		};

		// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó settings ‡∏à‡∏≤‡∏Å UI
		function updateSettings() {
			const maxDistance = document.getElementById('maxDistance')?.value;
			const metersPerPercent = document.getElementById('metersPerPercent')?.value;
			const autoConnect = document.getElementById('autoConnect')?.value;
			const snapToGrid = document.getElementById('snapToGrid')?.value;
			
			if (maxDistance) walkablePointsData.settings.maxConnectionDistance = parseFloat(maxDistance);
			if (metersPerPercent) walkablePointsData.settings.metersPerPercent = parseFloat(metersPerPercent);
			if (autoConnect) walkablePointsData.settings.autoConnect = autoConnect === 'true';
			if (snapToGrid) walkablePointsData.settings.snapToGrid = snapToGrid === 'true';
			
			console.log('Updated walkable settings:', walkablePointsData.settings);
		}

		// Helper Functions
		function getCurrentSelectedBuilding() {
			return window.currentSelectedBuilding || 'Main Building';
		}

		function findNodeAtPosition(x, y, tolerance = 2) {
			return Object.values(walkablePointsData.nodes).find(node => {
				const distance = Math.sqrt(Math.pow(node.x - x, 2) + Math.pow(node.y - y, 2));
				return distance <= tolerance;
			});
		}

		function selectEdge(edge) {
			if (confirm('‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏ô‡∏µ‡πâ?')) {
				const index = walkablePointsData.edges.indexOf(edge);
				if (index > -1) {
					walkablePointsData.edges.splice(index, 1);
					renderWalkablePoints();
					updateWalkableStats();
				}
			}
		}

		function deleteSelectedNodes() {
			if (walkablePointsData.selectedNodes.size === 0) {
				showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
				return;
			}
			
			if (!confirm(`‡∏•‡∏ö‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô ${walkablePointsData.selectedNodes.size} ‡∏à‡∏∏‡∏î?`)) return;
			
			// ‡∏•‡∏ö nodes
			walkablePointsData.selectedNodes.forEach(nodeId => {
				delete walkablePointsData.nodes[nodeId];
			});
			
			// ‡∏•‡∏ö edges ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
			walkablePointsData.edges = walkablePointsData.edges.filter(edge => {
				return !walkablePointsData.selectedNodes.has(edge.from) && 
					   !walkablePointsData.selectedNodes.has(edge.to);
			});
			
			walkablePointsData.selectedNodes.clear();
			
			renderWalkablePoints();
			updateWalkableStats();
			
			showNotification('üóëÔ∏è ‡∏•‡∏ö‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
		}

		function connectSelectedNodes() {
			const selectedArray = Array.from(walkablePointsData.selectedNodes);
			
			if (selectedArray.length < 2) {
				showNotification('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏à‡∏∏‡∏î', 'error');
				return;
			}
			
			let connectionsAdded = 0;
			
			for (let i = 0; i < selectedArray.length; i++) {
				for (let j = i + 1; j < selectedArray.length; j++) {
					const nodeA = walkablePointsData.nodes[selectedArray[i]];
					const nodeB = walkablePointsData.nodes[selectedArray[j]];
					const distance = calculateDistance(nodeA, nodeB);
					
					const existingEdge = walkablePointsData.edges.find(edge => 
						(edge.from === selectedArray[i] && edge.to === selectedArray[j]) ||
						(edge.from === selectedArray[j] && edge.to === selectedArray[i])
					);
					
					if (!existingEdge) {
						addEdgeIfNotExists(selectedArray[i], selectedArray[j], distance);
						connectionsAdded++;
					}
				}
			}
			
			renderWalkablePoints();
			updateWalkableStats();
			
			showNotification(`üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á ${connectionsAdded} ‡πÄ‡∏™‡πâ‡∏ô`, 'success');
		}

		function copyWalkableData() {
			const textarea = document.getElementById('walkableExportData');
			if (textarea && textarea.value) {
				textarea.select();
				document.execCommand('copy');
				showNotification('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'success');
			}
		}

		function updateSelectionInfo() {
			const count = walkablePointsData.selectedNodes.size;
			if (count > 0) {
				showNotification(`üìç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô ${count} ‡∏à‡∏∏‡∏î`, 'info');
			}
		}

		// Export functions for global access
		window.walkablePointsAdmin = {
			addWalkablePointsSection,
			generateAutoNodes,
			optimizeConnections,
			saveWalkableData,
			exportWalkableData,
			importWalkableData,
			walkablePointsData
		};

		

	 
		
	 // =================== Initialization ===================
			// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï initializeAdmin function ‡πÉ‡∏´‡πâ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å module
			async function initializeAdmin() {
				try {
					console.log('üöÄ Initializing Complete Admin Panel System...');
					
					// Show loading indicator
					showNotification('üîß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Admin Panel...', 'info');
					
					// 1. Load basic configuration
					console.log('üìã Loading basic configurations...');
					loadEnhancedSheetsConfig();
					
					// 2. Initialize all modules
					console.log('üîß Initializing modules...');
					initializeEnhancedNavigationModule();
					initializeCRUDModule();
					initializeModalModule();
					initializeMapsModule();
					initializeDeploymentModule();
					initializeEnhancedSheetsModule();
					
					// 3. Add keyboard shortcuts help button
					//addKeyboardShortcutsButton();
					
					// 4. Setup responsive handlers
					setupResponsiveHandlers();
					
					// 5. Start sequential loading
					console.log('üìä Starting sequential data loading...');
					await sequentialLoader.startSequentialLoad();
					
					// 6. Post-initialization setup
					console.log('üéØ Completing initialization...');
					
					// Initialize current section
					const activeSection = document.querySelector('.page-section.active');
					if (activeSection) {
						const sectionId = activeSection.id.replace('-section', '');
						if (sectionId === 'dashboard') {
							updateDashboardStats();
						} else if (sectionId === 'buildings') {
							loadBuildingsTable();
						} else if (sectionId === 'rooms') {
							loadRoomsTable();
						}
					}
					
							
					// 7. Show success notification
					showNotification('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö Admin Panel ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!', 'success');
					
					// 8. Show welcome message with shortcuts info
					setTimeout(() => {
						showWelcomeMessage();
					}, 2000);

				
				} catch (error) {
					console.error('‚ùå Admin initialization error:', error);
					showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ', 'error');
					
					// Fallback initialization
					try {
						console.log('üîÑ Attempting fallback initialization...');
						loadEnhancedSheetsConfig();
						updateDashboardStats();
						showNotification('‚ö†Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î', 'warning');
					} catch (fallbackError) {
						console.error('‚ùå Fallback initialization failed:', fallbackError);
					}
				}
			}
			
			
			async function initializeAdminOrg() {
				try {
					console.log('üöÄ Initializing Admin Panel with Sequential Loading...');

					// Load basic settings
					loadSheetsConfig();

					// Start sequential loading
					await sequentialLoader.startSequentialLoad();

					console.log('‚úÖ Admin Panel initialized successfully');

				} catch (error) {
					console.error('‚ùå Admin initialization error:', error);
					showNotification('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ', 'error');
				}
			}		


			// ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô initializeDeploymentModule ‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
			function initializeDeploymentModule() {
				console.log('üöÄ Initializing Deployment Module...');
				
				try {
					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ section deployment ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
					const deploymentSection = document.getElementById('deployment-section');
					if (deploymentSection) {
						console.log('‚úÖ Deployment section found');
					}
					
					console.log('‚úÖ Deployment Module initialized');
					return true;
				} catch (error) {
					console.error('‚ùå Error initializing Deployment module:', error);
					return false;
				}
			}
			
			// ========== Quick Fix: getCurrentBuilding Function ==========
			// üö® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô Phase 2.1 code ‡πÉ‡∏ô admin.html ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ReferenceError

			// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô getCurrentBuilding ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Bridge System
			function getCurrentBuilding() {
				// ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏´‡∏≤ current building:
				// 1. ‡∏à‡∏≤‡∏Å walkablePointsData.currentBuilding
				// 2. ‡∏à‡∏≤‡∏Å getCurrentSelectedBuilding() (existing function)
				// 3. ‡∏à‡∏≤‡∏Å global variables ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
				// 4. Default fallback
				
				try {
					// ‡∏•‡∏≠‡∏á‡∏à‡∏≤‡∏Å walkablePointsData ‡∏Å‡πà‡∏≠‡∏ô
					if (typeof walkablePointsData !== 'undefined' && walkablePointsData.currentBuilding) {
						return walkablePointsData.currentBuilding;
					}
					
					// ‡∏•‡∏≠‡∏á‡∏à‡∏≤‡∏Å existing function
					if (typeof getCurrentSelectedBuilding === 'function') {
						const selected = getCurrentSelectedBuilding();
						if (selected && selected !== 'undefined') {
							return selected;
						}
					}
					
					// ‡∏•‡∏≠‡∏á‡∏à‡∏≤‡∏Å global variables
					if (typeof window.currentSelectedBuilding !== 'undefined' && window.currentSelectedBuilding) {
						return window.currentSelectedBuilding;
					}
					
					if (typeof window.currentBuilding !== 'undefined' && window.currentBuilding) {
						return window.currentBuilding;
					}
					
					// ‡∏•‡∏≠‡∏á‡∏à‡∏≤‡∏Å DOM elements
					const buildingSelect = document.getElementById('buildingSelect');
					if (buildingSelect && buildingSelect.value) {
						return buildingSelect.value;
					}
					
					// ‡∏•‡∏≠‡∏á‡∏à‡∏≤‡∏Å ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏£‡∏∑‡∏≠ title elements
					const buildingTitle = document.querySelector('[data-building]') || 
										 document.querySelector('.building-title') ||
										 document.querySelector('.current-building');
					
					if (buildingTitle && buildingTitle.textContent) {
						return buildingTitle.textContent.trim();
					}
					
				} catch (error) {
					console.warn('Error in getCurrentBuilding:', error);
				}
				
				// Default fallback
				return 'Main Building';
			}

			// ‡πÄ‡∏û‡∏¥‡πà‡∏° getCurrentBuildingName ‡πÄ‡∏õ‡πá‡∏ô alias (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Phase 2.1 code)
			function getCurrentBuildingName() {
				return getCurrentBuilding();
			}

			// Safe wrapper ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö getCurrentSelectedBuilding  
			function safeGetCurrentSelectedBuilding() {
				try {
					if (typeof getCurrentSelectedBuilding === 'function') {
						return getCurrentSelectedBuilding();
					}
					return getCurrentBuilding();
				} catch (error) {
					console.warn('Error in safeGetCurrentSelectedBuilding:', error);
					return getCurrentBuilding();
				}
			}
	  
			
			// ========== Phase 2.1: Storage Key Separation + Complete Data Bridge ==========
			// üéØ Mission: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç storage conflicts ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á complete data conversion bridge
			// üîß Target: admin.html + index.html ‡πÉ‡∏ä‡πâ storage keys ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞ sync ‡πÑ‡∏î‡πâ

			// ========== 1. Enhanced ADMIN_INDEX_BRIDGE ==========
			// ========== 2. Safe Storage Key Functions ==========

			// ‡∏î‡∏∂‡∏á storage key ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏° environment
			function getSafeStorageKey(building, forceMode = null) {
				if (!building) building = getCurrentBuildingName();
				
				let mode;
				if (forceMode) {
					mode = forceMode;
				} else if (ADMIN_INDEX_BRIDGE.isAdminMode()) {
					mode = 'admin';
				} else if (ADMIN_INDEX_BRIDGE.isIndexMode()) {
					mode = 'index';
				} else {
					mode = 'unknown';
				}
				
				return ADMIN_INDEX_BRIDGE.getStorageKey(building, mode);
			}

			// ‡∏´‡∏≤ building name ‡∏à‡∏≤‡∏Å environment
			function getCurrentBuildingName() {
				// ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏à‡∏≤‡∏Å global variables
				if (typeof walkablePointsData !== 'undefined' && walkablePointsData.currentBuilding) {
					return walkablePointsData.currentBuilding;
				}
				if (typeof walkableRoutingData !== 'undefined' && walkableRoutingData.currentBuilding) {
					return walkableRoutingData.currentBuilding;
				}
				if (typeof currentBuilding !== 'undefined') {
					return currentBuilding;
				}
				
				// ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏à‡∏≤‡∏Å DOM elements
				const buildingSelect = document.getElementById('buildingSelect') || 
									  document.querySelector('[data-building]') ||
									  document.querySelector('.building-selector');
				
				if (buildingSelect && buildingSelect.value) {
					return buildingSelect.value;
				}
				
				// Default fallback
				return 'Main Building';
			}

			// ========== 3. Complete Data Format Converters ==========

			// ‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å admin format ‡πÄ‡∏õ‡πá‡∏ô index format (COMPLETE VERSION)
			function convertAdminToIndexFormat(adminData) {
				if (!adminData || typeof adminData !== 'object') {
					debugLog('‚ùå Invalid admin data for conversion');
					return null;
				}
				
				try {
					ADMIN_INDEX_BRIDGE.conversionCount++;
					debugLog('üîÑ Converting admin data to index format...', {
						adminNodes: Object.keys(adminData.nodes || {}).length,
						adminEdges: (adminData.edges || []).length,
						conversionId: ADMIN_INDEX_BRIDGE.conversionCount
					});
					
					const indexData = {
						// Core structure for index.html
						nodes: {},
						edges: [],
						settings: {
							metersPerPercent: adminData.settings?.metersPerPercent || 1.2,
							maxSearchRadius: adminData.settings?.maxConnectionDistance || 25,
							gridSize: adminData.settings?.gridSize || 5,
							autoConnect: adminData.settings?.autoConnect !== false,
							snapToGrid: adminData.settings?.snapToGrid || false
						},
						
						// Metadata
						currentBuilding: adminData.currentBuilding || adminData.building,
						lastPath: null,
						isInitialized: true,
						
						// Bridge metadata
						dataSource: 'admin',
						syncTime: new Date().toISOString(),
						originalFormat: 'admin',
						conversionId: ADMIN_INDEX_BRIDGE.conversionCount
					};
					
					// ‡πÅ‡∏õ‡∏•‡∏á nodes
					if (adminData.nodes && typeof adminData.nodes === 'object') {
						for (const nodeId in adminData.nodes) {
							const adminNode = adminData.nodes[nodeId];
							if (adminNode && typeof adminNode === 'object') {
								indexData.nodes[nodeId] = {
									id: nodeId,
									x: parseFloat(adminNode.x) || 0,
									y: parseFloat(adminNode.y) || 0,
									type: adminNode.type || 'grid',
									building: adminNode.building || indexData.currentBuilding,
									isActive: adminNode.isActive !== false,
									source: 'admin'
								};
							}
						}
					}
					
					// ‡πÅ‡∏õ‡∏•‡∏á edges
					if (adminData.edges && Array.isArray(adminData.edges)) {
						adminData.edges.forEach((adminEdge, index) => {
							if (adminEdge && typeof adminEdge === 'object') {
								indexData.edges.push({
									from: adminEdge.from,
									to: adminEdge.to,
									weight: parseFloat(adminEdge.weight) || 0,
									bidirectional: adminEdge.bidirectional !== false,
									building: adminEdge.building || indexData.currentBuilding,
									isActive: adminEdge.isActive !== false,
									edgeId: adminEdge.edgeId || `E${index + 1}`,
									source: 'admin'
								});
							}
						});
					}
					
					debugLog('‚úÖ Admin to index conversion completed:', {
						convertedNodes: Object.keys(indexData.nodes).length,
						convertedEdges: indexData.edges.length,
						building: indexData.currentBuilding
					});
					
					ADMIN_INDEX_BRIDGE.lastConversionError = null;
					return indexData;
					
				} catch (error) {
					debugLog('‚ùå Error in admin to index conversion:', error);
					ADMIN_INDEX_BRIDGE.lastConversionError = error.message;
					return null;
				}
			}

			// ‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å index format ‡πÄ‡∏õ‡πá‡∏ô admin format (COMPLETE VERSION)
			function convertIndexToAdminFormat(indexData) {
				if (!indexData || typeof indexData !== 'object') {
					debugLog('‚ùå Invalid index data for conversion');
					return null;
				}
				
				try {
					ADMIN_INDEX_BRIDGE.conversionCount++;
					debugLog('üîÑ Converting index data to admin format...', {
						indexNodes: Object.keys(indexData.nodes || {}).length,
						indexEdges: (indexData.edges || []).length,
						conversionId: ADMIN_INDEX_BRIDGE.conversionCount
					});
					
					const adminData = {
						// Core structure for admin.html
						currentBuilding: indexData.currentBuilding || indexData.building,
						building: indexData.currentBuilding || indexData.building,
						nodes: {},
						edges: [],
						settings: {
							maxConnectionDistance: indexData.settings?.maxSearchRadius || 25,
							metersPerPercent: indexData.settings?.metersPerPercent || 1.2,
							autoConnect: indexData.settings?.autoConnect !== false,
							snapToGrid: indexData.settings?.snapToGrid || false,
							gridSize: indexData.settings?.gridSize || 5
						},
						
						// Admin-specific properties
						selectedNodes: new Set(),
						isDragging: false,
						dragNode: null,
						
						// Bridge metadata
						dataSource: 'index',
						syncTime: new Date().toISOString(),
						originalFormat: 'index',
						conversionId: ADMIN_INDEX_BRIDGE.conversionCount
					};
					
					// ‡πÅ‡∏õ‡∏•‡∏á nodes
					if (indexData.nodes && typeof indexData.nodes === 'object') {
						for (const nodeId in indexData.nodes) {
							const indexNode = indexData.nodes[nodeId];
							if (indexNode && typeof indexNode === 'object') {
								adminData.nodes[nodeId] = {
									id: nodeId,
									x: parseFloat(indexNode.x) || 0,
									y: parseFloat(indexNode.y) || 0,
									type: indexNode.type || 'grid',
									building: indexNode.building || adminData.currentBuilding,
									isActive: indexNode.isActive !== false,
									source: 'index'
								};
							}
						}
					}
					
					// ‡πÅ‡∏õ‡∏•‡∏á edges
					if (indexData.edges && Array.isArray(indexData.edges)) {
						indexData.edges.forEach((indexEdge, edgeIndex) => {
							if (indexEdge && typeof indexEdge === 'object') {
								adminData.edges.push({
									from: indexEdge.from,
									to: indexEdge.to,
									weight: parseFloat(indexEdge.weight) || 0,
									bidirectional: indexEdge.bidirectional !== false,
									building: indexEdge.building || adminData.currentBuilding,
									isActive: indexEdge.isActive !== false,
									edgeId: indexEdge.edgeId || `E${edgeIndex + 1}`,
									source: 'index'
								});
							}
						});
					}
					
					debugLog('‚úÖ Index to admin conversion completed:', {
						convertedNodes: Object.keys(adminData.nodes).length,
						convertedEdges: adminData.edges.length,
						building: adminData.currentBuilding
					});
					
					ADMIN_INDEX_BRIDGE.lastConversionError = null;
					return adminData;
					
				} catch (error) {
					debugLog('‚ùå Error in index to admin conversion:', error);
					ADMIN_INDEX_BRIDGE.lastConversionError = error.message;
					return null;
				}
			}

			// ========== 4. Safe Data Sync Functions ==========

			// Sync admin data ‡πÑ‡∏õ index (SAFE VERSION)
			function syncAdminDataToIndex(building) {
				if (!ADMIN_INDEX_BRIDGE.isIndexMode()) {
					debugLog('‚ö†Ô∏è Not in index mode, sync skipped');
					return false;
				}
				
				debugLog('üî• Syncing admin data to index...', { building });
				
				try {
					// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å admin storage
					const adminKey = getSafeStorageKey(building, 'admin');
					const adminDataString = localStorage.getItem(adminKey);
					
					if (!adminDataString) {
						debugLog('‚ÑπÔ∏è No admin data found in storage');
						return false;
					}
					
					const adminData = JSON.parse(adminDataString);
					
					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô circular sync)
					if (adminData.dataSource === 'index') {
						debugLog('üîÑ Data source is index, avoiding circular sync');
						return false;
					}
					
					// ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô index format
					const indexData = convertAdminToIndexFormat(adminData);
					if (!indexData) {
						debugLog('‚ùå Failed to convert admin data to index format');
						return false;
					}
					
					// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkableRoutingData ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
					if (typeof walkableRoutingData !== 'undefined') {
						Object.assign(walkableRoutingData, indexData);
						debugLog('‚úÖ walkableRoutingData updated from admin');
					}
					
					// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô index storage
					const indexKey = getSafeStorageKey(building, 'index');
					localStorage.setItem(indexKey, JSON.stringify(indexData));
					
					ADMIN_INDEX_BRIDGE.lastSyncTime = new Date().toISOString();
					
					debugLog('‚úÖ Admin data synced to index successfully', {
						adminKey,
						indexKey,
						nodes: Object.keys(indexData.nodes).length,
						edges: indexData.edges.length
					});
					
					return true;
					
				} catch (error) {
					debugLog('‚ùå Error syncing admin data to index:', error);
					return false;
				}
			}

			// Sync index data ‡πÑ‡∏õ admin (SAFE VERSION)  
			function syncIndexDataToAdmin(building) {
				if (!ADMIN_INDEX_BRIDGE.isAdminMode()) {
					debugLog('‚ö†Ô∏è Not in admin mode, sync skipped');
					return false;
				}
				
				debugLog('üî§ Syncing index data to admin...', { building });
				
				try {
					// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å index storage
					const indexKey = getSafeStorageKey(building, 'index');
					const indexDataString = localStorage.getItem(indexKey);
					
					if (!indexDataString) {
						debugLog('‚ÑπÔ∏è No index data found in storage');
						return false;
					}
					
					const indexData = JSON.parse(indexDataString);
					
					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å index ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
					if (indexData.dataSource === 'admin') {
						debugLog('üîÑ Data source is admin, avoiding circular sync');
						return false;
					}
					
					// ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô admin format
					const adminData = convertIndexToAdminFormat(indexData);
					if (!adminData) {
						debugLog('‚ùå Failed to convert index data to admin format');
						return false;
					}
					
					// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkablePointsData ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
					if (typeof walkablePointsData !== 'undefined') {
						Object.assign(walkablePointsData, adminData);
						
						// Render ‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
						if (typeof renderWalkablePoints === 'function') {
							renderWalkablePoints();
						}
						if (typeof updateWalkableStats === 'function') {
							updateWalkableStats();
						}
						
						debugLog('‚úÖ walkablePointsData updated from index');
					}
					
					// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô admin storage
					const adminKey = getSafeStorageKey(building, 'admin');
					localStorage.setItem(adminKey, JSON.stringify(adminData));
					
					ADMIN_INDEX_BRIDGE.lastSyncTime = new Date().toISOString();
					
					debugLog('‚úÖ Index data synced to admin successfully', {
						indexKey,
						adminKey,
						nodes: Object.keys(adminData.nodes).length,
						edges: adminData.edges.length
					});
					
					return true;
					
				} catch (error) {
					debugLog('‚ùå Error syncing index data to admin:', error);
					return false;
				}
			}

			// ========== 5. Enhanced Data Loading Functions ==========

			// Load data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin.html (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà loadWalkableDataForBuilding ‡πÄ‡∏î‡∏¥‡∏°)
			function loadWalkableDataForBuildingV2(building) {
				building = building || getCurrentBuildingName();
				debugLog('üìÇ Loading walkable data for building (v2)...', { building });
				
				// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï current building
				if (typeof walkablePointsData !== 'undefined') {
					walkablePointsData.currentBuilding = building;
				}
				
				try {
					// ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å admin storage ‡∏Å‡πà‡∏≠‡∏ô
					const adminKey = getSafeStorageKey(building, 'admin');
					const adminDataString = localStorage.getItem(adminKey);
					
					if (adminDataString) {
						const adminData = JSON.parse(adminDataString);
						
						// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkablePointsData
						if (typeof walkablePointsData !== 'undefined') {
							Object.assign(walkablePointsData, adminData);
							
							// Render ‡πÉ‡∏´‡∏°‡πà
							if (typeof renderWalkablePoints === 'function') {
								renderWalkablePoints();
							}
							if (typeof updateWalkableStats === 'function') {
								updateWalkableStats();
							}
							if (typeof loadWalkableSettings === 'function') {
								loadWalkableSettings();
							}
						}
						
						debugLog('‚úÖ Loaded admin walkable data', {
							nodes: Object.keys(adminData.nodes || {}).length,
							edges: (adminData.edges || []).length
						});
						return;
					}
					
					// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• admin ‡∏•‡∏≠‡∏á‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ index data ‡πÑ‡∏´‡∏°
					const synced = syncIndexDataToAdmin(building);
					if (synced) {
						debugLog('‚úÖ Synced index data to admin');
						return;
					}
					
					// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÜ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
					debugLog('üìã No existing data, creating fresh admin data');
					if (typeof walkablePointsData !== 'undefined') {
						walkablePointsData.nodes = {};
						walkablePointsData.edges = [];
						walkablePointsData.currentBuilding = building;
						
						if (typeof renderWalkablePoints === 'function') {
							renderWalkablePoints();
						}
						if (typeof updateWalkableStats === 'function') {
							updateWalkableStats();
						}
					}
					
				} catch (error) {
					debugLog('‚ùå Error loading walkable data for building:', error);
					
					// Error fallback
					if (typeof walkablePointsData !== 'undefined') {
						walkablePointsData.nodes = {};
						walkablePointsData.edges = [];
						walkablePointsData.currentBuilding = building;
					}
				}
			}

			// Load data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö index.html (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà loadWalkableData ‡πÄ‡∏î‡∏¥‡∏°)
			function loadWalkableDataWithAdminSyncV2(building) {
				building = building || getCurrentBuildingName();
				debugLog('üìÇ Loading walkable data with admin sync (v2)...', { building });
				
				// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï current building
				if (typeof walkableRoutingData !== 'undefined') {
					walkableRoutingData.currentBuilding = building;
				}
				
				try {
					// ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å admin ‡∏Å‡πà‡∏≠‡∏ô (admin has priority)
					const adminSynced = syncAdminDataToIndex(building);
					if (adminSynced) {
						debugLog('‚úÖ Loaded admin-created walkable data');
						return;
					}
					
					// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• admin ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å index cache
					const indexKey = getSafeStorageKey(building, 'index');
					const indexDataString = localStorage.getItem(indexKey);
					
					if (indexDataString) {
						const indexData = JSON.parse(indexDataString);
						
						// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkableRoutingData
						if (typeof walkableRoutingData !== 'undefined') {
							Object.assign(walkableRoutingData, indexData);
						}
						
						debugLog('üìã Loaded cached index walkable data', {
							nodes: Object.keys(indexData.nodes || {}).length,
							edges: (indexData.edges || []).length
						});
						return;
					}
					
					// ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÜ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á fixed grid
					debugLog('üóèÔ∏è No existing data, creating fixed grid');
					if (typeof createFixedWalkableGrid === 'function') {
						createFixedWalkableGrid();
					} else if (typeof walkableRoutingData !== 'undefined') {
						// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
						walkableRoutingData.nodes = {};
						walkableRoutingData.edges = [];
						walkableRoutingData.isInitialized = true;
					}
					
				} catch (error) {
					debugLog('‚ùå Error loading walkable data with admin sync:', error);
					
					// Error fallback
					if (typeof walkableRoutingData !== 'undefined') {
						walkableRoutingData.nodes = {};
						walkableRoutingData.edges = [];
						walkableRoutingData.isInitialized = false;
					}
				}
			}

			// ========== 6. Enhanced Save Functions ==========

			// Save data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin.html (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà saveWalkableData ‡πÄ‡∏î‡∏¥‡∏°)
			function saveWalkableDataV2() {
				const building = getCurrentBuildingName();
				debugLog('üíæ Saving walkable data (v2)...', { building });
				
				try {
					if (typeof walkablePointsData === 'undefined') {
						throw new Error('walkablePointsData not found');
					}
					
					// ‡πÄ‡∏û‡∏¥‡πà‡∏° metadata
					const dataToSave = {
						...walkablePointsData,
						building: building,
						currentBuilding: building,
						dataSource: 'admin',
						syncTime: new Date().toISOString(),
						timestamp: new Date().toISOString()
					};
					
					// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô admin storage
					const adminKey = getSafeStorageKey(building, 'admin');
					localStorage.setItem(adminKey, JSON.stringify(dataToSave));
					
					debugLog('‚úÖ Admin data saved successfully', {
						adminKey,
						nodes: Object.keys(dataToSave.nodes || {}).length,
						edges: (dataToSave.edges || []).length
					});
					
					// Auto-sync to index ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
					if (ADMIN_INDEX_BRIDGE.autoSyncOnChange) {
						const indexData = convertAdminToIndexFormat(dataToSave);
						if (indexData) {
							const indexKey = getSafeStorageKey(building, 'index');
							localStorage.setItem(indexKey, JSON.stringify(indexData));
							debugLog('üîÑ Auto-synced to index format');
						}
					}
					
					// ‡πÅ‡∏™‡∏î‡∏á notification ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
					if (typeof showNotification === 'function') {
						showNotification('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
					}
					
				} catch (error) {
					debugLog('‚ùå Error saving walkable data:', error);
					
					if (typeof showNotification === 'function') {
						showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
					}
				}
			}

			// Save data ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö index.html
			function saveWalkableDataV2ForIndex() {
				const building = getCurrentBuildingName();
				debugLog('üíæ Saving walkable data for index (v2)...', { building });
				
				try {
					if (typeof walkableRoutingData === 'undefined') {
						throw new Error('walkableRoutingData not found');
					}
					
					// ‡πÄ‡∏û‡∏¥‡πà‡∏° metadata
					const dataToSave = {
						...walkableRoutingData,
						currentBuilding: building,
						dataSource: 'index',
						syncTime: new Date().toISOString()
					};
					
					// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô index storage
					const indexKey = getSafeStorageKey(building, 'index');
					localStorage.setItem(indexKey, JSON.stringify(dataToSave));
					
					debugLog('‚úÖ Index data saved successfully', {
						indexKey,
						nodes: Object.keys(dataToSave.nodes || {}).length,
						edges: (dataToSave.edges || []).length
					});
					
				} catch (error) {
					debugLog('‚ùå Error saving index walkable data:', error);
				}
			}

			// ========== 7. Debug and Status Functions ==========

			// ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ bridge system
			function debugBridgeStatus() {
				const building = getCurrentBuildingName();
				
				console.group('üîç Bridge System Status');
				console.log('Environment:', {
					isAdmin: ADMIN_INDEX_BRIDGE.isAdminMode(),
					isIndex: ADMIN_INDEX_BRIDGE.isIndexMode(),
					building: building
				});
				
				console.log('Storage Keys:', {
					admin: getSafeStorageKey(building, 'admin'),
					index: getSafeStorageKey(building, 'index')
				});
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
				const adminKey = getSafeStorageKey(building, 'admin');
				const indexKey = getSafeStorageKey(building, 'index');
				
				const adminData = localStorage.getItem(adminKey);
				const indexData = localStorage.getItem(indexKey);
				
				console.log('Storage Status:', {
					adminData: adminData ? 'EXISTS' : 'NOT FOUND',
					indexData: indexData ? 'EXISTS' : 'NOT FOUND'
				});
				
				if (adminData) {
					try {
						const parsed = JSON.parse(adminData);
						console.log('Admin Data:', {
							nodes: Object.keys(parsed.nodes || {}).length,
							edges: (parsed.edges || []).length,
							source: parsed.dataSource,
							syncTime: parsed.syncTime
						});
					} catch (e) {
						console.warn('‚ö†Ô∏è Admin data parsing error:', e);
					}
				}
				
				if (indexData) {
					try {
						const parsed = JSON.parse(indexData);
						console.log('Index Data:', {
							nodes: Object.keys(parsed.nodes || {}).length,
							edges: (parsed.edges || []).length,
							source: parsed.dataSource,
							syncTime: parsed.syncTime
						});
					} catch (e) {
						console.warn('‚ö†Ô∏è Index data parsing error:', e);
					}
				}
				
				console.log('Bridge Status:', {
					lastSync: ADMIN_INDEX_BRIDGE.lastSyncTime,
					conversionCount: ADMIN_INDEX_BRIDGE.conversionCount,
					lastError: ADMIN_INDEX_BRIDGE.lastConversionError
				});
				
				console.groupEnd();
			}

			// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
			function testDataConversion() {
				const building = getCurrentBuildingName();
				console.group('üß™ Testing Data Conversion');
				
				// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
				const testAdminData = {
					currentBuilding: building,
					nodes: {
						'test1': { id: 'test1', x: 10, y: 20, type: 'center' },
						'test2': { id: 'test2', x: 30, y: 40, type: 'grid' }
					},
					edges: [
						{ from: 'test1', to: 'test2', weight: 25.5, bidirectional: true }
					],
					settings: { maxConnectionDistance: 30, metersPerPercent: 1.5 }
				};
				
				// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö admin ‚Üí index
				console.log('Testing admin ‚Üí index conversion...');
				const indexResult = convertAdminToIndexFormat(testAdminData);
				console.log('Result:', indexResult);
				
				// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö index ‚Üí admin
				if (indexResult) {
					console.log('Testing index ‚Üí admin conversion...');
					const adminResult = convertIndexToAdminFormat(indexResult);
					console.log('Result:', adminResult);
				}
				
				console.groupEnd();
			}

			// ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debug)
			function clearAllWalkableData(building) {
				building = building || getCurrentBuildingName();
				
				const adminKey = getSafeStorageKey(building, 'admin');
				const indexKey = getSafeStorageKey(building, 'index');
				
				localStorage.removeItem(adminKey);
				localStorage.removeItem(indexKey);
				
				// ‡∏•‡πâ‡∏≤‡∏á old format data ‡∏î‡πâ‡∏ß‡∏¢ (migration)
				const oldKey = `walkableData_${building}`;
				localStorage.removeItem(oldKey);
				
				console.log('üóëÔ∏è Cleared all walkable data for building:', building);
				debugBridgeStatus();
			}

			// ========== 8. Initialization and Integration ==========

			// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ready
			function initializeBridgeSystem() {
				debugLog('üöÄ Initializing Bridge System...');
				
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö environment
				if (!ADMIN_INDEX_BRIDGE.isAdminMode() && !ADMIN_INDEX_BRIDGE.isIndexMode()) {
					debugLog('‚ö†Ô∏è Unknown environment, bridge system inactive');
					return;
				}
				
				// ‡πÄ‡∏û‡∏¥‡πà‡∏° debug commands ‡πÉ‡∏ô window
				if (ADMIN_INDEX_BRIDGE.debugMode) {
					window.debugBridgeStatus = debugBridgeStatus;
					window.testDataConversion = testDataConversion;
					window.clearAllWalkableData = clearAllWalkableData;
					window.ADMIN_INDEX_BRIDGE = ADMIN_INDEX_BRIDGE;
				}
				
				debugLog('‚úÖ Bridge System initialized successfully');
				debugLog('üîß Available debug commands: debugBridgeStatus(), testDataConversion(), clearAllWalkableData()');
			}

			// Auto-initialize ‡πÄ‡∏°‡∏∑‡πà‡∏≠ script load
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', initializeBridgeSystem);
			} else {
				initializeBridgeSystem();
			}

			// ========== 9. Helper Functions ==========

			function debugLog(message, data = null) {
				if (!ADMIN_INDEX_BRIDGE.debugMode) return;
				
				const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
				const prefix = `[${timestamp}] Bridge:`;
				
				if (data) {
					console.log(prefix, message, data);
				} else {
					console.log(prefix, message);
				}
			}

			// Export functions for global use
			window.PHASE_2_1_FUNCTIONS = {
				// Storage
				getSafeStorageKey,
				getCurrentBuildingName,
				
				// Conversion
				convertAdminToIndexFormat,
				convertIndexToAdminFormat,
				
				// Sync
				syncAdminDataToIndex,
				syncIndexDataToAdmin,
				
				// Loading
				loadWalkableDataForBuildingV2,
				loadWalkableDataWithAdminSyncV2,
				
				// Saving
				saveWalkableDataV2,
				saveWalkableDataV2ForIndex,
				
				// Debug
				debugBridgeStatus,
				testDataConversion,
				clearAllWalkableData
			};
			
			// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadWalkableDataForBuilding ‡πÅ‡∏•‡∏∞ saveWalkableData ‡πÄ‡∏î‡∏¥‡∏°
			window.loadWalkableDataForBuilding = loadWalkableDataForBuildingV2;
			window.saveWalkableData = saveWalkableDataV2;

		// ========== End Phase 2.1: Storage Key Separation + Complete Data Bridge ==========
			
			
		// ========== Phase 2.2A: Admin Walkable Sheets Integration ==========

		// ========== 1. Walkable Sheets Configuration ==========

		// ‡πÄ‡∏û‡∏¥‡πà‡∏° flag ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô infinite recursion
		let _saveInProgress = false;
		
		// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô sheetsConfig object (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç existing sheetsConfig)
		const WALKABLE_SHEETS_CONFIG = {
			// Existing sheetsConfig properties...
			...sheetsConfig,
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° walkable-specific settings
			walkableEnabled: true,
			autoSyncWalkable: true,
			walkableTimeout: 10000,
			walkableRetryAttempts: 2,
			
			// Walkable sync status
			walkableSyncStatus: 'idle', // idle, syncing, success, error
			lastWalkableSync: null,
			walkableSyncErrors: []
		};

		// ========== 2. Core Walkable Sheets Functions ==========

		// ‡πÇ‡∏´‡∏•‡∏î walkable data ‡∏à‡∏≤‡∏Å Google Sheets
		async function loadWalkableDataFromSheets(building) {
			if (!sheetsConfig.url || !sheetsConfig.connected) {
				debugLog('‚ö†Ô∏è Sheets not configured or connected');
				return null;
			}
			
			building = building || getCurrentBuildingName();
			WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'syncing';
			updateWalkableSyncUI();
			
			try {
				debugLog(`üì• Loading walkable data from sheets for: ${building}`);
				
				const params = new URLSearchParams();
				params.append('action', 'getWalkableData');
				params.append('building', building);
				
				const response = await Promise.race([
					fetch(sheetsConfig.url, {
						method: 'POST',
						headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
						body: params.toString()
					}),
					new Promise((_, reject) => 
						setTimeout(() => reject(new Error('Timeout')), WALKABLE_SHEETS_CONFIG.walkableTimeout)
					)
				]);
				
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				
				const result = await response.json();
				
				if (result.success && result.data) {
					WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'success';
					WALKABLE_SHEETS_CONFIG.lastWalkableSync = new Date().toISOString();
					
					debugLog('‚úÖ Loaded walkable data from sheets:', {
						nodes: Object.keys(result.data.nodes || {}).length,
						edges: (result.data.edges || []).length
					});
					
					updateWalkableSyncUI();
					showWalkableNotification('üì• ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
					
					return result.data;
				} else {
					throw new Error(result.error || 'Invalid response format');
				}
				
			} catch (error) {
				WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'error';
				WALKABLE_SHEETS_CONFIG.walkableSyncErrors.push({
					timestamp: new Date().toISOString(),
					operation: 'load',
					error: error.message
				});
				
				debugLog('‚ùå Failed to load walkable data from sheets:', error);
				updateWalkableSyncUI();
				showWalkableNotification(`‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
				
				return null;
			}
		}

		// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å walkable data ‡πÑ‡∏õ Google Sheets
		async function saveWalkableDataToSheets(data) {
			if (!sheetsConfig.url || !sheetsConfig.connected) {
				debugLog('‚ö†Ô∏è Sheets not configured or connected');
				return false;
			}
			
			if (!data || !data.nodes) {
				debugLog('‚ùå Invalid walkable data for saving');
				return false;
			}
			
			WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'syncing';
			updateWalkableSyncUI();
			
			try {
				const building = data.currentBuilding || data.building || getCurrentBuildingName();
				
				debugLog(`üì§ Saving walkable data to sheets for: ${building}`);
				
				const params = new URLSearchParams();
				params.append('action', 'saveWalkableData');
				params.append('building', building);
				params.append('nodes', JSON.stringify(data.nodes || {}));
				params.append('edges', JSON.stringify(data.edges || []));
				params.append('settings', JSON.stringify(data.settings || {}));
				
				const response = await Promise.race([
					fetch(sheetsConfig.url, {
						method: 'POST',
						headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
						body: params.toString()
					}),
					new Promise((_, reject) => 
						setTimeout(() => reject(new Error('Timeout')), WALKABLE_SHEETS_CONFIG.walkableTimeout)
					)
				]);
				
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				
				const result = await response.json();
				
				if (result.success) {
					WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'success';
					WALKABLE_SHEETS_CONFIG.lastWalkableSync = new Date().toISOString();
					
					debugLog('‚úÖ Saved walkable data to sheets:', result.data);
					updateWalkableSyncUI();
					showWalkableNotification('üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
					
					return true;
				} else {
					throw new Error(result.error || 'Save operation failed');
				}
				
			} catch (error) {
				WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'error';
				WALKABLE_SHEETS_CONFIG.walkableSyncErrors.push({
					timestamp: new Date().toISOString(),
					operation: 'save',
					error: error.message
				});
				
				debugLog('‚ùå Failed to save walkable data to sheets:', error);
				updateWalkableSyncUI();
				showWalkableNotification(`‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
				
				return false;
			}
		}

		// ‡∏™‡∏£‡πâ‡∏≤‡∏á walkable sheets ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
		async function createWalkableSheetsAuto(building) {
			if (!sheetsConfig.url || !sheetsConfig.connected) {
				debugLog('‚ö†Ô∏è Cannot create sheets - not connected');
				return false;
			}
			
			building = building || getCurrentBuildingName();
			
			try {
				debugLog(`üèóÔ∏è Creating walkable sheets for: ${building}`);
				
				const params = new URLSearchParams();
				params.append('action', 'createWalkableSheets');
				params.append('building', building);
				
				const response = await fetch(sheetsConfig.url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: params.toString()
				});
				
				if (response.ok) {
					const result = await response.json();
					if (result.success) {
						debugLog('‚úÖ Walkable sheets created successfully');
						showWalkableNotification('üèóÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
						return true;
					}
				}
				
				throw new Error('Failed to create walkable sheets');
				
			} catch (error) {
				debugLog('‚ùå Error creating walkable sheets:', error);
				showWalkableNotification(`‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
				return false;
			}
		}

		// ========== 3. Enhanced Save Function with Sheets Integration ==========

		// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà saveWalkableData ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Sheets
		async function saveWalkableDataEnhanced() {
			// ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô infinite loop
			if (_saveInProgress) {
				debugLog('‚ö†Ô∏è Save already in progress, skipping...');
				return true;
			}
			
			_saveInProgress = true;
			
			try {
				const building = getCurrentBuildingName();
				debugLog('üíæ Saving walkable data (enhanced with sheets)...', { building });
				
				if (typeof walkablePointsData === 'undefined') {
					throw new Error('walkablePointsData not found');
				}
				
				// ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
				const dataToSave = {
					...walkablePointsData,
					building: building,
					currentBuilding: building,
					dataSource: 'admin',
					syncTime: new Date().toISOString(),
					timestamp: new Date().toISOString()
				};
				
				// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô localStorage (‡∏ï‡∏≤‡∏° Phase 2.1)
				const adminKey = getSafeStorageKey(building, 'admin');
				localStorage.setItem(adminKey, JSON.stringify(dataToSave));
				
				debugLog('‚úÖ Saved to localStorage:', { adminKey });
				
				// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ Google Sheets (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
				if (WALKABLE_SHEETS_CONFIG.walkableEnabled && sheetsConfig.connected) {
					const sheetsSuccess = await saveWalkableDataToSheets(dataToSave);
					
					if (sheetsSuccess) {
						debugLog('‚úÖ Saved to Google Sheets successfully');
					} else {
						debugLog('‚ö†Ô∏è Failed to save to Google Sheets, but localStorage saved');
						showWalkableNotification('‚ö†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà Google Sheets ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'warning');
					}
				}
				
				// Auto-sync ‡πÑ‡∏õ index format (‡∏ï‡∏≤‡∏° Phase 2.1)
				if (ADMIN_INDEX_BRIDGE.autoSyncOnChange) {
					const indexData = convertAdminToIndexFormat(dataToSave);
					if (indexData) {
						const indexKey = getSafeStorageKey(building, 'index');
						localStorage.setItem(indexKey, JSON.stringify(indexData));
						debugLog('üîÑ Auto-synced to index format');
					}
				}
				
				// ‡πÅ‡∏™‡∏î‡∏á notification
				if (typeof showNotification === 'function') {
					showNotification('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
				}
				
				return true;
				
			} catch (error) {
				debugLog('‚ùå Error in enhanced save:', error);
				
				if (typeof showNotification === 'function') {
					showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
				}
				
				return false;
			} finally {
				// ‡∏õ‡∏•‡πà‡∏≠‡∏¢ flag
				_saveInProgress = false;
			}
		}

		// ========== 4. Enhanced Load Function with Sheets Integration ==========

		// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà loadWalkableDataForBuilding ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Sheets
		async function loadWalkableDataForBuildingEnhanced(building) {
			building = building || getCurrentBuildingName();
			debugLog('üìÇ Loading walkable data (enhanced with sheets)...', { building });
			
			// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï current building
			if (typeof walkablePointsData !== 'undefined') {
				walkablePointsData.currentBuilding = building;
			}
			
			try {
				let loadedData = null;
				
				// ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î: Sheets ‚Üí localStorage ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
				
				// 1. ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets ‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)
				if (WALKABLE_SHEETS_CONFIG.walkableEnabled && sheetsConfig.connected) {
					loadedData = await loadWalkableDataFromSheets(building);
					
					if (loadedData) {
						// ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô admin format ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
						if (loadedData.dataSource !== 'admin') {
							loadedData = convertIndexToAdminFormat(loadedData) || loadedData;
						}
						
						// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkablePointsData
						if (typeof walkablePointsData !== 'undefined') {
							Object.assign(walkablePointsData, loadedData);
							renderUI();
						}
						
						debugLog('‚úÖ Loaded from Google Sheets');
						return;
					}
				}
				
				// 2. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localStorage (‡∏ï‡∏≤‡∏° Phase 2.1)
				const adminKey = getSafeStorageKey(building, 'admin');
				const adminDataString = localStorage.getItem(adminKey);
				
				if (adminDataString) {
					const adminData = JSON.parse(adminDataString);
					
					if (typeof walkablePointsData !== 'undefined') {
						Object.assign(walkablePointsData, adminData);
						renderUI();
					}
					
					debugLog('‚úÖ Loaded from localStorage');
					return;
				}
				
				// 3. ‡∏•‡∏≠‡∏á sync ‡∏à‡∏≤‡∏Å index (‡∏ï‡∏≤‡∏° Phase 2.1)
				const synced = syncIndexDataToAdmin(building);
				if (synced) {
					debugLog('‚úÖ Synced from index data');
					return;
				}
				
				// 4. ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
				debugLog('üìã Creating fresh admin data');
				if (typeof walkablePointsData !== 'undefined') {
					walkablePointsData.nodes = {};
					walkablePointsData.edges = [];
					walkablePointsData.currentBuilding = building;
					renderUI();
				}
				
			} catch (error) {
				debugLog('‚ùå Error in enhanced load:', error);
				
				// Fallback
				if (typeof walkablePointsData !== 'undefined') {
					walkablePointsData.nodes = {};
					walkablePointsData.edges = [];
					walkablePointsData.currentBuilding = building;
				}
				
				showWalkableNotification('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', 'warning');
			}
		}

		// ========== 5. UI Helper Functions ==========

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö walkable sync status
		function updateWalkableSyncUI() {
			// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sync status indicator (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
			const statusElement = document.getElementById('walkableSyncStatus');
			if (statusElement) {
				const status = WALKABLE_SHEETS_CONFIG.walkableSyncStatus;
				const lastSync = WALKABLE_SHEETS_CONFIG.lastWalkableSync;
				
				let statusText = '';
				let statusClass = '';
				
				switch (status) {
					case 'syncing':
						statusText = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á sync...';
						statusClass = 'syncing';
						break;
					case 'success':
						statusText = `‚úÖ sync ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${lastSync ? formatTime(lastSync) : ''}`;
						statusClass = 'success';
						break;
					case 'error':
						statusText = '‚ùå sync ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
						statusClass = 'error';
						break;
					default:
						statusText = '‚è∏Ô∏è ‡∏£‡∏≠ sync';
						statusClass = 'idle';
				}
				
				statusElement.textContent = statusText;
				statusElement.className = `sync-status ${statusClass}`;
			}
		}

		// ‡πÅ‡∏™‡∏î‡∏á notification ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö walkable
		function showWalkableNotification(message, type = 'info') {
			// ‡πÉ‡∏ä‡πâ existing showNotification ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
			if (typeof showNotification === 'function') {
				showNotification(message, type);
				return;
			}
			
			// Fallback notification
			console.log(`[${type.toUpperCase()}] ${message}`);
		}

		// Render UI elements (‡∏£‡∏ß‡∏° existing functions)
		function renderUI() {
			if (typeof renderWalkablePoints === 'function') {
				renderWalkablePoints();
			}
			if (typeof updateWalkableStats === 'function') {
				updateWalkableStats();
			}
			if (typeof loadWalkableSettings === 'function') {
				loadWalkableSettings();
			}
		}

		// Format timestamp for display
		function formatTime(isoString) {
			try {
				const date = new Date(isoString);
				return date.toLocaleTimeString('th-TH', { 
					hour: '2-digit', 
					minute: '2-digit' 
				});
			} catch {
				return '';
			}
		}

		// ========== 6. Manual Sync Functions ==========

		// Manual sync ‡πÑ‡∏õ Google Sheets
		async function manualSyncToSheets() {
			if (!sheetsConfig.connected) {
				showWalkableNotification('‚ùå ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', 'error');
				return;
			}
			
			if (typeof walkablePointsData === 'undefined' || !walkablePointsData.nodes) {
				showWalkableNotification('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sync', 'error');
				return;
			}
			
			showWalkableNotification('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ Google Sheets...', 'info');
			
			const success = await saveWalkableDataToSheets(walkablePointsData);
			
			if (success) {
				showWalkableNotification('‚úÖ Sync ‡πÑ‡∏õ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
			} else {
				showWalkableNotification('‚ùå Sync ‡πÑ‡∏õ Google Sheets ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
			}
		}

		// Manual load ‡∏à‡∏≤‡∏Å Google Sheets
		async function manualLoadFromSheets() {
			if (!sheetsConfig.connected) {
				showWalkableNotification('‚ùå ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', 'error');
				return;
			}
			
			showWalkableNotification('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏à‡∏≤‡∏Å Google Sheets...', 'info');
			
			const building = getCurrentBuildingName();
			const data = await loadWalkableDataFromSheets(building);
			
			if (data) {
				// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkablePointsData
				if (typeof walkablePointsData !== 'undefined') {
					Object.assign(walkablePointsData, data);
					renderUI();
				}
				
				// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô localStorage ‡∏î‡πâ‡∏ß‡∏¢
				const adminKey = getSafeStorageKey(building, 'admin');
				localStorage.setItem(adminKey, JSON.stringify(data));
				
				showWalkableNotification('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
			} else {
				showWalkableNotification('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
			}
		}

		// ========== 7. Integration with Existing Functions ==========

		// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà existing functions ‡∏î‡πâ‡∏ß‡∏¢ enhanced versions
		if (typeof window !== 'undefined') {
			// Backup original functions
			window.originalSaveWalkableData = window.saveWalkableData;
			window.originalLoadWalkableDataForBuilding = window.loadWalkableDataForBuilding;
			
			// Replace with enhanced versions
			window.saveWalkableData = saveWalkableDataEnhanced;
			window.loadWalkableDataForBuilding = loadWalkableDataForBuildingEnhanced;
			
			// Add new functions to window
			window.manualSyncToSheets = manualSyncToSheets;
			window.manualLoadFromSheets = manualLoadFromSheets;
			window.createWalkableSheetsAuto = createWalkableSheetsAuto;
		}

		// ========== 8. Auto-initialization ==========

		// Initialize enhanced walkable sheets on DOM ready
		function initializeWalkableSheets() {
			debugLog('üöÄ Initializing Walkable Sheets Integration...');
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ walkablePointsData
			if (typeof walkablePointsData === 'undefined') {
				debugLog('‚ö†Ô∏è walkablePointsData not found, walkable sheets integration inactive');
				return;
			}
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö auto-sync
			if (WALKABLE_SHEETS_CONFIG.autoSyncWalkable && typeof saveWalkableData === 'function') {
				// Auto-sync ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
				const originalAddNode = window.addWalkableNode;
				const originalDeleteNode = window.deleteWalkableNode;
				
				if (originalAddNode) {
					window.addWalkableNode = function(...args) {
						const result = originalAddNode.apply(this, args);
						if (result && WALKABLE_SHEETS_CONFIG.autoSyncWalkable) {
							setTimeout(() => saveWalkableDataEnhanced(), 1000);
						}
						return result;
					};
				}
				
				if (originalDeleteNode) {
					window.deleteWalkableNode = function(...args) {
						const result = originalDeleteNode.apply(this, args);
						if (result && WALKABLE_SHEETS_CONFIG.autoSyncWalkable) {
							setTimeout(() => saveWalkableDataEnhanced(), 1000);
						}
						return result;
					};
				}
			}
			
			debugLog('‚úÖ Walkable Sheets Integration initialized');
		}

		// Auto-initialize
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', initializeWalkableSheets);
		} else {
			initializeWalkableSheets();
		}
		
		// ========== 3. Enhanced Error Handling System ==========

		const WALKABLE_ERROR_HANDLER = {
			maxErrors: 10,
			retryDelays: [1000, 2000, 5000], // milliseconds
			
			// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å error ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô UI
			logError(operation, error, context = {}) {
				const timestamp = new Date().toISOString();
				const errorInfo = {
					timestamp,
					operation,
					error: error.message || error,
					context
				};
				
				// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô WALKABLE_SHEETS_CONFIG.walkableSyncErrors
				WALKABLE_SHEETS_CONFIG.walkableSyncErrors.push(errorInfo);
				
				// ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô errors
				if (WALKABLE_SHEETS_CONFIG.walkableSyncErrors.length > this.maxErrors) {
					WALKABLE_SHEETS_CONFIG.walkableSyncErrors.shift();
				}
				
				// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
				this.updateErrorUI();
				
				console.error(`[Walkable ${operation}]`, error, context);
			},
			
			// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï error log UI
			updateErrorUI() {
				const errorLog = document.getElementById('walkableErrorLog');
				const errorList = document.getElementById('walkableErrorList');
				const clearBtn = document.getElementById('clearErrorsBtn');
				
				if (!errorLog || !errorList) return;
				
				const errors = WALKABLE_SHEETS_CONFIG.walkableSyncErrors;
				
				if (errors.length === 0) {
					errorLog.style.display = 'none';
					if (clearBtn) clearBtn.style.display = 'none';
					return;
				}
				
				// ‡πÅ‡∏™‡∏î‡∏á error log
				errorLog.style.display = 'block';
				if (clearBtn) clearBtn.style.display = 'inline-block';
				
				// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ errors (‡πÅ‡∏™‡∏î‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 5 ‡∏≠‡∏±‡∏ô)
				const recentErrors = errors.slice(-5);
				errorList.innerHTML = recentErrors.map(err => {
					const time = new Date(err.timestamp).toLocaleTimeString('th-TH', {
						hour: '2-digit', minute: '2-digit'
					});
					return `<div class="error-item">${time}: ${err.operation} - ${err.error}</div>`;
				}).join('');
			},
			
			// ‡∏•‡∏≠‡∏á retry operation
			async retry(operation, maxAttempts = 3) {
				for (let attempt = 1; attempt <= maxAttempts; attempt++) {
					try {
						const result = await operation();
						return result;
					} catch (error) {
						if (attempt === maxAttempts) {
							throw error;
						}
						
						const delay = this.retryDelays[Math.min(attempt - 1, this.retryDelays.length - 1)];
						debugLog(`‚è≥ Retry ${attempt}/${maxAttempts} in ${delay}ms...`);
						await new Promise(resolve => setTimeout(resolve, delay));
					}
				}
			}
		};

		// ========== 4. Enhanced UI Update Functions ==========

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sync status ‡∏û‡∏£‡πâ‡∏≠‡∏° animation
		function updateWalkableSyncUIEnhanced() {
			const statusElement = document.getElementById('walkableSyncStatus');
			const progressElement = document.getElementById('walkableSyncProgress');
			const syncBtn = document.getElementById('syncToSheetsBtn');
			const loadBtn = document.getElementById('loadFromSheetsBtn');
			
			if (!statusElement) return;
			
			const status = WALKABLE_SHEETS_CONFIG.walkableSyncStatus;
			const lastSync = WALKABLE_SHEETS_CONFIG.lastWalkableSync;
			
			// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï status text ‡πÅ‡∏•‡∏∞ class
			let statusText, statusClass;
			
			switch (status) {
				case 'syncing':
					statusText = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á sync...';
					statusClass = 'syncing';
					if (progressElement) {
						progressElement.style.display = 'block';
						progressElement.querySelector('.progress-bar').style.width = '70%';
					}
					if (syncBtn) syncBtn.disabled = true;
					if (loadBtn) loadBtn.disabled = true;
					break;
					
				case 'success':
					statusText = `‚úÖ sync ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à${lastSync ? ' ' + formatTimeShort(lastSync) : ''}`;
					statusClass = 'success';
					if (progressElement) {
						progressElement.style.display = 'none';
					}
					if (syncBtn) syncBtn.disabled = false;
					if (loadBtn) loadBtn.disabled = false;
					break;
					
				case 'error':
					statusText = '‚ùå sync ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
					statusClass = 'error';
					if (progressElement) {
						progressElement.style.display = 'none';
					}
					if (syncBtn) syncBtn.disabled = false;
					if (loadBtn) loadBtn.disabled = false;
					break;
					
				default:
					statusText = '‚è∏Ô∏è ‡∏£‡∏≠ sync';
					statusClass = 'idle';
					if (progressElement) {
						progressElement.style.display = 'none';
					}
					if (syncBtn) syncBtn.disabled = false;
					if (loadBtn) loadBtn.disabled = false;
			}
			
			statusElement.textContent = statusText;
			statusElement.className = `sync-status ${statusClass}`;
			
			// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï auto-sync button
			const autoSyncBtn = document.getElementById('autoSyncBtn');
			if (autoSyncBtn) {
				autoSyncBtn.textContent = WALKABLE_SHEETS_CONFIG.autoSyncWalkable ? 'üîÑ Auto ON' : '‚è∏Ô∏è Auto OFF';
				autoSyncBtn.className = `btn btn-sm ${WALKABLE_SHEETS_CONFIG.autoSyncWalkable ? 'btn-success' : 'btn-secondary'}`;
			}
		}

		// ========== 5. Enhanced Functions with Error Handling ==========

		// Enhanced sync ‡πÑ‡∏õ Sheets ‡∏û‡∏£‡πâ‡∏≠‡∏° error handling
		async function manualSyncToSheetsEnhanced() {
			if (!sheetsConfig.connected) {
				showWalkableNotification('‚ùå ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', 'error');
				return false;
			}
			
			if (typeof walkablePointsData === 'undefined' || !walkablePointsData.nodes) {
				showWalkableNotification('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sync', 'error');
				return false;
			}
			
			WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'syncing';
			updateWalkableSyncUIEnhanced();
			
			try {
				const result = await WALKABLE_ERROR_HANDLER.retry(async () => {
					return await saveWalkableDataToSheets(walkablePointsData);
				}, 2);
				
				if (result) {
					WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'success';
					WALKABLE_SHEETS_CONFIG.lastWalkableSync = new Date().toISOString();
					showWalkableNotification('‚úÖ Sync ‡πÑ‡∏õ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
				} else {
					throw new Error('Sync operation returned false');
				}
				
			} catch (error) {
				WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'error';
				WALKABLE_ERROR_HANDLER.logError('manualSync', error, {
					nodesCount: Object.keys(walkablePointsData.nodes || {}).length,
					edgesCount: (walkablePointsData.edges || []).length
				});
				showWalkableNotification(`‚ùå Sync ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
			}
			
			updateWalkableSyncUIEnhanced();
			return WALKABLE_SHEETS_CONFIG.walkableSyncStatus === 'success';
		}

		// Enhanced load ‡∏à‡∏≤‡∏Å Sheets ‡∏û‡∏£‡πâ‡∏≠‡∏° error handling
		async function manualLoadFromSheetsEnhanced() {
			if (!sheetsConfig.connected) {
				showWalkableNotification('‚ùå ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets', 'error');
				return false;
			}
			
			WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'syncing';
			updateWalkableSyncUIEnhanced();
			
			try {
				const building = getCurrentBuildingName();
				const data = await WALKABLE_ERROR_HANDLER.retry(async () => {
					return await loadWalkableDataFromSheets(building);
				}, 2);
				
				if (data) {
					// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï walkablePointsData
					if (typeof walkablePointsData !== 'undefined') {
						Object.assign(walkablePointsData, data);
						renderUI();
					}
					
					// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô localStorage
					const adminKey = getSafeStorageKey(building, 'admin');
					localStorage.setItem(adminKey, JSON.stringify(data));
					
					WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'success';
					WALKABLE_SHEETS_CONFIG.lastWalkableSync = new Date().toISOString();
					showWalkableNotification('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
				} else {
					throw new Error('No data received from Sheets');
				}
				
			} catch (error) {
				WALKABLE_SHEETS_CONFIG.walkableSyncStatus = 'error';
				WALKABLE_ERROR_HANDLER.logError('manualLoad', error, {
					building: getCurrentBuildingName()
				});
				showWalkableNotification(`‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
			}
			
			updateWalkableSyncUIEnhanced();
			return WALKABLE_SHEETS_CONFIG.walkableSyncStatus === 'success';
		}

		// ========== 6. UI Control Functions ==========

		// Toggle auto-sync
		function autoSyncToggle() {
			WALKABLE_SHEETS_CONFIG.autoSyncWalkable = !WALKABLE_SHEETS_CONFIG.autoSyncWalkable;
			
			// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
			localStorage.setItem('walkableSheetsConfig', JSON.stringify(WALKABLE_SHEETS_CONFIG));
			
			updateWalkableSyncUIEnhanced();
			
			const status = WALKABLE_SHEETS_CONFIG.autoSyncWalkable ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î';
			showWalkableNotification(`üîÑ Auto-sync ${status}`, 'info');
		}

		// ‡∏•‡πâ‡∏≤‡∏á error log
		function clearWalkableErrors() {
			WALKABLE_SHEETS_CONFIG.walkableSyncErrors = [];
			WALKABLE_ERROR_HANDLER.updateErrorUI();
			showWalkableNotification('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á error log ‡πÅ‡∏•‡πâ‡∏ß', 'info');
		}

		// ========== 7. Connection Monitor ==========

		const CONNECTION_MONITOR = {
			intervalId: null,
			checkInterval: 30000, // 30 seconds
			 
			start() {
				if (this.intervalId) return;
				
				this.intervalId = setInterval(async () => {
					if (sheetsConfig.url && sheetsConfig.connected) {
						try {
							// Test connection ‡∏™‡∏±‡πâ‡∏ô‡πÜ
							const params = new URLSearchParams();
							params.append('action', 'getData');
							params.append('sheet', 'Buildings');
							
							const response = await Promise.race([
								fetch(sheetsConfig.url, {
									method: 'POST',
									headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
									body: params.toString()
								}),
								new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 5000))
							]);
							
							if (!response.ok) {
								throw new Error(`HTTP ${response.status}`);
							}
							
						} catch (error) {
							console.warn('üåê Connection check failed:', error.message);
							if (sheetsConfig.connected) {
								sheetsConfig.connected = false;
								showWalkableNotification('‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢', 'warning');
							}
						}
					}
				}, this.checkInterval);
			},
			
			stop() {
				if (this.intervalId) {
					clearInterval(this.intervalId);
					this.intervalId = null;
				}
			}
			
				 
		};

		// ========== 8. Helper Functions ==========

		function formatTimeShort(isoString) {
			try {
				const date = new Date(isoString);
				const now = new Date();
				const diffMs = now - date;
				
				if (diffMs < 60000) return '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
				if (diffMs < 3600000) return `${Math.floor(diffMs/60000)} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
				return date.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
			} catch {
				return '';
			}
		}

		// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï original functions
		function updateWalkableSyncUI() {
			updateWalkableSyncUIEnhanced();
		}

		// ========== 9. Initialization ==========

		function initializeWalkableUIEnhanced() {
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS styles
			if (!document.getElementById('walkableUIStyles')) {
				const style = document.createElement('style');
				style.id = 'walkableUIStyles';
				style.textContent = WALKABLE_UI_STYLES;
				document.head.appendChild(style);
			}
			
			// ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
			try {
				const savedConfig = localStorage.getItem('walkableSheetsConfig');
				if (savedConfig) {
					Object.assign(WALKABLE_SHEETS_CONFIG, JSON.parse(savedConfig));
				}
			} catch (error) {
				console.warn('Failed to load walkable sheets config:', error);
			}
			
			// ‡πÄ‡∏£‡∏¥‡πà‡∏° connection monitor
			CONNECTION_MONITOR.start();
			
			// ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà functions ‡πÄ‡∏î‡∏¥‡∏°
			if (typeof window !== 'undefined') {
				//window.manualSyncToSheets = manualSyncToSheetsEnhanced;
				//window.manualLoadFromSheets = manualLoadFromSheetsEnhanced;
				//window.autoSyncToggle = autoSyncToggle;
				//window.clearWalkableErrors = clearWalkableErrors;
			}
			
			// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
			updateWalkableSyncUIEnhanced();
			
			debugLog('‚úÖ Walkable UI Enhanced initialized');
		}

		// Auto-initialize
		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', initializeWalkableUIEnhanced);
		} else {
			initializeWalkableUIEnhanced();
		}

		// Cleanup on page unload
		window.addEventListener('beforeunload', () => {
			CONNECTION_MONITOR.stop();
		});

		//*****************End of  Phase 2.2A: Admin Walkable Sheets Integration ==========	
			
		// ========== COORDINATE SYSTEM FIX CLASS ========== 
		// üéØ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏Å‡∏≤‡∏£ sync coordinate system ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á admin ‡πÅ‡∏•‡∏∞ index

		class MapCoordinateSystem {
			constructor() {
				this.containers = new Map();
				this.initialized = false;
				this.debug = true;
			}

			// ‚úÖ Initialize coordinate system
			init() {
				if (this.initialized) return;
				
				this.log('üéØ Initializing Map Coordinate System...');
				
				// Find and register all map containers
				this.registerContainers();
				
				// Apply consistent sizing
				this.applyConsistentSizing();
				
				// Setup responsive handlers  
				this.setupResponsiveHandlers();
				
				// Setup coordinate conversion utilities
				this.setupCoordinateConversion();
				
				this.initialized = true;
				this.log('‚úÖ Map Coordinate System initialized');
			}

			// ‚úÖ Register all map containers
			registerContainers() {
				const selectors = [
					'#walkableMapContainer',
					'.map-area', 
					'.map-canvas-container',
					'.walkable-canvas',
					'.mapWrap',
					'.walkable-map-container'
				];

				selectors.forEach(selector => {
					const elements = document.querySelectorAll(selector);
					elements.forEach((element, index) => {
						const key = `${selector.replace(/[#.]/g, '')}_${index}`;
						this.containers.set(key, {
							element,
							selector,
							rect: null,
							aspectRatio: 4/3
						});
						
						// Set coordinate system attribute
						element.setAttribute('data-coordinate-system', 'percentage');
						
						this.log(`üìù Registered container: ${key}`, element);
					});
				});
			}

			// ‚úÖ Apply consistent sizing across all containers
			applyConsistentSizing() {
				const sizes = {
					desktop: { minHeight: '520px', aspectRatio: '4/3' },
					tablet: { minHeight: '350px', aspectRatio: '4/3' },
					mobile: { minHeight: '250px', aspectRatio: '3/2' }
				};

				this.containers.forEach((container, key) => {
					const element = container.element;
					
					// Apply base styles
					this.applyBaseStyles(element);
					
					// Apply responsive sizes
					this.applyResponsiveSizing(element, sizes);
					
					// Update container info
					container.rect = element.getBoundingClientRect();
					
					this.log(`üîß Applied sizing to: ${key}`);
				});
			}

			// ‚úÖ Apply base styles to container
			applyBaseStyles(element) {
				const styles = {
					position: 'relative',
					width: '100%',
					background: '#f8fafc',
					border: '1px solid #e2e8f0',
					borderRadius: '8px',
					overflow: 'hidden',
					display: 'flex',
					alignItems: 'center',
					justifyContent: 'center'
				};

				Object.assign(element.style, styles);
			}
			
			// ‚úÖ Apply responsive sizing to container
			applyResponsiveSizing(element, sizes) {
				// Apply desktop default
				element.style.minHeight = sizes.desktop.minHeight;
				element.style.aspectRatio = sizes.desktop.aspectRatio;
				
				// Check current screen size and apply appropriate sizing
				const screenWidth = window.innerWidth;
				
				if (screenWidth <= 480) {
					// Mobile
					element.style.minHeight = sizes.mobile.minHeight;
					element.style.aspectRatio = sizes.mobile.aspectRatio;
				} else if (screenWidth <= 768) {
					// Tablet  
					element.style.minHeight = sizes.tablet.minHeight;
					element.style.aspectRatio = sizes.tablet.aspectRatio;
				}
				
				this.log(`üì± Applied responsive sizing: ${element.style.minHeight}`);
			}
			
			// ‚úÖ Setup responsive handlers
			setupResponsiveHandlers() {
				this.log('üì± Setting up responsive handlers...');
				
				let resizeTimeout;
				window.addEventListener('resize', () => {
					clearTimeout(resizeTimeout);
					resizeTimeout = setTimeout(() => {
						this.log('üîÑ Window resized, updating containers...');
						this.applyConsistentSizing();
					}, 250);
				});
				
				// Setup media query listeners
				const queries = [
					{ query: '(max-width: 480px)', name: 'mobile' },
					{ query: '(max-width: 768px)', name: 'tablet' },
					{ query: '(min-width: 769px)', name: 'desktop' }
				];
				
				queries.forEach(({ query, name }) => {
					const mediaQuery = window.matchMedia(query);
					mediaQuery.addListener(() => {
						this.log(`üì± Media query changed: ${name}`);
						this.applyConsistentSizing();
					});
				});
				
				this.log('‚úÖ Responsive handlers setup complete');
			}

			// ‚úÖ Setup coordinate conversion utilities
			setupCoordinateConversion() {
				this.log('üéØ Setting up coordinate conversion utilities...');
				
				// Expose conversion methods globally
				window.mapCoordUtils = {
					toPercent: (x, y, containerId) => this.convertCoordinates(x, y, 'pixel-to-percent', containerId),
					toPixel: (x, y, containerId) => this.convertCoordinates(x, y, 'percent-to-pixel', containerId),
					getContainer: (containerId) => this.getMapContainer(containerId),
					validate: () => this.validateContainers()
				};
				
				this.log('‚úÖ Coordinate conversion utilities ready');
			}

			// ‚úÖ Get map container by ID or return first available
			getMapContainer(containerId = null) {
				if (containerId) {
					const container = this.containers.get(containerId);
					return container ? container.element : null;
				}
				
				// Return first available container
				const firstContainer = this.containers.values().next();
				return firstContainer.done ? null : firstContainer.value.element;
			}

			// ‚úÖ Validate all containers
			validateContainers() {
				const results = {
					valid: true,
					containers: [],
					errors: []
				};
				
				this.containers.forEach((container, key) => {
					const element = container.element;
					if (element) {
						const rect = element.getBoundingClientRect();
						const computedStyle = window.getComputedStyle(element);
						const minHeight = parseInt(computedStyle.minHeight) || 0;
						
						const validation = {
							key,
							minHeight,
							actualHeight: rect.height,
							hasValidSize: minHeight >= 250 && rect.height >= 200
						};
						
						results.containers.push(validation);
						
						if (!validation.hasValidSize) {
							results.valid = false;
							results.errors.push(`${key}: insufficient size (min: ${minHeight}px, actual: ${rect.height}px)`);
						}
					}
				});
				
				this.log('üîç Container validation:', results);
				return results;
			}

			// ‚úÖ Convert coordinates between percentage and pixels
			convertCoordinates(x, y, fromType, containerId = null) {
				const container = this.getMapContainer(containerId);
				if (!container) {
					this.log('‚ùå No valid container found for coordinate conversion');
					return { x: 0, y: 0 };
				}

				const rect = container.getBoundingClientRect();
				
				if (fromType === 'percent-to-pixel') {
					return {
						x: (x / 100) * rect.width,
						y: (y / 100) * rect.height
					};
				} else if (fromType === 'pixel-to-percent') {
					return {
						x: Math.max(0, Math.min(100, (x / rect.width) * 100)),
						y: Math.max(0, Math.min(100, (y / rect.height) * 100))
					};
				}

				return { x, y };
			}

			// ‚úÖ Debug logging
			log(...args) {
				if (this.debug) {
					console.log('[MapCoordinateSystem]', ...args);
				}
			}
		}

		// ========== WALKABLE SYNC MANAGER ========== 
		class WalkableSyncManager {
			constructor() {
				this.currentBuilding = null;
				this.walkableData = {
					nodes: {},
					edges: [],
					settings: {},
					metadata: {}
				};
				this.isAdmin = window.location.pathname.includes('admin');
				this.debug = true;
			}

			// ‚úÖ Initialize walkable sync system
			init() {
				this.log('üö∂ Initializing Walkable Sync Manager...');
				
				// Setup storage handlers
				//this.setupStorageHandlers();
				
				// Setup event listeners
				//this.setupEventListeners();
				
				// Load current building data
				//this.loadCurrentBuilding();
				
				this.log('‚úÖ Walkable Sync Manager initialized');
			}

			// ‚úÖ Add walkable node
			addNode(x, y, type = 'grid') {
				const nodeId = `N${Date.now()}`;
				const node = {
					id: nodeId,
					building: this.currentBuilding,
					x: Math.max(0, Math.min(100, parseFloat(x))),
					y: Math.max(0, Math.min(100, parseFloat(y))),
					type: type,
					isActive: true,
					connections: [],
					created: new Date().toISOString()
				};

				this.walkableData.nodes[nodeId] = node;
				this.log(`‚ûï Added node: ${nodeId} at (${node.x}%, ${node.y}%)`);

				// Auto-connect to nearby nodes if enabled
				if (this.getSettings().autoConnect) {
					this.autoConnectNode(nodeId);
				}

				// Update display
				this.updateWalkablePointsDisplay();
				this.updateStatsDisplay();

				// Emit event
				this.emitEvent('nodeAdded', { node });

				return node;
			}
			
			

			// ‚úÖ Update walkable points display
			updateWalkablePointsDisplay() {
				const containers = document.querySelectorAll(
					'.walkable-canvas, .map-area, .mapWrap, #walkableCanvas'
				);

				containers.forEach(container => {
					if (!container) return;

					// Clear existing points
					const existingPoints = container.querySelectorAll('.walkable-point, .node[data-walkable="true"]');
					existingPoints.forEach(point => point.remove());

					// Add current points
					Object.values(this.walkableData.nodes || {}).forEach(node => {
						this.createPointElement(container, node);
					});
				});

				// Update connections
				this.updateWalkableConnectionsDisplay();
			}

			// ‚úÖ Debug logging
			log(...args) {
				if (this.debug) {
					console.log('[WalkableSyncManager]', ...args);
				}
			}
		}
		
		// =================== SIMPLE CACHE DISABLE ===================

		function simpleCacheDisable() {
			// 1. ‡∏•‡πâ‡∏≤‡∏á data cache ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
			const dataCacheKeys = [
				'buildings', 'rooms', 'mapImages', 'batch',
				'sheetsConfig', 'currentMap', 'walkableData',
				'buildingsData', 'roomsData', 'mapsData'
			];
			
			dataCacheKeys.forEach(key => {
				localStorage.removeItem(key);
				localStorage.removeItem(key + '_timestamp');
			});
			
			// ‡∏•‡πâ‡∏≤‡∏á walkable cache ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
			Object.keys(localStorage).forEach(key => {
				if (key.includes('walkableData_')) {
					localStorage.removeItem(key);
				}
			});
			
			// ‡∏•‡πâ‡∏≤‡∏á session storage
			['temp_floorplan', 'temp_realphoto', 'floorplan_uploaded', 'realphoto_uploaded'].forEach(key => {
				sessionStorage.removeItem(key);
			});
			
			// 2. ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ Google Sheets ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
			if (typeof sheetsConfig !== 'undefined') {
				sheetsConfig.lastFetchTime = 0;
				sheetsConfig.cacheEnabled = false;
			}
			
			// ‡∏•‡πâ‡∏≤‡∏á timestamp cache
			['buildings_timestamp', 'rooms_timestamp', 'mapImages_timestamp', 'batch_timestamp'].forEach(key => {
				localStorage.removeItem(key);
			});
			
			// 3. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô clearCacheOnPageLoad ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
			if (typeof clearCacheOnPageLoad === 'function') {
				window.originalClearCacheOnPageLoad = clearCacheOnPageLoad;
				
				window.clearCacheOnPageLoad = function() {
					// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°
					if (window.originalClearCacheOnPageLoad) {
						try {
							window.originalClearCacheOnPageLoad();
						} catch (error) {
							// ignore error
						}
					}
					// ‡∏•‡πâ‡∏≤‡∏á cache ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
					simpleCacheDisable();
				};
			}
		}
		// =================== end of SIMPLE CACHE DISABLE ===================

		// ========== INITIALIZE SYSTEMS ==========
		const mapCoordSystem = new MapCoordinateSystem();
		const walkableSyncManager = new WalkableSyncManager();

		// ‚úÖ Auto-initialize
		function initializeCompleteSystem() {
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', () => {
					setTimeout(() => {
						mapCoordSystem.init();
						walkableSyncManager.init();
					}, 1000);
				});
			} else {
				setTimeout(() => {
					mapCoordSystem.init();
					walkableSyncManager.init();
				}, 1000);
			}
		}

		// ‚úÖ Initialize
		initializeCompleteSystem();

		// ‚úÖ Expose global utilities
		window.MapCoordinateSystem = mapCoordSystem;
		window.WalkableSyncManager = walkableSyncManager;
		window.fixMapCoordinates = () => mapCoordSystem.init();
		window.validateMapSystem = () => mapCoordSystem.validateContainers();
		window.addWalkablePoint = (x, y, type) => walkableSyncManager.addNode(x, y, type);	
			
			
		// ‚úÖ Image error handling
		function handleImageError(img) {
			console.error('‚ùå Failed to load map image:', img.src);
		}

		// ‚úÖ Image load success handling
		function handleImageLoad(img) {
			console.log('‚úÖ Map image loaded successfully:', img.src);
			
			// Initialize coordinate system for this container
			if (window.MapCoordinateSystem) {
				window.MapCoordinateSystem.updateCoordinateSystem();
			}
		}
        // =================== Initialize When Page Loads ===================
        
        document.addEventListener('DOMContentLoaded', function() {
            simpleCacheDisable();
            if (checkLoginStatus()) {
                initializeAdmin();
            }
        });
		
		// ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô login page)
		document.addEventListener('DOMContentLoaded', function() {
			console.log('üéØ Initializing Maps fixes...');
			
			// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
			const isInAdminPage = document.getElementById('adminContainer') && 
								 document.getElementById('adminContainer').style.display !== 'none';
			
			if (isInAdminPage) {
				// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î Maps ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö navigation
				enhanceNavigationWithMaps();
				
				// ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ admin ‡πÅ‡∏•‡∏∞ login ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î Maps
				setTimeout(() => {
					if (typeof isLoggedIn !== 'undefined' && isLoggedIn) {
						console.log('üó∫Ô∏è User logged in, initializing Maps...');
						initializeMapsModule();
					}
				}, 2000);
			} else {
				console.log('üìù In login page, skipping Maps initialization');
			}
			
			// ‡πÄ‡∏û‡∏¥‡πà‡∏° enhancement ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö login ‡πÅ‡∏•‡∏∞ admin initialization
			enhanceLoginHandling(); 
			
			console.log('‚úÖ Maps fixes initialization completed');
		});
		
		// ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ window ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô login page)
		window.addEventListener('load', function() {
			setTimeout(() => {
				// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ admin ‡πÅ‡∏•‡∏∞ login ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
				const isLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
				const adminContainer = document.getElementById('adminContainer');
				const loginContainer = document.getElementById('loginContainer');
				
				if (isLoggedIn && adminContainer && adminContainer.style.display !== 'none') {
					console.log('üîÑ Backup Maps initialization...');
					
					// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Maps ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
					const mapsSection = document.getElementById('maps-section');
					if (mapsSection) {
						initializeMapsModule();
					}
				} else {
					console.log('üìù In login page or not logged in, skipping backup Maps initialization');
				}
			}, 3000);
		});
 
		// Global routing system state
		window.routingSystemReady = false;
		window.walkablePointsReady = false;
		// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ window ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å console
		window.clearMapImageCache = clearMapImageCache;
		window.forceEnableAutoSync = forceEnableAutoSync;
 	
    </script>
</body>
</html>
